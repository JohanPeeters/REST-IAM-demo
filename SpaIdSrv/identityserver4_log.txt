2017-06-10 07:33:29.083 +00:00 [Information] You are using the in-memory version of the persisted grant store. This will store consent decisions, authorization codes, refresh and reference tokens in memory only. If you are using any of those features in production, you want to switch to a different store implementation.
2017-06-10 07:33:29.157 +00:00 [Debug] Using built-in CookieAuthentication middleware with scheme: "idsrv"
2017-06-10 07:33:29.160 +00:00 [Debug] Adding CookieAuthentication middleware for external authentication with scheme: "idsrv.external"
2017-06-10 07:33:29.209 +00:00 [Information] User profile is available. Using '"/root/.aspnet/DataProtection-Keys"' as key repository; keys will not be encrypted at rest.
2017-06-10 07:33:29.858 +00:00 [Information] Request starting HTTP/1.1 GET http://localhost:5005/  
2017-06-10 07:33:29.941 +00:00 [Verbose] No endpoint entry found for request path: "/"
2017-06-10 07:33:29.962 +00:00 [Information] Request finished in 108.7771ms 404 
2017-06-10 07:33:30.247 +00:00 [Information] Request starting HTTP/1.1 GET http://localhost:5005/  
2017-06-10 07:33:30.257 +00:00 [Verbose] No endpoint entry found for request path: "/"
2017-06-10 07:33:30.258 +00:00 [Information] Request finished in 10.7158ms 404 
2017-06-10 07:33:55.440 +00:00 [Information] Request starting HTTP/1.1 GET http://localhost:5005/.well-known/openid-configuration  
2017-06-10 07:33:55.447 +00:00 [Debug] CORS request made for path: "/.well-known/openid-configuration" from origin: "http://localhost:5007"
2017-06-10 07:33:55.450 +00:00 [Debug] Client list checked and origin: "http://localhost:5007" is allowed
2017-06-10 07:33:55.450 +00:00 [Debug] CorsPolicyService allowed origin: "http://localhost:5007"
2017-06-10 07:33:55.454 +00:00 [Debug] Request path "/.well-known/openid-configuration" matched to endpoint type Discovery
2017-06-10 07:33:55.457 +00:00 [Debug] Mapping found for endpoint: Discovery, creating handler: "IdentityServer4.Endpoints.DiscoveryEndpoint"
2017-06-10 07:33:55.459 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.DiscoveryEndpoint" for "/.well-known/openid-configuration"
2017-06-10 07:33:55.461 +00:00 [Verbose] Processing discovery request.
2017-06-10 07:33:55.464 +00:00 [Debug] Start discovery request
2017-06-10 07:33:55.484 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.DiscoveryDocumentResult"
2017-06-10 07:33:55.628 +00:00 [Information] Request finished in 187.8001ms 200 application/json
2017-06-10 07:33:55.639 +00:00 [Information] Request starting HTTP/1.1 GET http://localhost:5005/connect/authorize?client_id=spaclient&redirect_uri=http%3A%2F%2Flocalhost%3A5007%2Fcallback.html&response_type=id_token%20token&scope=openid%20profile%20productapi&state=8c2d903cd0be4717a9b331bf68a7c8f3&nonce=08f90b7bd3794e8280fd14f043515d07  
2017-06-10 07:33:55.640 +00:00 [Debug] Request path "/connect/authorize" matched to endpoint type Authorize
2017-06-10 07:33:55.640 +00:00 [Debug] Mapping found for endpoint: Authorize, creating handler: "IdentityServer4.Endpoints.AuthorizeEndpoint"
2017-06-10 07:33:55.650 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.AuthorizeEndpoint" for "/connect/authorize"
2017-06-10 07:33:55.672 +00:00 [Debug] Start authorize request
2017-06-10 07:33:55.745 +00:00 [Debug] No user present in authorize request
2017-06-10 07:33:55.750 +00:00 [Debug] Start authorize request protocol validation
2017-06-10 07:33:55.783 +00:00 [Error] Invalid scope: "openid"
2017-06-10 07:33:55.788 +00:00 [Error] Request validation failed
2017-06-10 07:33:55.811 +00:00 [Information] "{
  \"ClientId\": \"spaclient\",
  \"ClientName\": \"SPAClient\",
  \"RedirectUri\": \"http://localhost:5007/callback.html\",
  \"AllowedRedirectUris\": [
    \"http://localhost:5007/callback.html\"
  ],
  \"SubjectId\": \"anonymous\",
  \"ResponseType\": \"id_token token\",
  \"ResponseMode\": \"fragment\",
  \"GrantType\": \"implicit\",
  \"RequestedScopes\": \"openid profile productapi\",
  \"State\": \"8c2d903cd0be4717a9b331bf68a7c8f3\",
  \"Raw\": {
    \"client_id\": \"spaclient\",
    \"redirect_uri\": \"http://localhost:5007/callback.html\",
    \"response_type\": \"id_token token\",
    \"scope\": \"openid profile productapi\",
    \"state\": \"8c2d903cd0be4717a9b331bf68a7c8f3\",
    \"nonce\": \"08f90b7bd3794e8280fd14f043515d07\"
  }
}"
2017-06-10 07:33:55.822 +00:00 [Verbose] End authorize request. result type: "IdentityServer4.Endpoints.Results.AuthorizeResult"
2017-06-10 07:33:55.823 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.AuthorizeResult"
2017-06-10 07:33:55.841 +00:00 [Verbose] Protecting message: "{\"Id\":\"13515735a82c853a4cfaa72cfa345ecc\",\"Created\":636326768358319820,\"Data\":{\"Error\":\"invalid_scope\",\"RequestId\":\"0HL5FQBUPEGDU\"}}"
2017-06-10 07:33:55.888 +00:00 [Information] Request finished in 248.2097ms 302 
2017-06-10 07:33:55.894 +00:00 [Information] Request starting HTTP/1.1 GET http://localhost:5005/home/error?errorId=13515735a82c853a4cfaa72cfa345ecc  
2017-06-10 07:33:55.895 +00:00 [Verbose] No endpoint entry found for request path: "/home/error"
2017-06-10 07:33:55.896 +00:00 [Information] Request finished in 1.9048ms 404 
2017-06-10 07:37:31.446 +00:00 [Information] You are using the in-memory version of the persisted grant store. This will store consent decisions, authorization codes, refresh and reference tokens in memory only. If you are using any of those features in production, you want to switch to a different store implementation.
2017-06-10 07:37:31.509 +00:00 [Debug] Using built-in CookieAuthentication middleware with scheme: "idsrv"
2017-06-10 07:37:31.514 +00:00 [Debug] Adding CookieAuthentication middleware for external authentication with scheme: "idsrv.external"
2017-06-10 07:37:31.575 +00:00 [Information] User profile is available. Using '"/root/.aspnet/DataProtection-Keys"' as key repository; keys will not be encrypted at rest.
2017-06-10 07:37:32.047 +00:00 [Information] Request starting HTTP/1.1 GET http://localhost:5005/  
2017-06-10 07:37:32.140 +00:00 [Verbose] No endpoint entry found for request path: "/"
2017-06-10 07:37:32.169 +00:00 [Information] Request finished in 133.1198ms 404 
2017-06-10 07:37:32.435 +00:00 [Information] Request starting HTTP/1.1 GET http://localhost:5005/  
2017-06-10 07:37:32.443 +00:00 [Verbose] No endpoint entry found for request path: "/"
2017-06-10 07:37:32.449 +00:00 [Information] Request finished in 14.3094ms 404 
2017-06-10 07:46:22.966 +00:00 [Information] You are using the in-memory version of the persisted grant store. This will store consent decisions, authorization codes, refresh and reference tokens in memory only. If you are using any of those features in production, you want to switch to a different store implementation.
2017-06-10 07:46:23.050 +00:00 [Debug] Using built-in CookieAuthentication middleware with scheme: "idsrv"
2017-06-10 07:46:23.058 +00:00 [Debug] Adding CookieAuthentication middleware for external authentication with scheme: "idsrv.external"
2017-06-10 07:46:23.134 +00:00 [Information] User profile is available. Using '"/root/.aspnet/DataProtection-Keys"' as key repository; keys will not be encrypted at rest.
2017-06-10 07:46:23.560 +00:00 [Information] Request starting HTTP/1.1 GET http://localhost:5005/  
2017-06-10 07:46:23.649 +00:00 [Verbose] No endpoint entry found for request path: "/"
2017-06-10 07:46:23.674 +00:00 [Information] Request finished in 118.2996ms 404 
2017-06-10 07:46:23.911 +00:00 [Information] Request starting HTTP/1.1 GET http://localhost:5005/  
2017-06-10 07:46:23.930 +00:00 [Verbose] No endpoint entry found for request path: "/"
2017-06-10 07:46:23.934 +00:00 [Information] Request finished in 22.6663ms 404 
2017-06-10 07:46:30.352 +00:00 [Information] Request starting HTTP/1.1 GET http://localhost:5005/.well-known/openid-configuration  
2017-06-10 07:46:30.361 +00:00 [Debug] CORS request made for path: "/.well-known/openid-configuration" from origin: "http://localhost:5007"
2017-06-10 07:46:30.365 +00:00 [Debug] Client list checked and origin: "http://localhost:5007" is allowed
2017-06-10 07:46:30.366 +00:00 [Debug] CorsPolicyService allowed origin: "http://localhost:5007"
2017-06-10 07:46:30.371 +00:00 [Debug] Request path "/.well-known/openid-configuration" matched to endpoint type Discovery
2017-06-10 07:46:30.374 +00:00 [Debug] Mapping found for endpoint: Discovery, creating handler: "IdentityServer4.Endpoints.DiscoveryEndpoint"
2017-06-10 07:46:30.376 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.DiscoveryEndpoint" for "/.well-known/openid-configuration"
2017-06-10 07:46:30.378 +00:00 [Verbose] Processing discovery request.
2017-06-10 07:46:30.381 +00:00 [Debug] Start discovery request
2017-06-10 07:46:30.402 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.DiscoveryDocumentResult"
2017-06-10 07:46:30.554 +00:00 [Information] Request finished in 202.4583ms 200 application/json
2017-06-10 07:46:30.576 +00:00 [Information] Request starting HTTP/1.1 GET http://localhost:5005/connect/authorize?client_id=spaclient&redirect_uri=http%3A%2F%2Flocalhost%3A5007%2Fcallback.html&response_type=id_token%20token&scope=openid%20profile%20productapi&state=11f8489714d54f02be21f425563651ae&nonce=193e4047884b48949f723a16dfbe8a54  
2017-06-10 07:46:30.576 +00:00 [Debug] Request path "/connect/authorize" matched to endpoint type Authorize
2017-06-10 07:46:30.577 +00:00 [Debug] Mapping found for endpoint: Authorize, creating handler: "IdentityServer4.Endpoints.AuthorizeEndpoint"
2017-06-10 07:46:30.584 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.AuthorizeEndpoint" for "/connect/authorize"
2017-06-10 07:46:30.607 +00:00 [Debug] Start authorize request
2017-06-10 07:46:30.665 +00:00 [Debug] No user present in authorize request
2017-06-10 07:46:30.670 +00:00 [Debug] Start authorize request protocol validation
2017-06-10 07:46:30.717 +00:00 [Debug] Calling into custom validator: "IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator"
2017-06-10 07:46:30.718 +00:00 [Verbose] Authorize request protocol validation successful
2017-06-10 07:46:30.741 +00:00 [Information] ValidatedAuthorizeRequest
"{
  \"ClientId\": \"spaclient\",
  \"ClientName\": \"SPAClient\",
  \"RedirectUri\": \"http://localhost:5007/callback.html\",
  \"AllowedRedirectUris\": [
    \"http://localhost:5007/callback.html\"
  ],
  \"SubjectId\": \"anonymous\",
  \"ResponseType\": \"id_token token\",
  \"ResponseMode\": \"fragment\",
  \"GrantType\": \"implicit\",
  \"RequestedScopes\": \"openid profile productapi\",
  \"State\": \"11f8489714d54f02be21f425563651ae\",
  \"Nonce\": \"193e4047884b48949f723a16dfbe8a54\",
  \"Raw\": {
    \"client_id\": \"spaclient\",
    \"redirect_uri\": \"http://localhost:5007/callback.html\",
    \"response_type\": \"id_token token\",
    \"scope\": \"openid profile productapi\",
    \"state\": \"11f8489714d54f02be21f425563651ae\",
    \"nonce\": \"193e4047884b48949f723a16dfbe8a54\"
  }
}"
2017-06-10 07:46:30.750 +00:00 [Verbose] ProcessInteractionAsync
2017-06-10 07:46:30.754 +00:00 [Information] Showing login: User is not authenticated
2017-06-10 07:46:30.756 +00:00 [Verbose] End authorize request. result type: "IdentityServer4.Endpoints.Results.LoginPageResult"
2017-06-10 07:46:30.756 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.LoginPageResult"
2017-06-10 07:46:30.773 +00:00 [Information] Request finished in 197.5798ms 302 
2017-06-10 07:46:30.774 +00:00 [Information] Request starting HTTP/1.1 GET http://localhost:5005/account/login?returnUrl=%2Fconnect%2Fauthorize%2Flogin%3Fclient_id%3Dspaclient%26redirect_uri%3Dhttp%253A%252F%252Flocalhost%253A5007%252Fcallback.html%26response_type%3Did_token%2520token%26scope%3Dopenid%2520profile%2520productapi%26state%3D11f8489714d54f02be21f425563651ae%26nonce%3D193e4047884b48949f723a16dfbe8a54  
2017-06-10 07:46:30.774 +00:00 [Verbose] No endpoint entry found for request path: "/account/login"
2017-06-10 07:46:30.774 +00:00 [Information] Request finished in 0.3206ms 404 
2017-06-10 07:46:39.953 +00:00 [Information] Request starting HTTP/1.1 GET http://localhost:5005/.well-known/openid-configuration  
2017-06-10 07:46:39.953 +00:00 [Debug] CORS request made for path: "/.well-known/openid-configuration" from origin: "http://localhost:5007"
2017-06-10 07:46:39.954 +00:00 [Debug] Client list checked and origin: "http://localhost:5007" is allowed
2017-06-10 07:46:39.954 +00:00 [Debug] CorsPolicyService allowed origin: "http://localhost:5007"
2017-06-10 07:46:39.955 +00:00 [Debug] Request path "/.well-known/openid-configuration" matched to endpoint type Discovery
2017-06-10 07:46:39.955 +00:00 [Debug] Mapping found for endpoint: Discovery, creating handler: "IdentityServer4.Endpoints.DiscoveryEndpoint"
2017-06-10 07:46:39.956 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.DiscoveryEndpoint" for "/.well-known/openid-configuration"
2017-06-10 07:46:39.957 +00:00 [Verbose] Processing discovery request.
2017-06-10 07:46:39.958 +00:00 [Debug] Start discovery request
2017-06-10 07:46:39.958 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.DiscoveryDocumentResult"
2017-06-10 07:46:39.960 +00:00 [Information] Request finished in 6.546ms 200 application/json
2017-06-10 07:46:39.982 +00:00 [Information] Request starting HTTP/1.1 GET http://localhost:5005/connect/authorize?client_id=spaclient&redirect_uri=http%3A%2F%2Flocalhost%3A5007%2Fcallback.html&response_type=id_token%20token&scope=openid%20profile%20productapi&state=37c8a133eb2041129700de3628ff820a&nonce=0a8f97e5a6b34026b0ee27e67a5c5cb6  
2017-06-10 07:46:39.983 +00:00 [Debug] Request path "/connect/authorize" matched to endpoint type Authorize
2017-06-10 07:46:39.984 +00:00 [Debug] Mapping found for endpoint: Authorize, creating handler: "IdentityServer4.Endpoints.AuthorizeEndpoint"
2017-06-10 07:46:39.985 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.AuthorizeEndpoint" for "/connect/authorize"
2017-06-10 07:46:39.985 +00:00 [Debug] Start authorize request
2017-06-10 07:46:39.986 +00:00 [Debug] No user present in authorize request
2017-06-10 07:46:39.987 +00:00 [Debug] Start authorize request protocol validation
2017-06-10 07:46:39.988 +00:00 [Debug] Calling into custom validator: "IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator"
2017-06-10 07:46:39.988 +00:00 [Verbose] Authorize request protocol validation successful
2017-06-10 07:46:39.994 +00:00 [Information] ValidatedAuthorizeRequest
"{
  \"ClientId\": \"spaclient\",
  \"ClientName\": \"SPAClient\",
  \"RedirectUri\": \"http://localhost:5007/callback.html\",
  \"AllowedRedirectUris\": [
    \"http://localhost:5007/callback.html\"
  ],
  \"SubjectId\": \"anonymous\",
  \"ResponseType\": \"id_token token\",
  \"ResponseMode\": \"fragment\",
  \"GrantType\": \"implicit\",
  \"RequestedScopes\": \"openid profile productapi\",
  \"State\": \"37c8a133eb2041129700de3628ff820a\",
  \"Nonce\": \"0a8f97e5a6b34026b0ee27e67a5c5cb6\",
  \"Raw\": {
    \"client_id\": \"spaclient\",
    \"redirect_uri\": \"http://localhost:5007/callback.html\",
    \"response_type\": \"id_token token\",
    \"scope\": \"openid profile productapi\",
    \"state\": \"37c8a133eb2041129700de3628ff820a\",
    \"nonce\": \"0a8f97e5a6b34026b0ee27e67a5c5cb6\"
  }
}"
2017-06-10 07:46:39.995 +00:00 [Verbose] ProcessInteractionAsync
2017-06-10 07:46:39.995 +00:00 [Information] Showing login: User is not authenticated
2017-06-10 07:46:39.996 +00:00 [Verbose] End authorize request. result type: "IdentityServer4.Endpoints.Results.LoginPageResult"
2017-06-10 07:46:39.996 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.LoginPageResult"
2017-06-10 07:46:39.999 +00:00 [Information] Request finished in 17.5332ms 302 
2017-06-10 07:46:40.016 +00:00 [Information] Request starting HTTP/1.1 GET http://localhost:5005/account/login?returnUrl=%2Fconnect%2Fauthorize%2Flogin%3Fclient_id%3Dspaclient%26redirect_uri%3Dhttp%253A%252F%252Flocalhost%253A5007%252Fcallback.html%26response_type%3Did_token%2520token%26scope%3Dopenid%2520profile%2520productapi%26state%3D37c8a133eb2041129700de3628ff820a%26nonce%3D0a8f97e5a6b34026b0ee27e67a5c5cb6  
2017-06-10 07:46:40.017 +00:00 [Verbose] No endpoint entry found for request path: "/account/login"
2017-06-10 07:46:40.018 +00:00 [Information] Request finished in 1.5365ms 404 
2017-06-10 07:46:43.080 +00:00 [Information] Request starting HTTP/1.1 GET http://localhost:5005/account/login?returnUrl=%2Fconnect%2Fauthorize%2Flogin%3Fclient_id%3Dspaclient%26redirect_uri%3Dhttp%253A%252F%252Flocalhost%253A5007%252Fcallback.html%26response_type%3Did_token%2520token%26scope%3Dopenid%2520profile%2520productapi%26state%3D37c8a133eb2041129700de3628ff820a%26nonce%3D0a8f97e5a6b34026b0ee27e67a5c5cb6  
2017-06-10 07:46:43.080 +00:00 [Verbose] No endpoint entry found for request path: "/account/login"
2017-06-10 07:46:43.081 +00:00 [Information] Request finished in 0.429ms 404 
2017-06-10 07:46:58.048 +00:00 [Information] Request starting HTTP/1.1 GET http://localhost:5005/.well-known/openid-configuration  
2017-06-10 07:46:58.048 +00:00 [Debug] CORS request made for path: "/.well-known/openid-configuration" from origin: "http://localhost:5007"
2017-06-10 07:46:58.048 +00:00 [Debug] Client list checked and origin: "http://localhost:5007" is allowed
2017-06-10 07:46:58.048 +00:00 [Debug] CorsPolicyService allowed origin: "http://localhost:5007"
2017-06-10 07:46:58.049 +00:00 [Debug] Request path "/.well-known/openid-configuration" matched to endpoint type Discovery
2017-06-10 07:46:58.050 +00:00 [Debug] Mapping found for endpoint: Discovery, creating handler: "IdentityServer4.Endpoints.DiscoveryEndpoint"
2017-06-10 07:46:58.050 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.DiscoveryEndpoint" for "/.well-known/openid-configuration"
2017-06-10 07:46:58.050 +00:00 [Verbose] Processing discovery request.
2017-06-10 07:46:58.051 +00:00 [Debug] Start discovery request
2017-06-10 07:46:58.051 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.DiscoveryDocumentResult"
2017-06-10 07:46:58.052 +00:00 [Information] Request finished in 4.1846ms 200 application/json
2017-06-10 07:46:58.064 +00:00 [Information] Request starting HTTP/1.1 GET http://localhost:5005/connect/endsession?post_logout_redirect_uri=http%3A%2F%2Flocalhost%3A5007%2Findex.html  
2017-06-10 07:46:58.065 +00:00 [Debug] Request path "/connect/endsession" matched to endpoint type EndSession
2017-06-10 07:46:58.065 +00:00 [Debug] Mapping found for endpoint: EndSession, creating handler: "IdentityServer4.Endpoints.EndSessionEndpoint"
2017-06-10 07:46:58.067 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.EndSessionEndpoint" for "/connect/endsession"
2017-06-10 07:46:58.079 +00:00 [Debug] Processing signout request for "anonymous"
2017-06-10 07:46:58.085 +00:00 [Debug] Start end session request validation
2017-06-10 07:46:58.091 +00:00 [Information] End session request validation success
"{
  \"SubjectId\": \"unknown\",
  \"Raw\": {
    \"post_logout_redirect_uri\": \"http://localhost:5007/index.html\"
  }
}"
2017-06-10 07:46:58.091 +00:00 [Debug] Success validating end session request from null
2017-06-10 07:46:58.094 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.EndSessionResult"
2017-06-10 07:46:58.112 +00:00 [Verbose] Protecting message: "{\"Id\":\"d162d8c81aef3182b613b1677f696157\",\"Created\":636326776180992750,\"Data\":{\"Parameters\":[{\"Key\":\"post_logout_redirect_uri\",\"Values\":[\"http://localhost:5007/index.html\"]}],\"ShowSignoutPrompt\":true}}"
2017-06-10 07:46:58.158 +00:00 [Information] Request finished in 94.6255ms 302 
2017-06-10 07:46:58.164 +00:00 [Information] Request starting HTTP/1.1 GET http://localhost:5005/account/logout?logoutId=d162d8c81aef3182b613b1677f696157  
2017-06-10 07:46:58.165 +00:00 [Verbose] No endpoint entry found for request path: "/account/logout"
2017-06-10 07:46:58.166 +00:00 [Information] Request finished in 1.7537ms 404 
2017-06-10 07:47:02.207 +00:00 [Information] Request starting HTTP/1.1 GET http://localhost:5005/.well-known/openid-configuration  
2017-06-10 07:47:02.207 +00:00 [Debug] CORS request made for path: "/.well-known/openid-configuration" from origin: "http://localhost:5007"
2017-06-10 07:47:02.208 +00:00 [Debug] Client list checked and origin: "http://localhost:5007" is allowed
2017-06-10 07:47:02.208 +00:00 [Debug] CorsPolicyService allowed origin: "http://localhost:5007"
2017-06-10 07:47:02.208 +00:00 [Debug] Request path "/.well-known/openid-configuration" matched to endpoint type Discovery
2017-06-10 07:47:02.208 +00:00 [Debug] Mapping found for endpoint: Discovery, creating handler: "IdentityServer4.Endpoints.DiscoveryEndpoint"
2017-06-10 07:47:02.209 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.DiscoveryEndpoint" for "/.well-known/openid-configuration"
2017-06-10 07:47:02.209 +00:00 [Verbose] Processing discovery request.
2017-06-10 07:47:02.209 +00:00 [Debug] Start discovery request
2017-06-10 07:47:02.210 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.DiscoveryDocumentResult"
2017-06-10 07:47:02.210 +00:00 [Information] Request finished in 3.3944ms 200 application/json
2017-06-10 07:47:02.222 +00:00 [Information] Request starting HTTP/1.1 GET http://localhost:5005/connect/authorize?client_id=spaclient&redirect_uri=http%3A%2F%2Flocalhost%3A5007%2Fcallback.html&response_type=id_token%20token&scope=openid%20profile%20productapi&state=331ee4662ffe4cbd866c0a7f203f8ed1&nonce=43036b7cd686404694d94062f173380e  
2017-06-10 07:47:02.222 +00:00 [Debug] Request path "/connect/authorize" matched to endpoint type Authorize
2017-06-10 07:47:02.222 +00:00 [Debug] Mapping found for endpoint: Authorize, creating handler: "IdentityServer4.Endpoints.AuthorizeEndpoint"
2017-06-10 07:47:02.222 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.AuthorizeEndpoint" for "/connect/authorize"
2017-06-10 07:47:02.222 +00:00 [Debug] Start authorize request
2017-06-10 07:47:02.222 +00:00 [Debug] No user present in authorize request
2017-06-10 07:47:02.222 +00:00 [Debug] Start authorize request protocol validation
2017-06-10 07:47:02.223 +00:00 [Debug] Calling into custom validator: "IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator"
2017-06-10 07:47:02.223 +00:00 [Verbose] Authorize request protocol validation successful
2017-06-10 07:47:02.223 +00:00 [Information] ValidatedAuthorizeRequest
"{
  \"ClientId\": \"spaclient\",
  \"ClientName\": \"SPAClient\",
  \"RedirectUri\": \"http://localhost:5007/callback.html\",
  \"AllowedRedirectUris\": [
    \"http://localhost:5007/callback.html\"
  ],
  \"SubjectId\": \"anonymous\",
  \"ResponseType\": \"id_token token\",
  \"ResponseMode\": \"fragment\",
  \"GrantType\": \"implicit\",
  \"RequestedScopes\": \"openid profile productapi\",
  \"State\": \"331ee4662ffe4cbd866c0a7f203f8ed1\",
  \"Nonce\": \"43036b7cd686404694d94062f173380e\",
  \"Raw\": {
    \"client_id\": \"spaclient\",
    \"redirect_uri\": \"http://localhost:5007/callback.html\",
    \"response_type\": \"id_token token\",
    \"scope\": \"openid profile productapi\",
    \"state\": \"331ee4662ffe4cbd866c0a7f203f8ed1\",
    \"nonce\": \"43036b7cd686404694d94062f173380e\"
  }
}"
2017-06-10 07:47:02.223 +00:00 [Verbose] ProcessInteractionAsync
2017-06-10 07:47:02.223 +00:00 [Information] Showing login: User is not authenticated
2017-06-10 07:47:02.224 +00:00 [Verbose] End authorize request. result type: "IdentityServer4.Endpoints.Results.LoginPageResult"
2017-06-10 07:47:02.224 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.LoginPageResult"
2017-06-10 07:47:02.224 +00:00 [Information] Request finished in 2.1586ms 302 
2017-06-10 07:47:02.233 +00:00 [Information] Request starting HTTP/1.1 GET http://localhost:5005/account/login?returnUrl=%2Fconnect%2Fauthorize%2Flogin%3Fclient_id%3Dspaclient%26redirect_uri%3Dhttp%253A%252F%252Flocalhost%253A5007%252Fcallback.html%26response_type%3Did_token%2520token%26scope%3Dopenid%2520profile%2520productapi%26state%3D331ee4662ffe4cbd866c0a7f203f8ed1%26nonce%3D43036b7cd686404694d94062f173380e  
2017-06-10 07:47:02.234 +00:00 [Verbose] No endpoint entry found for request path: "/account/login"
2017-06-10 07:47:02.236 +00:00 [Information] Request finished in 2.9593ms 404 
2017-06-10 07:47:55.680 +00:00 [Information] Request starting HTTP/1.1 GET http://localhost:5005/.well-known/openid-configuration  
2017-06-10 07:47:55.682 +00:00 [Debug] Request path "/.well-known/openid-configuration" matched to endpoint type Discovery
2017-06-10 07:47:55.682 +00:00 [Debug] Mapping found for endpoint: Discovery, creating handler: "IdentityServer4.Endpoints.DiscoveryEndpoint"
2017-06-10 07:47:55.683 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.DiscoveryEndpoint" for "/.well-known/openid-configuration"
2017-06-10 07:47:55.683 +00:00 [Verbose] Processing discovery request.
2017-06-10 07:47:55.684 +00:00 [Debug] Start discovery request
2017-06-10 07:47:55.685 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.DiscoveryDocumentResult"
2017-06-10 07:47:55.687 +00:00 [Information] Request finished in 27.4662ms 200 application/json
2017-06-10 07:47:55.891 +00:00 [Information] Request starting HTTP/1.1 GET http://localhost:5005/favicon.ico  
2017-06-10 07:47:55.892 +00:00 [Verbose] No endpoint entry found for request path: "/favicon.ico"
2017-06-10 07:47:55.892 +00:00 [Information] Request finished in 1.7192ms 404 
2017-06-10 09:55:38.396 +02:00 [Information] You are using the in-memory version of the persisted grant store. This will store consent decisions, authorization codes, refresh and reference tokens in memory only. If you are using any of those features in production, you want to switch to a different store implementation.
2017-06-10 09:55:38.464 +02:00 [Debug] Using built-in CookieAuthentication middleware with scheme: "idsrv"
2017-06-10 09:55:38.472 +02:00 [Debug] Adding CookieAuthentication middleware for external authentication with scheme: "idsrv.external"
2017-06-10 09:55:38.552 +02:00 [Information] User profile is available. Using '"C:\Users\Michael\AppData\Local\ASP.NET\DataProtection-Keys"' as key repository and Windows DPAPI to encrypt keys at rest.
2017-06-10 09:55:38.817 +02:00 [Fatal] Unable to start Kestrel.
System.IO.IOException: Failed to bind to address http://0.0.0.0:5005: address already in use. ---> System.AggregateException: One or more errors occurred. (Error -4091 EADDRINUSE address already in use) ---> Microsoft.AspNetCore.Server.Kestrel.Internal.Networking.UvException: Error -4091 EADDRINUSE address already in use
   at Microsoft.AspNetCore.Server.Kestrel.Internal.Networking.Libuv.ThrowError(Int32 statusCode)
   at Microsoft.AspNetCore.Server.Kestrel.Internal.Networking.Libuv.tcp_getsockname(UvTcpHandle handle, SockAddr& addr, Int32& namelen)
   at Microsoft.AspNetCore.Server.Kestrel.Internal.Networking.UvTcpHandle.GetSockIPEndPoint()
   at Microsoft.AspNetCore.Server.Kestrel.Internal.Http.TcpListenerPrimary.CreateListenSocket()
   at Microsoft.AspNetCore.Server.Kestrel.Internal.Http.Listener.<StartAsync>b__8_0(Object state)
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at Microsoft.AspNetCore.Server.Kestrel.Internal.Http.ListenerPrimary.<StartAsync>d__12.MoveNext()
   --- End of inner exception stack trace ---
   at System.Threading.Tasks.Task.ThrowIfExceptional(Boolean includeTaskCanceledExceptions)
   at System.Threading.Tasks.Task.Wait(Int32 millisecondsTimeout, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Internal.KestrelEngine.CreateServer(ServerAddress address)
   at Microsoft.AspNetCore.Server.Kestrel.KestrelServer.Start[TContext](IHttpApplication`1 application)
   --- End of inner exception stack trace ---
   at Microsoft.AspNetCore.Server.Kestrel.KestrelServer.Start[TContext](IHttpApplication`1 application)
2017-06-10 07:59:55.556 +00:00 [Information] You are using the in-memory version of the persisted grant store. This will store consent decisions, authorization codes, refresh and reference tokens in memory only. If you are using any of those features in production, you want to switch to a different store implementation.
2017-06-10 07:59:55.632 +00:00 [Debug] Using built-in CookieAuthentication middleware with scheme: "idsrv"
2017-06-10 07:59:55.636 +00:00 [Debug] Adding CookieAuthentication middleware for external authentication with scheme: "idsrv.external"
2017-06-10 07:59:55.734 +00:00 [Information] User profile is available. Using '"/root/.aspnet/DataProtection-Keys"' as key repository; keys will not be encrypted at rest.
2017-06-10 08:06:02.141 +00:00 [Information] You are using the in-memory version of the persisted grant store. This will store consent decisions, authorization codes, refresh and reference tokens in memory only. If you are using any of those features in production, you want to switch to a different store implementation.
2017-06-10 08:06:02.220 +00:00 [Debug] Using built-in CookieAuthentication middleware with scheme: "idsrv"
2017-06-10 08:06:02.224 +00:00 [Debug] Adding CookieAuthentication middleware for external authentication with scheme: "idsrv.external"
2017-06-10 08:06:02.316 +00:00 [Information] User profile is available. Using '"/root/.aspnet/DataProtection-Keys"' as key repository; keys will not be encrypted at rest.
2017-06-10 08:23:35.484 +00:00 [Information] You are using the in-memory version of the persisted grant store. This will store consent decisions, authorization codes, refresh and reference tokens in memory only. If you are using any of those features in production, you want to switch to a different store implementation.
2017-06-10 08:23:35.559 +00:00 [Debug] Using built-in CookieAuthentication middleware with scheme: "idsrv"
2017-06-10 08:23:35.561 +00:00 [Debug] Adding CookieAuthentication middleware for external authentication with scheme: "idsrv.external"
2017-06-10 08:23:35.633 +00:00 [Information] User profile is available. Using '"/root/.aspnet/DataProtection-Keys"' as key repository; keys will not be encrypted at rest.
2017-06-10 08:25:05.199 +00:00 [Information] Request starting HTTP/1.1 GET http://localhost:5005/.well-known/openid-configuration  
2017-06-10 08:25:05.214 +00:00 [Debug] CORS request made for path: "/.well-known/openid-configuration" from origin: "http://localhost:5007"
2017-06-10 08:25:05.220 +00:00 [Debug] Client list checked and origin: "http://localhost:5007" is allowed
2017-06-10 08:25:05.220 +00:00 [Debug] CorsPolicyService allowed origin: "http://localhost:5007"
2017-06-10 08:25:05.279 +00:00 [Debug] Request path "/.well-known/openid-configuration" matched to endpoint type Discovery
2017-06-10 08:25:05.283 +00:00 [Debug] Mapping found for endpoint: Discovery, creating handler: "IdentityServer4.Endpoints.DiscoveryEndpoint"
2017-06-10 08:25:05.287 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.DiscoveryEndpoint" for "/.well-known/openid-configuration"
2017-06-10 08:25:05.289 +00:00 [Verbose] Processing discovery request.
2017-06-10 08:25:05.294 +00:00 [Debug] Start discovery request
2017-06-10 08:25:05.314 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.DiscoveryDocumentResult"
2017-06-10 08:25:05.486 +00:00 [Information] Request finished in 294.5561ms 200 application/json
2017-06-10 08:25:05.499 +00:00 [Information] Request starting HTTP/1.1 GET http://localhost:5005/connect/authorize?client_id=spaclient&redirect_uri=http%3A%2F%2Flocalhost%3A5007%2Fcallback.html&response_type=id_token%20token&scope=openid%20profile%20productapi&state=80b5f3ce9fa2406fa894b414b4b8e9d8&nonce=3c467d7cdf99473f96fcf7786931b14b  
2017-06-10 08:25:05.509 +00:00 [Debug] Request path "/connect/authorize" matched to endpoint type Authorize
2017-06-10 08:25:05.510 +00:00 [Debug] Mapping found for endpoint: Authorize, creating handler: "IdentityServer4.Endpoints.AuthorizeEndpoint"
2017-06-10 08:25:05.519 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.AuthorizeEndpoint" for "/connect/authorize"
2017-06-10 08:25:05.541 +00:00 [Debug] Start authorize request
2017-06-10 08:25:05.620 +00:00 [Debug] No user present in authorize request
2017-06-10 08:25:05.625 +00:00 [Debug] Start authorize request protocol validation
2017-06-10 08:25:05.669 +00:00 [Debug] Calling into custom validator: "IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator"
2017-06-10 08:25:05.672 +00:00 [Verbose] Authorize request protocol validation successful
2017-06-10 08:25:05.693 +00:00 [Information] ValidatedAuthorizeRequest
"{
  \"ClientId\": \"spaclient\",
  \"ClientName\": \"SPAClient\",
  \"RedirectUri\": \"http://localhost:5007/callback.html\",
  \"AllowedRedirectUris\": [
    \"http://localhost:5007/callback.html\"
  ],
  \"SubjectId\": \"anonymous\",
  \"ResponseType\": \"id_token token\",
  \"ResponseMode\": \"fragment\",
  \"GrantType\": \"implicit\",
  \"RequestedScopes\": \"openid profile productapi\",
  \"State\": \"80b5f3ce9fa2406fa894b414b4b8e9d8\",
  \"Nonce\": \"3c467d7cdf99473f96fcf7786931b14b\",
  \"Raw\": {
    \"client_id\": \"spaclient\",
    \"redirect_uri\": \"http://localhost:5007/callback.html\",
    \"response_type\": \"id_token token\",
    \"scope\": \"openid profile productapi\",
    \"state\": \"80b5f3ce9fa2406fa894b414b4b8e9d8\",
    \"nonce\": \"3c467d7cdf99473f96fcf7786931b14b\"
  }
}"
2017-06-10 08:25:05.700 +00:00 [Verbose] ProcessInteractionAsync
2017-06-10 08:25:05.708 +00:00 [Information] Showing login: User is not authenticated
2017-06-10 08:25:05.709 +00:00 [Verbose] End authorize request. result type: "IdentityServer4.Endpoints.Results.LoginPageResult"
2017-06-10 08:25:05.710 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.LoginPageResult"
2017-06-10 08:25:05.720 +00:00 [Information] Request finished in 220.9224ms 302 
2017-06-10 08:25:05.728 +00:00 [Information] Request starting HTTP/1.1 GET http://localhost:5005/account/login?returnUrl=%2Fconnect%2Fauthorize%2Flogin%3Fclient_id%3Dspaclient%26redirect_uri%3Dhttp%253A%252F%252Flocalhost%253A5007%252Fcallback.html%26response_type%3Did_token%2520token%26scope%3Dopenid%2520profile%2520productapi%26state%3D80b5f3ce9fa2406fa894b414b4b8e9d8%26nonce%3D3c467d7cdf99473f96fcf7786931b14b  
2017-06-10 08:25:05.729 +00:00 [Verbose] No endpoint entry found for request path: "/account/login"
2017-06-10 08:25:05.729 +00:00 [Information] Request finished in 0.9865ms 404 
2017-06-10 08:34:10.527 +00:00 [Information] You are using the in-memory version of the persisted grant store. This will store consent decisions, authorization codes, refresh and reference tokens in memory only. If you are using any of those features in production, you want to switch to a different store implementation.
2017-06-10 08:34:10.597 +00:00 [Debug] Using built-in CookieAuthentication middleware with scheme: "idsrv"
2017-06-10 08:34:10.603 +00:00 [Debug] Adding CookieAuthentication middleware for external authentication with scheme: "idsrv.external"
2017-06-10 08:34:10.899 +00:00 [Information] User profile is available. Using '"/root/.aspnet/DataProtection-Keys"' as key repository; keys will not be encrypted at rest.
2017-06-10 08:34:24.100 +00:00 [Information] Request starting HTTP/1.1 GET http://localhost:5005/.well-known/openid-configuration  
2017-06-10 08:34:24.115 +00:00 [Debug] CORS request made for path: "/.well-known/openid-configuration" from origin: "http://localhost:5007"
2017-06-10 08:34:24.121 +00:00 [Debug] Client list checked and origin: "http://localhost:5007" is allowed
2017-06-10 08:34:24.122 +00:00 [Debug] CorsPolicyService allowed origin: "http://localhost:5007"
2017-06-10 08:34:24.169 +00:00 [Debug] Request path "/.well-known/openid-configuration" matched to endpoint type Discovery
2017-06-10 08:34:24.172 +00:00 [Debug] Mapping found for endpoint: Discovery, creating handler: "IdentityServer4.Endpoints.DiscoveryEndpoint"
2017-06-10 08:34:24.175 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.DiscoveryEndpoint" for "/.well-known/openid-configuration"
2017-06-10 08:34:24.179 +00:00 [Verbose] Processing discovery request.
2017-06-10 08:34:24.184 +00:00 [Debug] Start discovery request
2017-06-10 08:34:24.208 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.DiscoveryDocumentResult"
2017-06-10 08:34:24.332 +00:00 [Information] Request finished in 238.3206ms 200 application/json
2017-06-10 08:34:24.345 +00:00 [Information] Request starting HTTP/1.1 GET http://localhost:5005/connect/authorize?client_id=spaclient&redirect_uri=http%3A%2F%2Flocalhost%3A5007%2Fcallback.html&response_type=id_token%20token&scope=openid%20profile%20productapi&state=f1c6326c836f4a2e811ca7a99547f85e&nonce=be417d88989f46d683a91188a676c6c2  
2017-06-10 08:34:24.350 +00:00 [Debug] Request path "/connect/authorize" matched to endpoint type Authorize
2017-06-10 08:34:24.350 +00:00 [Debug] Mapping found for endpoint: Authorize, creating handler: "IdentityServer4.Endpoints.AuthorizeEndpoint"
2017-06-10 08:34:24.359 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.AuthorizeEndpoint" for "/connect/authorize"
2017-06-10 08:34:24.369 +00:00 [Debug] Start authorize request
2017-06-10 08:34:24.431 +00:00 [Debug] No user present in authorize request
2017-06-10 08:34:24.437 +00:00 [Debug] Start authorize request protocol validation
2017-06-10 08:34:24.483 +00:00 [Debug] Calling into custom validator: "IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator"
2017-06-10 08:34:24.484 +00:00 [Verbose] Authorize request protocol validation successful
2017-06-10 08:34:24.506 +00:00 [Information] ValidatedAuthorizeRequest
"{
  \"ClientId\": \"spaclient\",
  \"ClientName\": \"SPAClient\",
  \"RedirectUri\": \"http://localhost:5007/callback.html\",
  \"AllowedRedirectUris\": [
    \"http://localhost:5007/callback.html\"
  ],
  \"SubjectId\": \"anonymous\",
  \"ResponseType\": \"id_token token\",
  \"ResponseMode\": \"fragment\",
  \"GrantType\": \"implicit\",
  \"RequestedScopes\": \"openid profile productapi\",
  \"State\": \"f1c6326c836f4a2e811ca7a99547f85e\",
  \"Nonce\": \"be417d88989f46d683a91188a676c6c2\",
  \"Raw\": {
    \"client_id\": \"spaclient\",
    \"redirect_uri\": \"http://localhost:5007/callback.html\",
    \"response_type\": \"id_token token\",
    \"scope\": \"openid profile productapi\",
    \"state\": \"f1c6326c836f4a2e811ca7a99547f85e\",
    \"nonce\": \"be417d88989f46d683a91188a676c6c2\"
  }
}"
2017-06-10 08:34:24.514 +00:00 [Verbose] ProcessInteractionAsync
2017-06-10 08:34:24.522 +00:00 [Information] Showing login: User is not authenticated
2017-06-10 08:34:24.523 +00:00 [Verbose] End authorize request. result type: "IdentityServer4.Endpoints.Results.LoginPageResult"
2017-06-10 08:34:24.525 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.LoginPageResult"
2017-06-10 08:34:24.536 +00:00 [Information] Request finished in 191.9358ms 302 
2017-06-10 08:34:24.546 +00:00 [Information] Request starting HTTP/1.1 GET http://localhost:5005/account/login?returnUrl=%2Fconnect%2Fauthorize%2Flogin%3Fclient_id%3Dspaclient%26redirect_uri%3Dhttp%253A%252F%252Flocalhost%253A5007%252Fcallback.html%26response_type%3Did_token%2520token%26scope%3Dopenid%2520profile%2520productapi%26state%3Df1c6326c836f4a2e811ca7a99547f85e%26nonce%3Dbe417d88989f46d683a91188a676c6c2  
2017-06-10 08:34:24.546 +00:00 [Verbose] No endpoint entry found for request path: "/account/login"
2017-06-10 08:34:24.865 +00:00 [Information] Executing action method "IdentityServer4.Quickstart.UI.AccountController.Login (SpaIdSrv)" with arguments (["/connect/authorize/login?client_id=spaclient&redirect_uri=http%3A%2F%2Flocalhost%3A5007%2Fcallback.html&response_type=id_token%20token&scope=openid%20profile%20productapi&state=f1c6326c836f4a2e811ca7a99547f85e&nonce=be417d88989f46d683a91188a676c6c2"]) - ModelState is Valid
2017-06-10 08:34:24.886 +00:00 [Verbose] returnUrl is valid
2017-06-10 08:34:24.890 +00:00 [Verbose] returnUrl is valid
2017-06-10 08:34:24.893 +00:00 [Debug] Start authorize request protocol validation
2017-06-10 08:34:24.894 +00:00 [Debug] Calling into custom validator: "IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator"
2017-06-10 08:34:24.896 +00:00 [Verbose] Authorize request protocol validation successful
2017-06-10 08:34:24.899 +00:00 [Verbose] AuthorizationRequest being returned
2017-06-10 08:34:24.901 +00:00 [Verbose] AuthorizationRequest being returned
2017-06-10 08:34:29.515 +00:00 [Information] Executing ViewResult, running view at path "/Views/Account/Login.cshtml".
2017-06-10 08:34:29.669 +00:00 [Information] Creating key {00a25e3c-07b4-4e5a-86d0-6f0d9422b73d} with creation date 2017-06-10 08:34:29Z, activation date 2017-06-10 08:34:29Z, and expiration date 2017-09-08 08:34:29Z.
2017-06-10 08:34:29.680 +00:00 [Warning] No XML encryptor configured. Key {00a25e3c-07b4-4e5a-86d0-6f0d9422b73d} may be persisted to storage in unencrypted form.
2017-06-10 08:34:29.686 +00:00 [Information] Writing data to file '"/root/.aspnet/DataProtection-Keys/key-00a25e3c-07b4-4e5a-86d0-6f0d9422b73d.xml"'.
2017-06-10 08:34:29.970 +00:00 [Information] Executed action "IdentityServer4.Quickstart.UI.AccountController.Login (SpaIdSrv)" in 5218.1043ms
2017-06-10 08:34:29.976 +00:00 [Information] Request finished in 5430.4715ms 200 text/html; charset=utf-8
2017-06-10 08:34:29.988 +00:00 [Information] Request starting HTTP/1.1 GET http://localhost:5005/lib/bootstrap/css/bootstrap.css  
2017-06-10 08:34:29.989 +00:00 [Verbose] No endpoint entry found for request path: "/lib/bootstrap/css/bootstrap.css"
2017-06-10 08:34:29.991 +00:00 [Information] Request starting HTTP/1.1 GET http://localhost:5005/css/site.css  
2017-06-10 08:34:29.992 +00:00 [Verbose] No endpoint entry found for request path: "/css/site.css"
2017-06-10 08:34:30.005 +00:00 [Information] Sending file. Request path: '"/css/site.css"'. Physical path: '"/app/wwwroot/css/site.css"'
2017-06-10 08:34:30.022 +00:00 [Information] Sending file. Request path: '"/lib/bootstrap/css/bootstrap.css"'. Physical path: '"/app/wwwroot/lib/bootstrap/css/bootstrap.css"'
2017-06-10 08:34:30.035 +00:00 [Information] Request starting HTTP/1.1 GET http://localhost:5005/lib/jquery/jquery.js  
2017-06-10 08:34:30.035 +00:00 [Verbose] No endpoint entry found for request path: "/lib/jquery/jquery.js"
2017-06-10 08:34:30.042 +00:00 [Information] Sending file. Request path: '"/lib/jquery/jquery.js"'. Physical path: '"/app/wwwroot/lib/jquery/jquery.js"'
2017-06-10 08:34:30.091 +00:00 [Information] Request finished in 99.8846ms 200 text/css
2017-06-10 08:34:30.161 +00:00 [Information] Request finished in 124.5167ms 200 text/css
2017-06-10 08:34:30.188 +00:00 [Information] Request starting HTTP/1.1 GET http://localhost:5005/lib/bootstrap/js/bootstrap.js  
2017-06-10 08:34:30.190 +00:00 [Information] Request starting HTTP/1.1 GET http://localhost:5005/icon.png  
2017-06-10 08:34:30.211 +00:00 [Verbose] No endpoint entry found for request path: "/icon.png"
2017-06-10 08:34:30.226 +00:00 [Information] Sending file. Request path: '"/icon.png"'. Physical path: '"/app/wwwroot/icon.png"'
2017-06-10 08:34:30.226 +00:00 [Verbose] No endpoint entry found for request path: "/lib/bootstrap/js/bootstrap.js"
2017-06-10 08:34:30.247 +00:00 [Information] Request finished in 211.9163ms 200 application/javascript
2017-06-10 08:34:30.251 +00:00 [Information] Sending file. Request path: '"/lib/bootstrap/js/bootstrap.js"'. Physical path: '"/app/wwwroot/lib/bootstrap/js/bootstrap.js"'
2017-06-10 08:34:30.296 +00:00 [Information] Request finished in 105.195ms 200 image/png
2017-06-10 08:34:30.353 +00:00 [Information] Request finished in 184.882ms 200 application/javascript
2017-06-10 08:34:37.340 +00:00 [Information] Request starting HTTP/1.1 POST http://localhost:5005/account/login?returnUrl=%2Fconnect%2Fauthorize%2Flogin%3Fclient_id%3Dspaclient%26redirect_uri%3Dhttp%253A%252F%252Flocalhost%253A5007%252Fcallback.html%26response_type%3Did_token%2520token%26scope%3Dopenid%2520profile%2520productapi%26state%3Df1c6326c836f4a2e811ca7a99547f85e%26nonce%3Dbe417d88989f46d683a91188a676c6c2 application/x-www-form-urlencoded 542
2017-06-10 08:34:37.341 +00:00 [Verbose] No endpoint entry found for request path: "/account/login"
2017-06-10 08:34:37.383 +00:00 [Information] Executing action method "IdentityServer4.Quickstart.UI.AccountController.Login (SpaIdSrv)" with arguments (["IdentityServer4.Quickstart.UI.LoginInputModel"]) - ModelState is Valid
2017-06-10 08:34:37.402 +00:00 [Debug] Augmenting SignInContext
2017-06-10 08:34:37.413 +00:00 [Information] AuthenticationScheme: "idsrv" signed in.
2017-06-10 08:34:37.414 +00:00 [Verbose] returnUrl is valid
2017-06-10 08:34:37.415 +00:00 [Verbose] IsValidReturnUrl true
2017-06-10 08:34:37.417 +00:00 [Information] Executing RedirectResult, redirecting to "/connect/authorize/login?client_id=spaclient&redirect_uri=http%3A%2F%2Flocalhost%3A5007%2Fcallback.html&response_type=id_token%20token&scope=openid%20profile%20productapi&state=f1c6326c836f4a2e811ca7a99547f85e&nonce=be417d88989f46d683a91188a676c6c2".
2017-06-10 08:34:37.418 +00:00 [Information] Executed action "IdentityServer4.Quickstart.UI.AccountController.Login (SpaIdSrv)" in 62.534ms
2017-06-10 08:34:37.419 +00:00 [Information] Request finished in 78.869ms 302 
2017-06-10 08:34:37.425 +00:00 [Information] Request starting HTTP/1.1 GET http://localhost:5005/connect/authorize/login?client_id=spaclient&redirect_uri=http%3A%2F%2Flocalhost%3A5007%2Fcallback.html&response_type=id_token%20token&scope=openid%20profile%20productapi&state=f1c6326c836f4a2e811ca7a99547f85e&nonce=be417d88989f46d683a91188a676c6c2  
2017-06-10 08:34:37.428 +00:00 [Information] HttpContext.User merged via AutomaticAuthentication from authenticationScheme: "idsrv".
2017-06-10 08:34:37.428 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 08:34:37.429 +00:00 [Debug] Request path "/connect/authorize/login" matched to endpoint type Authorize
2017-06-10 08:34:37.429 +00:00 [Debug] Mapping found for endpoint: Authorize, creating handler: "IdentityServer4.Endpoints.AuthorizeEndpoint"
2017-06-10 08:34:37.430 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.AuthorizeEndpoint" for "/connect/authorize/login"
2017-06-10 08:34:37.438 +00:00 [Debug] Start authorize request (after login)
2017-06-10 08:34:37.439 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 08:34:37.441 +00:00 [Debug] User in authorize request: "2"
2017-06-10 08:34:37.441 +00:00 [Debug] Start authorize request protocol validation
2017-06-10 08:34:37.442 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 08:34:37.442 +00:00 [Debug] Calling into custom validator: "IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator"
2017-06-10 08:34:37.442 +00:00 [Verbose] Authorize request protocol validation successful
2017-06-10 08:34:37.443 +00:00 [Information] ValidatedAuthorizeRequest
"{
  \"ClientId\": \"spaclient\",
  \"ClientName\": \"SPAClient\",
  \"RedirectUri\": \"http://localhost:5007/callback.html\",
  \"AllowedRedirectUris\": [
    \"http://localhost:5007/callback.html\"
  ],
  \"SubjectId\": \"2\",
  \"ResponseType\": \"id_token token\",
  \"ResponseMode\": \"fragment\",
  \"GrantType\": \"implicit\",
  \"RequestedScopes\": \"openid profile productapi\",
  \"State\": \"f1c6326c836f4a2e811ca7a99547f85e\",
  \"Nonce\": \"be417d88989f46d683a91188a676c6c2\",
  \"SessionId\": \"d87fd1fa3d28ae1f36dab49a8149a965\",
  \"Raw\": {
    \"client_id\": \"spaclient\",
    \"redirect_uri\": \"http://localhost:5007/callback.html\",
    \"response_type\": \"id_token token\",
    \"scope\": \"openid profile productapi\",
    \"state\": \"f1c6326c836f4a2e811ca7a99547f85e\",
    \"nonce\": \"be417d88989f46d683a91188a676c6c2\"
  }
}"
2017-06-10 08:34:37.445 +00:00 [Verbose] ProcessInteractionAsync
2017-06-10 08:34:37.463 +00:00 [Debug] "user_consent" grant with value: "spaclient|2" not found in store.
2017-06-10 08:34:37.463 +00:00 [Information] Showing consent: User has not yet consented
2017-06-10 08:34:37.465 +00:00 [Verbose] End Authorize Request. Result type: "IdentityServer4.Endpoints.Results.ConsentPageResult"
2017-06-10 08:34:37.465 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.ConsentPageResult"
2017-06-10 08:34:37.468 +00:00 [Information] Request finished in 42.8636ms 302 
2017-06-10 08:34:37.476 +00:00 [Information] Request starting HTTP/1.1 GET http://localhost:5005/consent?returnUrl=%2Fconnect%2Fauthorize%2Fconsent%3Fclient_id%3Dspaclient%26redirect_uri%3Dhttp%253A%252F%252Flocalhost%253A5007%252Fcallback.html%26response_type%3Did_token%2520token%26scope%3Dopenid%2520profile%2520productapi%26state%3Df1c6326c836f4a2e811ca7a99547f85e%26nonce%3Dbe417d88989f46d683a91188a676c6c2  
2017-06-10 08:34:37.477 +00:00 [Information] HttpContext.User merged via AutomaticAuthentication from authenticationScheme: "idsrv".
2017-06-10 08:34:37.478 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 08:34:37.478 +00:00 [Verbose] No endpoint entry found for request path: "/consent"
2017-06-10 08:34:37.483 +00:00 [Information] Executing action method "IdentityServer4.Quickstart.UI.ConsentController.Index (SpaIdSrv)" with arguments (["/connect/authorize/consent?client_id=spaclient&redirect_uri=http%3A%2F%2Flocalhost%3A5007%2Fcallback.html&response_type=id_token%20token&scope=openid%20profile%20productapi&state=f1c6326c836f4a2e811ca7a99547f85e&nonce=be417d88989f46d683a91188a676c6c2"]) - ModelState is Valid
2017-06-10 08:34:37.487 +00:00 [Verbose] returnUrl is valid
2017-06-10 08:34:37.487 +00:00 [Verbose] returnUrl is valid
2017-06-10 08:34:37.488 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 08:34:37.488 +00:00 [Debug] Start authorize request protocol validation
2017-06-10 08:34:37.489 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 08:34:37.489 +00:00 [Debug] Calling into custom validator: "IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator"
2017-06-10 08:34:37.489 +00:00 [Verbose] Authorize request protocol validation successful
2017-06-10 08:34:37.490 +00:00 [Verbose] AuthorizationRequest being returned
2017-06-10 08:34:37.490 +00:00 [Verbose] AuthorizationRequest being returned
2017-06-10 08:34:37.669 +00:00 [Information] Executing ViewResult, running view at path "/Views/Consent/Index.cshtml".
2017-06-10 08:34:37.791 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 08:34:37.797 +00:00 [Information] Executed action "IdentityServer4.Quickstart.UI.ConsentController.Index (SpaIdSrv)" in 316.1815ms
2017-06-10 08:34:37.798 +00:00 [Information] Request finished in 321.513ms 200 text/html; charset=utf-8
2017-06-10 08:34:37.889 +00:00 [Information] Request starting HTTP/1.1 GET http://localhost:5005/lib/bootstrap/fonts/glyphicons-halflings-regular.woff2  
2017-06-10 08:34:37.890 +00:00 [Information] HttpContext.User merged via AutomaticAuthentication from authenticationScheme: "idsrv".
2017-06-10 08:34:37.890 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 08:34:37.890 +00:00 [Verbose] No endpoint entry found for request path: "/lib/bootstrap/fonts/glyphicons-halflings-regular.woff2"
2017-06-10 08:34:37.897 +00:00 [Information] Sending file. Request path: '"/lib/bootstrap/fonts/glyphicons-halflings-regular.woff2"'. Physical path: '"/app/wwwroot/lib/bootstrap/fonts/glyphicons-halflings-regular.woff2"'
2017-06-10 08:34:37.938 +00:00 [Information] Request finished in 48.5089ms 200 application/font-woff2
2017-06-10 08:34:41.724 +00:00 [Information] Request starting HTTP/1.1 POST http://localhost:5005/consent application/x-www-form-urlencoded 639
2017-06-10 08:34:41.725 +00:00 [Information] HttpContext.User merged via AutomaticAuthentication from authenticationScheme: "idsrv".
2017-06-10 08:34:41.725 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 08:34:41.725 +00:00 [Verbose] No endpoint entry found for request path: "/consent"
2017-06-10 08:34:41.739 +00:00 [Information] Executing action method "IdentityServer4.Quickstart.UI.ConsentController.Index (SpaIdSrv)" with arguments (["IdentityServer4.Quickstart.UI.ConsentInputModel"]) - ModelState is Valid
2017-06-10 08:34:41.746 +00:00 [Verbose] returnUrl is valid
2017-06-10 08:34:41.746 +00:00 [Verbose] returnUrl is valid
2017-06-10 08:34:41.746 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 08:34:41.749 +00:00 [Debug] Start authorize request protocol validation
2017-06-10 08:34:41.752 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 08:34:41.753 +00:00 [Debug] Calling into custom validator: "IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator"
2017-06-10 08:34:41.753 +00:00 [Verbose] Authorize request protocol validation successful
2017-06-10 08:34:41.753 +00:00 [Verbose] AuthorizationRequest being returned
2017-06-10 08:34:41.753 +00:00 [Verbose] AuthorizationRequest being returned
2017-06-10 08:34:41.757 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 08:34:41.772 +00:00 [Verbose] Protecting message: "{\"Created\":636326804817597870,\"Data\":{\"Granted\":true,\"ScopesConsented\":[\"openid\",\"profile\",\"productapi\"]}}"
2017-06-10 08:34:41.774 +00:00 [Information] Executing RedirectResult, redirecting to "/connect/authorize/consent?client_id=spaclient&redirect_uri=http%3A%2F%2Flocalhost%3A5007%2Fcallback.html&response_type=id_token%20token&scope=openid%20profile%20productapi&state=f1c6326c836f4a2e811ca7a99547f85e&nonce=be417d88989f46d683a91188a676c6c2".
2017-06-10 08:34:41.775 +00:00 [Information] Executed action "IdentityServer4.Quickstart.UI.ConsentController.Index (SpaIdSrv)" in 46.5763ms
2017-06-10 08:34:41.775 +00:00 [Information] Request finished in 50.88ms 302 
2017-06-10 08:34:41.781 +00:00 [Information] Request starting HTTP/1.1 GET http://localhost:5005/connect/authorize/consent?client_id=spaclient&redirect_uri=http%3A%2F%2Flocalhost%3A5007%2Fcallback.html&response_type=id_token%20token&scope=openid%20profile%20productapi&state=f1c6326c836f4a2e811ca7a99547f85e&nonce=be417d88989f46d683a91188a676c6c2  
2017-06-10 08:34:41.781 +00:00 [Information] HttpContext.User merged via AutomaticAuthentication from authenticationScheme: "idsrv".
2017-06-10 08:34:41.782 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 08:34:41.782 +00:00 [Debug] Request path "/connect/authorize/consent" matched to endpoint type Authorize
2017-06-10 08:34:41.782 +00:00 [Debug] Mapping found for endpoint: Authorize, creating handler: "IdentityServer4.Endpoints.AuthorizeEndpoint"
2017-06-10 08:34:41.783 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.AuthorizeEndpoint" for "/connect/authorize/consent"
2017-06-10 08:34:41.792 +00:00 [Debug] Start authorize request (after consent)
2017-06-10 08:34:41.792 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 08:34:41.799 +00:00 [Debug] User in authorize request: "2"
2017-06-10 08:34:41.799 +00:00 [Debug] Start authorize request protocol validation
2017-06-10 08:34:41.800 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 08:34:41.800 +00:00 [Debug] Calling into custom validator: "IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator"
2017-06-10 08:34:41.800 +00:00 [Verbose] Authorize request protocol validation successful
2017-06-10 08:34:41.800 +00:00 [Information] ValidatedAuthorizeRequest
"{
  \"ClientId\": \"spaclient\",
  \"ClientName\": \"SPAClient\",
  \"RedirectUri\": \"http://localhost:5007/callback.html\",
  \"AllowedRedirectUris\": [
    \"http://localhost:5007/callback.html\"
  ],
  \"SubjectId\": \"2\",
  \"ResponseType\": \"id_token token\",
  \"ResponseMode\": \"fragment\",
  \"GrantType\": \"implicit\",
  \"RequestedScopes\": \"openid profile productapi\",
  \"State\": \"f1c6326c836f4a2e811ca7a99547f85e\",
  \"Nonce\": \"be417d88989f46d683a91188a676c6c2\",
  \"SessionId\": \"d87fd1fa3d28ae1f36dab49a8149a965\",
  \"Raw\": {
    \"client_id\": \"spaclient\",
    \"redirect_uri\": \"http://localhost:5007/callback.html\",
    \"response_type\": \"id_token token\",
    \"scope\": \"openid profile productapi\",
    \"state\": \"f1c6326c836f4a2e811ca7a99547f85e\",
    \"nonce\": \"be417d88989f46d683a91188a676c6c2\"
  }
}"
2017-06-10 08:34:41.802 +00:00 [Verbose] ProcessInteractionAsync
2017-06-10 08:34:41.803 +00:00 [Debug] "user_consent" grant with value: "spaclient|2" not found in store.
2017-06-10 08:34:41.803 +00:00 [Verbose] Consent was shown to user
2017-06-10 08:34:41.817 +00:00 [Information] User consented to scopes: ["openid", "profile", "productapi"]
2017-06-10 08:34:41.832 +00:00 [Debug] Creating Implicit Flow response.
2017-06-10 08:34:41.836 +00:00 [Verbose] Creating access token
2017-06-10 08:34:41.842 +00:00 [Debug] Getting claims for access token for client: "spaclient"
2017-06-10 08:34:41.843 +00:00 [Debug] Getting claims for access token for subject: "2"
2017-06-10 08:34:41.849 +00:00 [Debug] Get profile called for subject "2" from client "SPAClient" with claim types [] via "ClaimsProviderAccessToken"
2017-06-10 08:34:41.854 +00:00 [Verbose] Creating JWT access token
2017-06-10 08:34:41.965 +00:00 [Verbose] Creating identity token
2017-06-10 08:34:41.971 +00:00 [Debug] Getting claims for identity token for subject: "2" and client: "spaclient"
2017-06-10 08:34:41.971 +00:00 [Debug] In addition to an id_token, an access_token was requested. No claims other than sub are included in the id_token. To obtain more user claims, either use the user info endpoint or set AlwaysIncludeUserClaimsInIdToken on the client configuration.
2017-06-10 08:34:41.971 +00:00 [Verbose] Creating JWT identity token
2017-06-10 08:34:41.977 +00:00 [Verbose] Identity token issued for "spaclient (SPAClient)" / "2": "eyJhbGciOiJSUzI1NiIsImtpZCI6IjUzYThlMDkwNmIxZjNjMTRkOTRkN2ZmMWZhZDE3Y2ExIiwidHlwIjoiSldUIn0.eyJuYmYiOjE0OTcwODM2ODEsImV4cCI6MTQ5NzA4Mzk4MSwiaXNzIjoiaHR0cDovL2xvY2FsaG9zdDo1MDA1IiwiYXVkIjoic3BhY2xpZW50Iiwibm9uY2UiOiJiZTQxN2Q4ODk4OWY0NmQ2ODNhOTExODhhNjc2YzZjMiIsImlhdCI6MTQ5NzA4MzY4MSwiYXRfaGFzaCI6IktEblFWN3QtVGwzVHhLNnM0bnhkaGciLCJzaWQiOiJkODdmZDFmYTNkMjhhZTFmMzZkYWI0OWE4MTQ5YTk2NSIsInN1YiI6IjIiLCJhdXRoX3RpbWUiOjE0OTcwODM2NzcsImlkcCI6ImxvY2FsIiwiYW1yIjpbInB3ZCJdfQ.vCjE0qezcIPiKy86o4hlu9mq7g9sGYIlj1lJaVJ0O9O4SrYQ0wL8k3FDkl7mdPJU-2QMaNc6i0JX9czVgEDOsUpfLE0zL9mox70cxglzdrq99gDwfGvdId3WzxR4JcVuPE0yHYGazQLhQmpLscY5Y727G4UtHvW59rVxgZppn7b-unTUZkILAsL9yAGfBHfUPV4Hnai4_P_jdzdYimtpkFC-XVh-m_H4vpNMaiczw6BPzmxcMMMmLJClLvpsFS84K_hF_IUwkR6Gfp-rAEFzwSoaoC0ODmK153fOQtyZxd4E-5TMquED5XIr-Ktth24JKQHpZIKRqmlMv9Yv9dgpEg"
2017-06-10 08:34:41.977 +00:00 [Verbose] Access token issued for "spaclient (SPAClient)" / "2": "eyJhbGciOiJSUzI1NiIsImtpZCI6IjUzYThlMDkwNmIxZjNjMTRkOTRkN2ZmMWZhZDE3Y2ExIiwidHlwIjoiSldUIn0.eyJuYmYiOjE0OTcwODM2ODEsImV4cCI6MTQ5NzA4NzI4MSwiaXNzIjoiaHR0cDovL2xvY2FsaG9zdDo1MDA1IiwiYXVkIjpbImh0dHA6Ly9sb2NhbGhvc3Q6NTAwNS9yZXNvdXJjZXMiLCJwcm9kdWN0YXBpIl0sImNsaWVudF9pZCI6InNwYWNsaWVudCIsInN1YiI6IjIiLCJhdXRoX3RpbWUiOjE0OTcwODM2NzcsImlkcCI6ImxvY2FsIiwic2NvcGUiOlsib3BlbmlkIiwicHJvZmlsZSIsInByb2R1Y3RhcGkiXSwiYW1yIjpbInB3ZCJdfQ.10HE9VFTAcZKeTLEZ4jrWSBKYSxoKz77f7dBS_bERbc5M-HRnjYr182U0fmpWEsSbZKqFgfqaCv4chVIraTKM50AdVr73oDQZ1wcqs0PgLJnFeXovo6AtKlr6yB5ejOIF2nkd6cJyKp9PdcMWuhdxXZJ1nOZwb08889SzYoHK4WZszbnX4ZNuZivDivu0JP1N-whCTa8meYxYL4vHTrAFEkngnILHTea1TQwhllzHfZMTRyLoZNR1pQPnNF0udRn7wRUQea2eF-b7ktqcPcbtxCRLvBJ5e4W73uWwsHYFdIlmhvPHgsf1LW89LPME_oKUSZJudCJlvC1pgbDEH7-eg"
2017-06-10 08:34:41.987 +00:00 [Information] Authorize endpoint response
"{
  \"SubjectId\": \"2\",
  \"ClientId\": \"spaclient\",
  \"RedirectUri\": \"http://localhost:5007/callback.html\",
  \"State\": \"f1c6326c836f4a2e811ca7a99547f85e\",
  \"Scope\": \"openid profile productapi\"
}"
2017-06-10 08:34:41.988 +00:00 [Verbose] End Authorize Request. Result type: "IdentityServer4.Endpoints.Results.AuthorizeResult"
2017-06-10 08:34:41.990 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.AuthorizeResult"
2017-06-10 08:34:42.003 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 08:34:42.011 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 08:34:42.014 +00:00 [Debug] Augmenting SignInContext
2017-06-10 08:34:42.015 +00:00 [Information] AuthenticationScheme: "idsrv" signed in.
2017-06-10 08:34:42.021 +00:00 [Information] Request finished in 240.7019ms 302 
2017-06-10 08:34:42.266 +00:00 [Information] Request starting HTTP/1.1 GET http://localhost:5005/.well-known/openid-configuration  
2017-06-10 08:34:42.266 +00:00 [Debug] CORS request made for path: "/.well-known/openid-configuration" from origin: "http://localhost:5007"
2017-06-10 08:34:42.266 +00:00 [Debug] Client list checked and origin: "http://localhost:5007" is allowed
2017-06-10 08:34:42.267 +00:00 [Debug] CorsPolicyService allowed origin: "http://localhost:5007"
2017-06-10 08:34:42.267 +00:00 [Debug] Request path "/.well-known/openid-configuration" matched to endpoint type Discovery
2017-06-10 08:34:42.267 +00:00 [Debug] Mapping found for endpoint: Discovery, creating handler: "IdentityServer4.Endpoints.DiscoveryEndpoint"
2017-06-10 08:34:42.267 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.DiscoveryEndpoint" for "/.well-known/openid-configuration"
2017-06-10 08:34:42.268 +00:00 [Verbose] Processing discovery request.
2017-06-10 08:34:42.268 +00:00 [Debug] Start discovery request
2017-06-10 08:34:42.268 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.DiscoveryDocumentResult"
2017-06-10 08:34:42.269 +00:00 [Information] Request finished in 3.2817ms 200 application/json
2017-06-10 08:34:42.291 +00:00 [Information] Request starting HTTP/1.1 GET http://localhost:5005/.well-known/openid-configuration/jwks  
2017-06-10 08:34:42.291 +00:00 [Debug] CORS request made for path: "/.well-known/openid-configuration/jwks" from origin: "http://localhost:5007"
2017-06-10 08:34:42.291 +00:00 [Debug] Client list checked and origin: "http://localhost:5007" is allowed
2017-06-10 08:34:42.291 +00:00 [Debug] CorsPolicyService allowed origin: "http://localhost:5007"
2017-06-10 08:34:42.291 +00:00 [Debug] Request path "/.well-known/openid-configuration/jwks" matched to endpoint type Discovery
2017-06-10 08:34:42.292 +00:00 [Debug] Mapping found for endpoint: Discovery, creating handler: "IdentityServer4.Endpoints.DiscoveryEndpoint"
2017-06-10 08:34:42.292 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.DiscoveryEndpoint" for "/.well-known/openid-configuration/jwks"
2017-06-10 08:34:42.292 +00:00 [Verbose] Processing discovery request.
2017-06-10 08:34:42.298 +00:00 [Debug] Start key discovery request
2017-06-10 08:34:42.309 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.JsonWebKeysResult"
2017-06-10 08:34:42.318 +00:00 [Information] Request finished in 26.8677ms 200 application/json
2017-06-10 08:34:42.339 +00:00 [Information] Request starting HTTP/1.1 OPTIONS http://localhost:5005/connect/userinfo  
2017-06-10 08:34:42.340 +00:00 [Debug] CORS request made for path: "/connect/userinfo" from origin: "http://localhost:5007"
2017-06-10 08:34:42.342 +00:00 [Debug] Client list checked and origin: "http://localhost:5007" is allowed
2017-06-10 08:34:42.342 +00:00 [Debug] CorsPolicyService allowed origin: "http://localhost:5007"
2017-06-10 08:34:42.347 +00:00 [Information] Request finished in 7.8661ms 204 
2017-06-10 08:34:42.351 +00:00 [Information] Request starting HTTP/1.1 GET http://localhost:5005/connect/userinfo  
2017-06-10 08:34:42.352 +00:00 [Debug] CORS request made for path: "/connect/userinfo" from origin: "http://localhost:5007"
2017-06-10 08:34:42.354 +00:00 [Debug] Client list checked and origin: "http://localhost:5007" is allowed
2017-06-10 08:34:42.356 +00:00 [Debug] CorsPolicyService allowed origin: "http://localhost:5007"
2017-06-10 08:34:42.357 +00:00 [Debug] Request path "/connect/userinfo" matched to endpoint type UserInfo
2017-06-10 08:34:42.358 +00:00 [Debug] Mapping found for endpoint: UserInfo, creating handler: "IdentityServer4.Endpoints.UserInfoEndpoint"
2017-06-10 08:34:42.360 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.UserInfoEndpoint" for "/connect/userinfo"
2017-06-10 08:34:42.369 +00:00 [Debug] Start userinfo request
2017-06-10 08:34:42.373 +00:00 [Information] ValidateAsync: Locating bearer token
2017-06-10 08:34:42.377 +00:00 [Verbose] Authorization header value found
2017-06-10 08:34:42.377 +00:00 [Verbose] Authorization scheme is bearer
2017-06-10 08:34:42.377 +00:00 [Debug] Bearer token found in header
2017-06-10 08:34:42.379 +00:00 [Debug] Token found: "AuthorizationHeader"
2017-06-10 08:34:42.385 +00:00 [Verbose] Start access token validation
2017-06-10 08:34:42.441 +00:00 [Debug] Token validation success
"{
  \"ValidateLifetime\": true,
  \"AccessTokenType\": \"Jwt\",
  \"ExpectedScope\": \"openid\",
  \"Claims\": {
    \"nbf\": 1497083681,
    \"exp\": 1497087281,
    \"iss\": \"http://localhost:5005\",
    \"aud\": [
      \"http://localhost:5005/resources\",
      \"productapi\"
    ],
    \"client_id\": \"spaclient\",
    \"sub\": \"2\",
    \"auth_time\": 1497083677,
    \"idp\": \"local\",
    \"scope\": [
      \"openid\",
      \"profile\",
      \"productapi\"
    ],
    \"amr\": \"pwd\"
  }
}"
2017-06-10 08:34:42.450 +00:00 [Verbose] Creating userinfo response
2017-06-10 08:34:42.457 +00:00 [Debug] Scopes in access token: "openid profile productapi"
2017-06-10 08:34:42.465 +00:00 [Debug] Requested claim types: "sub name family_name given_name middle_name nickname preferred_username profile picture website gender birthdate zoneinfo locale updated_at"
2017-06-10 08:34:42.465 +00:00 [Debug] Get profile called for subject "2" from client "SPAClient" with claim types ["sub", "name", "family_name", "given_name", "middle_name", "nickname", "preferred_username", "profile", "picture", "website", "gender", "birthdate", "zoneinfo", "locale", "updated_at"] via "UserInfoEndpoint"
2017-06-10 08:34:42.467 +00:00 [Information] Profile service returned to the following claim types: ""
2017-06-10 08:34:42.468 +00:00 [Debug] End userinfo request
2017-06-10 08:34:42.468 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.UserInfoResult"
2017-06-10 08:34:42.475 +00:00 [Information] Request finished in 124.0374ms 200 application/json
2017-06-10 08:34:42.485 +00:00 [Information] Request starting HTTP/1.1 GET http://localhost:5005/connect/checksession  
2017-06-10 08:34:42.486 +00:00 [Information] HttpContext.User merged via AutomaticAuthentication from authenticationScheme: "idsrv".
2017-06-10 08:34:42.486 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 08:34:42.486 +00:00 [Debug] Request path "/connect/checksession" matched to endpoint type CheckSession
2017-06-10 08:34:42.486 +00:00 [Debug] Mapping found for endpoint: CheckSession, creating handler: "IdentityServer4.Endpoints.CheckSessionEndpoint"
2017-06-10 08:34:42.487 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.CheckSessionEndpoint" for "/connect/checksession"
2017-06-10 08:34:42.489 +00:00 [Debug] Rendering check session result
2017-06-10 08:34:42.489 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.CheckSessionResult"
2017-06-10 08:34:42.496 +00:00 [Information] Request finished in 10.9433ms 200 text/html; charset=UTF-8
2017-06-10 08:34:42.630 +00:00 [Information] Request starting HTTP/1.1 GET http://localhost:5005/.well-known/openid-configuration  
2017-06-10 08:34:42.630 +00:00 [Debug] CORS request made for path: "/.well-known/openid-configuration" from origin: "http://localhost:5007"
2017-06-10 08:34:42.630 +00:00 [Debug] Client list checked and origin: "http://localhost:5007" is allowed
2017-06-10 08:34:42.631 +00:00 [Debug] CorsPolicyService allowed origin: "http://localhost:5007"
2017-06-10 08:34:42.631 +00:00 [Debug] Request path "/.well-known/openid-configuration" matched to endpoint type Discovery
2017-06-10 08:34:42.631 +00:00 [Debug] Mapping found for endpoint: Discovery, creating handler: "IdentityServer4.Endpoints.DiscoveryEndpoint"
2017-06-10 08:34:42.631 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.DiscoveryEndpoint" for "/.well-known/openid-configuration"
2017-06-10 08:34:42.631 +00:00 [Verbose] Processing discovery request.
2017-06-10 08:34:42.631 +00:00 [Debug] Start discovery request
2017-06-10 08:34:42.632 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.DiscoveryDocumentResult"
2017-06-10 08:34:42.632 +00:00 [Information] Request finished in 2.6795ms 200 application/json
2017-06-10 08:34:42.652 +00:00 [Information] Request starting HTTP/1.1 GET http://localhost:5005/connect/checksession  
2017-06-10 08:34:42.653 +00:00 [Information] HttpContext.User merged via AutomaticAuthentication from authenticationScheme: "idsrv".
2017-06-10 08:34:42.654 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 08:34:42.654 +00:00 [Debug] Request path "/connect/checksession" matched to endpoint type CheckSession
2017-06-10 08:34:42.654 +00:00 [Debug] Mapping found for endpoint: CheckSession, creating handler: "IdentityServer4.Endpoints.CheckSessionEndpoint"
2017-06-10 08:34:42.656 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.CheckSessionEndpoint" for "/connect/checksession"
2017-06-10 08:34:42.657 +00:00 [Debug] Rendering check session result
2017-06-10 08:34:42.661 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.CheckSessionResult"
2017-06-10 08:34:42.662 +00:00 [Information] Request finished in 10.0225ms 200 text/html; charset=UTF-8
2017-06-10 08:38:17.692 +00:00 [Information] You are using the in-memory version of the persisted grant store. This will store consent decisions, authorization codes, refresh and reference tokens in memory only. If you are using any of those features in production, you want to switch to a different store implementation.
2017-06-10 08:38:17.750 +00:00 [Debug] Using built-in CookieAuthentication middleware with scheme: "idsrv"
2017-06-10 08:38:17.754 +00:00 [Debug] Adding CookieAuthentication middleware for external authentication with scheme: "idsrv.external"
2017-06-10 08:38:18.071 +00:00 [Information] User profile is available. Using '"/root/.aspnet/DataProtection-Keys"' as key repository; keys will not be encrypted at rest.
2017-06-10 08:56:37.618 +00:00 [Information] You are using the in-memory version of the persisted grant store. This will store consent decisions, authorization codes, refresh and reference tokens in memory only. If you are using any of those features in production, you want to switch to a different store implementation.
2017-06-10 08:56:37.705 +00:00 [Debug] Using built-in CookieAuthentication middleware with scheme: "idsrv"
2017-06-10 08:56:37.712 +00:00 [Debug] Adding CookieAuthentication middleware for external authentication with scheme: "idsrv.external"
2017-06-10 08:56:38.032 +00:00 [Information] User profile is available. Using '"/root/.aspnet/DataProtection-Keys"' as key repository; keys will not be encrypted at rest.
2017-06-10 12:31:50.504 +02:00 [Information] You are using the in-memory version of the persisted grant store. This will store consent decisions, authorization codes, refresh and reference tokens in memory only. If you are using any of those features in production, you want to switch to a different store implementation.
2017-06-10 12:31:50.556 +02:00 [Debug] Using built-in CookieAuthentication middleware with scheme: "idsrv"
2017-06-10 12:31:50.564 +02:00 [Debug] Adding CookieAuthentication middleware for external authentication with scheme: "idsrv.external"
2017-06-10 12:31:50.842 +02:00 [Information] User profile is available. Using '"C:\Users\Michael\AppData\Local\ASP.NET\DataProtection-Keys"' as key repository and Windows DPAPI to encrypt keys at rest.
2017-06-10 12:31:51.082 +02:00 [Warning] Unable to bind to http://localhost:5005 on the IPv4 loopback interface: (Error -4092 EACCES permission denied)
2017-06-10 12:31:51.088 +02:00 [Fatal] Unable to start Kestrel.
System.IO.IOException: Failed to bind to address http://localhost:5005 on the IPv6 loopback interface: port already in use. ---> System.AggregateException: One or more errors occurred. (Error -4091 EADDRINUSE address already in use) ---> Microsoft.AspNetCore.Server.Kestrel.Internal.Networking.UvException: Error -4091 EADDRINUSE address already in use
   at Microsoft.AspNetCore.Server.Kestrel.Internal.Networking.Libuv.ThrowError(Int32 statusCode)
   at Microsoft.AspNetCore.Server.Kestrel.Internal.Networking.Libuv.tcp_getsockname(UvTcpHandle handle, SockAddr& addr, Int32& namelen)
   at Microsoft.AspNetCore.Server.Kestrel.Internal.Networking.UvTcpHandle.GetSockIPEndPoint()
   at Microsoft.AspNetCore.Server.Kestrel.Internal.Http.TcpListenerPrimary.CreateListenSocket()
   at Microsoft.AspNetCore.Server.Kestrel.Internal.Http.Listener.<StartAsync>b__8_0(Object state)
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at Microsoft.AspNetCore.Server.Kestrel.Internal.Http.ListenerPrimary.<StartAsync>d__12.MoveNext()
   --- End of inner exception stack trace ---
   at System.Threading.Tasks.Task.ThrowIfExceptional(Boolean includeTaskCanceledExceptions)
   at System.Threading.Tasks.Task.Wait(Int32 millisecondsTimeout, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Internal.KestrelEngine.CreateServer(ServerAddress address)
   at Microsoft.AspNetCore.Server.Kestrel.KestrelServer.Start[TContext](IHttpApplication`1 application)
   --- End of inner exception stack trace ---
   at Microsoft.AspNetCore.Server.Kestrel.KestrelServer.Start[TContext](IHttpApplication`1 application)
2017-06-10 12:32:20.466 +02:00 [Information] You are using the in-memory version of the persisted grant store. This will store consent decisions, authorization codes, refresh and reference tokens in memory only. If you are using any of those features in production, you want to switch to a different store implementation.
2017-06-10 12:32:20.519 +02:00 [Debug] Using built-in CookieAuthentication middleware with scheme: "idsrv"
2017-06-10 12:32:20.526 +02:00 [Debug] Adding CookieAuthentication middleware for external authentication with scheme: "idsrv.external"
2017-06-10 12:32:20.782 +02:00 [Information] User profile is available. Using '"C:\Users\Michael\AppData\Local\ASP.NET\DataProtection-Keys"' as key repository and Windows DPAPI to encrypt keys at rest.
2017-06-10 12:32:21.049 +02:00 [Warning] Unable to bind to http://localhost:5005 on the IPv4 loopback interface: (Error -4092 EACCES permission denied)
2017-06-10 12:32:21.055 +02:00 [Fatal] Unable to start Kestrel.
System.IO.IOException: Failed to bind to address http://localhost:5005 on the IPv6 loopback interface: port already in use. ---> System.AggregateException: One or more errors occurred. (Error -4091 EADDRINUSE address already in use) ---> Microsoft.AspNetCore.Server.Kestrel.Internal.Networking.UvException: Error -4091 EADDRINUSE address already in use
   at Microsoft.AspNetCore.Server.Kestrel.Internal.Networking.Libuv.ThrowError(Int32 statusCode)
   at Microsoft.AspNetCore.Server.Kestrel.Internal.Networking.Libuv.tcp_getsockname(UvTcpHandle handle, SockAddr& addr, Int32& namelen)
   at Microsoft.AspNetCore.Server.Kestrel.Internal.Networking.UvTcpHandle.GetSockIPEndPoint()
   at Microsoft.AspNetCore.Server.Kestrel.Internal.Http.TcpListenerPrimary.CreateListenSocket()
   at Microsoft.AspNetCore.Server.Kestrel.Internal.Http.Listener.<StartAsync>b__8_0(Object state)
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at Microsoft.AspNetCore.Server.Kestrel.Internal.Http.ListenerPrimary.<StartAsync>d__12.MoveNext()
   --- End of inner exception stack trace ---
   at System.Threading.Tasks.Task.ThrowIfExceptional(Boolean includeTaskCanceledExceptions)
   at System.Threading.Tasks.Task.Wait(Int32 millisecondsTimeout, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Internal.KestrelEngine.CreateServer(ServerAddress address)
   at Microsoft.AspNetCore.Server.Kestrel.KestrelServer.Start[TContext](IHttpApplication`1 application)
   --- End of inner exception stack trace ---
   at Microsoft.AspNetCore.Server.Kestrel.KestrelServer.Start[TContext](IHttpApplication`1 application)
2017-06-10 12:32:39.018 +02:00 [Information] You are using the in-memory version of the persisted grant store. This will store consent decisions, authorization codes, refresh and reference tokens in memory only. If you are using any of those features in production, you want to switch to a different store implementation.
2017-06-10 12:32:39.070 +02:00 [Debug] Using built-in CookieAuthentication middleware with scheme: "idsrv"
2017-06-10 12:32:39.077 +02:00 [Debug] Adding CookieAuthentication middleware for external authentication with scheme: "idsrv.external"
2017-06-10 12:32:39.331 +02:00 [Information] User profile is available. Using '"C:\Users\Michael\AppData\Local\ASP.NET\DataProtection-Keys"' as key repository and Windows DPAPI to encrypt keys at rest.
2017-06-10 12:32:55.118 +02:00 [Information] Request starting HTTP/1.1 GET http://localhost:5005/.well-known/openid-configuration  
2017-06-10 12:32:55.338 +02:00 [Information] "idsrv" was not authenticated. Failure message: "Unprotect ticket failed"
2017-06-10 12:32:55.374 +02:00 [Debug] Request path "/.well-known/openid-configuration" matched to endpoint type Discovery
2017-06-10 12:32:55.379 +02:00 [Debug] Mapping found for endpoint: Discovery, creating handler: "IdentityServer4.Endpoints.DiscoveryEndpoint"
2017-06-10 12:32:55.382 +02:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.DiscoveryEndpoint" for "/.well-known/openid-configuration"
2017-06-10 12:32:55.388 +02:00 [Verbose] Processing discovery request.
2017-06-10 12:32:55.392 +02:00 [Debug] Start discovery request
2017-06-10 12:32:55.417 +02:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.DiscoveryDocumentResult"
2017-06-10 12:32:55.684 +02:00 [Information] Request finished in 587.8595ms 200 application/json
2017-06-10 12:50:10.777 +02:00 [Information] You are using the in-memory version of the persisted grant store. This will store consent decisions, authorization codes, refresh and reference tokens in memory only. If you are using any of those features in production, you want to switch to a different store implementation.
2017-06-10 12:50:10.833 +02:00 [Debug] Using built-in CookieAuthentication middleware with scheme: "idsrv"
2017-06-10 12:50:10.841 +02:00 [Debug] Adding CookieAuthentication middleware for external authentication with scheme: "idsrv.external"
2017-06-10 12:50:11.106 +02:00 [Information] User profile is available. Using '"C:\Users\Michael\AppData\Local\ASP.NET\DataProtection-Keys"' as key repository and Windows DPAPI to encrypt keys at rest.
2017-06-10 10:53:43.412 +00:00 [Information] You are using the in-memory version of the persisted grant store. This will store consent decisions, authorization codes, refresh and reference tokens in memory only. If you are using any of those features in production, you want to switch to a different store implementation.
2017-06-10 10:53:43.487 +00:00 [Debug] Using built-in CookieAuthentication middleware with scheme: "idsrv"
2017-06-10 10:53:43.493 +00:00 [Debug] Adding CookieAuthentication middleware for external authentication with scheme: "idsrv.external"
2017-06-10 10:53:43.729 +00:00 [Information] User profile is available. Using '"/root/.aspnet/DataProtection-Keys"' as key repository; keys will not be encrypted at rest.
2017-06-10 10:59:30.657 +00:00 [Information] You are using the in-memory version of the persisted grant store. This will store consent decisions, authorization codes, refresh and reference tokens in memory only. If you are using any of those features in production, you want to switch to a different store implementation.
2017-06-10 10:59:30.727 +00:00 [Debug] Using built-in CookieAuthentication middleware with scheme: "idsrv"
2017-06-10 10:59:30.739 +00:00 [Debug] Adding CookieAuthentication middleware for external authentication with scheme: "idsrv.external"
2017-06-10 10:59:31.097 +00:00 [Information] User profile is available. Using '"/root/.aspnet/DataProtection-Keys"' as key repository; keys will not be encrypted at rest.
2017-06-10 11:43:21.590 +00:00 [Information] You are using the in-memory version of the persisted grant store. This will store consent decisions, authorization codes, refresh and reference tokens in memory only. If you are using any of those features in production, you want to switch to a different store implementation.
2017-06-10 11:43:21.649 +00:00 [Debug] Using built-in CookieAuthentication middleware with scheme: "idsrv"
2017-06-10 11:43:21.653 +00:00 [Debug] Adding CookieAuthentication middleware for external authentication with scheme: "idsrv.external"
2017-06-10 11:43:21.964 +00:00 [Information] User profile is available. Using '"/root/.aspnet/DataProtection-Keys"' as key repository; keys will not be encrypted at rest.
2017-06-10 11:47:44.527 +00:00 [Information] You are using the in-memory version of the persisted grant store. This will store consent decisions, authorization codes, refresh and reference tokens in memory only. If you are using any of those features in production, you want to switch to a different store implementation.
2017-06-10 11:47:44.623 +00:00 [Debug] Using built-in CookieAuthentication middleware with scheme: "idsrv"
2017-06-10 11:47:44.633 +00:00 [Debug] Adding CookieAuthentication middleware for external authentication with scheme: "idsrv.external"
2017-06-10 11:47:44.891 +00:00 [Information] User profile is available. Using '"/root/.aspnet/DataProtection-Keys"' as key repository; keys will not be encrypted at rest.
2017-06-10 13:50:43.033 +02:00 [Information] You are using the in-memory version of the persisted grant store. This will store consent decisions, authorization codes, refresh and reference tokens in memory only. If you are using any of those features in production, you want to switch to a different store implementation.
2017-06-10 13:50:43.088 +02:00 [Debug] Using built-in CookieAuthentication middleware with scheme: "idsrv"
2017-06-10 13:50:43.094 +02:00 [Debug] Adding CookieAuthentication middleware for external authentication with scheme: "idsrv.external"
2017-06-10 13:50:43.387 +02:00 [Information] User profile is available. Using '"C:\Users\Michael\AppData\Local\ASP.NET\DataProtection-Keys"' as key repository and Windows DPAPI to encrypt keys at rest.
2017-06-10 13:51:04.558 +02:00 [Warning] Unable to bind to http://localhost:5005 on the IPv4 loopback interface: (Error -4092 EACCES permission denied)
2017-06-10 13:51:04.564 +02:00 [Fatal] Unable to start Kestrel.
System.IO.IOException: Failed to bind to address http://localhost:5005 on the IPv6 loopback interface: port already in use. ---> System.AggregateException: One or more errors occurred. (Error -4091 EADDRINUSE address already in use) ---> Microsoft.AspNetCore.Server.Kestrel.Internal.Networking.UvException: Error -4091 EADDRINUSE address already in use
   at Microsoft.AspNetCore.Server.Kestrel.Internal.Networking.Libuv.ThrowError(Int32 statusCode)
   at Microsoft.AspNetCore.Server.Kestrel.Internal.Networking.Libuv.tcp_getsockname(UvTcpHandle handle, SockAddr& addr, Int32& namelen)
   at Microsoft.AspNetCore.Server.Kestrel.Internal.Networking.UvTcpHandle.GetSockIPEndPoint()
   at Microsoft.AspNetCore.Server.Kestrel.Internal.Http.TcpListenerPrimary.CreateListenSocket()
   at Microsoft.AspNetCore.Server.Kestrel.Internal.Http.Listener.<StartAsync>b__8_0(Object state)
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at Microsoft.AspNetCore.Server.Kestrel.Internal.Http.ListenerPrimary.<StartAsync>d__12.MoveNext()
   --- End of inner exception stack trace ---
   at System.Threading.Tasks.Task.ThrowIfExceptional(Boolean includeTaskCanceledExceptions)
   at System.Threading.Tasks.Task.Wait(Int32 millisecondsTimeout, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Internal.KestrelEngine.CreateServer(ServerAddress address)
   at Microsoft.AspNetCore.Server.Kestrel.KestrelServer.Start[TContext](IHttpApplication`1 application)
   --- End of inner exception stack trace ---
   at Microsoft.AspNetCore.Server.Kestrel.KestrelServer.Start[TContext](IHttpApplication`1 application)
2017-06-10 11:53:55.916 +00:00 [Information] You are using the in-memory version of the persisted grant store. This will store consent decisions, authorization codes, refresh and reference tokens in memory only. If you are using any of those features in production, you want to switch to a different store implementation.
2017-06-10 11:53:55.963 +00:00 [Debug] Using built-in CookieAuthentication middleware with scheme: "idsrv"
2017-06-10 11:53:55.967 +00:00 [Debug] Adding CookieAuthentication middleware for external authentication with scheme: "idsrv.external"
2017-06-10 11:53:56.142 +00:00 [Information] User profile is available. Using '"/root/.aspnet/DataProtection-Keys"' as key repository; keys will not be encrypted at rest.
2017-06-10 13:56:58.997 +02:00 [Information] You are using the in-memory version of the persisted grant store. This will store consent decisions, authorization codes, refresh and reference tokens in memory only. If you are using any of those features in production, you want to switch to a different store implementation.
2017-06-10 13:56:59.053 +02:00 [Debug] Using built-in CookieAuthentication middleware with scheme: "idsrv"
2017-06-10 13:56:59.061 +02:00 [Debug] Adding CookieAuthentication middleware for external authentication with scheme: "idsrv.external"
2017-06-10 13:56:59.327 +02:00 [Information] User profile is available. Using '"C:\Users\Michael\AppData\Local\ASP.NET\DataProtection-Keys"' as key repository and Windows DPAPI to encrypt keys at rest.
2017-06-10 13:57:05.552 +02:00 [Information] Request starting HTTP/1.1 GET http://localhost:5005/.well-known/openid-configuration  
2017-06-10 13:57:05.728 +02:00 [Information] "idsrv" was not authenticated. Failure message: "Unprotect ticket failed"
2017-06-10 13:57:05.764 +02:00 [Debug] Request path "/.well-known/openid-configuration" matched to endpoint type Discovery
2017-06-10 13:57:05.770 +02:00 [Debug] Mapping found for endpoint: Discovery, creating handler: "IdentityServer4.Endpoints.DiscoveryEndpoint"
2017-06-10 13:57:05.774 +02:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.DiscoveryEndpoint" for "/.well-known/openid-configuration"
2017-06-10 13:57:05.783 +02:00 [Verbose] Processing discovery request.
2017-06-10 13:57:05.791 +02:00 [Debug] Start discovery request
2017-06-10 13:57:05.816 +02:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.DiscoveryDocumentResult"
2017-06-10 13:57:06.065 +02:00 [Information] Request finished in 537.2802ms 200 application/json
2017-06-10 13:57:06.278 +02:00 [Information] Request starting HTTP/1.1 GET http://localhost:5005/favicon.ico  
2017-06-10 13:57:06.282 +02:00 [Information] "idsrv" was not authenticated. Failure message: "Unprotect ticket failed"
2017-06-10 13:57:06.286 +02:00 [Verbose] No endpoint entry found for request path: "/favicon.ico"
2017-06-10 13:57:06.326 +02:00 [Information] Sending file. Request path: '"/favicon.ico"'. Physical path: '"C:\Users\Michael\Yo\SpaIdSrv\SpaIdSrv\wwwroot\favicon.ico"'
2017-06-10 13:57:06.362 +02:00 [Information] Request finished in 83.4153ms 200 image/x-icon
2017-06-10 14:04:44.587 +02:00 [Information] You are using the in-memory version of the persisted grant store. This will store consent decisions, authorization codes, refresh and reference tokens in memory only. If you are using any of those features in production, you want to switch to a different store implementation.
2017-06-10 14:04:44.640 +02:00 [Debug] Using built-in CookieAuthentication middleware with scheme: "idsrv"
2017-06-10 14:04:44.647 +02:00 [Debug] Adding CookieAuthentication middleware for external authentication with scheme: "idsrv.external"
2017-06-10 14:04:44.897 +02:00 [Information] User profile is available. Using '"C:\Users\Michael\AppData\Local\ASP.NET\DataProtection-Keys"' as key repository and Windows DPAPI to encrypt keys at rest.
2017-06-10 12:07:03.365 +00:00 [Information] You are using the in-memory version of the persisted grant store. This will store consent decisions, authorization codes, refresh and reference tokens in memory only. If you are using any of those features in production, you want to switch to a different store implementation.
2017-06-10 12:07:03.428 +00:00 [Debug] Using built-in CookieAuthentication middleware with scheme: "idsrv"
2017-06-10 12:07:03.433 +00:00 [Debug] Adding CookieAuthentication middleware for external authentication with scheme: "idsrv.external"
2017-06-10 12:07:03.647 +00:00 [Information] User profile is available. Using '"/root/.aspnet/DataProtection-Keys"' as key repository; keys will not be encrypted at rest.
2017-06-10 14:13:24.587 +02:00 [Information] You are using the in-memory version of the persisted grant store. This will store consent decisions, authorization codes, refresh and reference tokens in memory only. If you are using any of those features in production, you want to switch to a different store implementation.
2017-06-10 14:13:24.638 +02:00 [Debug] Using built-in CookieAuthentication middleware with scheme: "idsrv"
2017-06-10 14:13:24.644 +02:00 [Debug] Adding CookieAuthentication middleware for external authentication with scheme: "idsrv.external"
2017-06-10 14:13:24.901 +02:00 [Information] User profile is available. Using '"C:\Users\Michael\AppData\Local\ASP.NET\DataProtection-Keys"' as key repository and Windows DPAPI to encrypt keys at rest.
2017-06-10 14:14:13.776 +02:00 [Information] You are using the in-memory version of the persisted grant store. This will store consent decisions, authorization codes, refresh and reference tokens in memory only. If you are using any of those features in production, you want to switch to a different store implementation.
2017-06-10 14:14:13.832 +02:00 [Debug] Using built-in CookieAuthentication middleware with scheme: "idsrv"
2017-06-10 14:14:13.839 +02:00 [Debug] Adding CookieAuthentication middleware for external authentication with scheme: "idsrv.external"
2017-06-10 14:14:14.107 +02:00 [Information] User profile is available. Using '"C:\Users\Michael\AppData\Local\ASP.NET\DataProtection-Keys"' as key repository and Windows DPAPI to encrypt keys at rest.
2017-06-10 14:14:37.184 +02:00 [Information] You are using the in-memory version of the persisted grant store. This will store consent decisions, authorization codes, refresh and reference tokens in memory only. If you are using any of those features in production, you want to switch to a different store implementation.
2017-06-10 14:14:37.241 +02:00 [Debug] Using built-in CookieAuthentication middleware with scheme: "idsrv"
2017-06-10 14:14:37.250 +02:00 [Debug] Adding CookieAuthentication middleware for external authentication with scheme: "idsrv.external"
2017-06-10 14:14:37.514 +02:00 [Information] User profile is available. Using '"C:\Users\Michael\AppData\Local\ASP.NET\DataProtection-Keys"' as key repository and Windows DPAPI to encrypt keys at rest.
2017-06-10 14:18:05.541 +02:00 [Information] You are using the in-memory version of the persisted grant store. This will store consent decisions, authorization codes, refresh and reference tokens in memory only. If you are using any of those features in production, you want to switch to a different store implementation.
2017-06-10 14:18:05.602 +02:00 [Debug] Using built-in CookieAuthentication middleware with scheme: "idsrv"
2017-06-10 14:18:05.609 +02:00 [Debug] Adding CookieAuthentication middleware for external authentication with scheme: "idsrv.external"
2017-06-10 14:18:05.873 +02:00 [Information] User profile is available. Using '"C:\Users\Michael\AppData\Local\ASP.NET\DataProtection-Keys"' as key repository and Windows DPAPI to encrypt keys at rest.
2017-06-10 14:18:35.848 +02:00 [Information] You are using the in-memory version of the persisted grant store. This will store consent decisions, authorization codes, refresh and reference tokens in memory only. If you are using any of those features in production, you want to switch to a different store implementation.
2017-06-10 14:18:35.905 +02:00 [Debug] Using built-in CookieAuthentication middleware with scheme: "idsrv"
2017-06-10 14:18:35.912 +02:00 [Debug] Adding CookieAuthentication middleware for external authentication with scheme: "idsrv.external"
2017-06-10 14:18:36.178 +02:00 [Information] User profile is available. Using '"C:\Users\Michael\AppData\Local\ASP.NET\DataProtection-Keys"' as key repository and Windows DPAPI to encrypt keys at rest.
2017-06-10 14:19:22.026 +02:00 [Information] You are using the in-memory version of the persisted grant store. This will store consent decisions, authorization codes, refresh and reference tokens in memory only. If you are using any of those features in production, you want to switch to a different store implementation.
2017-06-10 14:19:22.081 +02:00 [Debug] Using built-in CookieAuthentication middleware with scheme: "idsrv"
2017-06-10 14:19:22.086 +02:00 [Debug] Adding CookieAuthentication middleware for external authentication with scheme: "idsrv.external"
2017-06-10 14:19:22.343 +02:00 [Information] User profile is available. Using '"C:\Users\Michael\AppData\Local\ASP.NET\DataProtection-Keys"' as key repository and Windows DPAPI to encrypt keys at rest.
2017-06-10 14:19:22.586 +02:00 [Fatal] Unable to start Kestrel.
System.IO.IOException: Failed to bind to address http://0.0.0.0:5005: address already in use. ---> System.AggregateException: One or more errors occurred. (Error -4091 EADDRINUSE address already in use) ---> Microsoft.AspNetCore.Server.Kestrel.Internal.Networking.UvException: Error -4091 EADDRINUSE address already in use
   at Microsoft.AspNetCore.Server.Kestrel.Internal.Networking.Libuv.ThrowError(Int32 statusCode)
   at Microsoft.AspNetCore.Server.Kestrel.Internal.Networking.Libuv.tcp_getsockname(UvTcpHandle handle, SockAddr& addr, Int32& namelen)
   at Microsoft.AspNetCore.Server.Kestrel.Internal.Networking.UvTcpHandle.GetSockIPEndPoint()
   at Microsoft.AspNetCore.Server.Kestrel.Internal.Http.TcpListenerPrimary.CreateListenSocket()
   at Microsoft.AspNetCore.Server.Kestrel.Internal.Http.Listener.<StartAsync>b__8_0(Object state)
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at Microsoft.AspNetCore.Server.Kestrel.Internal.Http.ListenerPrimary.<StartAsync>d__12.MoveNext()
   --- End of inner exception stack trace ---
   at System.Threading.Tasks.Task.ThrowIfExceptional(Boolean includeTaskCanceledExceptions)
   at System.Threading.Tasks.Task.Wait(Int32 millisecondsTimeout, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Internal.KestrelEngine.CreateServer(ServerAddress address)
   at Microsoft.AspNetCore.Server.Kestrel.KestrelServer.Start[TContext](IHttpApplication`1 application)
   --- End of inner exception stack trace ---
   at Microsoft.AspNetCore.Server.Kestrel.KestrelServer.Start[TContext](IHttpApplication`1 application)
2017-06-10 14:21:17.609 +02:00 [Information] You are using the in-memory version of the persisted grant store. This will store consent decisions, authorization codes, refresh and reference tokens in memory only. If you are using any of those features in production, you want to switch to a different store implementation.
2017-06-10 14:21:17.666 +02:00 [Debug] Using built-in CookieAuthentication middleware with scheme: "idsrv"
2017-06-10 14:21:17.674 +02:00 [Debug] Adding CookieAuthentication middleware for external authentication with scheme: "idsrv.external"
2017-06-10 14:21:17.930 +02:00 [Information] User profile is available. Using '"C:\Users\Michael\AppData\Local\ASP.NET\DataProtection-Keys"' as key repository and Windows DPAPI to encrypt keys at rest.
2017-06-10 14:21:18.174 +02:00 [Fatal] Unable to start Kestrel.
System.IO.IOException: Failed to bind to address http://0.0.0.0:5005: address already in use. ---> System.AggregateException: One or more errors occurred. (Error -4091 EADDRINUSE address already in use) ---> Microsoft.AspNetCore.Server.Kestrel.Internal.Networking.UvException: Error -4091 EADDRINUSE address already in use
   at Microsoft.AspNetCore.Server.Kestrel.Internal.Networking.Libuv.ThrowError(Int32 statusCode)
   at Microsoft.AspNetCore.Server.Kestrel.Internal.Networking.Libuv.tcp_getsockname(UvTcpHandle handle, SockAddr& addr, Int32& namelen)
   at Microsoft.AspNetCore.Server.Kestrel.Internal.Networking.UvTcpHandle.GetSockIPEndPoint()
   at Microsoft.AspNetCore.Server.Kestrel.Internal.Http.TcpListenerPrimary.CreateListenSocket()
   at Microsoft.AspNetCore.Server.Kestrel.Internal.Http.Listener.<StartAsync>b__8_0(Object state)
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at Microsoft.AspNetCore.Server.Kestrel.Internal.Http.ListenerPrimary.<StartAsync>d__12.MoveNext()
   --- End of inner exception stack trace ---
   at System.Threading.Tasks.Task.ThrowIfExceptional(Boolean includeTaskCanceledExceptions)
   at System.Threading.Tasks.Task.Wait(Int32 millisecondsTimeout, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Internal.KestrelEngine.CreateServer(ServerAddress address)
   at Microsoft.AspNetCore.Server.Kestrel.KestrelServer.Start[TContext](IHttpApplication`1 application)
   --- End of inner exception stack trace ---
   at Microsoft.AspNetCore.Server.Kestrel.KestrelServer.Start[TContext](IHttpApplication`1 application)
2017-06-10 12:23:33.791 +00:00 [Information] You are using the in-memory version of the persisted grant store. This will store consent decisions, authorization codes, refresh and reference tokens in memory only. If you are using any of those features in production, you want to switch to a different store implementation.
2017-06-10 12:23:33.841 +00:00 [Debug] Using built-in CookieAuthentication middleware with scheme: "idsrv"
2017-06-10 12:23:33.846 +00:00 [Debug] Adding CookieAuthentication middleware for external authentication with scheme: "idsrv.external"
2017-06-10 12:23:34.053 +00:00 [Information] User profile is available. Using '"/root/.aspnet/DataProtection-Keys"' as key repository; keys will not be encrypted at rest.
2017-06-10 12:23:42.386 +00:00 [Information] Request starting HTTP/1.1 GET http://localhost:5005/.well-known/openid-configuration  
2017-06-10 12:23:42.440 +00:00 [Information] Creating key {0265b63f-dc3a-4692-baef-54c767580e07} with creation date 2017-06-10 12:23:42Z, activation date 2017-06-10 12:23:42Z, and expiration date 2017-09-08 12:23:42Z.
2017-06-10 12:23:42.454 +00:00 [Warning] No XML encryptor configured. Key {0265b63f-dc3a-4692-baef-54c767580e07} may be persisted to storage in unencrypted form.
2017-06-10 12:23:42.463 +00:00 [Information] Writing data to file '"/root/.aspnet/DataProtection-Keys/key-0265b63f-dc3a-4692-baef-54c767580e07.xml"'.
2017-06-10 12:23:42.503 +00:00 [Information] "idsrv" was not authenticated. Failure message: "Unprotect ticket failed"
2017-06-10 12:23:42.549 +00:00 [Debug] Request path "/.well-known/openid-configuration" matched to endpoint type Discovery
2017-06-10 12:23:42.554 +00:00 [Debug] Mapping found for endpoint: Discovery, creating handler: "IdentityServer4.Endpoints.DiscoveryEndpoint"
2017-06-10 12:23:42.558 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.DiscoveryEndpoint" for "/.well-known/openid-configuration"
2017-06-10 12:23:42.561 +00:00 [Verbose] Processing discovery request.
2017-06-10 12:23:42.564 +00:00 [Debug] Start discovery request
2017-06-10 12:23:42.587 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.DiscoveryDocumentResult"
2017-06-10 12:23:42.711 +00:00 [Information] Request finished in 331.0687ms 200 application/json
2017-06-10 12:23:48.825 +00:00 [Information] Request starting HTTP/1.1 GET http://localhost:5005/.well-known/openid-configuration  
2017-06-10 12:23:48.834 +00:00 [Debug] CORS request made for path: "/.well-known/openid-configuration" from origin: "http://localhost:5007"
2017-06-10 12:23:48.841 +00:00 [Debug] Client list checked and origin: "http://localhost:5007" is allowed
2017-06-10 12:23:48.842 +00:00 [Debug] CorsPolicyService allowed origin: "http://localhost:5007"
2017-06-10 12:23:48.847 +00:00 [Debug] Request path "/.well-known/openid-configuration" matched to endpoint type Discovery
2017-06-10 12:23:48.847 +00:00 [Debug] Mapping found for endpoint: Discovery, creating handler: "IdentityServer4.Endpoints.DiscoveryEndpoint"
2017-06-10 12:23:48.847 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.DiscoveryEndpoint" for "/.well-known/openid-configuration"
2017-06-10 12:23:48.847 +00:00 [Verbose] Processing discovery request.
2017-06-10 12:23:48.848 +00:00 [Debug] Start discovery request
2017-06-10 12:23:48.848 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.DiscoveryDocumentResult"
2017-06-10 12:23:48.849 +00:00 [Information] Request finished in 24.173ms 200 application/json
2017-06-10 12:23:48.863 +00:00 [Information] Request starting HTTP/1.1 GET http://localhost:5005/connect/authorize?client_id=http%3A%2F%2Flocalhost%3A5007&redirect_uri=http%3A%2F%2Flocalhost%3A5007%2Fcallback.html&response_type=id_token%20token&scope=openid%20profile%20productapi&state=2dbd3115bad241078e54f91e0eb857e4&nonce=a35b6d3aaf184042bd913f82747a521d  
2017-06-10 12:23:48.867 +00:00 [Information] "idsrv" was not authenticated. Failure message: "Unprotect ticket failed"
2017-06-10 12:23:48.869 +00:00 [Debug] Request path "/connect/authorize" matched to endpoint type Authorize
2017-06-10 12:23:48.870 +00:00 [Debug] Mapping found for endpoint: Authorize, creating handler: "IdentityServer4.Endpoints.AuthorizeEndpoint"
2017-06-10 12:23:48.879 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.AuthorizeEndpoint" for "/connect/authorize"
2017-06-10 12:23:48.892 +00:00 [Debug] Start authorize request
2017-06-10 12:23:48.938 +00:00 [Debug] No user present in authorize request
2017-06-10 12:23:48.944 +00:00 [Debug] Start authorize request protocol validation
2017-06-10 12:23:48.998 +00:00 [Debug] Calling into custom validator: "IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator"
2017-06-10 12:23:49.000 +00:00 [Verbose] Authorize request protocol validation successful
2017-06-10 12:23:49.024 +00:00 [Information] ValidatedAuthorizeRequest
"{
  \"ClientId\": \"http://localhost:5007\",
  \"ClientName\": \"SPAClient\",
  \"RedirectUri\": \"http://localhost:5007/callback.html\",
  \"AllowedRedirectUris\": [
    \"http://localhost:5007/callback.html\"
  ],
  \"SubjectId\": \"anonymous\",
  \"ResponseType\": \"id_token token\",
  \"ResponseMode\": \"fragment\",
  \"GrantType\": \"implicit\",
  \"RequestedScopes\": \"openid profile productapi\",
  \"State\": \"2dbd3115bad241078e54f91e0eb857e4\",
  \"Nonce\": \"a35b6d3aaf184042bd913f82747a521d\",
  \"Raw\": {
    \"client_id\": \"http://localhost:5007\",
    \"redirect_uri\": \"http://localhost:5007/callback.html\",
    \"response_type\": \"id_token token\",
    \"scope\": \"openid profile productapi\",
    \"state\": \"2dbd3115bad241078e54f91e0eb857e4\",
    \"nonce\": \"a35b6d3aaf184042bd913f82747a521d\"
  }
}"
2017-06-10 12:23:49.035 +00:00 [Verbose] ProcessInteractionAsync
2017-06-10 12:23:49.040 +00:00 [Information] Showing login: User is not authenticated
2017-06-10 12:23:49.041 +00:00 [Verbose] End authorize request. result type: "IdentityServer4.Endpoints.Results.LoginPageResult"
2017-06-10 12:23:49.042 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.LoginPageResult"
2017-06-10 12:23:49.054 +00:00 [Information] Request finished in 191.4939ms 302 
2017-06-10 12:23:49.061 +00:00 [Information] Request starting HTTP/1.1 GET http://localhost:5005/account/login?returnUrl=%2Fconnect%2Fauthorize%2Flogin%3Fclient_id%3Dhttp%253A%252F%252Flocalhost%253A5007%26redirect_uri%3Dhttp%253A%252F%252Flocalhost%253A5007%252Fcallback.html%26response_type%3Did_token%2520token%26scope%3Dopenid%2520profile%2520productapi%26state%3D2dbd3115bad241078e54f91e0eb857e4%26nonce%3Da35b6d3aaf184042bd913f82747a521d  
2017-06-10 12:23:49.064 +00:00 [Information] "idsrv" was not authenticated. Failure message: "Unprotect ticket failed"
2017-06-10 12:23:49.065 +00:00 [Verbose] No endpoint entry found for request path: "/account/login"
2017-06-10 12:23:49.336 +00:00 [Information] Executing action method "IdentityServer4.Quickstart.UI.AccountController.Login (SpaIdSrv)" with arguments (["/connect/authorize/login?client_id=http%3A%2F%2Flocalhost%3A5007&redirect_uri=http%3A%2F%2Flocalhost%3A5007%2Fcallback.html&response_type=id_token%20token&scope=openid%20profile%20productapi&state=2dbd3115bad241078e54f91e0eb857e4&nonce=a35b6d3aaf184042bd913f82747a521d"]) - ModelState is Valid
2017-06-10 12:23:49.353 +00:00 [Verbose] returnUrl is valid
2017-06-10 12:23:49.359 +00:00 [Verbose] returnUrl is valid
2017-06-10 12:23:49.361 +00:00 [Debug] Start authorize request protocol validation
2017-06-10 12:23:49.362 +00:00 [Debug] Calling into custom validator: "IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator"
2017-06-10 12:23:49.363 +00:00 [Verbose] Authorize request protocol validation successful
2017-06-10 12:23:49.363 +00:00 [Verbose] AuthorizationRequest being returned
2017-06-10 12:23:49.366 +00:00 [Verbose] AuthorizationRequest being returned
2017-06-10 12:23:52.432 +00:00 [Information] Executing ViewResult, running view at path "/Views/Account/Login.cshtml".
2017-06-10 12:23:52.569 +00:00 [Error] An exception was thrown while deserializing the token.
System.InvalidOperationException: The antiforgery token could not be decrypted. ---> System.Security.Cryptography.CryptographicException: The key {00a25e3c-07b4-4e5a-86d0-6f0d9422b73d} was not found in the key ring.
   at Microsoft.AspNetCore.DataProtection.KeyManagement.KeyRingBasedDataProtector.UnprotectCore(Byte[] protectedData, Boolean allowOperationsOnRevokedKeys, UnprotectStatus& status)
   at Microsoft.AspNetCore.DataProtection.KeyManagement.KeyRingBasedDataProtector.DangerousUnprotect(Byte[] protectedData, Boolean ignoreRevocationErrors, Boolean& requiresMigration, Boolean& wasRevoked)
   at Microsoft.AspNetCore.DataProtection.KeyManagement.KeyRingBasedDataProtector.Unprotect(Byte[] protectedData)
   at Microsoft.AspNetCore.Antiforgery.Internal.DefaultAntiforgeryTokenSerializer.Deserialize(String serializedToken)
   --- End of inner exception stack trace ---
   at Microsoft.AspNetCore.Antiforgery.Internal.DefaultAntiforgeryTokenSerializer.Deserialize(String serializedToken)
   at Microsoft.AspNetCore.Antiforgery.Internal.DefaultAntiforgery.GetCookieTokenDoesNotThrow(HttpContext httpContext)
2017-06-10 12:23:52.940 +00:00 [Information] Executed action "IdentityServer4.Quickstart.UI.AccountController.Login (SpaIdSrv)" in 3680.6123ms
2017-06-10 12:23:52.945 +00:00 [Information] Request finished in 3884.6209ms 200 text/html; charset=utf-8
2017-06-10 12:23:53.222 +00:00 [Information] Request starting HTTP/1.1 GET http://localhost:5005/lib/bootstrap/css/bootstrap.css.map  
2017-06-10 12:23:53.223 +00:00 [Information] "idsrv" was not authenticated. Failure message: "Unprotect ticket failed"
2017-06-10 12:23:53.224 +00:00 [Verbose] No endpoint entry found for request path: "/lib/bootstrap/css/bootstrap.css.map"
2017-06-10 12:23:53.244 +00:00 [Information] Sending file. Request path: '"/lib/bootstrap/css/bootstrap.css.map"'. Physical path: '"/app/wwwroot/lib/bootstrap/css/bootstrap.css.map"'
2017-06-10 12:23:53.421 +00:00 [Information] Request finished in 198.9883ms 200 text/plain
2017-06-10 12:23:56.271 +00:00 [Information] Request starting HTTP/1.1 POST http://localhost:5005/account/login?returnUrl=%2Fconnect%2Fauthorize%2Flogin%3Fclient_id%3Dhttp%253A%252F%252Flocalhost%253A5007%26redirect_uri%3Dhttp%253A%252F%252Flocalhost%253A5007%252Fcallback.html%26response_type%3Did_token%2520token%26scope%3Dopenid%2520profile%2520productapi%26state%3D2dbd3115bad241078e54f91e0eb857e4%26nonce%3Da35b6d3aaf184042bd913f82747a521d application/x-www-form-urlencoded 570
2017-06-10 12:23:56.271 +00:00 [Information] "idsrv" was not authenticated. Failure message: "Unprotect ticket failed"
2017-06-10 12:23:56.272 +00:00 [Verbose] No endpoint entry found for request path: "/account/login"
2017-06-10 12:23:56.324 +00:00 [Information] Executing action method "IdentityServer4.Quickstart.UI.AccountController.Login (SpaIdSrv)" with arguments (["IdentityServer4.Quickstart.UI.LoginInputModel"]) - ModelState is Valid
2017-06-10 12:23:56.363 +00:00 [Debug] Augmenting SignInContext
2017-06-10 12:23:56.382 +00:00 [Information] AuthenticationScheme: "idsrv" signed in.
2017-06-10 12:23:56.386 +00:00 [Verbose] returnUrl is valid
2017-06-10 12:23:56.386 +00:00 [Verbose] IsValidReturnUrl true
2017-06-10 12:23:56.391 +00:00 [Information] Executing RedirectResult, redirecting to "/connect/authorize/login?client_id=http%3A%2F%2Flocalhost%3A5007&redirect_uri=http%3A%2F%2Flocalhost%3A5007%2Fcallback.html&response_type=id_token%20token&scope=openid%20profile%20productapi&state=2dbd3115bad241078e54f91e0eb857e4&nonce=a35b6d3aaf184042bd913f82747a521d".
2017-06-10 12:23:56.393 +00:00 [Information] Executed action "IdentityServer4.Quickstart.UI.AccountController.Login (SpaIdSrv)" in 118.7199ms
2017-06-10 12:23:56.396 +00:00 [Information] Request finished in 123.6551ms 302 
2017-06-10 12:23:56.401 +00:00 [Information] Request starting HTTP/1.1 GET http://localhost:5005/connect/authorize/login?client_id=http%3A%2F%2Flocalhost%3A5007&redirect_uri=http%3A%2F%2Flocalhost%3A5007%2Fcallback.html&response_type=id_token%20token&scope=openid%20profile%20productapi&state=2dbd3115bad241078e54f91e0eb857e4&nonce=a35b6d3aaf184042bd913f82747a521d  
2017-06-10 12:23:56.403 +00:00 [Information] HttpContext.User merged via AutomaticAuthentication from authenticationScheme: "idsrv".
2017-06-10 12:23:56.404 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 12:23:56.404 +00:00 [Debug] Request path "/connect/authorize/login" matched to endpoint type Authorize
2017-06-10 12:23:56.404 +00:00 [Debug] Mapping found for endpoint: Authorize, creating handler: "IdentityServer4.Endpoints.AuthorizeEndpoint"
2017-06-10 12:23:56.406 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.AuthorizeEndpoint" for "/connect/authorize/login"
2017-06-10 12:23:56.424 +00:00 [Debug] Start authorize request (after login)
2017-06-10 12:23:56.425 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 12:23:56.428 +00:00 [Debug] User in authorize request: "2"
2017-06-10 12:23:56.428 +00:00 [Debug] Start authorize request protocol validation
2017-06-10 12:23:56.430 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 12:23:56.432 +00:00 [Debug] Calling into custom validator: "IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator"
2017-06-10 12:23:56.432 +00:00 [Verbose] Authorize request protocol validation successful
2017-06-10 12:23:56.433 +00:00 [Information] ValidatedAuthorizeRequest
"{
  \"ClientId\": \"http://localhost:5007\",
  \"ClientName\": \"SPAClient\",
  \"RedirectUri\": \"http://localhost:5007/callback.html\",
  \"AllowedRedirectUris\": [
    \"http://localhost:5007/callback.html\"
  ],
  \"SubjectId\": \"2\",
  \"ResponseType\": \"id_token token\",
  \"ResponseMode\": \"fragment\",
  \"GrantType\": \"implicit\",
  \"RequestedScopes\": \"openid profile productapi\",
  \"State\": \"2dbd3115bad241078e54f91e0eb857e4\",
  \"Nonce\": \"a35b6d3aaf184042bd913f82747a521d\",
  \"SessionId\": \"cb57b9555579372d1ec4a58eff48d40c\",
  \"Raw\": {
    \"client_id\": \"http://localhost:5007\",
    \"redirect_uri\": \"http://localhost:5007/callback.html\",
    \"response_type\": \"id_token token\",
    \"scope\": \"openid profile productapi\",
    \"state\": \"2dbd3115bad241078e54f91e0eb857e4\",
    \"nonce\": \"a35b6d3aaf184042bd913f82747a521d\"
  }
}"
2017-06-10 12:23:56.433 +00:00 [Verbose] ProcessInteractionAsync
2017-06-10 12:23:56.483 +00:00 [Debug] "user_consent" grant with value: "http://localhost:5007|2" not found in store.
2017-06-10 12:23:56.483 +00:00 [Information] Showing consent: User has not yet consented
2017-06-10 12:23:56.485 +00:00 [Verbose] End Authorize Request. Result type: "IdentityServer4.Endpoints.Results.ConsentPageResult"
2017-06-10 12:23:56.485 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.ConsentPageResult"
2017-06-10 12:23:56.488 +00:00 [Information] Request finished in 86.7591ms 302 
2017-06-10 12:23:56.492 +00:00 [Information] Request starting HTTP/1.1 GET http://localhost:5005/consent?returnUrl=%2Fconnect%2Fauthorize%2Fconsent%3Fclient_id%3Dhttp%253A%252F%252Flocalhost%253A5007%26redirect_uri%3Dhttp%253A%252F%252Flocalhost%253A5007%252Fcallback.html%26response_type%3Did_token%2520token%26scope%3Dopenid%2520profile%2520productapi%26state%3D2dbd3115bad241078e54f91e0eb857e4%26nonce%3Da35b6d3aaf184042bd913f82747a521d  
2017-06-10 12:23:56.496 +00:00 [Information] HttpContext.User merged via AutomaticAuthentication from authenticationScheme: "idsrv".
2017-06-10 12:23:56.496 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 12:23:56.496 +00:00 [Verbose] No endpoint entry found for request path: "/consent"
2017-06-10 12:23:56.503 +00:00 [Information] Executing action method "IdentityServer4.Quickstart.UI.ConsentController.Index (SpaIdSrv)" with arguments (["/connect/authorize/consent?client_id=http%3A%2F%2Flocalhost%3A5007&redirect_uri=http%3A%2F%2Flocalhost%3A5007%2Fcallback.html&response_type=id_token%20token&scope=openid%20profile%20productapi&state=2dbd3115bad241078e54f91e0eb857e4&nonce=a35b6d3aaf184042bd913f82747a521d"]) - ModelState is Valid
2017-06-10 12:23:56.510 +00:00 [Verbose] returnUrl is valid
2017-06-10 12:23:56.510 +00:00 [Verbose] returnUrl is valid
2017-06-10 12:23:56.510 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 12:23:56.511 +00:00 [Debug] Start authorize request protocol validation
2017-06-10 12:23:56.512 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 12:23:56.512 +00:00 [Debug] Calling into custom validator: "IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator"
2017-06-10 12:23:56.512 +00:00 [Verbose] Authorize request protocol validation successful
2017-06-10 12:23:56.512 +00:00 [Verbose] AuthorizationRequest being returned
2017-06-10 12:23:56.513 +00:00 [Verbose] AuthorizationRequest being returned
2017-06-10 12:23:56.639 +00:00 [Information] Executing ViewResult, running view at path "/Views/Consent/Index.cshtml".
2017-06-10 12:23:56.800 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 12:23:56.808 +00:00 [Information] Executed action "IdentityServer4.Quickstart.UI.ConsentController.Index (SpaIdSrv)" in 309.0641ms
2017-06-10 12:23:56.809 +00:00 [Information] Request finished in 316.667ms 200 text/html; charset=utf-8
2017-06-10 12:24:00.026 +00:00 [Information] Request starting HTTP/1.1 POST http://localhost:5005/consent application/x-www-form-urlencoded 667
2017-06-10 12:24:00.026 +00:00 [Information] HttpContext.User merged via AutomaticAuthentication from authenticationScheme: "idsrv".
2017-06-10 12:24:00.026 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 12:24:00.027 +00:00 [Verbose] No endpoint entry found for request path: "/consent"
2017-06-10 12:24:00.047 +00:00 [Information] Executing action method "IdentityServer4.Quickstart.UI.ConsentController.Index (SpaIdSrv)" with arguments (["IdentityServer4.Quickstart.UI.ConsentInputModel"]) - ModelState is Valid
2017-06-10 12:24:00.057 +00:00 [Verbose] returnUrl is valid
2017-06-10 12:24:00.057 +00:00 [Verbose] returnUrl is valid
2017-06-10 12:24:00.058 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 12:24:00.059 +00:00 [Debug] Start authorize request protocol validation
2017-06-10 12:24:00.064 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 12:24:00.065 +00:00 [Debug] Calling into custom validator: "IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator"
2017-06-10 12:24:00.066 +00:00 [Verbose] Authorize request protocol validation successful
2017-06-10 12:24:00.066 +00:00 [Verbose] AuthorizationRequest being returned
2017-06-10 12:24:00.067 +00:00 [Verbose] AuthorizationRequest being returned
2017-06-10 12:24:00.072 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 12:24:00.088 +00:00 [Verbose] Protecting message: "{\"Created\":636326942400763860,\"Data\":{\"Granted\":true,\"ScopesConsented\":[\"openid\",\"profile\",\"productapi\"]}}"
2017-06-10 12:24:00.090 +00:00 [Information] Executing RedirectResult, redirecting to "/connect/authorize/consent?client_id=http%3A%2F%2Flocalhost%3A5007&redirect_uri=http%3A%2F%2Flocalhost%3A5007%2Fcallback.html&response_type=id_token%20token&scope=openid%20profile%20productapi&state=2dbd3115bad241078e54f91e0eb857e4&nonce=a35b6d3aaf184042bd913f82747a521d".
2017-06-10 12:24:00.091 +00:00 [Information] Executed action "IdentityServer4.Quickstart.UI.ConsentController.Index (SpaIdSrv)" in 61.2876ms
2017-06-10 12:24:00.092 +00:00 [Information] Request finished in 66.1036ms 302 
2017-06-10 12:24:00.101 +00:00 [Information] Request starting HTTP/1.1 GET http://localhost:5005/connect/authorize/consent?client_id=http%3A%2F%2Flocalhost%3A5007&redirect_uri=http%3A%2F%2Flocalhost%3A5007%2Fcallback.html&response_type=id_token%20token&scope=openid%20profile%20productapi&state=2dbd3115bad241078e54f91e0eb857e4&nonce=a35b6d3aaf184042bd913f82747a521d  
2017-06-10 12:24:00.102 +00:00 [Information] HttpContext.User merged via AutomaticAuthentication from authenticationScheme: "idsrv".
2017-06-10 12:24:00.102 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 12:24:00.103 +00:00 [Debug] Request path "/connect/authorize/consent" matched to endpoint type Authorize
2017-06-10 12:24:00.103 +00:00 [Debug] Mapping found for endpoint: Authorize, creating handler: "IdentityServer4.Endpoints.AuthorizeEndpoint"
2017-06-10 12:24:00.103 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.AuthorizeEndpoint" for "/connect/authorize/consent"
2017-06-10 12:24:00.117 +00:00 [Debug] Start authorize request (after consent)
2017-06-10 12:24:00.117 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 12:24:00.130 +00:00 [Debug] User in authorize request: "2"
2017-06-10 12:24:00.130 +00:00 [Debug] Start authorize request protocol validation
2017-06-10 12:24:00.132 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 12:24:00.132 +00:00 [Debug] Calling into custom validator: "IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator"
2017-06-10 12:24:00.133 +00:00 [Verbose] Authorize request protocol validation successful
2017-06-10 12:24:00.133 +00:00 [Information] ValidatedAuthorizeRequest
"{
  \"ClientId\": \"http://localhost:5007\",
  \"ClientName\": \"SPAClient\",
  \"RedirectUri\": \"http://localhost:5007/callback.html\",
  \"AllowedRedirectUris\": [
    \"http://localhost:5007/callback.html\"
  ],
  \"SubjectId\": \"2\",
  \"ResponseType\": \"id_token token\",
  \"ResponseMode\": \"fragment\",
  \"GrantType\": \"implicit\",
  \"RequestedScopes\": \"openid profile productapi\",
  \"State\": \"2dbd3115bad241078e54f91e0eb857e4\",
  \"Nonce\": \"a35b6d3aaf184042bd913f82747a521d\",
  \"SessionId\": \"cb57b9555579372d1ec4a58eff48d40c\",
  \"Raw\": {
    \"client_id\": \"http://localhost:5007\",
    \"redirect_uri\": \"http://localhost:5007/callback.html\",
    \"response_type\": \"id_token token\",
    \"scope\": \"openid profile productapi\",
    \"state\": \"2dbd3115bad241078e54f91e0eb857e4\",
    \"nonce\": \"a35b6d3aaf184042bd913f82747a521d\"
  }
}"
2017-06-10 12:24:00.137 +00:00 [Verbose] ProcessInteractionAsync
2017-06-10 12:24:00.138 +00:00 [Debug] "user_consent" grant with value: "http://localhost:5007|2" not found in store.
2017-06-10 12:24:00.140 +00:00 [Verbose] Consent was shown to user
2017-06-10 12:24:00.150 +00:00 [Information] User consented to scopes: ["openid", "profile", "productapi"]
2017-06-10 12:24:00.166 +00:00 [Debug] Creating Implicit Flow response.
2017-06-10 12:24:00.173 +00:00 [Verbose] Creating access token
2017-06-10 12:24:00.181 +00:00 [Debug] Getting claims for access token for client: "http://localhost:5007"
2017-06-10 12:24:00.182 +00:00 [Debug] Getting claims for access token for subject: "2"
2017-06-10 12:24:00.190 +00:00 [Debug] Get profile called for subject "2" from client "SPAClient" with claim types [] via "ClaimsProviderAccessToken"
2017-06-10 12:24:00.196 +00:00 [Verbose] Creating JWT access token
2017-06-10 12:24:00.428 +00:00 [Verbose] Creating identity token
2017-06-10 12:24:00.434 +00:00 [Debug] Getting claims for identity token for subject: "2" and client: "http://localhost:5007"
2017-06-10 12:24:00.434 +00:00 [Debug] In addition to an id_token, an access_token was requested. No claims other than sub are included in the id_token. To obtain more user claims, either use the user info endpoint or set AlwaysIncludeUserClaimsInIdToken on the client configuration.
2017-06-10 12:24:00.435 +00:00 [Verbose] Creating JWT identity token
2017-06-10 12:24:00.440 +00:00 [Verbose] Identity token issued for "http://localhost:5007 (SPAClient)" / "2": "eyJhbGciOiJSUzI1NiIsImtpZCI6ImE2ZWZiZDAyNTY1ODE0MWNkNWZiODBkNDgzY2Y5ZjUxIiwidHlwIjoiSldUIn0.eyJuYmYiOjE0OTcwOTc0NDAsImV4cCI6MTQ5NzA5Nzc0MCwiaXNzIjoiaHR0cDovL2xvY2FsaG9zdDo1MDA1IiwiYXVkIjoiaHR0cDovL2xvY2FsaG9zdDo1MDA3Iiwibm9uY2UiOiJhMzViNmQzYWFmMTg0MDQyYmQ5MTNmODI3NDdhNTIxZCIsImlhdCI6MTQ5NzA5NzQ0MCwiYXRfaGFzaCI6IkY4NWRKRFZibHo2NTBkby1PazdUTHciLCJzaWQiOiJjYjU3Yjk1NTU1NzkzNzJkMWVjNGE1OGVmZjQ4ZDQwYyIsInN1YiI6IjIiLCJhdXRoX3RpbWUiOjE0OTcwOTc0MzYsImlkcCI6ImxvY2FsIiwiYW1yIjpbInB3ZCJdfQ.jUEB7aRGnYF8jsxfX1BoIeuEaDpsPjS6yReYUAeQ6sMrxMguVxHtM9pOeLUovboxxXM4MtwY2n1bEd6OBKosxAkQ07K0DvLKY9Fy300iOnvcQZt4MtROoDCpKUeP4OjZcHYo4cgabtajMEQtrBE85miUD195n4tw0kDLO20uM3sMjpv6wAmZCoeUwqQdbe4mjmgOruN6m8vgFnlAkRNGDe4ucaz1QemduGzkI29iuxWcWtVbzj0E2OsiYItX9UpLGIATO_41aM3fAqGADqPm55re-Mo4pQA-ltASgimlL8fH1Hi1AsJTK4LhEPe1R9VwGuY3tw5WBMGbsMf4ZIMDmQ"
2017-06-10 12:24:00.441 +00:00 [Verbose] Access token issued for "http://localhost:5007 (SPAClient)" / "2": "eyJhbGciOiJSUzI1NiIsImtpZCI6ImE2ZWZiZDAyNTY1ODE0MWNkNWZiODBkNDgzY2Y5ZjUxIiwidHlwIjoiSldUIn0.eyJuYmYiOjE0OTcwOTc0NDAsImV4cCI6MTQ5NzEwMTA0MCwiaXNzIjoiaHR0cDovL2xvY2FsaG9zdDo1MDA1IiwiYXVkIjpbImh0dHA6Ly9sb2NhbGhvc3Q6NTAwNS9yZXNvdXJjZXMiLCJwcm9kdWN0YXBpIl0sImNsaWVudF9pZCI6Imh0dHA6Ly9sb2NhbGhvc3Q6NTAwNyIsInN1YiI6IjIiLCJhdXRoX3RpbWUiOjE0OTcwOTc0MzYsImlkcCI6ImxvY2FsIiwic2NvcGUiOlsib3BlbmlkIiwicHJvZmlsZSIsInByb2R1Y3RhcGkiXSwiYW1yIjpbInB3ZCJdfQ.H8cQ0eVMyFq5EZ3BQDyaYaHmUn73l6b3ItW8nT2BUdKTw7_fJ07gT5y_Xj_hxpcCjnU3H8qWe9jlcu5mv7NdPHzMdumgPrIOknCJwFckeziQecF86gg7v7TPTrKm0ghuC6_s-fxQpUrPTNXoupq53l8pfLUUq364Bfud6242lvFKwGcPZTed-vg8A6sjYgBk4RaxI4WXOwQogV0beegSpoqsqY4VwdL3QCKnpY904Zg33oyGne3KyurLMgJDeew3lQAVOw0CSy0HgPUKoeegB628y8bT7iqTJCQRIf-6DPPW4EElc-mgnY2I8kDMKF8K918PBoeI0Q0_GPdOOpa7Nw"
2017-06-10 12:24:00.449 +00:00 [Information] Authorize endpoint response
"{
  \"SubjectId\": \"2\",
  \"ClientId\": \"http://localhost:5007\",
  \"RedirectUri\": \"http://localhost:5007/callback.html\",
  \"State\": \"2dbd3115bad241078e54f91e0eb857e4\",
  \"Scope\": \"openid profile productapi\"
}"
2017-06-10 12:24:00.451 +00:00 [Verbose] End Authorize Request. Result type: "IdentityServer4.Endpoints.Results.AuthorizeResult"
2017-06-10 12:24:00.456 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.AuthorizeResult"
2017-06-10 12:24:00.469 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 12:24:00.489 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 12:24:00.494 +00:00 [Debug] Augmenting SignInContext
2017-06-10 12:24:00.495 +00:00 [Information] AuthenticationScheme: "idsrv" signed in.
2017-06-10 12:24:00.504 +00:00 [Information] Request finished in 402.5569ms 302 
2017-06-10 12:24:00.861 +00:00 [Information] Request starting HTTP/1.1 GET http://localhost:5005/.well-known/openid-configuration  
2017-06-10 12:24:00.862 +00:00 [Debug] CORS request made for path: "/.well-known/openid-configuration" from origin: "http://localhost:5007"
2017-06-10 12:24:00.864 +00:00 [Debug] Client list checked and origin: "http://localhost:5007" is allowed
2017-06-10 12:24:00.864 +00:00 [Debug] CorsPolicyService allowed origin: "http://localhost:5007"
2017-06-10 12:24:00.865 +00:00 [Debug] Request path "/.well-known/openid-configuration" matched to endpoint type Discovery
2017-06-10 12:24:00.865 +00:00 [Debug] Mapping found for endpoint: Discovery, creating handler: "IdentityServer4.Endpoints.DiscoveryEndpoint"
2017-06-10 12:24:00.865 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.DiscoveryEndpoint" for "/.well-known/openid-configuration"
2017-06-10 12:24:00.865 +00:00 [Verbose] Processing discovery request.
2017-06-10 12:24:00.865 +00:00 [Debug] Start discovery request
2017-06-10 12:24:00.865 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.DiscoveryDocumentResult"
2017-06-10 12:24:00.866 +00:00 [Information] Request finished in 4.6843ms 200 application/json
2017-06-10 12:24:00.910 +00:00 [Information] Request starting HTTP/1.1 GET http://localhost:5005/.well-known/openid-configuration/jwks  
2017-06-10 12:24:00.910 +00:00 [Debug] CORS request made for path: "/.well-known/openid-configuration/jwks" from origin: "http://localhost:5007"
2017-06-10 12:24:00.910 +00:00 [Debug] Client list checked and origin: "http://localhost:5007" is allowed
2017-06-10 12:24:00.910 +00:00 [Debug] CorsPolicyService allowed origin: "http://localhost:5007"
2017-06-10 12:24:00.911 +00:00 [Debug] Request path "/.well-known/openid-configuration/jwks" matched to endpoint type Discovery
2017-06-10 12:24:00.912 +00:00 [Debug] Mapping found for endpoint: Discovery, creating handler: "IdentityServer4.Endpoints.DiscoveryEndpoint"
2017-06-10 12:24:00.912 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.DiscoveryEndpoint" for "/.well-known/openid-configuration/jwks"
2017-06-10 12:24:00.913 +00:00 [Verbose] Processing discovery request.
2017-06-10 12:24:00.918 +00:00 [Debug] Start key discovery request
2017-06-10 12:24:00.924 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.JsonWebKeysResult"
2017-06-10 12:24:00.937 +00:00 [Information] Request finished in 26.6112ms 200 application/json
2017-06-10 12:24:00.970 +00:00 [Information] Request starting HTTP/1.1 OPTIONS http://localhost:5005/connect/userinfo  
2017-06-10 12:24:00.970 +00:00 [Debug] CORS request made for path: "/connect/userinfo" from origin: "http://localhost:5007"
2017-06-10 12:24:00.975 +00:00 [Debug] Client list checked and origin: "http://localhost:5007" is allowed
2017-06-10 12:24:00.977 +00:00 [Debug] CorsPolicyService allowed origin: "http://localhost:5007"
2017-06-10 12:24:00.983 +00:00 [Information] Request finished in 12.8664ms 204 
2017-06-10 12:24:00.987 +00:00 [Information] Request starting HTTP/1.1 GET http://localhost:5005/connect/userinfo  
2017-06-10 12:24:00.988 +00:00 [Debug] CORS request made for path: "/connect/userinfo" from origin: "http://localhost:5007"
2017-06-10 12:24:00.988 +00:00 [Debug] Client list checked and origin: "http://localhost:5007" is allowed
2017-06-10 12:24:00.988 +00:00 [Debug] CorsPolicyService allowed origin: "http://localhost:5007"
2017-06-10 12:24:00.989 +00:00 [Debug] Request path "/connect/userinfo" matched to endpoint type UserInfo
2017-06-10 12:24:00.989 +00:00 [Debug] Mapping found for endpoint: UserInfo, creating handler: "IdentityServer4.Endpoints.UserInfoEndpoint"
2017-06-10 12:24:00.992 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.UserInfoEndpoint" for "/connect/userinfo"
2017-06-10 12:24:01.004 +00:00 [Debug] Start userinfo request
2017-06-10 12:24:01.009 +00:00 [Information] ValidateAsync: Locating bearer token
2017-06-10 12:24:01.011 +00:00 [Verbose] Authorization header value found
2017-06-10 12:24:01.011 +00:00 [Verbose] Authorization scheme is bearer
2017-06-10 12:24:01.011 +00:00 [Debug] Bearer token found in header
2017-06-10 12:24:01.013 +00:00 [Debug] Token found: "AuthorizationHeader"
2017-06-10 12:24:01.022 +00:00 [Verbose] Start access token validation
2017-06-10 12:24:01.098 +00:00 [Debug] Token validation success
"{
  \"ValidateLifetime\": true,
  \"AccessTokenType\": \"Jwt\",
  \"ExpectedScope\": \"openid\",
  \"Claims\": {
    \"nbf\": 1497097440,
    \"exp\": 1497101040,
    \"iss\": \"http://localhost:5005\",
    \"aud\": [
      \"http://localhost:5005/resources\",
      \"productapi\"
    ],
    \"client_id\": \"http://localhost:5007\",
    \"sub\": \"2\",
    \"auth_time\": 1497097436,
    \"idp\": \"local\",
    \"scope\": [
      \"openid\",
      \"profile\",
      \"productapi\"
    ],
    \"amr\": \"pwd\"
  }
}"
2017-06-10 12:24:01.117 +00:00 [Verbose] Creating userinfo response
2017-06-10 12:24:01.121 +00:00 [Debug] Scopes in access token: "openid profile productapi"
2017-06-10 12:24:01.127 +00:00 [Debug] Requested claim types: "sub name family_name given_name middle_name nickname preferred_username profile picture website gender birthdate zoneinfo locale updated_at"
2017-06-10 12:24:01.127 +00:00 [Debug] Get profile called for subject "2" from client "SPAClient" with claim types ["sub", "name", "family_name", "given_name", "middle_name", "nickname", "preferred_username", "profile", "picture", "website", "gender", "birthdate", "zoneinfo", "locale", "updated_at"] via "UserInfoEndpoint"
2017-06-10 12:24:01.132 +00:00 [Information] Profile service returned to the following claim types: ""
2017-06-10 12:24:01.132 +00:00 [Debug] End userinfo request
2017-06-10 12:24:01.132 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.UserInfoResult"
2017-06-10 12:24:01.136 +00:00 [Information] Request finished in 148.9039ms 200 application/json
2017-06-10 12:24:01.149 +00:00 [Information] Request starting HTTP/1.1 GET http://localhost:5005/connect/checksession  
2017-06-10 12:24:01.149 +00:00 [Information] HttpContext.User merged via AutomaticAuthentication from authenticationScheme: "idsrv".
2017-06-10 12:24:01.150 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 12:24:01.150 +00:00 [Debug] Request path "/connect/checksession" matched to endpoint type CheckSession
2017-06-10 12:24:01.150 +00:00 [Debug] Mapping found for endpoint: CheckSession, creating handler: "IdentityServer4.Endpoints.CheckSessionEndpoint"
2017-06-10 12:24:01.150 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.CheckSessionEndpoint" for "/connect/checksession"
2017-06-10 12:24:01.159 +00:00 [Debug] Rendering check session result
2017-06-10 12:24:01.159 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.CheckSessionResult"
2017-06-10 12:24:01.177 +00:00 [Information] Request finished in 28.0404ms 200 text/html; charset=UTF-8
2017-06-10 12:24:01.490 +00:00 [Information] Request starting HTTP/1.1 GET http://localhost:5005/.well-known/openid-configuration  
2017-06-10 12:24:01.490 +00:00 [Debug] CORS request made for path: "/.well-known/openid-configuration" from origin: "http://localhost:5007"
2017-06-10 12:24:01.490 +00:00 [Debug] Client list checked and origin: "http://localhost:5007" is allowed
2017-06-10 12:24:01.490 +00:00 [Debug] CorsPolicyService allowed origin: "http://localhost:5007"
2017-06-10 12:24:01.491 +00:00 [Debug] Request path "/.well-known/openid-configuration" matched to endpoint type Discovery
2017-06-10 12:24:01.491 +00:00 [Debug] Mapping found for endpoint: Discovery, creating handler: "IdentityServer4.Endpoints.DiscoveryEndpoint"
2017-06-10 12:24:01.491 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.DiscoveryEndpoint" for "/.well-known/openid-configuration"
2017-06-10 12:24:01.491 +00:00 [Verbose] Processing discovery request.
2017-06-10 12:24:01.491 +00:00 [Debug] Start discovery request
2017-06-10 12:24:01.492 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.DiscoveryDocumentResult"
2017-06-10 12:24:01.492 +00:00 [Information] Request finished in 2.5526ms 200 application/json
2017-06-10 12:24:01.519 +00:00 [Information] Request starting HTTP/1.1 GET http://localhost:5005/connect/checksession  
2017-06-10 12:24:01.519 +00:00 [Information] HttpContext.User merged via AutomaticAuthentication from authenticationScheme: "idsrv".
2017-06-10 12:24:01.520 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 12:24:01.520 +00:00 [Debug] Request path "/connect/checksession" matched to endpoint type CheckSession
2017-06-10 12:24:01.520 +00:00 [Debug] Mapping found for endpoint: CheckSession, creating handler: "IdentityServer4.Endpoints.CheckSessionEndpoint"
2017-06-10 12:24:01.520 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.CheckSessionEndpoint" for "/connect/checksession"
2017-06-10 12:24:01.520 +00:00 [Debug] Rendering check session result
2017-06-10 12:24:01.520 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.CheckSessionResult"
2017-06-10 12:24:01.521 +00:00 [Information] Request finished in 2.6738ms 200 text/html; charset=UTF-8
2017-06-10 12:33:20.381 +00:00 [Information] You are using the in-memory version of the persisted grant store. This will store consent decisions, authorization codes, refresh and reference tokens in memory only. If you are using any of those features in production, you want to switch to a different store implementation.
2017-06-10 12:33:20.460 +00:00 [Debug] Using built-in CookieAuthentication middleware with scheme: "idsrv"
2017-06-10 12:33:20.469 +00:00 [Debug] Adding CookieAuthentication middleware for external authentication with scheme: "idsrv.external"
2017-06-10 12:33:20.665 +00:00 [Information] User profile is available. Using '"/root/.aspnet/DataProtection-Keys"' as key repository; keys will not be encrypted at rest.
2017-06-10 12:35:07.700 +00:00 [Information] You are using the in-memory version of the persisted grant store. This will store consent decisions, authorization codes, refresh and reference tokens in memory only. If you are using any of those features in production, you want to switch to a different store implementation.
2017-06-10 12:35:07.750 +00:00 [Debug] Using built-in CookieAuthentication middleware with scheme: "idsrv"
2017-06-10 12:35:07.754 +00:00 [Debug] Adding CookieAuthentication middleware for external authentication with scheme: "idsrv.external"
2017-06-10 12:35:07.963 +00:00 [Information] User profile is available. Using '"/root/.aspnet/DataProtection-Keys"' as key repository; keys will not be encrypted at rest.
2017-06-10 12:36:04.732 +00:00 [Information] You are using the in-memory version of the persisted grant store. This will store consent decisions, authorization codes, refresh and reference tokens in memory only. If you are using any of those features in production, you want to switch to a different store implementation.
2017-06-10 12:36:04.792 +00:00 [Debug] Using built-in CookieAuthentication middleware with scheme: "idsrv"
2017-06-10 12:36:04.798 +00:00 [Debug] Adding CookieAuthentication middleware for external authentication with scheme: "idsrv.external"
2017-06-10 12:36:04.989 +00:00 [Information] User profile is available. Using '"/root/.aspnet/DataProtection-Keys"' as key repository; keys will not be encrypted at rest.
2017-06-10 12:38:34.887 +00:00 [Information] You are using the in-memory version of the persisted grant store. This will store consent decisions, authorization codes, refresh and reference tokens in memory only. If you are using any of those features in production, you want to switch to a different store implementation.
2017-06-10 12:38:34.982 +00:00 [Debug] Using built-in CookieAuthentication middleware with scheme: "idsrv"
2017-06-10 12:38:34.991 +00:00 [Debug] Adding CookieAuthentication middleware for external authentication with scheme: "idsrv.external"
2017-06-10 12:38:35.216 +00:00 [Information] User profile is available. Using '"/root/.aspnet/DataProtection-Keys"' as key repository; keys will not be encrypted at rest.
2017-06-10 12:39:01.912 +00:00 [Information] You are using the in-memory version of the persisted grant store. This will store consent decisions, authorization codes, refresh and reference tokens in memory only. If you are using any of those features in production, you want to switch to a different store implementation.
2017-06-10 12:39:01.964 +00:00 [Debug] Using built-in CookieAuthentication middleware with scheme: "idsrv"
2017-06-10 12:39:01.970 +00:00 [Debug] Adding CookieAuthentication middleware for external authentication with scheme: "idsrv.external"
2017-06-10 12:39:02.222 +00:00 [Information] User profile is available. Using '"/root/.aspnet/DataProtection-Keys"' as key repository; keys will not be encrypted at rest.
2017-06-10 12:39:06.733 +00:00 [Information] Request starting HTTP/1.1 GET http://localhost:5005/.well-known/openid-configuration  
2017-06-10 12:39:06.753 +00:00 [Debug] CORS request made for path: "/.well-known/openid-configuration" from origin: "http://localhost:5007"
2017-06-10 12:39:06.759 +00:00 [Debug] Client list checked and origin: "http://localhost:5007" is allowed
2017-06-10 12:39:06.760 +00:00 [Debug] CorsPolicyService allowed origin: "http://localhost:5007"
2017-06-10 12:39:06.814 +00:00 [Debug] Request path "/.well-known/openid-configuration" matched to endpoint type Discovery
2017-06-10 12:39:06.818 +00:00 [Debug] Mapping found for endpoint: Discovery, creating handler: "IdentityServer4.Endpoints.DiscoveryEndpoint"
2017-06-10 12:39:06.822 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.DiscoveryEndpoint" for "/.well-known/openid-configuration"
2017-06-10 12:39:06.825 +00:00 [Verbose] Processing discovery request.
2017-06-10 12:39:06.830 +00:00 [Debug] Start discovery request
2017-06-10 12:39:06.851 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.DiscoveryDocumentResult"
2017-06-10 12:39:06.952 +00:00 [Information] Request finished in 223.4853ms 200 application/json
2017-06-10 12:39:06.979 +00:00 [Information] Request starting HTTP/1.1 GET http://localhost:5005/connect/authorize?client_id=http%3A%2F%2Flocalhost%3A5007&redirect_uri=http%3A%2F%2Flocalhost%3A5007%2Fcallback.html&response_type=id_token%20token&scope=openid%20profile%20productapi&state=8d8ce46952464fa9a1e7ad67adcfed50&nonce=5ebfdfafe51b47bfabeffd438992a169  
2017-06-10 12:39:07.019 +00:00 [Information] HttpContext.User merged via AutomaticAuthentication from authenticationScheme: "idsrv".
2017-06-10 12:39:07.021 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 12:39:07.026 +00:00 [Debug] Request path "/connect/authorize" matched to endpoint type Authorize
2017-06-10 12:39:07.027 +00:00 [Debug] Mapping found for endpoint: Authorize, creating handler: "IdentityServer4.Endpoints.AuthorizeEndpoint"
2017-06-10 12:39:07.038 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.AuthorizeEndpoint" for "/connect/authorize"
2017-06-10 12:39:07.047 +00:00 [Debug] Start authorize request
2017-06-10 12:39:07.085 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 12:39:07.096 +00:00 [Debug] User in authorize request: "2"
2017-06-10 12:39:07.103 +00:00 [Debug] Start authorize request protocol validation
2017-06-10 12:39:07.148 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 12:39:07.148 +00:00 [Debug] Calling into custom validator: "IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator"
2017-06-10 12:39:07.150 +00:00 [Verbose] Authorize request protocol validation successful
2017-06-10 12:39:07.173 +00:00 [Information] ValidatedAuthorizeRequest
"{
  \"ClientId\": \"http://localhost:5007\",
  \"ClientName\": \"SPAClient\",
  \"RedirectUri\": \"http://localhost:5007/callback.html\",
  \"AllowedRedirectUris\": [
    \"http://localhost:5007/callback.html\"
  ],
  \"SubjectId\": \"2\",
  \"ResponseType\": \"id_token token\",
  \"ResponseMode\": \"fragment\",
  \"GrantType\": \"implicit\",
  \"RequestedScopes\": \"openid profile productapi\",
  \"State\": \"8d8ce46952464fa9a1e7ad67adcfed50\",
  \"Nonce\": \"5ebfdfafe51b47bfabeffd438992a169\",
  \"SessionId\": \"cb57b9555579372d1ec4a58eff48d40c\",
  \"Raw\": {
    \"client_id\": \"http://localhost:5007\",
    \"redirect_uri\": \"http://localhost:5007/callback.html\",
    \"response_type\": \"id_token token\",
    \"scope\": \"openid profile productapi\",
    \"state\": \"8d8ce46952464fa9a1e7ad67adcfed50\",
    \"nonce\": \"5ebfdfafe51b47bfabeffd438992a169\"
  }
}"
2017-06-10 12:39:07.178 +00:00 [Verbose] ProcessInteractionAsync
2017-06-10 12:39:07.197 +00:00 [Debug] "user_consent" grant with value: "http://localhost:5007|2" not found in store.
2017-06-10 12:39:07.198 +00:00 [Information] Showing consent: User has not yet consented
2017-06-10 12:39:07.200 +00:00 [Verbose] End authorize request. result type: "IdentityServer4.Endpoints.Results.ConsentPageResult"
2017-06-10 12:39:07.200 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.ConsentPageResult"
2017-06-10 12:39:07.213 +00:00 [Information] Request finished in 234.2084ms 302 
2017-06-10 12:39:07.219 +00:00 [Information] Request starting HTTP/1.1 GET http://localhost:5005/consent?returnUrl=%2Fconnect%2Fauthorize%2Fconsent%3Fclient_id%3Dhttp%253A%252F%252Flocalhost%253A5007%26redirect_uri%3Dhttp%253A%252F%252Flocalhost%253A5007%252Fcallback.html%26response_type%3Did_token%2520token%26scope%3Dopenid%2520profile%2520productapi%26state%3D8d8ce46952464fa9a1e7ad67adcfed50%26nonce%3D5ebfdfafe51b47bfabeffd438992a169  
2017-06-10 12:39:07.220 +00:00 [Information] HttpContext.User merged via AutomaticAuthentication from authenticationScheme: "idsrv".
2017-06-10 12:39:07.221 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 12:39:07.221 +00:00 [Verbose] No endpoint entry found for request path: "/consent"
2017-06-10 12:39:07.467 +00:00 [Information] Executing action method "IdentityServer4.Quickstart.UI.ConsentController.Index (SpaIdSrv)" with arguments (["/connect/authorize/consent?client_id=http%3A%2F%2Flocalhost%3A5007&redirect_uri=http%3A%2F%2Flocalhost%3A5007%2Fcallback.html&response_type=id_token%20token&scope=openid%20profile%20productapi&state=8d8ce46952464fa9a1e7ad67adcfed50&nonce=5ebfdfafe51b47bfabeffd438992a169"]) - ModelState is Valid
2017-06-10 12:39:07.483 +00:00 [Verbose] returnUrl is valid
2017-06-10 12:39:07.486 +00:00 [Verbose] returnUrl is valid
2017-06-10 12:39:07.489 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 12:39:07.490 +00:00 [Debug] Start authorize request protocol validation
2017-06-10 12:39:07.490 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 12:39:07.491 +00:00 [Debug] Calling into custom validator: "IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator"
2017-06-10 12:39:07.491 +00:00 [Verbose] Authorize request protocol validation successful
2017-06-10 12:39:07.491 +00:00 [Verbose] AuthorizationRequest being returned
2017-06-10 12:39:07.495 +00:00 [Verbose] AuthorizationRequest being returned
2017-06-10 12:39:12.539 +00:00 [Information] Executing ViewResult, running view at path "/Views/Consent/Index.cshtml".
2017-06-10 12:39:13.090 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 12:39:13.144 +00:00 [Information] Executed action "IdentityServer4.Quickstart.UI.ConsentController.Index (SpaIdSrv)" in 5750.9371ms
2017-06-10 12:39:13.157 +00:00 [Information] Request finished in 5937.0213ms 200 text/html; charset=utf-8
2017-06-10 12:39:15.785 +00:00 [Information] Request starting HTTP/1.1 POST http://localhost:5005/consent application/x-www-form-urlencoded 667
2017-06-10 12:39:15.787 +00:00 [Information] HttpContext.User merged via AutomaticAuthentication from authenticationScheme: "idsrv".
2017-06-10 12:39:15.787 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 12:39:15.788 +00:00 [Verbose] No endpoint entry found for request path: "/consent"
2017-06-10 12:39:15.859 +00:00 [Information] Executing action method "IdentityServer4.Quickstart.UI.ConsentController.Index (SpaIdSrv)" with arguments (["IdentityServer4.Quickstart.UI.ConsentInputModel"]) - ModelState is Valid
2017-06-10 12:39:15.874 +00:00 [Verbose] returnUrl is valid
2017-06-10 12:39:15.875 +00:00 [Verbose] returnUrl is valid
2017-06-10 12:39:15.877 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 12:39:15.879 +00:00 [Debug] Start authorize request protocol validation
2017-06-10 12:39:15.881 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 12:39:15.883 +00:00 [Debug] Calling into custom validator: "IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator"
2017-06-10 12:39:15.885 +00:00 [Verbose] Authorize request protocol validation successful
2017-06-10 12:39:15.886 +00:00 [Verbose] AuthorizationRequest being returned
2017-06-10 12:39:15.887 +00:00 [Verbose] AuthorizationRequest being returned
2017-06-10 12:39:15.897 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 12:39:15.935 +00:00 [Verbose] Protecting message: "{\"Created\":636326951559093470,\"Data\":{\"Granted\":true,\"ScopesConsented\":[\"openid\",\"profile\",\"productapi\"]}}"
2017-06-10 12:39:15.945 +00:00 [Information] Executing RedirectResult, redirecting to "/connect/authorize/consent?client_id=http%3A%2F%2Flocalhost%3A5007&redirect_uri=http%3A%2F%2Flocalhost%3A5007%2Fcallback.html&response_type=id_token%20token&scope=openid%20profile%20productapi&state=8d8ce46952464fa9a1e7ad67adcfed50&nonce=5ebfdfafe51b47bfabeffd438992a169".
2017-06-10 12:39:15.949 +00:00 [Information] Executed action "IdentityServer4.Quickstart.UI.ConsentController.Index (SpaIdSrv)" in 156.6295ms
2017-06-10 12:39:15.952 +00:00 [Information] Request finished in 167.3084ms 302 
2017-06-10 12:39:15.957 +00:00 [Information] Request starting HTTP/1.1 GET http://localhost:5005/connect/authorize/consent?client_id=http%3A%2F%2Flocalhost%3A5007&redirect_uri=http%3A%2F%2Flocalhost%3A5007%2Fcallback.html&response_type=id_token%20token&scope=openid%20profile%20productapi&state=8d8ce46952464fa9a1e7ad67adcfed50&nonce=5ebfdfafe51b47bfabeffd438992a169  
2017-06-10 12:39:15.962 +00:00 [Information] HttpContext.User merged via AutomaticAuthentication from authenticationScheme: "idsrv".
2017-06-10 12:39:15.963 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 12:39:15.964 +00:00 [Debug] Request path "/connect/authorize/consent" matched to endpoint type Authorize
2017-06-10 12:39:15.964 +00:00 [Debug] Mapping found for endpoint: Authorize, creating handler: "IdentityServer4.Endpoints.AuthorizeEndpoint"
2017-06-10 12:39:15.965 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.AuthorizeEndpoint" for "/connect/authorize/consent"
2017-06-10 12:39:15.974 +00:00 [Debug] Start authorize request (after consent)
2017-06-10 12:39:15.974 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 12:39:15.983 +00:00 [Debug] User in authorize request: "2"
2017-06-10 12:39:15.983 +00:00 [Debug] Start authorize request protocol validation
2017-06-10 12:39:15.984 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 12:39:15.985 +00:00 [Debug] Calling into custom validator: "IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator"
2017-06-10 12:39:15.985 +00:00 [Verbose] Authorize request protocol validation successful
2017-06-10 12:39:15.986 +00:00 [Information] ValidatedAuthorizeRequest
"{
  \"ClientId\": \"http://localhost:5007\",
  \"ClientName\": \"SPAClient\",
  \"RedirectUri\": \"http://localhost:5007/callback.html\",
  \"AllowedRedirectUris\": [
    \"http://localhost:5007/callback.html\"
  ],
  \"SubjectId\": \"2\",
  \"ResponseType\": \"id_token token\",
  \"ResponseMode\": \"fragment\",
  \"GrantType\": \"implicit\",
  \"RequestedScopes\": \"openid profile productapi\",
  \"State\": \"8d8ce46952464fa9a1e7ad67adcfed50\",
  \"Nonce\": \"5ebfdfafe51b47bfabeffd438992a169\",
  \"SessionId\": \"cb57b9555579372d1ec4a58eff48d40c\",
  \"Raw\": {
    \"client_id\": \"http://localhost:5007\",
    \"redirect_uri\": \"http://localhost:5007/callback.html\",
    \"response_type\": \"id_token token\",
    \"scope\": \"openid profile productapi\",
    \"state\": \"8d8ce46952464fa9a1e7ad67adcfed50\",
    \"nonce\": \"5ebfdfafe51b47bfabeffd438992a169\"
  }
}"
2017-06-10 12:39:15.989 +00:00 [Verbose] ProcessInteractionAsync
2017-06-10 12:39:15.990 +00:00 [Debug] "user_consent" grant with value: "http://localhost:5007|2" not found in store.
2017-06-10 12:39:15.991 +00:00 [Verbose] Consent was shown to user
2017-06-10 12:39:16.000 +00:00 [Information] User consented to scopes: ["openid", "profile", "productapi"]
2017-06-10 12:39:16.013 +00:00 [Debug] Creating Implicit Flow response.
2017-06-10 12:39:16.018 +00:00 [Verbose] Creating access token
2017-06-10 12:39:16.025 +00:00 [Debug] Getting claims for access token for client: "http://localhost:5007"
2017-06-10 12:39:16.026 +00:00 [Debug] Getting claims for access token for subject: "2"
2017-06-10 12:39:16.033 +00:00 [Debug] Get profile called for subject "2" from client "SPAClient" with claim types [] via "ClaimsProviderAccessToken"
2017-06-10 12:39:16.038 +00:00 [Verbose] Creating JWT access token
2017-06-10 12:39:16.428 +00:00 [Verbose] Creating identity token
2017-06-10 12:39:16.437 +00:00 [Debug] Getting claims for identity token for subject: "2" and client: "http://localhost:5007"
2017-06-10 12:39:16.437 +00:00 [Debug] In addition to an id_token, an access_token was requested. No claims other than sub are included in the id_token. To obtain more user claims, either use the user info endpoint or set AlwaysIncludeUserClaimsInIdToken on the client configuration.
2017-06-10 12:39:16.439 +00:00 [Verbose] Creating JWT identity token
2017-06-10 12:39:16.444 +00:00 [Verbose] Identity token issued for "http://localhost:5007 (SPAClient)" / "2": "eyJhbGciOiJSUzI1NiIsImtpZCI6ImVhZTZiYmVkYTI3NjMwODc3MjNmM2QwNjI2MDFlMTNjIiwidHlwIjoiSldUIn0.eyJuYmYiOjE0OTcwOTgzNTYsImV4cCI6MTQ5NzA5ODY1NiwiaXNzIjoiaHR0cDovL2xvY2FsaG9zdDo1MDA1IiwiYXVkIjoiaHR0cDovL2xvY2FsaG9zdDo1MDA3Iiwibm9uY2UiOiI1ZWJmZGZhZmU1MWI0N2JmYWJlZmZkNDM4OTkyYTE2OSIsImlhdCI6MTQ5NzA5ODM1NiwiYXRfaGFzaCI6IjV5em1xMng3TnVvbm5rck5iMWZadWciLCJzaWQiOiJjYjU3Yjk1NTU1NzkzNzJkMWVjNGE1OGVmZjQ4ZDQwYyIsInN1YiI6IjIiLCJhdXRoX3RpbWUiOjE0OTcwOTc0MzYsImlkcCI6ImxvY2FsIiwiYW1yIjpbInB3ZCJdfQ.mLNA9R02miyyOqj2xZMXFtqa8q5Br85Kpq8lhvzmTbCoIHArhAYEQwg34jPKW68F18Qb5ursHbMpfw6cryoyqq1mO83zks1AO6NaxjnquiSVG_WBv3BBxfSlolhHHbjNWR08GAV7mBTD8G_r4LofFwty284oMdNe7JVt3QX1KCfnrjAL0HIz6u2-0-rVqzvJmvLooHdZn0cVvfpZasDha91BQBiqpJLzQKjm-5eWMnWRre8telIdkPTT8OuyH6I_lRtjd3AiZoW-9aL4Q5T0t91_t5sllIDVrUr5sDG-fxfyATis2-UFpcjoHOzZNaGaotPh4RWDYX20z5kzA_oHjA"
2017-06-10 12:39:16.445 +00:00 [Verbose] Access token issued for "http://localhost:5007 (SPAClient)" / "2": "eyJhbGciOiJSUzI1NiIsImtpZCI6ImVhZTZiYmVkYTI3NjMwODc3MjNmM2QwNjI2MDFlMTNjIiwidHlwIjoiSldUIn0.eyJuYmYiOjE0OTcwOTgzNTYsImV4cCI6MTQ5NzEwMTk1NiwiaXNzIjoiaHR0cDovL2xvY2FsaG9zdDo1MDA1IiwiYXVkIjpbImh0dHA6Ly9sb2NhbGhvc3Q6NTAwNS9yZXNvdXJjZXMiLCJwcm9kdWN0YXBpIl0sImNsaWVudF9pZCI6Imh0dHA6Ly9sb2NhbGhvc3Q6NTAwNyIsInN1YiI6IjIiLCJhdXRoX3RpbWUiOjE0OTcwOTc0MzYsImlkcCI6ImxvY2FsIiwic2NvcGUiOlsib3BlbmlkIiwicHJvZmlsZSIsInByb2R1Y3RhcGkiXSwiYW1yIjpbInB3ZCJdfQ.jz5nFszSsG_XP2k4tPEAaiKtZi1MDmvidJmZeHPeWbp8aOiQzuUdxKb7CBczLoal2IuOPADDkBJf0M6s9ZnTWhCV-5mJjF17GEP8TBWNV0auvwpZfuiPvozQFY15sEHVIjrUphzJIgTOLHVY9gxWU6U0fU0SqmnWIqLbPQ_nEWzNsCnd6-W86v3WFSjMpN_L7BlYGLPxgatzOxLJaU-LLt_DUoDNcJXJSrjumqtp1oHppAu54LYlntF-0xrlNEWmUOLzmPyL2tiIFYfHhXRGm-YvXUptaWYTD1bm2RP-BrKOzToHwapUKecw6PUZajMEL8ziplIlm3rzJryh4jdbKA"
2017-06-10 12:39:16.458 +00:00 [Information] Authorize endpoint response
"{
  \"SubjectId\": \"2\",
  \"ClientId\": \"http://localhost:5007\",
  \"RedirectUri\": \"http://localhost:5007/callback.html\",
  \"State\": \"8d8ce46952464fa9a1e7ad67adcfed50\",
  \"Scope\": \"openid profile productapi\"
}"
2017-06-10 12:39:16.460 +00:00 [Verbose] End Authorize Request. Result type: "IdentityServer4.Endpoints.Results.AuthorizeResult"
2017-06-10 12:39:16.462 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.AuthorizeResult"
2017-06-10 12:39:16.474 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 12:39:16.484 +00:00 [Information] Request finished in 527.351ms 302 
2017-06-10 12:39:16.851 +00:00 [Information] Request starting HTTP/1.1 GET http://localhost:5005/.well-known/openid-configuration  
2017-06-10 12:39:16.852 +00:00 [Debug] CORS request made for path: "/.well-known/openid-configuration" from origin: "http://localhost:5007"
2017-06-10 12:39:16.852 +00:00 [Debug] Client list checked and origin: "http://localhost:5007" is allowed
2017-06-10 12:39:16.853 +00:00 [Debug] CorsPolicyService allowed origin: "http://localhost:5007"
2017-06-10 12:39:16.855 +00:00 [Debug] Request path "/.well-known/openid-configuration" matched to endpoint type Discovery
2017-06-10 12:39:16.855 +00:00 [Debug] Mapping found for endpoint: Discovery, creating handler: "IdentityServer4.Endpoints.DiscoveryEndpoint"
2017-06-10 12:39:16.857 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.DiscoveryEndpoint" for "/.well-known/openid-configuration"
2017-06-10 12:39:16.857 +00:00 [Verbose] Processing discovery request.
2017-06-10 12:39:16.860 +00:00 [Debug] Start discovery request
2017-06-10 12:39:16.862 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.DiscoveryDocumentResult"
2017-06-10 12:39:16.863 +00:00 [Information] Request finished in 11.8856ms 200 application/json
2017-06-10 12:39:16.925 +00:00 [Information] Request starting HTTP/1.1 GET http://localhost:5005/.well-known/openid-configuration/jwks  
2017-06-10 12:39:16.925 +00:00 [Debug] CORS request made for path: "/.well-known/openid-configuration/jwks" from origin: "http://localhost:5007"
2017-06-10 12:39:16.926 +00:00 [Debug] Client list checked and origin: "http://localhost:5007" is allowed
2017-06-10 12:39:16.926 +00:00 [Debug] CorsPolicyService allowed origin: "http://localhost:5007"
2017-06-10 12:39:16.926 +00:00 [Debug] Request path "/.well-known/openid-configuration/jwks" matched to endpoint type Discovery
2017-06-10 12:39:16.926 +00:00 [Debug] Mapping found for endpoint: Discovery, creating handler: "IdentityServer4.Endpoints.DiscoveryEndpoint"
2017-06-10 12:39:16.926 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.DiscoveryEndpoint" for "/.well-known/openid-configuration/jwks"
2017-06-10 12:39:16.927 +00:00 [Verbose] Processing discovery request.
2017-06-10 12:39:16.932 +00:00 [Debug] Start key discovery request
2017-06-10 12:39:16.951 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.JsonWebKeysResult"
2017-06-10 12:39:16.976 +00:00 [Information] Request finished in 51.2001ms 200 application/json
2017-06-10 12:39:17.000 +00:00 [Information] Request starting HTTP/1.1 OPTIONS http://localhost:5005/connect/userinfo  
2017-06-10 12:39:17.000 +00:00 [Debug] CORS request made for path: "/connect/userinfo" from origin: "http://localhost:5007"
2017-06-10 12:39:17.000 +00:00 [Debug] Client list checked and origin: "http://localhost:5007" is allowed
2017-06-10 12:39:17.001 +00:00 [Debug] CorsPolicyService allowed origin: "http://localhost:5007"
2017-06-10 12:39:17.011 +00:00 [Information] Request finished in 11.6764ms 204 
2017-06-10 12:39:17.018 +00:00 [Information] Request starting HTTP/1.1 GET http://localhost:5005/connect/userinfo  
2017-06-10 12:39:17.018 +00:00 [Debug] CORS request made for path: "/connect/userinfo" from origin: "http://localhost:5007"
2017-06-10 12:39:17.019 +00:00 [Debug] Client list checked and origin: "http://localhost:5007" is allowed
2017-06-10 12:39:17.019 +00:00 [Debug] CorsPolicyService allowed origin: "http://localhost:5007"
2017-06-10 12:39:17.019 +00:00 [Debug] Request path "/connect/userinfo" matched to endpoint type UserInfo
2017-06-10 12:39:17.019 +00:00 [Debug] Mapping found for endpoint: UserInfo, creating handler: "IdentityServer4.Endpoints.UserInfoEndpoint"
2017-06-10 12:39:17.026 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.UserInfoEndpoint" for "/connect/userinfo"
2017-06-10 12:39:17.035 +00:00 [Debug] Start userinfo request
2017-06-10 12:39:17.039 +00:00 [Information] ValidateAsync: Locating bearer token
2017-06-10 12:39:17.041 +00:00 [Verbose] Authorization header value found
2017-06-10 12:39:17.042 +00:00 [Verbose] Authorization scheme is bearer
2017-06-10 12:39:17.042 +00:00 [Debug] Bearer token found in header
2017-06-10 12:39:17.042 +00:00 [Debug] Token found: "AuthorizationHeader"
2017-06-10 12:39:17.050 +00:00 [Verbose] Start access token validation
2017-06-10 12:39:17.116 +00:00 [Debug] Token validation success
"{
  \"ValidateLifetime\": true,
  \"AccessTokenType\": \"Jwt\",
  \"ExpectedScope\": \"openid\",
  \"Claims\": {
    \"nbf\": 1497098356,
    \"exp\": 1497101956,
    \"iss\": \"http://localhost:5005\",
    \"aud\": [
      \"http://localhost:5005/resources\",
      \"productapi\"
    ],
    \"client_id\": \"http://localhost:5007\",
    \"sub\": \"2\",
    \"auth_time\": 1497097436,
    \"idp\": \"local\",
    \"scope\": [
      \"openid\",
      \"profile\",
      \"productapi\"
    ],
    \"amr\": \"pwd\"
  }
}"
2017-06-10 12:39:17.127 +00:00 [Verbose] Creating userinfo response
2017-06-10 12:39:17.131 +00:00 [Debug] Scopes in access token: "openid profile productapi"
2017-06-10 12:39:17.135 +00:00 [Debug] Requested claim types: "sub name family_name given_name middle_name nickname preferred_username profile picture website gender birthdate zoneinfo locale updated_at"
2017-06-10 12:39:17.136 +00:00 [Debug] Get profile called for subject "2" from client "SPAClient" with claim types ["sub", "name", "family_name", "given_name", "middle_name", "nickname", "preferred_username", "profile", "picture", "website", "gender", "birthdate", "zoneinfo", "locale", "updated_at"] via "UserInfoEndpoint"
2017-06-10 12:39:17.138 +00:00 [Information] Profile service returned to the following claim types: ""
2017-06-10 12:39:17.138 +00:00 [Debug] End userinfo request
2017-06-10 12:39:17.138 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.UserInfoResult"
2017-06-10 12:39:17.142 +00:00 [Information] Request finished in 124.0833ms 200 application/json
2017-06-10 12:39:17.149 +00:00 [Information] Request starting HTTP/1.1 GET http://localhost:5005/connect/checksession  
2017-06-10 12:39:17.150 +00:00 [Information] HttpContext.User merged via AutomaticAuthentication from authenticationScheme: "idsrv".
2017-06-10 12:39:17.150 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 12:39:17.150 +00:00 [Debug] Request path "/connect/checksession" matched to endpoint type CheckSession
2017-06-10 12:39:17.150 +00:00 [Debug] Mapping found for endpoint: CheckSession, creating handler: "IdentityServer4.Endpoints.CheckSessionEndpoint"
2017-06-10 12:39:17.151 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.CheckSessionEndpoint" for "/connect/checksession"
2017-06-10 12:39:17.155 +00:00 [Debug] Rendering check session result
2017-06-10 12:39:17.155 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.CheckSessionResult"
2017-06-10 12:39:17.162 +00:00 [Information] Request finished in 13.192ms 200 text/html; charset=UTF-8
2017-06-10 12:39:17.523 +00:00 [Information] Request starting HTTP/1.1 GET http://localhost:5005/.well-known/openid-configuration  
2017-06-10 12:39:17.523 +00:00 [Debug] CORS request made for path: "/.well-known/openid-configuration" from origin: "http://localhost:5007"
2017-06-10 12:39:17.524 +00:00 [Debug] Client list checked and origin: "http://localhost:5007" is allowed
2017-06-10 12:39:17.524 +00:00 [Debug] CorsPolicyService allowed origin: "http://localhost:5007"
2017-06-10 12:39:17.524 +00:00 [Debug] Request path "/.well-known/openid-configuration" matched to endpoint type Discovery
2017-06-10 12:39:17.525 +00:00 [Debug] Mapping found for endpoint: Discovery, creating handler: "IdentityServer4.Endpoints.DiscoveryEndpoint"
2017-06-10 12:39:17.525 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.DiscoveryEndpoint" for "/.well-known/openid-configuration"
2017-06-10 12:39:17.525 +00:00 [Verbose] Processing discovery request.
2017-06-10 12:39:17.525 +00:00 [Debug] Start discovery request
2017-06-10 12:39:17.525 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.DiscoveryDocumentResult"
2017-06-10 12:39:17.526 +00:00 [Information] Request finished in 2.9891ms 200 application/json
2017-06-10 12:39:17.555 +00:00 [Information] Request starting HTTP/1.1 GET http://localhost:5005/connect/checksession  
2017-06-10 12:39:17.555 +00:00 [Information] HttpContext.User merged via AutomaticAuthentication from authenticationScheme: "idsrv".
2017-06-10 12:39:17.556 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 12:39:17.556 +00:00 [Debug] Request path "/connect/checksession" matched to endpoint type CheckSession
2017-06-10 12:39:17.556 +00:00 [Debug] Mapping found for endpoint: CheckSession, creating handler: "IdentityServer4.Endpoints.CheckSessionEndpoint"
2017-06-10 12:39:17.556 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.CheckSessionEndpoint" for "/connect/checksession"
2017-06-10 12:39:17.556 +00:00 [Debug] Rendering check session result
2017-06-10 12:39:17.557 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.CheckSessionResult"
2017-06-10 12:39:17.558 +00:00 [Information] Request finished in 3.1524ms 200 text/html; charset=UTF-8
2017-06-10 12:43:59.064 +00:00 [Information] You are using the in-memory version of the persisted grant store. This will store consent decisions, authorization codes, refresh and reference tokens in memory only. If you are using any of those features in production, you want to switch to a different store implementation.
2017-06-10 12:43:59.118 +00:00 [Debug] Using built-in CookieAuthentication middleware with scheme: "idsrv"
2017-06-10 12:43:59.122 +00:00 [Debug] Adding CookieAuthentication middleware for external authentication with scheme: "idsrv.external"
2017-06-10 12:43:59.302 +00:00 [Information] User profile is available. Using '"/root/.aspnet/DataProtection-Keys"' as key repository; keys will not be encrypted at rest.
2017-06-10 12:44:13.602 +00:00 [Information] Request starting HTTP/1.1 GET http://localhost:5005/.well-known/openid-configuration  
2017-06-10 12:44:13.629 +00:00 [Debug] CORS request made for path: "/.well-known/openid-configuration" from origin: "http://localhost:5007"
2017-06-10 12:44:13.638 +00:00 [Debug] Client list checked and origin: "http://localhost:5007" is allowed
2017-06-10 12:44:13.642 +00:00 [Debug] CorsPolicyService allowed origin: "http://localhost:5007"
2017-06-10 12:44:13.726 +00:00 [Debug] Request path "/.well-known/openid-configuration" matched to endpoint type Discovery
2017-06-10 12:44:13.730 +00:00 [Debug] Mapping found for endpoint: Discovery, creating handler: "IdentityServer4.Endpoints.DiscoveryEndpoint"
2017-06-10 12:44:13.739 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.DiscoveryEndpoint" for "/.well-known/openid-configuration"
2017-06-10 12:44:13.742 +00:00 [Verbose] Processing discovery request.
2017-06-10 12:44:13.746 +00:00 [Debug] Start discovery request
2017-06-10 12:44:13.773 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.DiscoveryDocumentResult"
2017-06-10 12:44:13.908 +00:00 [Information] Request finished in 315.5595ms 200 application/json
2017-06-10 12:44:13.922 +00:00 [Information] Request starting HTTP/1.1 GET http://localhost:5005/connect/checksession  
2017-06-10 12:44:13.981 +00:00 [Information] HttpContext.User merged via AutomaticAuthentication from authenticationScheme: "idsrv".
2017-06-10 12:44:13.993 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 12:44:13.996 +00:00 [Debug] Request path "/connect/checksession" matched to endpoint type CheckSession
2017-06-10 12:44:13.996 +00:00 [Debug] Mapping found for endpoint: CheckSession, creating handler: "IdentityServer4.Endpoints.CheckSessionEndpoint"
2017-06-10 12:44:13.997 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.CheckSessionEndpoint" for "/connect/checksession"
2017-06-10 12:44:13.998 +00:00 [Debug] Rendering check session result
2017-06-10 12:44:13.998 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.CheckSessionResult"
2017-06-10 12:44:14.010 +00:00 [Information] Request finished in 87.7413ms 200 text/html; charset=UTF-8
2017-06-10 12:46:40.534 +00:00 [Information] You are using the in-memory version of the persisted grant store. This will store consent decisions, authorization codes, refresh and reference tokens in memory only. If you are using any of those features in production, you want to switch to a different store implementation.
2017-06-10 12:46:40.595 +00:00 [Debug] Using built-in CookieAuthentication middleware with scheme: "idsrv"
2017-06-10 12:46:40.608 +00:00 [Debug] Adding CookieAuthentication middleware for external authentication with scheme: "idsrv.external"
2017-06-10 12:46:40.897 +00:00 [Information] User profile is available. Using '"/root/.aspnet/DataProtection-Keys"' as key repository; keys will not be encrypted at rest.
2017-06-10 12:47:10.733 +00:00 [Information] Request starting HTTP/1.1 GET http://localhost:5005/.well-known/openid-configuration  
2017-06-10 12:47:10.752 +00:00 [Debug] CORS request made for path: "/.well-known/openid-configuration" from origin: "http://localhost:5007"
2017-06-10 12:47:10.757 +00:00 [Debug] Client list checked and origin: "http://localhost:5007" is allowed
2017-06-10 12:47:10.758 +00:00 [Debug] CorsPolicyService allowed origin: "http://localhost:5007"
2017-06-10 12:47:10.812 +00:00 [Debug] Request path "/.well-known/openid-configuration" matched to endpoint type Discovery
2017-06-10 12:47:10.818 +00:00 [Debug] Mapping found for endpoint: Discovery, creating handler: "IdentityServer4.Endpoints.DiscoveryEndpoint"
2017-06-10 12:47:10.823 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.DiscoveryEndpoint" for "/.well-known/openid-configuration"
2017-06-10 12:47:10.826 +00:00 [Verbose] Processing discovery request.
2017-06-10 12:47:10.830 +00:00 [Debug] Start discovery request
2017-06-10 12:47:10.854 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.DiscoveryDocumentResult"
2017-06-10 12:47:10.964 +00:00 [Information] Request finished in 236.4723ms 200 application/json
2017-06-10 12:47:10.981 +00:00 [Information] Request starting HTTP/1.1 GET http://localhost:5005/connect/checksession  
2017-06-10 12:47:11.033 +00:00 [Information] HttpContext.User merged via AutomaticAuthentication from authenticationScheme: "idsrv".
2017-06-10 12:47:11.035 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 12:47:11.042 +00:00 [Debug] Request path "/connect/checksession" matched to endpoint type CheckSession
2017-06-10 12:47:11.043 +00:00 [Debug] Mapping found for endpoint: CheckSession, creating handler: "IdentityServer4.Endpoints.CheckSessionEndpoint"
2017-06-10 12:47:11.044 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.CheckSessionEndpoint" for "/connect/checksession"
2017-06-10 12:47:11.047 +00:00 [Debug] Rendering check session result
2017-06-10 12:47:11.049 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.CheckSessionResult"
2017-06-10 12:47:11.063 +00:00 [Information] Request finished in 81.3502ms 200 text/html; charset=UTF-8
2017-06-10 12:47:39.376 +00:00 [Information] Request starting HTTP/1.1 GET http://localhost:5005/.well-known/openid-configuration  
2017-06-10 12:47:39.377 +00:00 [Debug] CORS request made for path: "/.well-known/openid-configuration" from origin: "http://localhost:5007"
2017-06-10 12:47:39.378 +00:00 [Debug] Client list checked and origin: "http://localhost:5007" is allowed
2017-06-10 12:47:39.378 +00:00 [Debug] CorsPolicyService allowed origin: "http://localhost:5007"
2017-06-10 12:47:39.378 +00:00 [Debug] Request path "/.well-known/openid-configuration" matched to endpoint type Discovery
2017-06-10 12:47:39.379 +00:00 [Debug] Mapping found for endpoint: Discovery, creating handler: "IdentityServer4.Endpoints.DiscoveryEndpoint"
2017-06-10 12:47:39.379 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.DiscoveryEndpoint" for "/.well-known/openid-configuration"
2017-06-10 12:47:39.379 +00:00 [Verbose] Processing discovery request.
2017-06-10 12:47:39.380 +00:00 [Debug] Start discovery request
2017-06-10 12:47:39.381 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.DiscoveryDocumentResult"
2017-06-10 12:47:39.382 +00:00 [Information] Request finished in 5.4045ms 200 application/json
2017-06-10 12:47:39.445 +00:00 [Information] Request starting HTTP/1.1 GET http://localhost:5005/connect/checksession  
2017-06-10 12:47:39.447 +00:00 [Information] HttpContext.User merged via AutomaticAuthentication from authenticationScheme: "idsrv".
2017-06-10 12:47:39.447 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 12:47:39.447 +00:00 [Debug] Request path "/connect/checksession" matched to endpoint type CheckSession
2017-06-10 12:47:39.448 +00:00 [Debug] Mapping found for endpoint: CheckSession, creating handler: "IdentityServer4.Endpoints.CheckSessionEndpoint"
2017-06-10 12:47:39.448 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.CheckSessionEndpoint" for "/connect/checksession"
2017-06-10 12:47:39.448 +00:00 [Debug] Rendering check session result
2017-06-10 12:47:39.448 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.CheckSessionResult"
2017-06-10 12:47:39.449 +00:00 [Information] Request finished in 3.618ms 200 text/html; charset=UTF-8
2017-06-10 12:47:41.177 +00:00 [Information] Request starting HTTP/1.1 GET http://localhost:5005/connect/authorize?client_id=http%3A%2F%2Flocalhost%3A5007&redirect_uri=http%3A%2F%2Flocalhost%3A5007%2Fcallback.html&response_type=id_token%20token&scope=openid%20profile%20productapi&state=8e41cb461024472895160e7110bc033b&nonce=abd6b8d1b42144349ea9d363ca3e4372  
2017-06-10 12:47:41.178 +00:00 [Information] HttpContext.User merged via AutomaticAuthentication from authenticationScheme: "idsrv".
2017-06-10 12:47:41.178 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 12:47:41.179 +00:00 [Debug] Request path "/connect/authorize" matched to endpoint type Authorize
2017-06-10 12:47:41.179 +00:00 [Debug] Mapping found for endpoint: Authorize, creating handler: "IdentityServer4.Endpoints.AuthorizeEndpoint"
2017-06-10 12:47:41.192 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.AuthorizeEndpoint" for "/connect/authorize"
2017-06-10 12:47:41.201 +00:00 [Debug] Start authorize request
2017-06-10 12:47:41.245 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 12:47:41.254 +00:00 [Debug] User in authorize request: "2"
2017-06-10 12:47:41.258 +00:00 [Debug] Start authorize request protocol validation
2017-06-10 12:47:41.308 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 12:47:41.308 +00:00 [Debug] Calling into custom validator: "IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator"
2017-06-10 12:47:41.309 +00:00 [Verbose] Authorize request protocol validation successful
2017-06-10 12:47:41.331 +00:00 [Information] ValidatedAuthorizeRequest
"{
  \"ClientId\": \"http://localhost:5007\",
  \"ClientName\": \"SPAClient\",
  \"RedirectUri\": \"http://localhost:5007/callback.html\",
  \"AllowedRedirectUris\": [
    \"http://localhost:5007/callback.html\"
  ],
  \"SubjectId\": \"2\",
  \"ResponseType\": \"id_token token\",
  \"ResponseMode\": \"fragment\",
  \"GrantType\": \"implicit\",
  \"RequestedScopes\": \"openid profile productapi\",
  \"State\": \"8e41cb461024472895160e7110bc033b\",
  \"Nonce\": \"abd6b8d1b42144349ea9d363ca3e4372\",
  \"SessionId\": \"cb57b9555579372d1ec4a58eff48d40c\",
  \"Raw\": {
    \"client_id\": \"http://localhost:5007\",
    \"redirect_uri\": \"http://localhost:5007/callback.html\",
    \"response_type\": \"id_token token\",
    \"scope\": \"openid profile productapi\",
    \"state\": \"8e41cb461024472895160e7110bc033b\",
    \"nonce\": \"abd6b8d1b42144349ea9d363ca3e4372\"
  }
}"
2017-06-10 12:47:41.337 +00:00 [Verbose] ProcessInteractionAsync
2017-06-10 12:47:41.361 +00:00 [Debug] "user_consent" grant with value: "http://localhost:5007|2" not found in store.
2017-06-10 12:47:41.361 +00:00 [Information] Showing consent: User has not yet consented
2017-06-10 12:47:41.362 +00:00 [Verbose] End authorize request. result type: "IdentityServer4.Endpoints.Results.ConsentPageResult"
2017-06-10 12:47:41.363 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.ConsentPageResult"
2017-06-10 12:47:41.375 +00:00 [Information] Request finished in 198.1353ms 302 
2017-06-10 12:47:41.381 +00:00 [Information] Request starting HTTP/1.1 GET http://localhost:5005/consent?returnUrl=%2Fconnect%2Fauthorize%2Fconsent%3Fclient_id%3Dhttp%253A%252F%252Flocalhost%253A5007%26redirect_uri%3Dhttp%253A%252F%252Flocalhost%253A5007%252Fcallback.html%26response_type%3Did_token%2520token%26scope%3Dopenid%2520profile%2520productapi%26state%3D8e41cb461024472895160e7110bc033b%26nonce%3Dabd6b8d1b42144349ea9d363ca3e4372  
2017-06-10 12:47:41.381 +00:00 [Information] HttpContext.User merged via AutomaticAuthentication from authenticationScheme: "idsrv".
2017-06-10 12:47:41.382 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 12:47:41.382 +00:00 [Verbose] No endpoint entry found for request path: "/consent"
2017-06-10 12:47:41.647 +00:00 [Information] Executing action method "IdentityServer4.Quickstart.UI.ConsentController.Index (SpaIdSrv)" with arguments (["/connect/authorize/consent?client_id=http%3A%2F%2Flocalhost%3A5007&redirect_uri=http%3A%2F%2Flocalhost%3A5007%2Fcallback.html&response_type=id_token%20token&scope=openid%20profile%20productapi&state=8e41cb461024472895160e7110bc033b&nonce=abd6b8d1b42144349ea9d363ca3e4372"]) - ModelState is Valid
2017-06-10 12:47:41.663 +00:00 [Verbose] returnUrl is valid
2017-06-10 12:47:41.666 +00:00 [Verbose] returnUrl is valid
2017-06-10 12:47:41.668 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 12:47:41.669 +00:00 [Debug] Start authorize request protocol validation
2017-06-10 12:47:41.670 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 12:47:41.670 +00:00 [Debug] Calling into custom validator: "IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator"
2017-06-10 12:47:41.670 +00:00 [Verbose] Authorize request protocol validation successful
2017-06-10 12:47:41.671 +00:00 [Verbose] AuthorizationRequest being returned
2017-06-10 12:47:41.677 +00:00 [Verbose] AuthorizationRequest being returned
2017-06-10 12:47:45.399 +00:00 [Information] Executing ViewResult, running view at path "/Views/Consent/Index.cshtml".
2017-06-10 12:47:45.871 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 12:47:45.901 +00:00 [Information] Executed action "IdentityServer4.Quickstart.UI.ConsentController.Index (SpaIdSrv)" in 4353.0148ms
2017-06-10 12:47:45.909 +00:00 [Information] Request finished in 4527.4856ms 200 text/html; charset=utf-8
2017-06-10 12:47:48.650 +00:00 [Information] Request starting HTTP/1.1 POST http://localhost:5005/consent application/x-www-form-urlencoded 667
2017-06-10 12:47:48.650 +00:00 [Information] HttpContext.User merged via AutomaticAuthentication from authenticationScheme: "idsrv".
2017-06-10 12:47:48.651 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 12:47:48.651 +00:00 [Verbose] No endpoint entry found for request path: "/consent"
2017-06-10 12:47:48.692 +00:00 [Information] Executing action method "IdentityServer4.Quickstart.UI.ConsentController.Index (SpaIdSrv)" with arguments (["IdentityServer4.Quickstart.UI.ConsentInputModel"]) - ModelState is Valid
2017-06-10 12:47:48.698 +00:00 [Verbose] returnUrl is valid
2017-06-10 12:47:48.699 +00:00 [Verbose] returnUrl is valid
2017-06-10 12:47:48.699 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 12:47:48.699 +00:00 [Debug] Start authorize request protocol validation
2017-06-10 12:47:48.699 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 12:47:48.699 +00:00 [Debug] Calling into custom validator: "IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator"
2017-06-10 12:47:48.699 +00:00 [Verbose] Authorize request protocol validation successful
2017-06-10 12:47:48.699 +00:00 [Verbose] AuthorizationRequest being returned
2017-06-10 12:47:48.699 +00:00 [Verbose] AuthorizationRequest being returned
2017-06-10 12:47:48.707 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 12:47:48.721 +00:00 [Verbose] Protecting message: "{\"Created\":636326956687126690,\"Data\":{\"Granted\":true,\"ScopesConsented\":[\"openid\",\"profile\",\"productapi\"]}}"
2017-06-10 12:47:48.726 +00:00 [Information] Executing RedirectResult, redirecting to "/connect/authorize/consent?client_id=http%3A%2F%2Flocalhost%3A5007&redirect_uri=http%3A%2F%2Flocalhost%3A5007%2Fcallback.html&response_type=id_token%20token&scope=openid%20profile%20productapi&state=8e41cb461024472895160e7110bc033b&nonce=abd6b8d1b42144349ea9d363ca3e4372".
2017-06-10 12:47:48.726 +00:00 [Information] Executed action "IdentityServer4.Quickstart.UI.ConsentController.Index (SpaIdSrv)" in 71.4697ms
2017-06-10 12:47:48.727 +00:00 [Information] Request finished in 76.6599ms 302 
2017-06-10 12:47:48.734 +00:00 [Information] Request starting HTTP/1.1 GET http://localhost:5005/connect/authorize/consent?client_id=http%3A%2F%2Flocalhost%3A5007&redirect_uri=http%3A%2F%2Flocalhost%3A5007%2Fcallback.html&response_type=id_token%20token&scope=openid%20profile%20productapi&state=8e41cb461024472895160e7110bc033b&nonce=abd6b8d1b42144349ea9d363ca3e4372  
2017-06-10 12:47:48.737 +00:00 [Information] HttpContext.User merged via AutomaticAuthentication from authenticationScheme: "idsrv".
2017-06-10 12:47:48.738 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 12:47:48.738 +00:00 [Debug] Request path "/connect/authorize/consent" matched to endpoint type Authorize
2017-06-10 12:47:48.739 +00:00 [Debug] Mapping found for endpoint: Authorize, creating handler: "IdentityServer4.Endpoints.AuthorizeEndpoint"
2017-06-10 12:47:48.739 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.AuthorizeEndpoint" for "/connect/authorize/consent"
2017-06-10 12:47:48.759 +00:00 [Debug] Start authorize request (after consent)
2017-06-10 12:47:48.760 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 12:47:48.771 +00:00 [Debug] User in authorize request: "2"
2017-06-10 12:47:48.771 +00:00 [Debug] Start authorize request protocol validation
2017-06-10 12:47:48.772 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 12:47:48.774 +00:00 [Debug] Calling into custom validator: "IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator"
2017-06-10 12:47:48.774 +00:00 [Verbose] Authorize request protocol validation successful
2017-06-10 12:47:48.775 +00:00 [Information] ValidatedAuthorizeRequest
"{
  \"ClientId\": \"http://localhost:5007\",
  \"ClientName\": \"SPAClient\",
  \"RedirectUri\": \"http://localhost:5007/callback.html\",
  \"AllowedRedirectUris\": [
    \"http://localhost:5007/callback.html\"
  ],
  \"SubjectId\": \"2\",
  \"ResponseType\": \"id_token token\",
  \"ResponseMode\": \"fragment\",
  \"GrantType\": \"implicit\",
  \"RequestedScopes\": \"openid profile productapi\",
  \"State\": \"8e41cb461024472895160e7110bc033b\",
  \"Nonce\": \"abd6b8d1b42144349ea9d363ca3e4372\",
  \"SessionId\": \"cb57b9555579372d1ec4a58eff48d40c\",
  \"Raw\": {
    \"client_id\": \"http://localhost:5007\",
    \"redirect_uri\": \"http://localhost:5007/callback.html\",
    \"response_type\": \"id_token token\",
    \"scope\": \"openid profile productapi\",
    \"state\": \"8e41cb461024472895160e7110bc033b\",
    \"nonce\": \"abd6b8d1b42144349ea9d363ca3e4372\"
  }
}"
2017-06-10 12:47:48.777 +00:00 [Verbose] ProcessInteractionAsync
2017-06-10 12:47:48.778 +00:00 [Debug] "user_consent" grant with value: "http://localhost:5007|2" not found in store.
2017-06-10 12:47:48.778 +00:00 [Verbose] Consent was shown to user
2017-06-10 12:47:48.789 +00:00 [Information] User consented to scopes: ["openid", "profile", "productapi"]
2017-06-10 12:47:48.803 +00:00 [Debug] Creating Implicit Flow response.
2017-06-10 12:47:48.807 +00:00 [Verbose] Creating access token
2017-06-10 12:47:48.815 +00:00 [Debug] Getting claims for access token for client: "http://localhost:5007"
2017-06-10 12:47:48.815 +00:00 [Debug] Getting claims for access token for subject: "2"
2017-06-10 12:47:48.820 +00:00 [Debug] Get profile called for subject "2" from client "SPAClient" with claim types [] via "ClaimsProviderAccessToken"
2017-06-10 12:47:48.825 +00:00 [Verbose] Creating JWT access token
2017-06-10 12:47:49.026 +00:00 [Verbose] Creating identity token
2017-06-10 12:47:49.032 +00:00 [Debug] Getting claims for identity token for subject: "2" and client: "http://localhost:5007"
2017-06-10 12:47:49.032 +00:00 [Debug] In addition to an id_token, an access_token was requested. No claims other than sub are included in the id_token. To obtain more user claims, either use the user info endpoint or set AlwaysIncludeUserClaimsInIdToken on the client configuration.
2017-06-10 12:47:49.033 +00:00 [Verbose] Creating JWT identity token
2017-06-10 12:47:49.038 +00:00 [Verbose] Identity token issued for "http://localhost:5007 (SPAClient)" / "2": "eyJhbGciOiJSUzI1NiIsImtpZCI6ImI4YzlmMzM2N2ViMDQzZGU5MzNlYmE4NmZhNTljMjBjIiwidHlwIjoiSldUIn0.eyJuYmYiOjE0OTcwOTg4NjksImV4cCI6MTQ5NzA5OTE2OSwiaXNzIjoiaHR0cDovL2xvY2FsaG9zdDo1MDA1IiwiYXVkIjoiaHR0cDovL2xvY2FsaG9zdDo1MDA3Iiwibm9uY2UiOiJhYmQ2YjhkMWI0MjE0NDM0OWVhOWQzNjNjYTNlNDM3MiIsImlhdCI6MTQ5NzA5ODg2OSwiYXRfaGFzaCI6IkhfUDlpTmIxOUZBTURqU3dXVXBJaVEiLCJzaWQiOiJjYjU3Yjk1NTU1NzkzNzJkMWVjNGE1OGVmZjQ4ZDQwYyIsInN1YiI6IjIiLCJhdXRoX3RpbWUiOjE0OTcwOTc0MzYsImlkcCI6ImxvY2FsIiwiYW1yIjpbInB3ZCJdfQ.NunndOxkV1YIGujPSRuoFfW0XtSXMdS-1MmCZoMkKhOx_b60pa74wLQBr8yD_NeUnAc8KssE1G9gR2vOWfhTPljzCzbzMq36ff8eVjzWSHGOU-vYEHGiOZUqpCZhswbH6HCBQojqTW483yqe6_362p1qgmF_T_oVlYboIgfcJLZkP22K6WfYK3Eb5npYEc3REYVntdePuikO-ncI48wHnqp6yPSSGiBXugrtdFPsN5pgToFyd8wmev0FLtLp4Rcuugt3SbMlpnVkjmstzmZYxjJBw4oKuhBa241LUfvtdkgQLduofPj2JADhtfuKu7pzpF_tbmFlO5LJQXzJUtKs8Q"
2017-06-10 12:47:49.039 +00:00 [Verbose] Access token issued for "http://localhost:5007 (SPAClient)" / "2": "eyJhbGciOiJSUzI1NiIsImtpZCI6ImI4YzlmMzM2N2ViMDQzZGU5MzNlYmE4NmZhNTljMjBjIiwidHlwIjoiSldUIn0.eyJuYmYiOjE0OTcwOTg4NjgsImV4cCI6MTQ5NzEwMjQ2OCwiaXNzIjoiaHR0cDovL2xvY2FsaG9zdDo1MDA1IiwiYXVkIjpbImh0dHA6Ly9sb2NhbGhvc3Q6NTAwNS9yZXNvdXJjZXMiLCJwcm9kdWN0YXBpIl0sImNsaWVudF9pZCI6Imh0dHA6Ly9sb2NhbGhvc3Q6NTAwNyIsInN1YiI6IjIiLCJhdXRoX3RpbWUiOjE0OTcwOTc0MzYsImlkcCI6ImxvY2FsIiwic2NvcGUiOlsib3BlbmlkIiwicHJvZmlsZSIsInByb2R1Y3RhcGkiXSwiYW1yIjpbInB3ZCJdfQ.tdpxW4aNCdlwCWLAOPJ4yQKgQ3yYDzdjs9BSi_JlkdchieIFJpSkm_BuCMY1bx_vsyNiV99L07nzozsC9vj1rIm8vOQP9Ch4ppKcpdSgCgfPgZCCL44bVje_t3rcvH2qcsT5Z1uMP94AP1_cpoiFBhHj3XlF-Ye5a4R3dCTkMBSWm5MSWpJ-6qw-t56TsMDPtkJyv1g-vgOuMoIkX2GWvIh7J-R0gdSfdJuO2rUHd0aKgJWV9eoCNYlQx0-pms4j0fZpkCd1t6InW-swkqM2TkePBuF0pINKqkqZ09uppCw2u0a3wtrqcr-oqP7P7t8qm0h8Q7qES7ycpt1osQfsyw"
2017-06-10 12:47:49.053 +00:00 [Information] Authorize endpoint response
"{
  \"SubjectId\": \"2\",
  \"ClientId\": \"http://localhost:5007\",
  \"RedirectUri\": \"http://localhost:5007/callback.html\",
  \"State\": \"8e41cb461024472895160e7110bc033b\",
  \"Scope\": \"openid profile productapi\"
}"
2017-06-10 12:47:49.053 +00:00 [Verbose] End Authorize Request. Result type: "IdentityServer4.Endpoints.Results.AuthorizeResult"
2017-06-10 12:47:49.056 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.AuthorizeResult"
2017-06-10 12:47:49.073 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 12:47:49.083 +00:00 [Information] Request finished in 348.8237ms 302 
2017-06-10 12:47:49.425 +00:00 [Information] Request starting HTTP/1.1 GET http://localhost:5005/.well-known/openid-configuration  
2017-06-10 12:47:49.425 +00:00 [Debug] CORS request made for path: "/.well-known/openid-configuration" from origin: "http://localhost:5007"
2017-06-10 12:47:49.426 +00:00 [Debug] Client list checked and origin: "http://localhost:5007" is allowed
2017-06-10 12:47:49.426 +00:00 [Debug] CorsPolicyService allowed origin: "http://localhost:5007"
2017-06-10 12:47:49.426 +00:00 [Debug] Request path "/.well-known/openid-configuration" matched to endpoint type Discovery
2017-06-10 12:47:49.426 +00:00 [Debug] Mapping found for endpoint: Discovery, creating handler: "IdentityServer4.Endpoints.DiscoveryEndpoint"
2017-06-10 12:47:49.426 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.DiscoveryEndpoint" for "/.well-known/openid-configuration"
2017-06-10 12:47:49.426 +00:00 [Verbose] Processing discovery request.
2017-06-10 12:47:49.426 +00:00 [Debug] Start discovery request
2017-06-10 12:47:49.426 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.DiscoveryDocumentResult"
2017-06-10 12:47:49.427 +00:00 [Information] Request finished in 1.5196ms 200 application/json
2017-06-10 12:47:49.481 +00:00 [Information] Request starting HTTP/1.1 GET http://localhost:5005/.well-known/openid-configuration/jwks  
2017-06-10 12:47:49.481 +00:00 [Debug] CORS request made for path: "/.well-known/openid-configuration/jwks" from origin: "http://localhost:5007"
2017-06-10 12:47:49.481 +00:00 [Debug] Client list checked and origin: "http://localhost:5007" is allowed
2017-06-10 12:47:49.481 +00:00 [Debug] CorsPolicyService allowed origin: "http://localhost:5007"
2017-06-10 12:47:49.481 +00:00 [Debug] Request path "/.well-known/openid-configuration/jwks" matched to endpoint type Discovery
2017-06-10 12:47:49.481 +00:00 [Debug] Mapping found for endpoint: Discovery, creating handler: "IdentityServer4.Endpoints.DiscoveryEndpoint"
2017-06-10 12:47:49.481 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.DiscoveryEndpoint" for "/.well-known/openid-configuration/jwks"
2017-06-10 12:47:49.481 +00:00 [Verbose] Processing discovery request.
2017-06-10 12:47:49.485 +00:00 [Debug] Start key discovery request
2017-06-10 12:47:49.491 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.JsonWebKeysResult"
2017-06-10 12:47:49.516 +00:00 [Information] Request finished in 35.8317ms 200 application/json
2017-06-10 12:47:49.539 +00:00 [Information] Request starting HTTP/1.1 OPTIONS http://localhost:5005/connect/userinfo  
2017-06-10 12:47:49.539 +00:00 [Debug] CORS request made for path: "/connect/userinfo" from origin: "http://localhost:5007"
2017-06-10 12:47:49.539 +00:00 [Debug] Client list checked and origin: "http://localhost:5007" is allowed
2017-06-10 12:47:49.540 +00:00 [Debug] CorsPolicyService allowed origin: "http://localhost:5007"
2017-06-10 12:47:49.543 +00:00 [Information] Request finished in 4.3721ms 204 
2017-06-10 12:47:49.550 +00:00 [Information] Request starting HTTP/1.1 GET http://localhost:5005/connect/userinfo  
2017-06-10 12:47:49.550 +00:00 [Debug] CORS request made for path: "/connect/userinfo" from origin: "http://localhost:5007"
2017-06-10 12:47:49.550 +00:00 [Debug] Client list checked and origin: "http://localhost:5007" is allowed
2017-06-10 12:47:49.550 +00:00 [Debug] CorsPolicyService allowed origin: "http://localhost:5007"
2017-06-10 12:47:49.551 +00:00 [Debug] Request path "/connect/userinfo" matched to endpoint type UserInfo
2017-06-10 12:47:49.551 +00:00 [Debug] Mapping found for endpoint: UserInfo, creating handler: "IdentityServer4.Endpoints.UserInfoEndpoint"
2017-06-10 12:47:49.553 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.UserInfoEndpoint" for "/connect/userinfo"
2017-06-10 12:47:49.561 +00:00 [Debug] Start userinfo request
2017-06-10 12:47:49.566 +00:00 [Information] ValidateAsync: Locating bearer token
2017-06-10 12:47:49.569 +00:00 [Verbose] Authorization header value found
2017-06-10 12:47:49.569 +00:00 [Verbose] Authorization scheme is bearer
2017-06-10 12:47:49.571 +00:00 [Debug] Bearer token found in header
2017-06-10 12:47:49.572 +00:00 [Debug] Token found: "AuthorizationHeader"
2017-06-10 12:47:49.580 +00:00 [Verbose] Start access token validation
2017-06-10 12:47:49.639 +00:00 [Debug] Token validation success
"{
  \"ValidateLifetime\": true,
  \"AccessTokenType\": \"Jwt\",
  \"ExpectedScope\": \"openid\",
  \"Claims\": {
    \"nbf\": 1497098868,
    \"exp\": 1497102468,
    \"iss\": \"http://localhost:5005\",
    \"aud\": [
      \"http://localhost:5005/resources\",
      \"productapi\"
    ],
    \"client_id\": \"http://localhost:5007\",
    \"sub\": \"2\",
    \"auth_time\": 1497097436,
    \"idp\": \"local\",
    \"scope\": [
      \"openid\",
      \"profile\",
      \"productapi\"
    ],
    \"amr\": \"pwd\"
  }
}"
2017-06-10 12:47:49.652 +00:00 [Verbose] Creating userinfo response
2017-06-10 12:47:49.657 +00:00 [Debug] Scopes in access token: "openid profile productapi"
2017-06-10 12:47:49.660 +00:00 [Debug] Requested claim types: "sub name family_name given_name middle_name nickname preferred_username profile picture website gender birthdate zoneinfo locale updated_at"
2017-06-10 12:47:49.662 +00:00 [Debug] Get profile called for subject "2" from client "SPAClient" with claim types ["sub", "name", "family_name", "given_name", "middle_name", "nickname", "preferred_username", "profile", "picture", "website", "gender", "birthdate", "zoneinfo", "locale", "updated_at"] via "UserInfoEndpoint"
2017-06-10 12:47:49.665 +00:00 [Information] Profile service returned to the following claim types: ""
2017-06-10 12:47:49.665 +00:00 [Debug] End userinfo request
2017-06-10 12:47:49.666 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.UserInfoResult"
2017-06-10 12:47:49.671 +00:00 [Information] Request finished in 120.6257ms 200 application/json
2017-06-10 12:47:49.683 +00:00 [Information] Request starting HTTP/1.1 GET http://localhost:5005/connect/checksession  
2017-06-10 12:47:49.684 +00:00 [Information] HttpContext.User merged via AutomaticAuthentication from authenticationScheme: "idsrv".
2017-06-10 12:47:49.684 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 12:47:49.685 +00:00 [Debug] Request path "/connect/checksession" matched to endpoint type CheckSession
2017-06-10 12:47:49.690 +00:00 [Debug] Mapping found for endpoint: CheckSession, creating handler: "IdentityServer4.Endpoints.CheckSessionEndpoint"
2017-06-10 12:47:49.692 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.CheckSessionEndpoint" for "/connect/checksession"
2017-06-10 12:47:49.692 +00:00 [Debug] Rendering check session result
2017-06-10 12:47:49.692 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.CheckSessionResult"
2017-06-10 12:47:49.693 +00:00 [Information] Request finished in 9.9299ms 200 text/html; charset=UTF-8
2017-06-10 12:47:49.956 +00:00 [Information] Request starting HTTP/1.1 GET http://localhost:5005/.well-known/openid-configuration  
2017-06-10 12:47:49.956 +00:00 [Debug] CORS request made for path: "/.well-known/openid-configuration" from origin: "http://localhost:5007"
2017-06-10 12:47:49.956 +00:00 [Debug] Client list checked and origin: "http://localhost:5007" is allowed
2017-06-10 12:47:49.957 +00:00 [Debug] CorsPolicyService allowed origin: "http://localhost:5007"
2017-06-10 12:47:49.957 +00:00 [Debug] Request path "/.well-known/openid-configuration" matched to endpoint type Discovery
2017-06-10 12:47:49.957 +00:00 [Debug] Mapping found for endpoint: Discovery, creating handler: "IdentityServer4.Endpoints.DiscoveryEndpoint"
2017-06-10 12:47:49.957 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.DiscoveryEndpoint" for "/.well-known/openid-configuration"
2017-06-10 12:47:49.957 +00:00 [Verbose] Processing discovery request.
2017-06-10 12:47:49.958 +00:00 [Debug] Start discovery request
2017-06-10 12:47:49.958 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.DiscoveryDocumentResult"
2017-06-10 12:47:49.959 +00:00 [Information] Request finished in 2.638ms 200 application/json
2017-06-10 12:47:50.034 +00:00 [Information] Request starting HTTP/1.1 GET http://localhost:5005/connect/checksession  
2017-06-10 12:47:50.035 +00:00 [Information] HttpContext.User merged via AutomaticAuthentication from authenticationScheme: "idsrv".
2017-06-10 12:47:50.035 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 12:47:50.035 +00:00 [Debug] Request path "/connect/checksession" matched to endpoint type CheckSession
2017-06-10 12:47:50.035 +00:00 [Debug] Mapping found for endpoint: CheckSession, creating handler: "IdentityServer4.Endpoints.CheckSessionEndpoint"
2017-06-10 12:47:50.035 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.CheckSessionEndpoint" for "/connect/checksession"
2017-06-10 12:47:50.035 +00:00 [Debug] Rendering check session result
2017-06-10 12:47:50.035 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.CheckSessionResult"
2017-06-10 12:47:50.037 +00:00 [Information] Request finished in 2.1552ms 200 text/html; charset=UTF-8
2017-06-10 12:56:19.541 +00:00 [Information] You are using the in-memory version of the persisted grant store. This will store consent decisions, authorization codes, refresh and reference tokens in memory only. If you are using any of those features in production, you want to switch to a different store implementation.
2017-06-10 12:56:19.612 +00:00 [Debug] Using built-in CookieAuthentication middleware with scheme: "idsrv"
2017-06-10 12:56:19.616 +00:00 [Debug] Adding CookieAuthentication middleware for external authentication with scheme: "idsrv.external"
2017-06-10 12:56:19.858 +00:00 [Information] User profile is available. Using '"/root/.aspnet/DataProtection-Keys"' as key repository; keys will not be encrypted at rest.
2017-06-10 12:56:25.111 +00:00 [Information] Request starting HTTP/1.1 GET http://localhost:5005/.well-known/openid-configuration  
2017-06-10 12:56:25.131 +00:00 [Debug] CORS request made for path: "/.well-known/openid-configuration" from origin: "http://localhost:5007"
2017-06-10 12:56:25.137 +00:00 [Debug] Client list checked and origin: "http://localhost:5007" is allowed
2017-06-10 12:56:25.137 +00:00 [Debug] CorsPolicyService allowed origin: "http://localhost:5007"
2017-06-10 12:56:25.196 +00:00 [Debug] Request path "/.well-known/openid-configuration" matched to endpoint type Discovery
2017-06-10 12:56:25.202 +00:00 [Debug] Mapping found for endpoint: Discovery, creating handler: "IdentityServer4.Endpoints.DiscoveryEndpoint"
2017-06-10 12:56:25.205 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.DiscoveryEndpoint" for "/.well-known/openid-configuration"
2017-06-10 12:56:25.209 +00:00 [Verbose] Processing discovery request.
2017-06-10 12:56:25.213 +00:00 [Debug] Start discovery request
2017-06-10 12:56:25.237 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.DiscoveryDocumentResult"
2017-06-10 12:56:25.357 +00:00 [Information] Request finished in 253.8594ms 200 application/json
2017-06-10 12:56:25.365 +00:00 [Information] Request starting HTTP/1.1 GET http://localhost:5005/connect/checksession  
2017-06-10 12:56:25.408 +00:00 [Information] Creating key {e59e55d9-5c1b-4895-9bc5-58a0bb4c8b76} with creation date 2017-06-10 12:56:25Z, activation date 2017-06-10 12:56:25Z, and expiration date 2017-09-08 12:56:25Z.
2017-06-10 12:56:25.420 +00:00 [Warning] No XML encryptor configured. Key {e59e55d9-5c1b-4895-9bc5-58a0bb4c8b76} may be persisted to storage in unencrypted form.
2017-06-10 12:56:25.424 +00:00 [Information] Writing data to file '"/root/.aspnet/DataProtection-Keys/key-e59e55d9-5c1b-4895-9bc5-58a0bb4c8b76.xml"'.
2017-06-10 12:56:25.462 +00:00 [Information] "idsrv" was not authenticated. Failure message: "Unprotect ticket failed"
2017-06-10 12:56:25.469 +00:00 [Debug] Request path "/connect/checksession" matched to endpoint type CheckSession
2017-06-10 12:56:25.470 +00:00 [Debug] Mapping found for endpoint: CheckSession, creating handler: "IdentityServer4.Endpoints.CheckSessionEndpoint"
2017-06-10 12:56:25.471 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.CheckSessionEndpoint" for "/connect/checksession"
2017-06-10 12:56:25.476 +00:00 [Debug] Rendering check session result
2017-06-10 12:56:25.476 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.CheckSessionResult"
2017-06-10 12:56:25.492 +00:00 [Information] Request finished in 127.3476ms 200 text/html; charset=UTF-8
2017-06-10 13:08:15.157 +00:00 [Information] You are using the in-memory version of the persisted grant store. This will store consent decisions, authorization codes, refresh and reference tokens in memory only. If you are using any of those features in production, you want to switch to a different store implementation.
2017-06-10 13:08:15.254 +00:00 [Debug] Using built-in CookieAuthentication middleware with scheme: "idsrv"
2017-06-10 13:08:15.259 +00:00 [Debug] Adding CookieAuthentication middleware for external authentication with scheme: "idsrv.external"
2017-06-10 13:08:15.551 +00:00 [Information] User profile is available. Using '"/root/.aspnet/DataProtection-Keys"' as key repository; keys will not be encrypted at rest.
2017-06-10 13:10:47.603 +00:00 [Information] You are using the in-memory version of the persisted grant store. This will store consent decisions, authorization codes, refresh and reference tokens in memory only. If you are using any of those features in production, you want to switch to a different store implementation.
2017-06-10 13:10:47.652 +00:00 [Debug] Using built-in CookieAuthentication middleware with scheme: "idsrv"
2017-06-10 13:10:47.656 +00:00 [Debug] Adding CookieAuthentication middleware for external authentication with scheme: "idsrv.external"
2017-06-10 13:10:47.876 +00:00 [Information] User profile is available. Using '"/root/.aspnet/DataProtection-Keys"' as key repository; keys will not be encrypted at rest.
2017-06-10 13:11:35.289 +00:00 [Information] Request starting HTTP/1.1 GET http://localhost:5005/.well-known/openid-configuration  
2017-06-10 13:11:35.310 +00:00 [Debug] CORS request made for path: "/.well-known/openid-configuration" from origin: "http://localhost:5007"
2017-06-10 13:11:35.315 +00:00 [Debug] Client list checked and origin: "http://localhost:5007" is not allowed
2017-06-10 13:11:35.316 +00:00 [Warning] CorsPolicyService did not allow origin: "http://localhost:5007"
2017-06-10 13:11:35.381 +00:00 [Debug] Request path "/.well-known/openid-configuration" matched to endpoint type Discovery
2017-06-10 13:11:35.385 +00:00 [Debug] Mapping found for endpoint: Discovery, creating handler: "IdentityServer4.Endpoints.DiscoveryEndpoint"
2017-06-10 13:11:35.389 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.DiscoveryEndpoint" for "/.well-known/openid-configuration"
2017-06-10 13:11:35.392 +00:00 [Verbose] Processing discovery request.
2017-06-10 13:11:35.396 +00:00 [Debug] Start discovery request
2017-06-10 13:11:35.420 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.DiscoveryDocumentResult"
2017-06-10 13:11:35.531 +00:00 [Information] Request finished in 248.1074ms 200 application/json
2017-06-10 13:11:36.715 +00:00 [Information] Request starting HTTP/1.1 GET http://localhost:5005/.well-known/openid-configuration  
2017-06-10 13:11:36.716 +00:00 [Debug] CORS request made for path: "/.well-known/openid-configuration" from origin: "http://localhost:5007"
2017-06-10 13:11:36.740 +00:00 [Debug] Client list checked and origin: "http://localhost:5007" is not allowed
2017-06-10 13:11:36.741 +00:00 [Warning] CorsPolicyService did not allow origin: "http://localhost:5007"
2017-06-10 13:11:36.746 +00:00 [Debug] Request path "/.well-known/openid-configuration" matched to endpoint type Discovery
2017-06-10 13:11:36.746 +00:00 [Debug] Mapping found for endpoint: Discovery, creating handler: "IdentityServer4.Endpoints.DiscoveryEndpoint"
2017-06-10 13:11:36.747 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.DiscoveryEndpoint" for "/.well-known/openid-configuration"
2017-06-10 13:11:36.748 +00:00 [Verbose] Processing discovery request.
2017-06-10 13:11:36.748 +00:00 [Debug] Start discovery request
2017-06-10 13:11:36.752 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.DiscoveryDocumentResult"
2017-06-10 13:11:36.754 +00:00 [Information] Request finished in 39.3783ms 200 application/json
2017-06-10 13:11:56.281 +00:00 [Information] Request starting HTTP/1.1 GET http://localhost:5005/.well-known/openid-configuration  
2017-06-10 13:11:56.345 +00:00 [Information] "idsrv" was not authenticated. Failure message: "Unprotect ticket failed"
2017-06-10 13:11:56.348 +00:00 [Debug] Request path "/.well-known/openid-configuration" matched to endpoint type Discovery
2017-06-10 13:11:56.349 +00:00 [Debug] Mapping found for endpoint: Discovery, creating handler: "IdentityServer4.Endpoints.DiscoveryEndpoint"
2017-06-10 13:11:56.350 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.DiscoveryEndpoint" for "/.well-known/openid-configuration"
2017-06-10 13:11:56.351 +00:00 [Verbose] Processing discovery request.
2017-06-10 13:11:56.351 +00:00 [Debug] Start discovery request
2017-06-10 13:11:56.352 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.DiscoveryDocumentResult"
2017-06-10 13:11:56.353 +00:00 [Information] Request finished in 72.0716ms 200 application/json
2017-06-10 13:11:59.074 +00:00 [Information] Request starting HTTP/1.1 GET http://localhost:5005/.well-known/openid-configuration  
2017-06-10 13:11:59.074 +00:00 [Debug] CORS request made for path: "/.well-known/openid-configuration" from origin: "http://localhost:5007"
2017-06-10 13:11:59.074 +00:00 [Debug] Client list checked and origin: "http://localhost:5007" is not allowed
2017-06-10 13:11:59.075 +00:00 [Warning] CorsPolicyService did not allow origin: "http://localhost:5007"
2017-06-10 13:11:59.075 +00:00 [Debug] Request path "/.well-known/openid-configuration" matched to endpoint type Discovery
2017-06-10 13:11:59.075 +00:00 [Debug] Mapping found for endpoint: Discovery, creating handler: "IdentityServer4.Endpoints.DiscoveryEndpoint"
2017-06-10 13:11:59.076 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.DiscoveryEndpoint" for "/.well-known/openid-configuration"
2017-06-10 13:11:59.076 +00:00 [Verbose] Processing discovery request.
2017-06-10 13:11:59.076 +00:00 [Debug] Start discovery request
2017-06-10 13:11:59.076 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.DiscoveryDocumentResult"
2017-06-10 13:11:59.077 +00:00 [Information] Request finished in 3.8983ms 200 application/json
2017-06-10 13:12:06.938 +00:00 [Information] Request starting HTTP/1.1 GET http://localhost:5005/.well-known/openid-configuration  
2017-06-10 13:12:06.939 +00:00 [Debug] CORS request made for path: "/.well-known/openid-configuration" from origin: "http://localhost:5007"
2017-06-10 13:12:06.939 +00:00 [Debug] Client list checked and origin: "http://localhost:5007" is not allowed
2017-06-10 13:12:06.939 +00:00 [Warning] CorsPolicyService did not allow origin: "http://localhost:5007"
2017-06-10 13:12:06.939 +00:00 [Debug] Request path "/.well-known/openid-configuration" matched to endpoint type Discovery
2017-06-10 13:12:06.940 +00:00 [Debug] Mapping found for endpoint: Discovery, creating handler: "IdentityServer4.Endpoints.DiscoveryEndpoint"
2017-06-10 13:12:06.940 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.DiscoveryEndpoint" for "/.well-known/openid-configuration"
2017-06-10 13:12:06.940 +00:00 [Verbose] Processing discovery request.
2017-06-10 13:12:06.940 +00:00 [Debug] Start discovery request
2017-06-10 13:12:06.940 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.DiscoveryDocumentResult"
2017-06-10 13:12:06.941 +00:00 [Information] Request finished in 2.3416ms 200 application/json
2017-06-10 13:12:10.056 +00:00 [Information] Request starting HTTP/1.1 GET http://localhost:5005/.well-known/openid-configuration  
2017-06-10 13:12:10.057 +00:00 [Debug] CORS request made for path: "/.well-known/openid-configuration" from origin: "http://localhost:5007"
2017-06-10 13:12:10.058 +00:00 [Debug] Client list checked and origin: "http://localhost:5007" is not allowed
2017-06-10 13:12:10.058 +00:00 [Warning] CorsPolicyService did not allow origin: "http://localhost:5007"
2017-06-10 13:12:10.059 +00:00 [Debug] Request path "/.well-known/openid-configuration" matched to endpoint type Discovery
2017-06-10 13:12:10.060 +00:00 [Debug] Mapping found for endpoint: Discovery, creating handler: "IdentityServer4.Endpoints.DiscoveryEndpoint"
2017-06-10 13:12:10.061 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.DiscoveryEndpoint" for "/.well-known/openid-configuration"
2017-06-10 13:12:10.062 +00:00 [Verbose] Processing discovery request.
2017-06-10 13:12:10.062 +00:00 [Debug] Start discovery request
2017-06-10 13:12:10.064 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.DiscoveryDocumentResult"
2017-06-10 13:12:10.064 +00:00 [Information] Request finished in 8.2212ms 200 application/json
2017-06-10 13:12:11.442 +00:00 [Information] Request starting HTTP/1.1 GET http://localhost:5005/.well-known/openid-configuration  
2017-06-10 13:12:11.442 +00:00 [Debug] CORS request made for path: "/.well-known/openid-configuration" from origin: "http://localhost:5007"
2017-06-10 13:12:11.442 +00:00 [Debug] Client list checked and origin: "http://localhost:5007" is not allowed
2017-06-10 13:12:11.443 +00:00 [Warning] CorsPolicyService did not allow origin: "http://localhost:5007"
2017-06-10 13:12:11.444 +00:00 [Debug] Request path "/.well-known/openid-configuration" matched to endpoint type Discovery
2017-06-10 13:12:11.444 +00:00 [Debug] Mapping found for endpoint: Discovery, creating handler: "IdentityServer4.Endpoints.DiscoveryEndpoint"
2017-06-10 13:12:11.446 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.DiscoveryEndpoint" for "/.well-known/openid-configuration"
2017-06-10 13:12:11.447 +00:00 [Verbose] Processing discovery request.
2017-06-10 13:12:11.447 +00:00 [Debug] Start discovery request
2017-06-10 13:12:11.448 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.DiscoveryDocumentResult"
2017-06-10 13:12:11.449 +00:00 [Information] Request finished in 7.3254ms 200 application/json
2017-06-10 13:12:32.544 +00:00 [Information] Request starting HTTP/1.1 GET http://localhost:5005/.well-known/openid-configuration  
2017-06-10 13:12:32.546 +00:00 [Information] "idsrv" was not authenticated. Failure message: "Unprotect ticket failed"
2017-06-10 13:12:32.550 +00:00 [Debug] Request path "/.well-known/openid-configuration" matched to endpoint type Discovery
2017-06-10 13:12:32.552 +00:00 [Debug] Mapping found for endpoint: Discovery, creating handler: "IdentityServer4.Endpoints.DiscoveryEndpoint"
2017-06-10 13:12:32.552 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.DiscoveryEndpoint" for "/.well-known/openid-configuration"
2017-06-10 13:12:32.552 +00:00 [Verbose] Processing discovery request.
2017-06-10 13:12:32.552 +00:00 [Debug] Start discovery request
2017-06-10 13:12:32.553 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.DiscoveryDocumentResult"
2017-06-10 13:12:32.553 +00:00 [Information] Request finished in 8.9456ms 200 application/json
2017-06-10 13:12:36.228 +00:00 [Information] Request starting HTTP/1.1 GET http://localhost:5005/.well-known/openid-configuration  
2017-06-10 13:12:36.229 +00:00 [Information] "idsrv" was not authenticated. Failure message: "Unprotect ticket failed"
2017-06-10 13:12:36.229 +00:00 [Debug] Request path "/.well-known/openid-configuration" matched to endpoint type Discovery
2017-06-10 13:12:36.229 +00:00 [Debug] Mapping found for endpoint: Discovery, creating handler: "IdentityServer4.Endpoints.DiscoveryEndpoint"
2017-06-10 13:12:36.229 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.DiscoveryEndpoint" for "/.well-known/openid-configuration"
2017-06-10 13:12:36.229 +00:00 [Verbose] Processing discovery request.
2017-06-10 13:12:36.229 +00:00 [Debug] Start discovery request
2017-06-10 13:12:36.230 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.DiscoveryDocumentResult"
2017-06-10 13:12:36.230 +00:00 [Information] Request finished in 1.4917ms 200 application/json
2017-06-10 13:12:47.563 +00:00 [Information] Request starting HTTP/1.1 GET http://localhost:5005/.well-known/openid-configuration  
2017-06-10 13:12:47.563 +00:00 [Debug] CORS request made for path: "/.well-known/openid-configuration" from origin: "http://localhost:5007"
2017-06-10 13:12:47.563 +00:00 [Debug] Client list checked and origin: "http://localhost:5007" is not allowed
2017-06-10 13:12:47.563 +00:00 [Warning] CorsPolicyService did not allow origin: "http://localhost:5007"
2017-06-10 13:12:47.563 +00:00 [Debug] Request path "/.well-known/openid-configuration" matched to endpoint type Discovery
2017-06-10 13:12:47.563 +00:00 [Debug] Mapping found for endpoint: Discovery, creating handler: "IdentityServer4.Endpoints.DiscoveryEndpoint"
2017-06-10 13:12:47.563 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.DiscoveryEndpoint" for "/.well-known/openid-configuration"
2017-06-10 13:12:47.563 +00:00 [Verbose] Processing discovery request.
2017-06-10 13:12:47.564 +00:00 [Debug] Start discovery request
2017-06-10 13:12:47.564 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.DiscoveryDocumentResult"
2017-06-10 13:12:47.564 +00:00 [Information] Request finished in 1.512ms 200 application/json
2017-06-10 13:13:04.739 +00:00 [Information] Request starting HTTP/1.1 GET http://localhost:5005/.well-known/openid-configuration  
2017-06-10 13:13:04.740 +00:00 [Debug] CORS request made for path: "/.well-known/openid-configuration" from origin: "http://localhost:5007"
2017-06-10 13:13:04.740 +00:00 [Debug] Client list checked and origin: "http://localhost:5007" is not allowed
2017-06-10 13:13:04.740 +00:00 [Warning] CorsPolicyService did not allow origin: "http://localhost:5007"
2017-06-10 13:13:04.740 +00:00 [Debug] Request path "/.well-known/openid-configuration" matched to endpoint type Discovery
2017-06-10 13:13:04.740 +00:00 [Debug] Mapping found for endpoint: Discovery, creating handler: "IdentityServer4.Endpoints.DiscoveryEndpoint"
2017-06-10 13:13:04.740 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.DiscoveryEndpoint" for "/.well-known/openid-configuration"
2017-06-10 13:13:04.740 +00:00 [Verbose] Processing discovery request.
2017-06-10 13:13:04.740 +00:00 [Debug] Start discovery request
2017-06-10 13:13:04.740 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.DiscoveryDocumentResult"
2017-06-10 13:13:04.741 +00:00 [Information] Request finished in 1.4566ms 200 application/json
2017-06-10 13:13:24.993 +00:00 [Information] Request starting HTTP/1.1 GET http://localhost:5005/.well-known/openid-configuration  
2017-06-10 13:13:24.994 +00:00 [Debug] CORS request made for path: "/.well-known/openid-configuration" from origin: "http://localhost:5007"
2017-06-10 13:13:24.994 +00:00 [Debug] Client list checked and origin: "http://localhost:5007" is not allowed
2017-06-10 13:13:24.994 +00:00 [Warning] CorsPolicyService did not allow origin: "http://localhost:5007"
2017-06-10 13:13:24.995 +00:00 [Debug] Request path "/.well-known/openid-configuration" matched to endpoint type Discovery
2017-06-10 13:13:24.995 +00:00 [Debug] Mapping found for endpoint: Discovery, creating handler: "IdentityServer4.Endpoints.DiscoveryEndpoint"
2017-06-10 13:13:24.999 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.DiscoveryEndpoint" for "/.well-known/openid-configuration"
2017-06-10 13:13:24.999 +00:00 [Verbose] Processing discovery request.
2017-06-10 13:13:24.999 +00:00 [Debug] Start discovery request
2017-06-10 13:13:24.999 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.DiscoveryDocumentResult"
2017-06-10 13:13:24.999 +00:00 [Information] Request finished in 5.8878ms 200 application/json
2017-06-10 13:13:33.793 +00:00 [Information] Request starting HTTP/1.1 GET http://localhost:5005/.well-known/openid-configuration  
2017-06-10 13:13:33.793 +00:00 [Debug] CORS request made for path: "/.well-known/openid-configuration" from origin: "http://localhost:5007"
2017-06-10 13:13:33.793 +00:00 [Debug] Client list checked and origin: "http://localhost:5007" is not allowed
2017-06-10 13:13:33.793 +00:00 [Warning] CorsPolicyService did not allow origin: "http://localhost:5007"
2017-06-10 13:13:33.794 +00:00 [Debug] Request path "/.well-known/openid-configuration" matched to endpoint type Discovery
2017-06-10 13:13:33.795 +00:00 [Debug] Mapping found for endpoint: Discovery, creating handler: "IdentityServer4.Endpoints.DiscoveryEndpoint"
2017-06-10 13:13:33.796 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.DiscoveryEndpoint" for "/.well-known/openid-configuration"
2017-06-10 13:13:33.796 +00:00 [Verbose] Processing discovery request.
2017-06-10 13:13:33.796 +00:00 [Debug] Start discovery request
2017-06-10 13:13:33.796 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.DiscoveryDocumentResult"
2017-06-10 13:13:33.800 +00:00 [Information] Request finished in 6.4431ms 200 application/json
2017-06-10 13:14:06.037 +00:00 [Information] Request starting HTTP/1.1 GET http://localhost:5005/.well-known/openid-configuration  
2017-06-10 13:14:06.042 +00:00 [Debug] CORS request made for path: "/.well-known/openid-configuration" from origin: "http://localhost:5007"
2017-06-10 13:14:06.043 +00:00 [Debug] Client list checked and origin: "http://localhost:5007" is not allowed
2017-06-10 13:14:06.043 +00:00 [Warning] CorsPolicyService did not allow origin: "http://localhost:5007"
2017-06-10 13:14:06.044 +00:00 [Debug] Request path "/.well-known/openid-configuration" matched to endpoint type Discovery
2017-06-10 13:14:06.044 +00:00 [Debug] Mapping found for endpoint: Discovery, creating handler: "IdentityServer4.Endpoints.DiscoveryEndpoint"
2017-06-10 13:14:06.044 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.DiscoveryEndpoint" for "/.well-known/openid-configuration"
2017-06-10 13:14:06.044 +00:00 [Verbose] Processing discovery request.
2017-06-10 13:14:06.045 +00:00 [Debug] Start discovery request
2017-06-10 13:14:06.045 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.DiscoveryDocumentResult"
2017-06-10 13:14:06.045 +00:00 [Information] Request finished in 8.2869ms 200 application/json
2017-06-10 13:14:25.348 +00:00 [Information] Request starting HTTP/1.1 GET http://localhost:5005/.well-known/openid-configuration  
2017-06-10 13:14:25.349 +00:00 [Debug] CORS request made for path: "/.well-known/openid-configuration" from origin: "http://localhost:5007"
2017-06-10 13:14:25.349 +00:00 [Debug] Client list checked and origin: "http://localhost:5007" is not allowed
2017-06-10 13:14:25.349 +00:00 [Warning] CorsPolicyService did not allow origin: "http://localhost:5007"
2017-06-10 13:14:25.349 +00:00 [Debug] Request path "/.well-known/openid-configuration" matched to endpoint type Discovery
2017-06-10 13:14:25.350 +00:00 [Debug] Mapping found for endpoint: Discovery, creating handler: "IdentityServer4.Endpoints.DiscoveryEndpoint"
2017-06-10 13:14:25.350 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.DiscoveryEndpoint" for "/.well-known/openid-configuration"
2017-06-10 13:14:25.351 +00:00 [Verbose] Processing discovery request.
2017-06-10 13:14:25.351 +00:00 [Debug] Start discovery request
2017-06-10 13:14:25.352 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.DiscoveryDocumentResult"
2017-06-10 13:14:25.353 +00:00 [Information] Request finished in 4.2272ms 200 application/json
2017-06-10 13:17:35.602 +00:00 [Information] You are using the in-memory version of the persisted grant store. This will store consent decisions, authorization codes, refresh and reference tokens in memory only. If you are using any of those features in production, you want to switch to a different store implementation.
2017-06-10 13:17:35.662 +00:00 [Debug] Using built-in CookieAuthentication middleware with scheme: "idsrv"
2017-06-10 13:17:35.668 +00:00 [Debug] Adding CookieAuthentication middleware for external authentication with scheme: "idsrv.external"
2017-06-10 13:17:35.933 +00:00 [Information] User profile is available. Using '"/root/.aspnet/DataProtection-Keys"' as key repository; keys will not be encrypted at rest.
2017-06-10 13:17:39.698 +00:00 [Information] Request starting HTTP/1.1 GET http://localhost:5005/.well-known/openid-configuration  
2017-06-10 13:17:39.717 +00:00 [Debug] CORS request made for path: "/.well-known/openid-configuration" from origin: "http://localhost:5007"
2017-06-10 13:17:39.722 +00:00 [Debug] Client list checked and origin: "http://localhost:5007" is allowed
2017-06-10 13:17:39.722 +00:00 [Debug] CorsPolicyService allowed origin: "http://localhost:5007"
2017-06-10 13:17:39.769 +00:00 [Debug] Request path "/.well-known/openid-configuration" matched to endpoint type Discovery
2017-06-10 13:17:39.772 +00:00 [Debug] Mapping found for endpoint: Discovery, creating handler: "IdentityServer4.Endpoints.DiscoveryEndpoint"
2017-06-10 13:17:39.776 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.DiscoveryEndpoint" for "/.well-known/openid-configuration"
2017-06-10 13:17:39.779 +00:00 [Verbose] Processing discovery request.
2017-06-10 13:17:39.782 +00:00 [Debug] Start discovery request
2017-06-10 13:17:39.804 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.DiscoveryDocumentResult"
2017-06-10 13:17:39.901 +00:00 [Information] Request finished in 208.3493ms 200 application/json
2017-06-10 13:17:39.916 +00:00 [Information] Request starting HTTP/1.1 GET http://localhost:5005/connect/authorize?client_id=http%3A%2F%2Flocalhost%3A5007&redirect_uri=http%3A%2F%2Flocalhost%3A5007%2Fcallback.html&response_type=id_token%20token&scope=openid%20profile%20productapi&state=11e428c042704362b096252b83f9335a&nonce=39e927963ec948ce82ae5d2d5cc2426c  
2017-06-10 13:17:39.918 +00:00 [Debug] Request path "/connect/authorize" matched to endpoint type Authorize
2017-06-10 13:17:39.919 +00:00 [Debug] Mapping found for endpoint: Authorize, creating handler: "IdentityServer4.Endpoints.AuthorizeEndpoint"
2017-06-10 13:17:39.928 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.AuthorizeEndpoint" for "/connect/authorize"
2017-06-10 13:17:39.938 +00:00 [Debug] Start authorize request
2017-06-10 13:17:39.986 +00:00 [Debug] No user present in authorize request
2017-06-10 13:17:39.993 +00:00 [Debug] Start authorize request protocol validation
2017-06-10 13:17:40.041 +00:00 [Debug] Calling into custom validator: "IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator"
2017-06-10 13:17:40.043 +00:00 [Verbose] Authorize request protocol validation successful
2017-06-10 13:17:40.069 +00:00 [Information] ValidatedAuthorizeRequest
"{
  \"ClientId\": \"http://localhost:5007\",
  \"ClientName\": \"SPAClient\",
  \"RedirectUri\": \"http://localhost:5007/callback.html\",
  \"AllowedRedirectUris\": [
    \"http://localhost:5007/callback.html\"
  ],
  \"SubjectId\": \"anonymous\",
  \"ResponseType\": \"id_token token\",
  \"ResponseMode\": \"fragment\",
  \"GrantType\": \"implicit\",
  \"RequestedScopes\": \"openid profile productapi\",
  \"State\": \"11e428c042704362b096252b83f9335a\",
  \"Nonce\": \"39e927963ec948ce82ae5d2d5cc2426c\",
  \"Raw\": {
    \"client_id\": \"http://localhost:5007\",
    \"redirect_uri\": \"http://localhost:5007/callback.html\",
    \"response_type\": \"id_token token\",
    \"scope\": \"openid profile productapi\",
    \"state\": \"11e428c042704362b096252b83f9335a\",
    \"nonce\": \"39e927963ec948ce82ae5d2d5cc2426c\"
  }
}"
2017-06-10 13:17:40.077 +00:00 [Verbose] ProcessInteractionAsync
2017-06-10 13:17:40.083 +00:00 [Information] Showing login: User is not authenticated
2017-06-10 13:17:40.084 +00:00 [Verbose] End authorize request. result type: "IdentityServer4.Endpoints.Results.LoginPageResult"
2017-06-10 13:17:40.084 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.LoginPageResult"
2017-06-10 13:17:40.097 +00:00 [Information] Request finished in 180.1356ms 302 
2017-06-10 13:17:40.105 +00:00 [Information] Request starting HTTP/1.1 GET http://localhost:5005/account/login?returnUrl=%2Fconnect%2Fauthorize%2Flogin%3Fclient_id%3Dhttp%253A%252F%252Flocalhost%253A5007%26redirect_uri%3Dhttp%253A%252F%252Flocalhost%253A5007%252Fcallback.html%26response_type%3Did_token%2520token%26scope%3Dopenid%2520profile%2520productapi%26state%3D11e428c042704362b096252b83f9335a%26nonce%3D39e927963ec948ce82ae5d2d5cc2426c  
2017-06-10 13:17:40.105 +00:00 [Verbose] No endpoint entry found for request path: "/account/login"
2017-06-10 13:17:40.345 +00:00 [Information] Executing action method "IdentityServer4.Quickstart.UI.AccountController.Login (SpaIdSrv)" with arguments (["/connect/authorize/login?client_id=http%3A%2F%2Flocalhost%3A5007&redirect_uri=http%3A%2F%2Flocalhost%3A5007%2Fcallback.html&response_type=id_token%20token&scope=openid%20profile%20productapi&state=11e428c042704362b096252b83f9335a&nonce=39e927963ec948ce82ae5d2d5cc2426c"]) - ModelState is Valid
2017-06-10 13:17:40.367 +00:00 [Verbose] returnUrl is valid
2017-06-10 13:17:40.370 +00:00 [Verbose] returnUrl is valid
2017-06-10 13:17:40.374 +00:00 [Debug] Start authorize request protocol validation
2017-06-10 13:17:40.375 +00:00 [Debug] Calling into custom validator: "IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator"
2017-06-10 13:17:40.375 +00:00 [Verbose] Authorize request protocol validation successful
2017-06-10 13:17:40.375 +00:00 [Verbose] AuthorizationRequest being returned
2017-06-10 13:17:40.379 +00:00 [Verbose] AuthorizationRequest being returned
2017-06-10 13:17:44.339 +00:00 [Information] Executing ViewResult, running view at path "/Views/Account/Login.cshtml".
2017-06-10 13:17:44.709 +00:00 [Information] Executed action "IdentityServer4.Quickstart.UI.AccountController.Login (SpaIdSrv)" in 4443.5783ms
2017-06-10 13:17:44.715 +00:00 [Information] Request finished in 4609.6096ms 200 text/html; charset=utf-8
2017-06-10 13:17:48.022 +00:00 [Information] Request starting HTTP/1.1 POST http://localhost:5005/account/login?returnUrl=%2Fconnect%2Fauthorize%2Flogin%3Fclient_id%3Dhttp%253A%252F%252Flocalhost%253A5007%26redirect_uri%3Dhttp%253A%252F%252Flocalhost%253A5007%252Fcallback.html%26response_type%3Did_token%2520token%26scope%3Dopenid%2520profile%2520productapi%26state%3D11e428c042704362b096252b83f9335a%26nonce%3D39e927963ec948ce82ae5d2d5cc2426c application/x-www-form-urlencoded 570
2017-06-10 13:17:48.024 +00:00 [Verbose] No endpoint entry found for request path: "/account/login"
2017-06-10 13:17:48.064 +00:00 [Information] Executing action method "IdentityServer4.Quickstart.UI.AccountController.Login (SpaIdSrv)" with arguments (["IdentityServer4.Quickstart.UI.LoginInputModel"]) - ModelState is Valid
2017-06-10 13:17:48.080 +00:00 [Debug] Augmenting SignInContext
2017-06-10 13:17:48.089 +00:00 [Information] AuthenticationScheme: "idsrv" signed in.
2017-06-10 13:17:48.091 +00:00 [Verbose] returnUrl is valid
2017-06-10 13:17:48.092 +00:00 [Verbose] IsValidReturnUrl true
2017-06-10 13:17:48.093 +00:00 [Information] Executing RedirectResult, redirecting to "/connect/authorize/login?client_id=http%3A%2F%2Flocalhost%3A5007&redirect_uri=http%3A%2F%2Flocalhost%3A5007%2Fcallback.html&response_type=id_token%20token&scope=openid%20profile%20productapi&state=11e428c042704362b096252b83f9335a&nonce=39e927963ec948ce82ae5d2d5cc2426c".
2017-06-10 13:17:48.094 +00:00 [Information] Executed action "IdentityServer4.Quickstart.UI.AccountController.Login (SpaIdSrv)" in 63.1799ms
2017-06-10 13:17:48.095 +00:00 [Information] Request finished in 72.4898ms 302 
2017-06-10 13:17:48.103 +00:00 [Information] Request starting HTTP/1.1 GET http://localhost:5005/connect/authorize/login?client_id=http%3A%2F%2Flocalhost%3A5007&redirect_uri=http%3A%2F%2Flocalhost%3A5007%2Fcallback.html&response_type=id_token%20token&scope=openid%20profile%20productapi&state=11e428c042704362b096252b83f9335a&nonce=39e927963ec948ce82ae5d2d5cc2426c  
2017-06-10 13:17:48.105 +00:00 [Information] HttpContext.User merged via AutomaticAuthentication from authenticationScheme: "idsrv".
2017-06-10 13:17:48.105 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 13:17:48.106 +00:00 [Debug] Request path "/connect/authorize/login" matched to endpoint type Authorize
2017-06-10 13:17:48.106 +00:00 [Debug] Mapping found for endpoint: Authorize, creating handler: "IdentityServer4.Endpoints.AuthorizeEndpoint"
2017-06-10 13:17:48.106 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.AuthorizeEndpoint" for "/connect/authorize/login"
2017-06-10 13:17:48.113 +00:00 [Debug] Start authorize request (after login)
2017-06-10 13:17:48.113 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 13:17:48.116 +00:00 [Debug] User in authorize request: "2"
2017-06-10 13:17:48.116 +00:00 [Debug] Start authorize request protocol validation
2017-06-10 13:17:48.117 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 13:17:48.117 +00:00 [Debug] Calling into custom validator: "IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator"
2017-06-10 13:17:48.117 +00:00 [Verbose] Authorize request protocol validation successful
2017-06-10 13:17:48.117 +00:00 [Information] ValidatedAuthorizeRequest
"{
  \"ClientId\": \"http://localhost:5007\",
  \"ClientName\": \"SPAClient\",
  \"RedirectUri\": \"http://localhost:5007/callback.html\",
  \"AllowedRedirectUris\": [
    \"http://localhost:5007/callback.html\"
  ],
  \"SubjectId\": \"2\",
  \"ResponseType\": \"id_token token\",
  \"ResponseMode\": \"fragment\",
  \"GrantType\": \"implicit\",
  \"RequestedScopes\": \"openid profile productapi\",
  \"State\": \"11e428c042704362b096252b83f9335a\",
  \"Nonce\": \"39e927963ec948ce82ae5d2d5cc2426c\",
  \"SessionId\": \"1431bbf3d9abb06817077cb7d474a2c5\",
  \"Raw\": {
    \"client_id\": \"http://localhost:5007\",
    \"redirect_uri\": \"http://localhost:5007/callback.html\",
    \"response_type\": \"id_token token\",
    \"scope\": \"openid profile productapi\",
    \"state\": \"11e428c042704362b096252b83f9335a\",
    \"nonce\": \"39e927963ec948ce82ae5d2d5cc2426c\"
  }
}"
2017-06-10 13:17:48.117 +00:00 [Verbose] ProcessInteractionAsync
2017-06-10 13:17:48.147 +00:00 [Debug] "user_consent" grant with value: "http://localhost:5007|2" not found in store.
2017-06-10 13:17:48.147 +00:00 [Information] Showing consent: User has not yet consented
2017-06-10 13:17:48.149 +00:00 [Verbose] End Authorize Request. Result type: "IdentityServer4.Endpoints.Results.ConsentPageResult"
2017-06-10 13:17:48.149 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.ConsentPageResult"
2017-06-10 13:17:48.152 +00:00 [Information] Request finished in 49.2802ms 302 
2017-06-10 13:17:48.158 +00:00 [Information] Request starting HTTP/1.1 GET http://localhost:5005/consent?returnUrl=%2Fconnect%2Fauthorize%2Fconsent%3Fclient_id%3Dhttp%253A%252F%252Flocalhost%253A5007%26redirect_uri%3Dhttp%253A%252F%252Flocalhost%253A5007%252Fcallback.html%26response_type%3Did_token%2520token%26scope%3Dopenid%2520profile%2520productapi%26state%3D11e428c042704362b096252b83f9335a%26nonce%3D39e927963ec948ce82ae5d2d5cc2426c  
2017-06-10 13:17:48.159 +00:00 [Information] HttpContext.User merged via AutomaticAuthentication from authenticationScheme: "idsrv".
2017-06-10 13:17:48.159 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 13:17:48.160 +00:00 [Verbose] No endpoint entry found for request path: "/consent"
2017-06-10 13:17:48.184 +00:00 [Information] Executing action method "IdentityServer4.Quickstart.UI.ConsentController.Index (SpaIdSrv)" with arguments (["/connect/authorize/consent?client_id=http%3A%2F%2Flocalhost%3A5007&redirect_uri=http%3A%2F%2Flocalhost%3A5007%2Fcallback.html&response_type=id_token%20token&scope=openid%20profile%20productapi&state=11e428c042704362b096252b83f9335a&nonce=39e927963ec948ce82ae5d2d5cc2426c"]) - ModelState is Valid
2017-06-10 13:17:48.190 +00:00 [Verbose] returnUrl is valid
2017-06-10 13:17:48.190 +00:00 [Verbose] returnUrl is valid
2017-06-10 13:17:48.190 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 13:17:48.191 +00:00 [Debug] Start authorize request protocol validation
2017-06-10 13:17:48.193 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 13:17:48.193 +00:00 [Debug] Calling into custom validator: "IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator"
2017-06-10 13:17:48.193 +00:00 [Verbose] Authorize request protocol validation successful
2017-06-10 13:17:48.193 +00:00 [Verbose] AuthorizationRequest being returned
2017-06-10 13:17:48.193 +00:00 [Verbose] AuthorizationRequest being returned
2017-06-10 13:17:48.321 +00:00 [Information] Executing ViewResult, running view at path "/Views/Consent/Index.cshtml".
2017-06-10 13:17:48.486 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 13:17:48.494 +00:00 [Information] Executed action "IdentityServer4.Quickstart.UI.ConsentController.Index (SpaIdSrv)" in 313.1837ms
2017-06-10 13:17:48.495 +00:00 [Information] Request finished in 336.5881ms 200 text/html; charset=utf-8
2017-06-10 13:17:50.829 +00:00 [Information] Request starting HTTP/1.1 POST http://localhost:5005/consent application/x-www-form-urlencoded 667
2017-06-10 13:17:50.830 +00:00 [Information] HttpContext.User merged via AutomaticAuthentication from authenticationScheme: "idsrv".
2017-06-10 13:17:50.830 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 13:17:50.831 +00:00 [Verbose] No endpoint entry found for request path: "/consent"
2017-06-10 13:17:50.842 +00:00 [Information] Executing action method "IdentityServer4.Quickstart.UI.ConsentController.Index (SpaIdSrv)" with arguments (["IdentityServer4.Quickstart.UI.ConsentInputModel"]) - ModelState is Valid
2017-06-10 13:17:50.848 +00:00 [Verbose] returnUrl is valid
2017-06-10 13:17:50.848 +00:00 [Verbose] returnUrl is valid
2017-06-10 13:17:50.849 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 13:17:50.849 +00:00 [Debug] Start authorize request protocol validation
2017-06-10 13:17:50.851 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 13:17:50.852 +00:00 [Debug] Calling into custom validator: "IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator"
2017-06-10 13:17:50.853 +00:00 [Verbose] Authorize request protocol validation successful
2017-06-10 13:17:50.854 +00:00 [Verbose] AuthorizationRequest being returned
2017-06-10 13:17:50.855 +00:00 [Verbose] AuthorizationRequest being returned
2017-06-10 13:17:50.859 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 13:17:50.873 +00:00 [Verbose] Protecting message: "{\"Created\":636326974708635150,\"Data\":{\"Granted\":true,\"ScopesConsented\":[\"openid\",\"profile\",\"productapi\"]}}"
2017-06-10 13:17:50.875 +00:00 [Information] Executing RedirectResult, redirecting to "/connect/authorize/consent?client_id=http%3A%2F%2Flocalhost%3A5007&redirect_uri=http%3A%2F%2Flocalhost%3A5007%2Fcallback.html&response_type=id_token%20token&scope=openid%20profile%20productapi&state=11e428c042704362b096252b83f9335a&nonce=39e927963ec948ce82ae5d2d5cc2426c".
2017-06-10 13:17:50.876 +00:00 [Information] Executed action "IdentityServer4.Quickstart.UI.ConsentController.Index (SpaIdSrv)" in 41.5164ms
2017-06-10 13:17:50.876 +00:00 [Information] Request finished in 47.9117ms 302 
2017-06-10 13:17:50.883 +00:00 [Information] Request starting HTTP/1.1 GET http://localhost:5005/connect/authorize/consent?client_id=http%3A%2F%2Flocalhost%3A5007&redirect_uri=http%3A%2F%2Flocalhost%3A5007%2Fcallback.html&response_type=id_token%20token&scope=openid%20profile%20productapi&state=11e428c042704362b096252b83f9335a&nonce=39e927963ec948ce82ae5d2d5cc2426c  
2017-06-10 13:17:50.884 +00:00 [Information] HttpContext.User merged via AutomaticAuthentication from authenticationScheme: "idsrv".
2017-06-10 13:17:50.885 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 13:17:50.885 +00:00 [Debug] Request path "/connect/authorize/consent" matched to endpoint type Authorize
2017-06-10 13:17:50.885 +00:00 [Debug] Mapping found for endpoint: Authorize, creating handler: "IdentityServer4.Endpoints.AuthorizeEndpoint"
2017-06-10 13:17:50.886 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.AuthorizeEndpoint" for "/connect/authorize/consent"
2017-06-10 13:17:50.893 +00:00 [Debug] Start authorize request (after consent)
2017-06-10 13:17:50.894 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 13:17:50.902 +00:00 [Debug] User in authorize request: "2"
2017-06-10 13:17:50.903 +00:00 [Debug] Start authorize request protocol validation
2017-06-10 13:17:50.903 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 13:17:50.904 +00:00 [Debug] Calling into custom validator: "IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator"
2017-06-10 13:17:50.904 +00:00 [Verbose] Authorize request protocol validation successful
2017-06-10 13:17:50.905 +00:00 [Information] ValidatedAuthorizeRequest
"{
  \"ClientId\": \"http://localhost:5007\",
  \"ClientName\": \"SPAClient\",
  \"RedirectUri\": \"http://localhost:5007/callback.html\",
  \"AllowedRedirectUris\": [
    \"http://localhost:5007/callback.html\"
  ],
  \"SubjectId\": \"2\",
  \"ResponseType\": \"id_token token\",
  \"ResponseMode\": \"fragment\",
  \"GrantType\": \"implicit\",
  \"RequestedScopes\": \"openid profile productapi\",
  \"State\": \"11e428c042704362b096252b83f9335a\",
  \"Nonce\": \"39e927963ec948ce82ae5d2d5cc2426c\",
  \"SessionId\": \"1431bbf3d9abb06817077cb7d474a2c5\",
  \"Raw\": {
    \"client_id\": \"http://localhost:5007\",
    \"redirect_uri\": \"http://localhost:5007/callback.html\",
    \"response_type\": \"id_token token\",
    \"scope\": \"openid profile productapi\",
    \"state\": \"11e428c042704362b096252b83f9335a\",
    \"nonce\": \"39e927963ec948ce82ae5d2d5cc2426c\"
  }
}"
2017-06-10 13:17:50.906 +00:00 [Verbose] ProcessInteractionAsync
2017-06-10 13:17:50.907 +00:00 [Debug] "user_consent" grant with value: "http://localhost:5007|2" not found in store.
2017-06-10 13:17:50.907 +00:00 [Verbose] Consent was shown to user
2017-06-10 13:17:50.921 +00:00 [Information] User consented to scopes: ["openid", "profile", "productapi"]
2017-06-10 13:17:50.937 +00:00 [Debug] Creating Implicit Flow response.
2017-06-10 13:17:50.944 +00:00 [Verbose] Creating access token
2017-06-10 13:17:50.951 +00:00 [Debug] Getting claims for access token for client: "http://localhost:5007"
2017-06-10 13:17:50.951 +00:00 [Debug] Getting claims for access token for subject: "2"
2017-06-10 13:17:50.956 +00:00 [Debug] Get profile called for subject "2" from client "SPAClient" with claim types [] via "ClaimsProviderAccessToken"
2017-06-10 13:17:50.962 +00:00 [Verbose] Creating JWT access token
2017-06-10 13:17:51.146 +00:00 [Verbose] Creating identity token
2017-06-10 13:17:51.152 +00:00 [Debug] Getting claims for identity token for subject: "2" and client: "http://localhost:5007"
2017-06-10 13:17:51.152 +00:00 [Debug] In addition to an id_token, an access_token was requested. No claims other than sub are included in the id_token. To obtain more user claims, either use the user info endpoint or set AlwaysIncludeUserClaimsInIdToken on the client configuration.
2017-06-10 13:17:51.152 +00:00 [Verbose] Creating JWT identity token
2017-06-10 13:17:51.159 +00:00 [Verbose] Identity token issued for "http://localhost:5007 (SPAClient)" / "2": "eyJhbGciOiJSUzI1NiIsImtpZCI6ImZiZDNlODE4YWU4OTE3MmQxNDlkOTA0MWUyMjFhN2U5IiwidHlwIjoiSldUIn0.eyJuYmYiOjE0OTcxMDA2NzEsImV4cCI6MTQ5NzEwMDk3MSwiaXNzIjoiaHR0cDovL2xvY2FsaG9zdDo1MDA1IiwiYXVkIjoiaHR0cDovL2xvY2FsaG9zdDo1MDA3Iiwibm9uY2UiOiIzOWU5Mjc5NjNlYzk0OGNlODJhZTVkMmQ1Y2MyNDI2YyIsImlhdCI6MTQ5NzEwMDY3MSwiYXRfaGFzaCI6InVCWDdkZUl6NTBkUDhUREJncExBcXciLCJzaWQiOiIxNDMxYmJmM2Q5YWJiMDY4MTcwNzdjYjdkNDc0YTJjNSIsInN1YiI6IjIiLCJhdXRoX3RpbWUiOjE0OTcxMDA2NjgsImlkcCI6ImxvY2FsIiwiYW1yIjpbInB3ZCJdfQ.r1kcoxJlyYDYGZumYd10beHMETZayXHEmnlxlC4cJKGKxDYuyDJx4z-1xIe-b961NptQaoVHUlBFP7cD9IQp9Qfxhnea6ZF0sjseem0pgqWrpHl5p0ZeZlx9ZCXsiBjDerNXFaUyIQzQ_5MgghHhUMmF3KToLBU7AQ7OEKbKjUUcccS1IeID6-Tktycm0Uod4EfbKsIeq98yvAngJv_tME1CxTVBbV00OeFm7iTZUYX_SkB37ZjtRL2tmKJjO5OxI0_xgHIEvKZceGKZpwMKY2QH-ly6zOGzX-TO7K_Q7QWlOnagS9ZxU1ktdGTUSrHtqFySMtUlXSr1oFmYnialQA"
2017-06-10 13:17:51.159 +00:00 [Verbose] Access token issued for "http://localhost:5007 (SPAClient)" / "2": "eyJhbGciOiJSUzI1NiIsImtpZCI6ImZiZDNlODE4YWU4OTE3MmQxNDlkOTA0MWUyMjFhN2U5IiwidHlwIjoiSldUIn0.eyJuYmYiOjE0OTcxMDA2NzEsImV4cCI6MTQ5NzEwNDI3MSwiaXNzIjoiaHR0cDovL2xvY2FsaG9zdDo1MDA1IiwiYXVkIjpbImh0dHA6Ly9sb2NhbGhvc3Q6NTAwNS9yZXNvdXJjZXMiLCJwcm9kdWN0YXBpIl0sImNsaWVudF9pZCI6Imh0dHA6Ly9sb2NhbGhvc3Q6NTAwNyIsInN1YiI6IjIiLCJhdXRoX3RpbWUiOjE0OTcxMDA2NjgsImlkcCI6ImxvY2FsIiwic2NvcGUiOlsib3BlbmlkIiwicHJvZmlsZSIsInByb2R1Y3RhcGkiXSwiYW1yIjpbInB3ZCJdfQ.Isp1ZIxMLqbOW_RRO8moYhU3B9ZKrqtUTyeb0yMHUmqmintuQr52k8GF6ehNh8CIHn4HbTkBQ9zDELoRA903ZVqzOUA1ofq7aL9VazOHs_GzMM-wAhmoOHY3ZYik6i3OgJnxSgqH_WDcj8vJDzDaarjSwa-UMIH1vj8r90iyfSoKxQBAN9vnPIiQLpmoVpUcJoSP_Yy-hRuDqLo81WxwwiBonBVECetUqUf5kMb01phbaAvREF-90xDc9IDr4vAikQJRaxjo6PLMwOcgLeqthHgtCNgVrUVXLNjn1bHP0cmZjPQ_ntkaGIBruvpdJWK9TrNO6LDM35444k16OFaP3w"
2017-06-10 13:17:51.172 +00:00 [Information] Authorize endpoint response
"{
  \"SubjectId\": \"2\",
  \"ClientId\": \"http://localhost:5007\",
  \"RedirectUri\": \"http://localhost:5007/callback.html\",
  \"State\": \"11e428c042704362b096252b83f9335a\",
  \"Scope\": \"openid profile productapi\"
}"
2017-06-10 13:17:51.173 +00:00 [Verbose] End Authorize Request. Result type: "IdentityServer4.Endpoints.Results.AuthorizeResult"
2017-06-10 13:17:51.175 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.AuthorizeResult"
2017-06-10 13:17:51.188 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 13:17:51.196 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 13:17:51.199 +00:00 [Debug] Augmenting SignInContext
2017-06-10 13:17:51.200 +00:00 [Information] AuthenticationScheme: "idsrv" signed in.
2017-06-10 13:17:51.206 +00:00 [Information] Request finished in 323.1862ms 302 
2017-06-10 13:17:51.533 +00:00 [Information] Request starting HTTP/1.1 GET http://localhost:5005/.well-known/openid-configuration  
2017-06-10 13:17:51.534 +00:00 [Debug] CORS request made for path: "/.well-known/openid-configuration" from origin: "http://localhost:5007"
2017-06-10 13:17:51.534 +00:00 [Debug] Client list checked and origin: "http://localhost:5007" is allowed
2017-06-10 13:17:51.534 +00:00 [Debug] CorsPolicyService allowed origin: "http://localhost:5007"
2017-06-10 13:17:51.534 +00:00 [Debug] Request path "/.well-known/openid-configuration" matched to endpoint type Discovery
2017-06-10 13:17:51.535 +00:00 [Debug] Mapping found for endpoint: Discovery, creating handler: "IdentityServer4.Endpoints.DiscoveryEndpoint"
2017-06-10 13:17:51.535 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.DiscoveryEndpoint" for "/.well-known/openid-configuration"
2017-06-10 13:17:51.535 +00:00 [Verbose] Processing discovery request.
2017-06-10 13:17:51.535 +00:00 [Debug] Start discovery request
2017-06-10 13:17:51.536 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.DiscoveryDocumentResult"
2017-06-10 13:17:51.542 +00:00 [Information] Request finished in 9.159ms 200 application/json
2017-06-10 13:17:51.594 +00:00 [Information] Request starting HTTP/1.1 GET http://localhost:5005/.well-known/openid-configuration/jwks  
2017-06-10 13:17:51.595 +00:00 [Debug] CORS request made for path: "/.well-known/openid-configuration/jwks" from origin: "http://localhost:5007"
2017-06-10 13:17:51.595 +00:00 [Debug] Client list checked and origin: "http://localhost:5007" is allowed
2017-06-10 13:17:51.596 +00:00 [Debug] CorsPolicyService allowed origin: "http://localhost:5007"
2017-06-10 13:17:51.596 +00:00 [Debug] Request path "/.well-known/openid-configuration/jwks" matched to endpoint type Discovery
2017-06-10 13:17:51.596 +00:00 [Debug] Mapping found for endpoint: Discovery, creating handler: "IdentityServer4.Endpoints.DiscoveryEndpoint"
2017-06-10 13:17:51.597 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.DiscoveryEndpoint" for "/.well-known/openid-configuration/jwks"
2017-06-10 13:17:51.597 +00:00 [Verbose] Processing discovery request.
2017-06-10 13:17:51.602 +00:00 [Debug] Start key discovery request
2017-06-10 13:17:51.611 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.JsonWebKeysResult"
2017-06-10 13:17:51.631 +00:00 [Information] Request finished in 36.873ms 200 application/json
2017-06-10 13:17:51.660 +00:00 [Information] Request starting HTTP/1.1 OPTIONS http://localhost:5005/connect/userinfo  
2017-06-10 13:17:51.660 +00:00 [Debug] CORS request made for path: "/connect/userinfo" from origin: "http://localhost:5007"
2017-06-10 13:17:51.661 +00:00 [Debug] Client list checked and origin: "http://localhost:5007" is allowed
2017-06-10 13:17:51.661 +00:00 [Debug] CorsPolicyService allowed origin: "http://localhost:5007"
2017-06-10 13:17:51.664 +00:00 [Information] Request finished in 3.7057ms 204 
2017-06-10 13:17:51.685 +00:00 [Information] Request starting HTTP/1.1 GET http://localhost:5005/connect/userinfo  
2017-06-10 13:17:51.685 +00:00 [Debug] CORS request made for path: "/connect/userinfo" from origin: "http://localhost:5007"
2017-06-10 13:17:51.685 +00:00 [Debug] Client list checked and origin: "http://localhost:5007" is allowed
2017-06-10 13:17:51.686 +00:00 [Debug] CorsPolicyService allowed origin: "http://localhost:5007"
2017-06-10 13:17:51.686 +00:00 [Debug] Request path "/connect/userinfo" matched to endpoint type UserInfo
2017-06-10 13:17:51.686 +00:00 [Debug] Mapping found for endpoint: UserInfo, creating handler: "IdentityServer4.Endpoints.UserInfoEndpoint"
2017-06-10 13:17:51.688 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.UserInfoEndpoint" for "/connect/userinfo"
2017-06-10 13:17:51.698 +00:00 [Debug] Start userinfo request
2017-06-10 13:17:51.702 +00:00 [Information] ValidateAsync: Locating bearer token
2017-06-10 13:17:51.703 +00:00 [Verbose] Authorization header value found
2017-06-10 13:17:51.704 +00:00 [Verbose] Authorization scheme is bearer
2017-06-10 13:17:51.704 +00:00 [Debug] Bearer token found in header
2017-06-10 13:17:51.705 +00:00 [Debug] Token found: "AuthorizationHeader"
2017-06-10 13:17:51.712 +00:00 [Verbose] Start access token validation
2017-06-10 13:17:51.768 +00:00 [Debug] Token validation success
"{
  \"ValidateLifetime\": true,
  \"AccessTokenType\": \"Jwt\",
  \"ExpectedScope\": \"openid\",
  \"Claims\": {
    \"nbf\": 1497100671,
    \"exp\": 1497104271,
    \"iss\": \"http://localhost:5005\",
    \"aud\": [
      \"http://localhost:5005/resources\",
      \"productapi\"
    ],
    \"client_id\": \"http://localhost:5007\",
    \"sub\": \"2\",
    \"auth_time\": 1497100668,
    \"idp\": \"local\",
    \"scope\": [
      \"openid\",
      \"profile\",
      \"productapi\"
    ],
    \"amr\": \"pwd\"
  }
}"
2017-06-10 13:17:51.778 +00:00 [Verbose] Creating userinfo response
2017-06-10 13:17:51.783 +00:00 [Debug] Scopes in access token: "openid profile productapi"
2017-06-10 13:17:51.788 +00:00 [Debug] Requested claim types: "sub name family_name given_name middle_name nickname preferred_username profile picture website gender birthdate zoneinfo locale updated_at"
2017-06-10 13:17:51.788 +00:00 [Debug] Get profile called for subject "2" from client "SPAClient" with claim types ["sub", "name", "family_name", "given_name", "middle_name", "nickname", "preferred_username", "profile", "picture", "website", "gender", "birthdate", "zoneinfo", "locale", "updated_at"] via "UserInfoEndpoint"
2017-06-10 13:17:51.791 +00:00 [Information] Profile service returned to the following claim types: ""
2017-06-10 13:17:51.791 +00:00 [Debug] End userinfo request
2017-06-10 13:17:51.791 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.UserInfoResult"
2017-06-10 13:17:51.796 +00:00 [Information] Request finished in 111.0561ms 200 application/json
2017-06-10 13:17:51.806 +00:00 [Information] Request starting HTTP/1.1 GET http://localhost:5005/connect/checksession  
2017-06-10 13:17:51.806 +00:00 [Information] HttpContext.User merged via AutomaticAuthentication from authenticationScheme: "idsrv".
2017-06-10 13:17:51.806 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 13:17:51.806 +00:00 [Debug] Request path "/connect/checksession" matched to endpoint type CheckSession
2017-06-10 13:17:51.807 +00:00 [Debug] Mapping found for endpoint: CheckSession, creating handler: "IdentityServer4.Endpoints.CheckSessionEndpoint"
2017-06-10 13:17:51.807 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.CheckSessionEndpoint" for "/connect/checksession"
2017-06-10 13:17:51.814 +00:00 [Debug] Rendering check session result
2017-06-10 13:17:51.814 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.CheckSessionResult"
2017-06-10 13:17:51.820 +00:00 [Information] Request finished in 14.5988ms 200 text/html; charset=UTF-8
2017-06-10 13:17:52.113 +00:00 [Information] Request starting HTTP/1.1 GET http://localhost:5005/.well-known/openid-configuration  
2017-06-10 13:17:52.114 +00:00 [Debug] CORS request made for path: "/.well-known/openid-configuration" from origin: "http://localhost:5007"
2017-06-10 13:17:52.114 +00:00 [Debug] Client list checked and origin: "http://localhost:5007" is allowed
2017-06-10 13:17:52.114 +00:00 [Debug] CorsPolicyService allowed origin: "http://localhost:5007"
2017-06-10 13:17:52.117 +00:00 [Debug] Request path "/.well-known/openid-configuration" matched to endpoint type Discovery
2017-06-10 13:17:52.117 +00:00 [Debug] Mapping found for endpoint: Discovery, creating handler: "IdentityServer4.Endpoints.DiscoveryEndpoint"
2017-06-10 13:17:52.118 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.DiscoveryEndpoint" for "/.well-known/openid-configuration"
2017-06-10 13:17:52.119 +00:00 [Verbose] Processing discovery request.
2017-06-10 13:17:52.120 +00:00 [Debug] Start discovery request
2017-06-10 13:17:52.121 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.DiscoveryDocumentResult"
2017-06-10 13:17:52.125 +00:00 [Information] Request finished in 11.5016ms 200 application/json
2017-06-10 13:17:52.145 +00:00 [Information] Request starting HTTP/1.1 GET http://localhost:5005/connect/checksession  
2017-06-10 13:17:52.146 +00:00 [Information] HttpContext.User merged via AutomaticAuthentication from authenticationScheme: "idsrv".
2017-06-10 13:17:52.146 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 13:17:52.146 +00:00 [Debug] Request path "/connect/checksession" matched to endpoint type CheckSession
2017-06-10 13:17:52.146 +00:00 [Debug] Mapping found for endpoint: CheckSession, creating handler: "IdentityServer4.Endpoints.CheckSessionEndpoint"
2017-06-10 13:17:52.146 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.CheckSessionEndpoint" for "/connect/checksession"
2017-06-10 13:17:52.146 +00:00 [Debug] Rendering check session result
2017-06-10 13:17:52.146 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.CheckSessionResult"
2017-06-10 13:17:52.147 +00:00 [Information] Request finished in 1.3689ms 200 text/html; charset=UTF-8
2017-06-10 13:26:24.907 +00:00 [Information] You are using the in-memory version of the persisted grant store. This will store consent decisions, authorization codes, refresh and reference tokens in memory only. If you are using any of those features in production, you want to switch to a different store implementation.
2017-06-10 13:26:24.963 +00:00 [Debug] Using built-in CookieAuthentication middleware with scheme: "idsrv"
2017-06-10 13:26:24.968 +00:00 [Debug] Adding CookieAuthentication middleware for external authentication with scheme: "idsrv.external"
2017-06-10 13:26:25.228 +00:00 [Information] User profile is available. Using '"/root/.aspnet/DataProtection-Keys"' as key repository; keys will not be encrypted at rest.
2017-06-10 13:26:32.537 +00:00 [Information] Request starting HTTP/1.1 GET http://localhost:5005/.well-known/openid-configuration  
2017-06-10 13:26:32.558 +00:00 [Debug] CORS request made for path: "/.well-known/openid-configuration" from origin: "http://localhost:5007"
2017-06-10 13:26:32.565 +00:00 [Debug] Client list checked and origin: "http://localhost:5007" is allowed
2017-06-10 13:26:32.566 +00:00 [Debug] CorsPolicyService allowed origin: "http://localhost:5007"
2017-06-10 13:26:32.620 +00:00 [Debug] Request path "/.well-known/openid-configuration" matched to endpoint type Discovery
2017-06-10 13:26:32.623 +00:00 [Debug] Mapping found for endpoint: Discovery, creating handler: "IdentityServer4.Endpoints.DiscoveryEndpoint"
2017-06-10 13:26:32.627 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.DiscoveryEndpoint" for "/.well-known/openid-configuration"
2017-06-10 13:26:32.631 +00:00 [Verbose] Processing discovery request.
2017-06-10 13:26:32.635 +00:00 [Debug] Start discovery request
2017-06-10 13:26:32.657 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.DiscoveryDocumentResult"
2017-06-10 13:26:32.770 +00:00 [Information] Request finished in 242.6207ms 200 application/json
2017-06-10 13:26:32.785 +00:00 [Information] Request starting HTTP/1.1 GET http://localhost:5005/connect/checksession  
2017-06-10 13:26:32.814 +00:00 [Information] Creating key {34a7fa96-484d-4091-bee8-d07404b0abe9} with creation date 2017-06-10 13:26:32Z, activation date 2017-06-10 13:26:32Z, and expiration date 2017-09-08 13:26:32Z.
2017-06-10 13:26:32.823 +00:00 [Warning] No XML encryptor configured. Key {34a7fa96-484d-4091-bee8-d07404b0abe9} may be persisted to storage in unencrypted form.
2017-06-10 13:26:32.831 +00:00 [Information] Writing data to file '"/root/.aspnet/DataProtection-Keys/key-34a7fa96-484d-4091-bee8-d07404b0abe9.xml"'.
2017-06-10 13:26:32.862 +00:00 [Information] "idsrv" was not authenticated. Failure message: "Unprotect ticket failed"
2017-06-10 13:26:32.863 +00:00 [Debug] Request path "/connect/checksession" matched to endpoint type CheckSession
2017-06-10 13:26:32.865 +00:00 [Debug] Mapping found for endpoint: CheckSession, creating handler: "IdentityServer4.Endpoints.CheckSessionEndpoint"
2017-06-10 13:26:32.867 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.CheckSessionEndpoint" for "/connect/checksession"
2017-06-10 13:26:32.869 +00:00 [Debug] Rendering check session result
2017-06-10 13:26:32.870 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.CheckSessionResult"
2017-06-10 13:26:32.883 +00:00 [Information] Request finished in 98.0174ms 200 text/html; charset=UTF-8
2017-06-10 13:52:50.196 +00:00 [Information] You are using the in-memory version of the persisted grant store. This will store consent decisions, authorization codes, refresh and reference tokens in memory only. If you are using any of those features in production, you want to switch to a different store implementation.
2017-06-10 13:52:50.266 +00:00 [Debug] Using built-in CookieAuthentication middleware with scheme: "idsrv"
2017-06-10 13:52:50.276 +00:00 [Debug] Adding CookieAuthentication middleware for external authentication with scheme: "idsrv.external"
2017-06-10 13:52:50.510 +00:00 [Information] User profile is available. Using '"/root/.aspnet/DataProtection-Keys"' as key repository; keys will not be encrypted at rest.
2017-06-10 13:53:22.676 +00:00 [Information] Request starting HTTP/1.1 GET http://spaidsrv:5005/.well-known/openid-configuration  
2017-06-10 13:53:22.692 +00:00 [Debug] CORS request made for path: "/.well-known/openid-configuration" from origin: "http://localhost:5007"
2017-06-10 13:53:22.696 +00:00 [Debug] Client list checked and origin: "http://localhost:5007" is not allowed
2017-06-10 13:53:22.696 +00:00 [Warning] CorsPolicyService did not allow origin: "http://localhost:5007"
2017-06-10 13:53:22.755 +00:00 [Debug] Request path "/.well-known/openid-configuration" matched to endpoint type Discovery
2017-06-10 13:53:22.759 +00:00 [Debug] Mapping found for endpoint: Discovery, creating handler: "IdentityServer4.Endpoints.DiscoveryEndpoint"
2017-06-10 13:53:22.761 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.DiscoveryEndpoint" for "/.well-known/openid-configuration"
2017-06-10 13:53:22.764 +00:00 [Verbose] Processing discovery request.
2017-06-10 13:53:22.768 +00:00 [Debug] Start discovery request
2017-06-10 13:53:22.789 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.DiscoveryDocumentResult"
2017-06-10 13:53:22.906 +00:00 [Information] Request finished in 239.5446ms 200 application/json
2017-06-10 13:53:31.429 +00:00 [Information] Request starting HTTP/1.1 GET http://spaidsrv:5005/.well-known/openid-configuration  
2017-06-10 13:53:31.430 +00:00 [Debug] CORS request made for path: "/.well-known/openid-configuration" from origin: "http://localhost:5007"
2017-06-10 13:53:31.433 +00:00 [Debug] Client list checked and origin: "http://localhost:5007" is not allowed
2017-06-10 13:53:31.433 +00:00 [Warning] CorsPolicyService did not allow origin: "http://localhost:5007"
2017-06-10 13:53:31.436 +00:00 [Debug] Request path "/.well-known/openid-configuration" matched to endpoint type Discovery
2017-06-10 13:53:31.436 +00:00 [Debug] Mapping found for endpoint: Discovery, creating handler: "IdentityServer4.Endpoints.DiscoveryEndpoint"
2017-06-10 13:53:31.438 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.DiscoveryEndpoint" for "/.well-known/openid-configuration"
2017-06-10 13:53:31.438 +00:00 [Verbose] Processing discovery request.
2017-06-10 13:53:31.438 +00:00 [Debug] Start discovery request
2017-06-10 13:53:31.439 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.DiscoveryDocumentResult"
2017-06-10 13:53:31.449 +00:00 [Information] Request finished in 19.7737ms 200 application/json
2017-06-10 14:02:18.568 +00:00 [Information] You are using the in-memory version of the persisted grant store. This will store consent decisions, authorization codes, refresh and reference tokens in memory only. If you are using any of those features in production, you want to switch to a different store implementation.
2017-06-10 14:02:18.620 +00:00 [Debug] Using built-in CookieAuthentication middleware with scheme: "idsrv"
2017-06-10 14:02:18.624 +00:00 [Debug] Adding CookieAuthentication middleware for external authentication with scheme: "idsrv.external"
2017-06-10 14:02:18.788 +00:00 [Information] User profile is available. Using '"/root/.aspnet/DataProtection-Keys"' as key repository; keys will not be encrypted at rest.
2017-06-10 14:03:22.183 +00:00 [Information] You are using the in-memory version of the persisted grant store. This will store consent decisions, authorization codes, refresh and reference tokens in memory only. If you are using any of those features in production, you want to switch to a different store implementation.
2017-06-10 14:03:22.261 +00:00 [Debug] Using built-in CookieAuthentication middleware with scheme: "idsrv"
2017-06-10 14:03:22.267 +00:00 [Debug] Adding CookieAuthentication middleware for external authentication with scheme: "idsrv.external"
2017-06-10 14:03:22.441 +00:00 [Information] User profile is available. Using '"/root/.aspnet/DataProtection-Keys"' as key repository; keys will not be encrypted at rest.
2017-06-10 14:03:27.605 +00:00 [Information] Request starting HTTP/1.1 GET http://spaidsrv.org:5005/.well-known/openid-configuration  
2017-06-10 14:03:27.634 +00:00 [Debug] CORS request made for path: "/.well-known/openid-configuration" from origin: "http://spaclient.org:5007"
2017-06-10 14:03:27.642 +00:00 [Debug] Client list checked and origin: "http://spaclient.org:5007" is allowed
2017-06-10 14:03:27.642 +00:00 [Debug] CorsPolicyService allowed origin: "http://spaclient.org:5007"
2017-06-10 14:03:27.707 +00:00 [Debug] Request path "/.well-known/openid-configuration" matched to endpoint type Discovery
2017-06-10 14:03:27.710 +00:00 [Debug] Mapping found for endpoint: Discovery, creating handler: "IdentityServer4.Endpoints.DiscoveryEndpoint"
2017-06-10 14:03:27.713 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.DiscoveryEndpoint" for "/.well-known/openid-configuration"
2017-06-10 14:03:27.717 +00:00 [Verbose] Processing discovery request.
2017-06-10 14:03:27.720 +00:00 [Debug] Start discovery request
2017-06-10 14:03:27.740 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.DiscoveryDocumentResult"
2017-06-10 14:03:27.843 +00:00 [Information] Request finished in 250.1073ms 200 application/json
2017-06-10 14:03:27.861 +00:00 [Information] Request starting HTTP/1.1 GET http://spaidsrv.org:5005/connect/authorize?client_id=http%3A%2F%2Fspaclient.org%3A5007&redirect_uri=http%3A%2F%2Fspaclient.org%3A5007%2Fcallback.html&response_type=id_token%20token&scope=openid%20profile%20productapi&state=d669bef8729d40c3a1e284f5f91c119f&nonce=fdb087a517e64f668a06ef9095d3cab8  
2017-06-10 14:03:27.863 +00:00 [Debug] Request path "/connect/authorize" matched to endpoint type Authorize
2017-06-10 14:03:27.872 +00:00 [Debug] Mapping found for endpoint: Authorize, creating handler: "IdentityServer4.Endpoints.AuthorizeEndpoint"
2017-06-10 14:03:27.881 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.AuthorizeEndpoint" for "/connect/authorize"
2017-06-10 14:03:27.889 +00:00 [Debug] Start authorize request
2017-06-10 14:03:27.989 +00:00 [Debug] No user present in authorize request
2017-06-10 14:03:28.000 +00:00 [Debug] Start authorize request protocol validation
2017-06-10 14:03:28.083 +00:00 [Debug] Calling into custom validator: "IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator"
2017-06-10 14:03:28.084 +00:00 [Verbose] Authorize request protocol validation successful
2017-06-10 14:03:28.108 +00:00 [Information] ValidatedAuthorizeRequest
"{
  \"ClientId\": \"http://spaclient.org:5007\",
  \"ClientName\": \"SPAClient\",
  \"RedirectUri\": \"http://spaclient.org:5007/callback.html\",
  \"AllowedRedirectUris\": [
    \"http://spaclient.org:5007/callback.html\"
  ],
  \"SubjectId\": \"anonymous\",
  \"ResponseType\": \"id_token token\",
  \"ResponseMode\": \"fragment\",
  \"GrantType\": \"implicit\",
  \"RequestedScopes\": \"openid profile productapi\",
  \"State\": \"d669bef8729d40c3a1e284f5f91c119f\",
  \"Nonce\": \"fdb087a517e64f668a06ef9095d3cab8\",
  \"Raw\": {
    \"client_id\": \"http://spaclient.org:5007\",
    \"redirect_uri\": \"http://spaclient.org:5007/callback.html\",
    \"response_type\": \"id_token token\",
    \"scope\": \"openid profile productapi\",
    \"state\": \"d669bef8729d40c3a1e284f5f91c119f\",
    \"nonce\": \"fdb087a517e64f668a06ef9095d3cab8\"
  }
}"
2017-06-10 14:03:28.116 +00:00 [Verbose] ProcessInteractionAsync
2017-06-10 14:03:28.124 +00:00 [Information] Showing login: User is not authenticated
2017-06-10 14:03:28.125 +00:00 [Verbose] End authorize request. result type: "IdentityServer4.Endpoints.Results.LoginPageResult"
2017-06-10 14:03:28.125 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.LoginPageResult"
2017-06-10 14:03:28.139 +00:00 [Information] Request finished in 278.0918ms 302 
2017-06-10 14:03:28.144 +00:00 [Information] Request starting HTTP/1.1 GET http://spaidsrv.org:5005/account/login?returnUrl=%2Fconnect%2Fauthorize%2Flogin%3Fclient_id%3Dhttp%253A%252F%252Fspaclient.org%253A5007%26redirect_uri%3Dhttp%253A%252F%252Fspaclient.org%253A5007%252Fcallback.html%26response_type%3Did_token%2520token%26scope%3Dopenid%2520profile%2520productapi%26state%3Dd669bef8729d40c3a1e284f5f91c119f%26nonce%3Dfdb087a517e64f668a06ef9095d3cab8  
2017-06-10 14:03:28.145 +00:00 [Verbose] No endpoint entry found for request path: "/account/login"
2017-06-10 14:03:28.398 +00:00 [Information] Executing action method "IdentityServer4.Quickstart.UI.AccountController.Login (SpaIdSrv)" with arguments (["/connect/authorize/login?client_id=http%3A%2F%2Fspaclient.org%3A5007&redirect_uri=http%3A%2F%2Fspaclient.org%3A5007%2Fcallback.html&response_type=id_token%20token&scope=openid%20profile%20productapi&state=d669bef8729d40c3a1e284f5f91c119f&nonce=fdb087a517e64f668a06ef9095d3cab8"]) - ModelState is Valid
2017-06-10 14:03:28.419 +00:00 [Verbose] returnUrl is valid
2017-06-10 14:03:28.423 +00:00 [Verbose] returnUrl is valid
2017-06-10 14:03:28.426 +00:00 [Debug] Start authorize request protocol validation
2017-06-10 14:03:28.427 +00:00 [Debug] Calling into custom validator: "IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator"
2017-06-10 14:03:28.427 +00:00 [Verbose] Authorize request protocol validation successful
2017-06-10 14:03:28.428 +00:00 [Verbose] AuthorizationRequest being returned
2017-06-10 14:03:28.430 +00:00 [Verbose] AuthorizationRequest being returned
2017-06-10 14:03:32.136 +00:00 [Information] Executing ViewResult, running view at path "/Views/Account/Login.cshtml".
2017-06-10 14:03:32.284 +00:00 [Information] Creating key {40ca8c69-b6b3-4672-9b1e-1016049c7008} with creation date 2017-06-10 14:03:32Z, activation date 2017-06-10 14:03:32Z, and expiration date 2017-09-08 14:03:32Z.
2017-06-10 14:03:32.308 +00:00 [Warning] No XML encryptor configured. Key {40ca8c69-b6b3-4672-9b1e-1016049c7008} may be persisted to storage in unencrypted form.
2017-06-10 14:03:32.316 +00:00 [Information] Writing data to file '"/root/.aspnet/DataProtection-Keys/key-40ca8c69-b6b3-4672-9b1e-1016049c7008.xml"'.
2017-06-10 14:03:32.572 +00:00 [Information] Executed action "IdentityServer4.Quickstart.UI.AccountController.Login (SpaIdSrv)" in 4250.4984ms
2017-06-10 14:03:32.576 +00:00 [Information] Request finished in 4431.6182ms 200 text/html; charset=utf-8
2017-06-10 14:03:32.597 +00:00 [Information] Request starting HTTP/1.1 GET http://spaidsrv.org:5005/lib/bootstrap/css/bootstrap.css  
2017-06-10 14:03:32.598 +00:00 [Verbose] No endpoint entry found for request path: "/lib/bootstrap/css/bootstrap.css"
2017-06-10 14:03:32.598 +00:00 [Information] Request starting HTTP/1.1 GET http://spaidsrv.org:5005/css/site.css  
2017-06-10 14:03:32.599 +00:00 [Verbose] No endpoint entry found for request path: "/css/site.css"
2017-06-10 14:03:32.618 +00:00 [Information] Sending file. Request path: '"/lib/bootstrap/css/bootstrap.css"'. Physical path: '"/app/wwwroot/lib/bootstrap/css/bootstrap.css"'
2017-06-10 14:03:32.618 +00:00 [Information] Sending file. Request path: '"/css/site.css"'. Physical path: '"/app/wwwroot/css/site.css"'
2017-06-10 14:03:32.753 +00:00 [Information] Request finished in 154.6306ms 200 text/css
2017-06-10 14:03:32.762 +00:00 [Information] Request starting HTTP/1.1 GET http://spaidsrv.org:5005/lib/jquery/jquery.js  
2017-06-10 14:03:32.762 +00:00 [Verbose] No endpoint entry found for request path: "/lib/jquery/jquery.js"
2017-06-10 14:03:32.769 +00:00 [Information] Sending file. Request path: '"/lib/jquery/jquery.js"'. Physical path: '"/app/wwwroot/lib/jquery/jquery.js"'
2017-06-10 14:03:32.841 +00:00 [Information] Request finished in 243.6619ms 200 text/css
2017-06-10 14:03:32.874 +00:00 [Information] Request starting HTTP/1.1 GET http://spaidsrv.org:5005/icon.png  
2017-06-10 14:03:32.874 +00:00 [Verbose] No endpoint entry found for request path: "/icon.png"
2017-06-10 14:03:32.874 +00:00 [Information] Request starting HTTP/1.1 GET http://spaidsrv.org:5005/lib/bootstrap/js/bootstrap.js  
2017-06-10 14:03:32.874 +00:00 [Verbose] No endpoint entry found for request path: "/lib/bootstrap/js/bootstrap.js"
2017-06-10 14:03:32.879 +00:00 [Information] Sending file. Request path: '"/icon.png"'. Physical path: '"/app/wwwroot/icon.png"'
2017-06-10 14:03:32.887 +00:00 [Information] Sending file. Request path: '"/lib/bootstrap/js/bootstrap.js"'. Physical path: '"/app/wwwroot/lib/bootstrap/js/bootstrap.js"'
2017-06-10 14:03:32.930 +00:00 [Information] Request finished in 56.5587ms 200 image/png
2017-06-10 14:03:32.972 +00:00 [Information] Request starting HTTP/1.1 GET http://spaidsrv.org:5005/lib/bootstrap/css/bootstrap.css.map  
2017-06-10 14:03:32.987 +00:00 [Verbose] No endpoint entry found for request path: "/lib/bootstrap/css/bootstrap.css.map"
2017-06-10 14:03:32.995 +00:00 [Information] Sending file. Request path: '"/lib/bootstrap/css/bootstrap.css.map"'. Physical path: '"/app/wwwroot/lib/bootstrap/css/bootstrap.css.map"'
2017-06-10 14:03:33.018 +00:00 [Information] Request finished in 144.0028ms 200 application/javascript
2017-06-10 14:03:33.018 +00:00 [Information] Request finished in 256.6529ms 200 application/javascript
2017-06-10 14:03:33.114 +00:00 [Information] Request starting HTTP/1.1 GET http://spaidsrv.org:5005/favicon.ico  
2017-06-10 14:03:33.114 +00:00 [Verbose] No endpoint entry found for request path: "/favicon.ico"
2017-06-10 14:03:33.121 +00:00 [Information] Request finished in 175.2893ms 200 text/plain
2017-06-10 14:03:33.119 +00:00 [Information] Sending file. Request path: '"/favicon.ico"'. Physical path: '"/app/wwwroot/favicon.ico"'
2017-06-10 14:03:33.151 +00:00 [Information] Request finished in 43.5592ms 200 image/x-icon
2017-06-10 14:03:37.043 +00:00 [Information] Request starting HTTP/1.1 POST http://spaidsrv.org:5005/account/login?returnUrl=%2Fconnect%2Fauthorize%2Flogin%3Fclient_id%3Dhttp%253A%252F%252Fspaclient.org%253A5007%26redirect_uri%3Dhttp%253A%252F%252Fspaclient.org%253A5007%252Fcallback.html%26response_type%3Did_token%2520token%26scope%3Dopenid%2520profile%2520productapi%26state%3Dd669bef8729d40c3a1e284f5f91c119f%26nonce%3Dfdb087a517e64f668a06ef9095d3cab8 application/x-www-form-urlencoded 578
2017-06-10 14:03:37.043 +00:00 [Verbose] No endpoint entry found for request path: "/account/login"
2017-06-10 14:03:37.078 +00:00 [Information] Executing action method "IdentityServer4.Quickstart.UI.AccountController.Login (SpaIdSrv)" with arguments (["IdentityServer4.Quickstart.UI.LoginInputModel"]) - ModelState is Valid
2017-06-10 14:03:37.100 +00:00 [Debug] Augmenting SignInContext
2017-06-10 14:03:37.110 +00:00 [Information] AuthenticationScheme: "idsrv" signed in.
2017-06-10 14:03:37.114 +00:00 [Verbose] returnUrl is valid
2017-06-10 14:03:37.114 +00:00 [Verbose] IsValidReturnUrl true
2017-06-10 14:03:37.115 +00:00 [Information] Executing RedirectResult, redirecting to "/connect/authorize/login?client_id=http%3A%2F%2Fspaclient.org%3A5007&redirect_uri=http%3A%2F%2Fspaclient.org%3A5007%2Fcallback.html&response_type=id_token%20token&scope=openid%20profile%20productapi&state=d669bef8729d40c3a1e284f5f91c119f&nonce=fdb087a517e64f668a06ef9095d3cab8".
2017-06-10 14:03:37.116 +00:00 [Information] Executed action "IdentityServer4.Quickstart.UI.AccountController.Login (SpaIdSrv)" in 69.8575ms
2017-06-10 14:03:37.117 +00:00 [Information] Request finished in 74.3474ms 302 
2017-06-10 14:03:37.121 +00:00 [Information] Request starting HTTP/1.1 GET http://spaidsrv.org:5005/connect/authorize/login?client_id=http%3A%2F%2Fspaclient.org%3A5007&redirect_uri=http%3A%2F%2Fspaclient.org%3A5007%2Fcallback.html&response_type=id_token%20token&scope=openid%20profile%20productapi&state=d669bef8729d40c3a1e284f5f91c119f&nonce=fdb087a517e64f668a06ef9095d3cab8  
2017-06-10 14:03:37.124 +00:00 [Information] HttpContext.User merged via AutomaticAuthentication from authenticationScheme: "idsrv".
2017-06-10 14:03:37.124 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 14:03:37.124 +00:00 [Debug] Request path "/connect/authorize/login" matched to endpoint type Authorize
2017-06-10 14:03:37.125 +00:00 [Debug] Mapping found for endpoint: Authorize, creating handler: "IdentityServer4.Endpoints.AuthorizeEndpoint"
2017-06-10 14:03:37.132 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.AuthorizeEndpoint" for "/connect/authorize/login"
2017-06-10 14:03:37.138 +00:00 [Debug] Start authorize request (after login)
2017-06-10 14:03:37.139 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 14:03:37.140 +00:00 [Debug] User in authorize request: "2"
2017-06-10 14:03:37.140 +00:00 [Debug] Start authorize request protocol validation
2017-06-10 14:03:37.140 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 14:03:37.141 +00:00 [Debug] Calling into custom validator: "IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator"
2017-06-10 14:03:37.142 +00:00 [Verbose] Authorize request protocol validation successful
2017-06-10 14:03:37.143 +00:00 [Information] ValidatedAuthorizeRequest
"{
  \"ClientId\": \"http://spaclient.org:5007\",
  \"ClientName\": \"SPAClient\",
  \"RedirectUri\": \"http://spaclient.org:5007/callback.html\",
  \"AllowedRedirectUris\": [
    \"http://spaclient.org:5007/callback.html\"
  ],
  \"SubjectId\": \"2\",
  \"ResponseType\": \"id_token token\",
  \"ResponseMode\": \"fragment\",
  \"GrantType\": \"implicit\",
  \"RequestedScopes\": \"openid profile productapi\",
  \"State\": \"d669bef8729d40c3a1e284f5f91c119f\",
  \"Nonce\": \"fdb087a517e64f668a06ef9095d3cab8\",
  \"SessionId\": \"08cae3fa6327fe14b94b29ff5b58d7e3\",
  \"Raw\": {
    \"client_id\": \"http://spaclient.org:5007\",
    \"redirect_uri\": \"http://spaclient.org:5007/callback.html\",
    \"response_type\": \"id_token token\",
    \"scope\": \"openid profile productapi\",
    \"state\": \"d669bef8729d40c3a1e284f5f91c119f\",
    \"nonce\": \"fdb087a517e64f668a06ef9095d3cab8\"
  }
}"
2017-06-10 14:03:37.143 +00:00 [Verbose] ProcessInteractionAsync
2017-06-10 14:03:37.168 +00:00 [Debug] "user_consent" grant with value: "http://spaclient.org:5007|2" not found in store.
2017-06-10 14:03:37.168 +00:00 [Information] Showing consent: User has not yet consented
2017-06-10 14:03:37.170 +00:00 [Verbose] End Authorize Request. Result type: "IdentityServer4.Endpoints.Results.ConsentPageResult"
2017-06-10 14:03:37.171 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.ConsentPageResult"
2017-06-10 14:03:37.174 +00:00 [Information] Request finished in 52.6903ms 302 
2017-06-10 14:03:37.180 +00:00 [Information] Request starting HTTP/1.1 GET http://spaidsrv.org:5005/consent?returnUrl=%2Fconnect%2Fauthorize%2Fconsent%3Fclient_id%3Dhttp%253A%252F%252Fspaclient.org%253A5007%26redirect_uri%3Dhttp%253A%252F%252Fspaclient.org%253A5007%252Fcallback.html%26response_type%3Did_token%2520token%26scope%3Dopenid%2520profile%2520productapi%26state%3Dd669bef8729d40c3a1e284f5f91c119f%26nonce%3Dfdb087a517e64f668a06ef9095d3cab8  
2017-06-10 14:03:37.181 +00:00 [Information] HttpContext.User merged via AutomaticAuthentication from authenticationScheme: "idsrv".
2017-06-10 14:03:37.182 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 14:03:37.182 +00:00 [Verbose] No endpoint entry found for request path: "/consent"
2017-06-10 14:03:37.190 +00:00 [Information] Executing action method "IdentityServer4.Quickstart.UI.ConsentController.Index (SpaIdSrv)" with arguments (["/connect/authorize/consent?client_id=http%3A%2F%2Fspaclient.org%3A5007&redirect_uri=http%3A%2F%2Fspaclient.org%3A5007%2Fcallback.html&response_type=id_token%20token&scope=openid%20profile%20productapi&state=d669bef8729d40c3a1e284f5f91c119f&nonce=fdb087a517e64f668a06ef9095d3cab8"]) - ModelState is Valid
2017-06-10 14:03:37.196 +00:00 [Verbose] returnUrl is valid
2017-06-10 14:03:37.196 +00:00 [Verbose] returnUrl is valid
2017-06-10 14:03:37.196 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 14:03:37.197 +00:00 [Debug] Start authorize request protocol validation
2017-06-10 14:03:37.197 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 14:03:37.197 +00:00 [Debug] Calling into custom validator: "IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator"
2017-06-10 14:03:37.197 +00:00 [Verbose] Authorize request protocol validation successful
2017-06-10 14:03:37.198 +00:00 [Verbose] AuthorizationRequest being returned
2017-06-10 14:03:37.199 +00:00 [Verbose] AuthorizationRequest being returned
2017-06-10 14:03:37.321 +00:00 [Information] Executing ViewResult, running view at path "/Views/Consent/Index.cshtml".
2017-06-10 14:03:37.452 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 14:03:37.459 +00:00 [Information] Executed action "IdentityServer4.Quickstart.UI.ConsentController.Index (SpaIdSrv)" in 271.1382ms
2017-06-10 14:03:37.460 +00:00 [Information] Request finished in 280.4503ms 200 text/html; charset=utf-8
2017-06-10 14:03:37.656 +00:00 [Information] Request starting HTTP/1.1 GET http://spaidsrv.org:5005/lib/bootstrap/fonts/glyphicons-halflings-regular.woff2  
2017-06-10 14:03:37.656 +00:00 [Information] HttpContext.User merged via AutomaticAuthentication from authenticationScheme: "idsrv".
2017-06-10 14:03:37.656 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 14:03:37.656 +00:00 [Verbose] No endpoint entry found for request path: "/lib/bootstrap/fonts/glyphicons-halflings-regular.woff2"
2017-06-10 14:03:37.665 +00:00 [Information] Sending file. Request path: '"/lib/bootstrap/fonts/glyphicons-halflings-regular.woff2"'. Physical path: '"/app/wwwroot/lib/bootstrap/fonts/glyphicons-halflings-regular.woff2"'
2017-06-10 14:03:37.711 +00:00 [Information] Request finished in 55.4941ms 200 application/font-woff2
2017-06-10 14:03:40.930 +00:00 [Information] Request starting HTTP/1.1 POST http://spaidsrv.org:5005/consent application/x-www-form-urlencoded 675
2017-06-10 14:03:40.930 +00:00 [Information] HttpContext.User merged via AutomaticAuthentication from authenticationScheme: "idsrv".
2017-06-10 14:03:40.930 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 14:03:40.930 +00:00 [Verbose] No endpoint entry found for request path: "/consent"
2017-06-10 14:03:40.942 +00:00 [Information] Executing action method "IdentityServer4.Quickstart.UI.ConsentController.Index (SpaIdSrv)" with arguments (["IdentityServer4.Quickstart.UI.ConsentInputModel"]) - ModelState is Valid
2017-06-10 14:03:40.953 +00:00 [Verbose] returnUrl is valid
2017-06-10 14:03:40.954 +00:00 [Verbose] returnUrl is valid
2017-06-10 14:03:40.954 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 14:03:40.955 +00:00 [Debug] Start authorize request protocol validation
2017-06-10 14:03:40.955 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 14:03:40.955 +00:00 [Debug] Calling into custom validator: "IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator"
2017-06-10 14:03:40.956 +00:00 [Verbose] Authorize request protocol validation successful
2017-06-10 14:03:40.957 +00:00 [Verbose] AuthorizationRequest being returned
2017-06-10 14:03:40.957 +00:00 [Verbose] AuthorizationRequest being returned
2017-06-10 14:03:40.963 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 14:03:40.978 +00:00 [Verbose] Protecting message: "{\"Created\":636327002209691410,\"Data\":{\"Granted\":true,\"ScopesConsented\":[\"openid\",\"profile\",\"productapi\"]}}"
2017-06-10 14:03:40.980 +00:00 [Information] Executing RedirectResult, redirecting to "/connect/authorize/consent?client_id=http%3A%2F%2Fspaclient.org%3A5007&redirect_uri=http%3A%2F%2Fspaclient.org%3A5007%2Fcallback.html&response_type=id_token%20token&scope=openid%20profile%20productapi&state=d669bef8729d40c3a1e284f5f91c119f&nonce=fdb087a517e64f668a06ef9095d3cab8".
2017-06-10 14:03:40.983 +00:00 [Information] Executed action "IdentityServer4.Quickstart.UI.ConsentController.Index (SpaIdSrv)" in 50.9843ms
2017-06-10 14:03:40.984 +00:00 [Information] Request finished in 54.1474ms 302 
2017-06-10 14:03:40.988 +00:00 [Information] Request starting HTTP/1.1 GET http://spaidsrv.org:5005/connect/authorize/consent?client_id=http%3A%2F%2Fspaclient.org%3A5007&redirect_uri=http%3A%2F%2Fspaclient.org%3A5007%2Fcallback.html&response_type=id_token%20token&scope=openid%20profile%20productapi&state=d669bef8729d40c3a1e284f5f91c119f&nonce=fdb087a517e64f668a06ef9095d3cab8  
2017-06-10 14:03:40.989 +00:00 [Information] HttpContext.User merged via AutomaticAuthentication from authenticationScheme: "idsrv".
2017-06-10 14:03:40.990 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 14:03:40.990 +00:00 [Debug] Request path "/connect/authorize/consent" matched to endpoint type Authorize
2017-06-10 14:03:40.990 +00:00 [Debug] Mapping found for endpoint: Authorize, creating handler: "IdentityServer4.Endpoints.AuthorizeEndpoint"
2017-06-10 14:03:40.990 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.AuthorizeEndpoint" for "/connect/authorize/consent"
2017-06-10 14:03:41.000 +00:00 [Debug] Start authorize request (after consent)
2017-06-10 14:03:41.000 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 14:03:41.010 +00:00 [Debug] User in authorize request: "2"
2017-06-10 14:03:41.011 +00:00 [Debug] Start authorize request protocol validation
2017-06-10 14:03:41.011 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 14:03:41.011 +00:00 [Debug] Calling into custom validator: "IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator"
2017-06-10 14:03:41.011 +00:00 [Verbose] Authorize request protocol validation successful
2017-06-10 14:03:41.012 +00:00 [Information] ValidatedAuthorizeRequest
"{
  \"ClientId\": \"http://spaclient.org:5007\",
  \"ClientName\": \"SPAClient\",
  \"RedirectUri\": \"http://spaclient.org:5007/callback.html\",
  \"AllowedRedirectUris\": [
    \"http://spaclient.org:5007/callback.html\"
  ],
  \"SubjectId\": \"2\",
  \"ResponseType\": \"id_token token\",
  \"ResponseMode\": \"fragment\",
  \"GrantType\": \"implicit\",
  \"RequestedScopes\": \"openid profile productapi\",
  \"State\": \"d669bef8729d40c3a1e284f5f91c119f\",
  \"Nonce\": \"fdb087a517e64f668a06ef9095d3cab8\",
  \"SessionId\": \"08cae3fa6327fe14b94b29ff5b58d7e3\",
  \"Raw\": {
    \"client_id\": \"http://spaclient.org:5007\",
    \"redirect_uri\": \"http://spaclient.org:5007/callback.html\",
    \"response_type\": \"id_token token\",
    \"scope\": \"openid profile productapi\",
    \"state\": \"d669bef8729d40c3a1e284f5f91c119f\",
    \"nonce\": \"fdb087a517e64f668a06ef9095d3cab8\"
  }
}"
2017-06-10 14:03:41.012 +00:00 [Verbose] ProcessInteractionAsync
2017-06-10 14:03:41.012 +00:00 [Debug] "user_consent" grant with value: "http://spaclient.org:5007|2" not found in store.
2017-06-10 14:03:41.012 +00:00 [Verbose] Consent was shown to user
2017-06-10 14:03:41.028 +00:00 [Information] User consented to scopes: ["openid", "profile", "productapi"]
2017-06-10 14:03:41.042 +00:00 [Debug] Creating Implicit Flow response.
2017-06-10 14:03:41.047 +00:00 [Verbose] Creating access token
2017-06-10 14:03:41.057 +00:00 [Debug] Getting claims for access token for client: "http://spaclient.org:5007"
2017-06-10 14:03:41.058 +00:00 [Debug] Getting claims for access token for subject: "2"
2017-06-10 14:03:41.064 +00:00 [Debug] Get profile called for subject "2" from client "SPAClient" with claim types [] via "ClaimsProviderAccessToken"
2017-06-10 14:03:41.071 +00:00 [Verbose] Creating JWT access token
2017-06-10 14:03:41.256 +00:00 [Verbose] Creating identity token
2017-06-10 14:03:41.260 +00:00 [Debug] Getting claims for identity token for subject: "2" and client: "http://spaclient.org:5007"
2017-06-10 14:03:41.261 +00:00 [Debug] In addition to an id_token, an access_token was requested. No claims other than sub are included in the id_token. To obtain more user claims, either use the user info endpoint or set AlwaysIncludeUserClaimsInIdToken on the client configuration.
2017-06-10 14:03:41.261 +00:00 [Verbose] Creating JWT identity token
2017-06-10 14:03:41.267 +00:00 [Verbose] Identity token issued for "http://spaclient.org:5007 (SPAClient)" / "2": "eyJhbGciOiJSUzI1NiIsImtpZCI6IjI3M2M5ZjcyMjA2MTI0NDNiZTZlZTEzN2Q0YmFiM2M0IiwidHlwIjoiSldUIn0.eyJuYmYiOjE0OTcxMDM0MjEsImV4cCI6MTQ5NzEwMzcyMSwiaXNzIjoiaHR0cDovL3NwYWlkc3J2Lm9yZzo1MDA1IiwiYXVkIjoiaHR0cDovL3NwYWNsaWVudC5vcmc6NTAwNyIsIm5vbmNlIjoiZmRiMDg3YTUxN2U2NGY2NjhhMDZlZjkwOTVkM2NhYjgiLCJpYXQiOjE0OTcxMDM0MjEsImF0X2hhc2giOiJzY2F1N1FlU3YxdkV5ZFVxYk1EYWhnIiwic2lkIjoiMDhjYWUzZmE2MzI3ZmUxNGI5NGIyOWZmNWI1OGQ3ZTMiLCJzdWIiOiIyIiwiYXV0aF90aW1lIjoxNDk3MTAzNDE3LCJpZHAiOiJsb2NhbCIsImFtciI6WyJwd2QiXX0.oGVkVk9E3tlXv0XYrmWmQjDTJieT4q8BJAiNv9R6vLFhhsJTiPf8xcAB3y-9wqlzBKbI_AANeD_TMbHHVVDql304wRq8rblg-tCkFvIeXSzqPJAuucOezEIH-0incVpyLUQ43DNogiYbGUbt9SxBCgc02nDOyBs4nK2HAI72h3mWqmnTHZXqS_K1pyAWKuEx_mdTqTGnxu_7kz-lS7t1Bd9DmawN13THFVt6fX0gK_rL6rxeF862a5L0fkYxxN-Wwxs2Ico2BlTG1JxWaJP_tQ7mDMPesfp27fBjM4EmB2VLQ0rOEdKliNQMsE0ZETM_mk2kaaopqmbysIVuynpL2Q"
2017-06-10 14:03:41.267 +00:00 [Verbose] Access token issued for "http://spaclient.org:5007 (SPAClient)" / "2": "eyJhbGciOiJSUzI1NiIsImtpZCI6IjI3M2M5ZjcyMjA2MTI0NDNiZTZlZTEzN2Q0YmFiM2M0IiwidHlwIjoiSldUIn0.eyJuYmYiOjE0OTcxMDM0MjEsImV4cCI6MTQ5NzEwNzAyMSwiaXNzIjoiaHR0cDovL3NwYWlkc3J2Lm9yZzo1MDA1IiwiYXVkIjpbImh0dHA6Ly9zcGFpZHNydi5vcmc6NTAwNS9yZXNvdXJjZXMiLCJwcm9kdWN0YXBpIl0sImNsaWVudF9pZCI6Imh0dHA6Ly9zcGFjbGllbnQub3JnOjUwMDciLCJzdWIiOiIyIiwiYXV0aF90aW1lIjoxNDk3MTAzNDE3LCJpZHAiOiJsb2NhbCIsInNjb3BlIjpbIm9wZW5pZCIsInByb2ZpbGUiLCJwcm9kdWN0YXBpIl0sImFtciI6WyJwd2QiXX0.VQToZeiITf_THouwR3swXdtWEATS_bZs231jQLsnKd2gd3ZOB6J08SZQFb2ikrDGP_eY9MXquZZhqXW4HLl-tsMAYB_i0WVUk-uX843I8a8WgRFi9ucEHC8gpm_3c3RNRN1HQq4m-wRzAHHKWN2444RXScOYN_J2GHUxKsDNUZTpBazwS56DTYhcf7x_K6rpwJDCgFAWcLRtnq374yZsO0ptQCtOsx-szO4BnFF19IDo3aRqvNhfnKgXBOhaMOXSCfwhcJRfyf-ONK2Y55iLKNEjqV6mTrUOVtZ8UYZBViAkG7YGqmtKhiumbI7-8kWe2bRD0B2_MGu7TQUtbsjVgg"
2017-06-10 14:03:41.275 +00:00 [Information] Authorize endpoint response
"{
  \"SubjectId\": \"2\",
  \"ClientId\": \"http://spaclient.org:5007\",
  \"RedirectUri\": \"http://spaclient.org:5007/callback.html\",
  \"State\": \"d669bef8729d40c3a1e284f5f91c119f\",
  \"Scope\": \"openid profile productapi\"
}"
2017-06-10 14:03:41.276 +00:00 [Verbose] End Authorize Request. Result type: "IdentityServer4.Endpoints.Results.AuthorizeResult"
2017-06-10 14:03:41.278 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.AuthorizeResult"
2017-06-10 14:03:41.294 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 14:03:41.300 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 14:03:41.303 +00:00 [Debug] Augmenting SignInContext
2017-06-10 14:03:41.304 +00:00 [Information] AuthenticationScheme: "idsrv" signed in.
2017-06-10 14:03:41.310 +00:00 [Information] Request finished in 321.9619ms 302 
2017-06-10 14:03:41.657 +00:00 [Information] Request starting HTTP/1.1 GET http://spaidsrv.org:5005/.well-known/openid-configuration  
2017-06-10 14:03:41.658 +00:00 [Debug] CORS request made for path: "/.well-known/openid-configuration" from origin: "http://spaclient.org:5007"
2017-06-10 14:03:41.658 +00:00 [Debug] Client list checked and origin: "http://spaclient.org:5007" is allowed
2017-06-10 14:03:41.658 +00:00 [Debug] CorsPolicyService allowed origin: "http://spaclient.org:5007"
2017-06-10 14:03:41.658 +00:00 [Debug] Request path "/.well-known/openid-configuration" matched to endpoint type Discovery
2017-06-10 14:03:41.658 +00:00 [Debug] Mapping found for endpoint: Discovery, creating handler: "IdentityServer4.Endpoints.DiscoveryEndpoint"
2017-06-10 14:03:41.658 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.DiscoveryEndpoint" for "/.well-known/openid-configuration"
2017-06-10 14:03:41.659 +00:00 [Verbose] Processing discovery request.
2017-06-10 14:03:41.659 +00:00 [Debug] Start discovery request
2017-06-10 14:03:41.659 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.DiscoveryDocumentResult"
2017-06-10 14:03:41.659 +00:00 [Information] Request finished in 1.9933ms 200 application/json
2017-06-10 14:03:41.709 +00:00 [Information] Request starting HTTP/1.1 GET http://spaidsrv.org:5005/.well-known/openid-configuration/jwks  
2017-06-10 14:03:41.709 +00:00 [Debug] CORS request made for path: "/.well-known/openid-configuration/jwks" from origin: "http://spaclient.org:5007"
2017-06-10 14:03:41.709 +00:00 [Debug] Client list checked and origin: "http://spaclient.org:5007" is allowed
2017-06-10 14:03:41.710 +00:00 [Debug] CorsPolicyService allowed origin: "http://spaclient.org:5007"
2017-06-10 14:03:41.711 +00:00 [Debug] Request path "/.well-known/openid-configuration/jwks" matched to endpoint type Discovery
2017-06-10 14:03:41.711 +00:00 [Debug] Mapping found for endpoint: Discovery, creating handler: "IdentityServer4.Endpoints.DiscoveryEndpoint"
2017-06-10 14:03:41.711 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.DiscoveryEndpoint" for "/.well-known/openid-configuration/jwks"
2017-06-10 14:03:41.712 +00:00 [Verbose] Processing discovery request.
2017-06-10 14:03:41.716 +00:00 [Debug] Start key discovery request
2017-06-10 14:03:41.731 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.JsonWebKeysResult"
2017-06-10 14:03:41.756 +00:00 [Information] Request finished in 47.6253ms 200 application/json
2017-06-10 14:03:41.779 +00:00 [Information] Request starting HTTP/1.1 OPTIONS http://spaidsrv.org:5005/connect/userinfo  
2017-06-10 14:03:41.779 +00:00 [Debug] CORS request made for path: "/connect/userinfo" from origin: "http://spaclient.org:5007"
2017-06-10 14:03:41.780 +00:00 [Debug] Client list checked and origin: "http://spaclient.org:5007" is allowed
2017-06-10 14:03:41.781 +00:00 [Debug] CorsPolicyService allowed origin: "http://spaclient.org:5007"
2017-06-10 14:03:41.788 +00:00 [Information] Request finished in 8.3128ms 204 
2017-06-10 14:03:41.788 +00:00 [Information] Request starting HTTP/1.1 GET http://spaidsrv.org:5005/connect/userinfo  
2017-06-10 14:03:41.788 +00:00 [Debug] CORS request made for path: "/connect/userinfo" from origin: "http://spaclient.org:5007"
2017-06-10 14:03:41.788 +00:00 [Debug] Client list checked and origin: "http://spaclient.org:5007" is allowed
2017-06-10 14:03:41.789 +00:00 [Debug] CorsPolicyService allowed origin: "http://spaclient.org:5007"
2017-06-10 14:03:41.791 +00:00 [Debug] Request path "/connect/userinfo" matched to endpoint type UserInfo
2017-06-10 14:03:41.792 +00:00 [Debug] Mapping found for endpoint: UserInfo, creating handler: "IdentityServer4.Endpoints.UserInfoEndpoint"
2017-06-10 14:03:41.795 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.UserInfoEndpoint" for "/connect/userinfo"
2017-06-10 14:03:41.804 +00:00 [Debug] Start userinfo request
2017-06-10 14:03:41.814 +00:00 [Information] ValidateAsync: Locating bearer token
2017-06-10 14:03:41.816 +00:00 [Verbose] Authorization header value found
2017-06-10 14:03:41.816 +00:00 [Verbose] Authorization scheme is bearer
2017-06-10 14:03:41.816 +00:00 [Debug] Bearer token found in header
2017-06-10 14:03:41.817 +00:00 [Debug] Token found: "AuthorizationHeader"
2017-06-10 14:03:41.825 +00:00 [Verbose] Start access token validation
2017-06-10 14:03:41.877 +00:00 [Debug] Token validation success
"{
  \"ValidateLifetime\": true,
  \"AccessTokenType\": \"Jwt\",
  \"ExpectedScope\": \"openid\",
  \"Claims\": {
    \"nbf\": 1497103421,
    \"exp\": 1497107021,
    \"iss\": \"http://spaidsrv.org:5005\",
    \"aud\": [
      \"http://spaidsrv.org:5005/resources\",
      \"productapi\"
    ],
    \"client_id\": \"http://spaclient.org:5007\",
    \"sub\": \"2\",
    \"auth_time\": 1497103417,
    \"idp\": \"local\",
    \"scope\": [
      \"openid\",
      \"profile\",
      \"productapi\"
    ],
    \"amr\": \"pwd\"
  }
}"
2017-06-10 14:03:41.886 +00:00 [Verbose] Creating userinfo response
2017-06-10 14:03:41.892 +00:00 [Debug] Scopes in access token: "openid profile productapi"
2017-06-10 14:03:41.898 +00:00 [Debug] Requested claim types: "sub name family_name given_name middle_name nickname preferred_username profile picture website gender birthdate zoneinfo locale updated_at"
2017-06-10 14:03:41.899 +00:00 [Debug] Get profile called for subject "2" from client "SPAClient" with claim types ["sub", "name", "family_name", "given_name", "middle_name", "nickname", "preferred_username", "profile", "picture", "website", "gender", "birthdate", "zoneinfo", "locale", "updated_at"] via "UserInfoEndpoint"
2017-06-10 14:03:41.901 +00:00 [Information] Profile service returned to the following claim types: ""
2017-06-10 14:03:41.902 +00:00 [Debug] End userinfo request
2017-06-10 14:03:41.902 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.UserInfoResult"
2017-06-10 14:03:41.906 +00:00 [Information] Request finished in 118.6695ms 200 application/json
2017-06-10 14:03:41.925 +00:00 [Information] Request starting HTTP/1.1 GET http://spaidsrv.org:5005/connect/checksession  
2017-06-10 14:03:41.925 +00:00 [Information] HttpContext.User merged via AutomaticAuthentication from authenticationScheme: "idsrv".
2017-06-10 14:03:41.926 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 14:03:41.926 +00:00 [Debug] Request path "/connect/checksession" matched to endpoint type CheckSession
2017-06-10 14:03:41.926 +00:00 [Debug] Mapping found for endpoint: CheckSession, creating handler: "IdentityServer4.Endpoints.CheckSessionEndpoint"
2017-06-10 14:03:41.928 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.CheckSessionEndpoint" for "/connect/checksession"
2017-06-10 14:03:41.932 +00:00 [Debug] Rendering check session result
2017-06-10 14:03:41.933 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.CheckSessionResult"
2017-06-10 14:03:41.948 +00:00 [Information] Request finished in 23.3565ms 200 text/html; charset=UTF-8
2017-06-10 14:03:42.242 +00:00 [Information] Request starting HTTP/1.1 GET http://spaidsrv.org:5005/.well-known/openid-configuration  
2017-06-10 14:03:42.242 +00:00 [Debug] CORS request made for path: "/.well-known/openid-configuration" from origin: "http://spaclient.org:5007"
2017-06-10 14:03:42.242 +00:00 [Debug] Client list checked and origin: "http://spaclient.org:5007" is allowed
2017-06-10 14:03:42.242 +00:00 [Debug] CorsPolicyService allowed origin: "http://spaclient.org:5007"
2017-06-10 14:03:42.242 +00:00 [Debug] Request path "/.well-known/openid-configuration" matched to endpoint type Discovery
2017-06-10 14:03:42.242 +00:00 [Debug] Mapping found for endpoint: Discovery, creating handler: "IdentityServer4.Endpoints.DiscoveryEndpoint"
2017-06-10 14:03:42.242 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.DiscoveryEndpoint" for "/.well-known/openid-configuration"
2017-06-10 14:03:42.243 +00:00 [Verbose] Processing discovery request.
2017-06-10 14:03:42.243 +00:00 [Debug] Start discovery request
2017-06-10 14:03:42.243 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.DiscoveryDocumentResult"
2017-06-10 14:03:42.243 +00:00 [Information] Request finished in 1.6012ms 200 application/json
2017-06-10 14:03:42.296 +00:00 [Information] Request starting HTTP/1.1 GET http://spaidsrv.org:5005/connect/checksession  
2017-06-10 14:03:42.297 +00:00 [Information] HttpContext.User merged via AutomaticAuthentication from authenticationScheme: "idsrv".
2017-06-10 14:03:42.297 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 14:03:42.297 +00:00 [Debug] Request path "/connect/checksession" matched to endpoint type CheckSession
2017-06-10 14:03:42.297 +00:00 [Debug] Mapping found for endpoint: CheckSession, creating handler: "IdentityServer4.Endpoints.CheckSessionEndpoint"
2017-06-10 14:03:42.301 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.CheckSessionEndpoint" for "/connect/checksession"
2017-06-10 14:03:42.302 +00:00 [Debug] Rendering check session result
2017-06-10 14:03:42.302 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.CheckSessionResult"
2017-06-10 14:03:42.303 +00:00 [Information] Request finished in 6.3896ms 200 text/html; charset=UTF-8
2017-06-10 14:03:44.663 +00:00 [Information] Request starting HTTP/1.1 GET http://spaidsrv.org:5005/.well-known/openid-configuration  
2017-06-10 14:03:44.663 +00:00 [Debug] Request path "/.well-known/openid-configuration" matched to endpoint type Discovery
2017-06-10 14:03:44.663 +00:00 [Debug] Mapping found for endpoint: Discovery, creating handler: "IdentityServer4.Endpoints.DiscoveryEndpoint"
2017-06-10 14:03:44.664 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.DiscoveryEndpoint" for "/.well-known/openid-configuration"
2017-06-10 14:03:44.664 +00:00 [Verbose] Processing discovery request.
2017-06-10 14:03:44.664 +00:00 [Debug] Start discovery request
2017-06-10 14:03:44.664 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.DiscoveryDocumentResult"
2017-06-10 14:03:44.664 +00:00 [Information] Request finished in 1.5522ms 200 application/json
2017-06-10 14:03:44.871 +00:00 [Information] Request starting HTTP/1.1 GET http://spaidsrv.org:5005/.well-known/openid-configuration/jwks  
2017-06-10 14:03:44.871 +00:00 [Debug] Request path "/.well-known/openid-configuration/jwks" matched to endpoint type Discovery
2017-06-10 14:03:44.871 +00:00 [Debug] Mapping found for endpoint: Discovery, creating handler: "IdentityServer4.Endpoints.DiscoveryEndpoint"
2017-06-10 14:03:44.872 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.DiscoveryEndpoint" for "/.well-known/openid-configuration/jwks"
2017-06-10 14:03:44.872 +00:00 [Verbose] Processing discovery request.
2017-06-10 14:03:44.872 +00:00 [Debug] Start key discovery request
2017-06-10 14:03:44.872 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.JsonWebKeysResult"
2017-06-10 14:03:44.872 +00:00 [Information] Request finished in 0.8099ms 200 application/json
2017-06-10 14:08:33.999 +00:00 [Information] You are using the in-memory version of the persisted grant store. This will store consent decisions, authorization codes, refresh and reference tokens in memory only. If you are using any of those features in production, you want to switch to a different store implementation.
2017-06-10 14:08:34.091 +00:00 [Debug] Using built-in CookieAuthentication middleware with scheme: "idsrv"
2017-06-10 14:08:34.095 +00:00 [Debug] Adding CookieAuthentication middleware for external authentication with scheme: "idsrv.external"
2017-06-10 14:08:34.317 +00:00 [Information] User profile is available. Using '"/root/.aspnet/DataProtection-Keys"' as key repository; keys will not be encrypted at rest.
2017-06-10 14:08:40.435 +00:00 [Information] Request starting HTTP/1.1 GET http://spaidsrv.org:5005/.well-known/openid-configuration  
2017-06-10 14:08:40.454 +00:00 [Debug] CORS request made for path: "/.well-known/openid-configuration" from origin: "http://spaclient.org:5007"
2017-06-10 14:08:40.459 +00:00 [Debug] Client list checked and origin: "http://spaclient.org:5007" is allowed
2017-06-10 14:08:40.460 +00:00 [Debug] CorsPolicyService allowed origin: "http://spaclient.org:5007"
2017-06-10 14:08:40.515 +00:00 [Debug] Request path "/.well-known/openid-configuration" matched to endpoint type Discovery
2017-06-10 14:08:40.518 +00:00 [Debug] Mapping found for endpoint: Discovery, creating handler: "IdentityServer4.Endpoints.DiscoveryEndpoint"
2017-06-10 14:08:40.521 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.DiscoveryEndpoint" for "/.well-known/openid-configuration"
2017-06-10 14:08:40.523 +00:00 [Verbose] Processing discovery request.
2017-06-10 14:08:40.526 +00:00 [Debug] Start discovery request
2017-06-10 14:08:40.548 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.DiscoveryDocumentResult"
2017-06-10 14:08:40.647 +00:00 [Information] Request finished in 226.7862ms 200 application/json
2017-06-10 14:08:40.682 +00:00 [Information] Request starting HTTP/1.1 GET http://spaidsrv.org:5005/connect/checksession  
2017-06-10 14:08:40.730 +00:00 [Information] HttpContext.User merged via AutomaticAuthentication from authenticationScheme: "idsrv".
2017-06-10 14:08:40.731 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 14:08:40.734 +00:00 [Debug] Request path "/connect/checksession" matched to endpoint type CheckSession
2017-06-10 14:08:40.735 +00:00 [Debug] Mapping found for endpoint: CheckSession, creating handler: "IdentityServer4.Endpoints.CheckSessionEndpoint"
2017-06-10 14:08:40.736 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.CheckSessionEndpoint" for "/connect/checksession"
2017-06-10 14:08:40.738 +00:00 [Debug] Rendering check session result
2017-06-10 14:08:40.738 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.CheckSessionResult"
2017-06-10 14:08:40.754 +00:00 [Information] Request finished in 72.3811ms 200 text/html; charset=UTF-8
2017-06-10 14:16:49.616 +00:00 [Information] You are using the in-memory version of the persisted grant store. This will store consent decisions, authorization codes, refresh and reference tokens in memory only. If you are using any of those features in production, you want to switch to a different store implementation.
2017-06-10 14:16:49.700 +00:00 [Debug] Using built-in CookieAuthentication middleware with scheme: "idsrv"
2017-06-10 14:16:49.705 +00:00 [Debug] Adding CookieAuthentication middleware for external authentication with scheme: "idsrv.external"
2017-06-10 14:16:49.994 +00:00 [Information] User profile is available. Using '"/root/.aspnet/DataProtection-Keys"' as key repository; keys will not be encrypted at rest.
2017-06-10 14:17:31.894 +00:00 [Information] You are using the in-memory version of the persisted grant store. This will store consent decisions, authorization codes, refresh and reference tokens in memory only. If you are using any of those features in production, you want to switch to a different store implementation.
2017-06-10 14:17:31.981 +00:00 [Debug] Using built-in CookieAuthentication middleware with scheme: "idsrv"
2017-06-10 14:17:31.990 +00:00 [Debug] Adding CookieAuthentication middleware for external authentication with scheme: "idsrv.external"
2017-06-10 14:17:32.258 +00:00 [Information] User profile is available. Using '"/root/.aspnet/DataProtection-Keys"' as key repository; keys will not be encrypted at rest.
2017-06-10 14:18:41.886 +00:00 [Information] You are using the in-memory version of the persisted grant store. This will store consent decisions, authorization codes, refresh and reference tokens in memory only. If you are using any of those features in production, you want to switch to a different store implementation.
2017-06-10 14:18:41.975 +00:00 [Debug] Using built-in CookieAuthentication middleware with scheme: "idsrv"
2017-06-10 14:18:41.979 +00:00 [Debug] Adding CookieAuthentication middleware for external authentication with scheme: "idsrv.external"
2017-06-10 14:18:42.175 +00:00 [Information] User profile is available. Using '"/root/.aspnet/DataProtection-Keys"' as key repository; keys will not be encrypted at rest.
2017-06-10 14:30:34.937 +00:00 [Information] You are using the in-memory version of the persisted grant store. This will store consent decisions, authorization codes, refresh and reference tokens in memory only. If you are using any of those features in production, you want to switch to a different store implementation.
2017-06-10 14:30:35.037 +00:00 [Debug] Using built-in CookieAuthentication middleware with scheme: "idsrv"
2017-06-10 14:30:35.044 +00:00 [Debug] Adding CookieAuthentication middleware for external authentication with scheme: "idsrv.external"
2017-06-10 14:30:35.427 +00:00 [Information] User profile is available. Using '"/root/.aspnet/DataProtection-Keys"' as key repository; keys will not be encrypted at rest.
2017-06-10 14:31:25.635 +00:00 [Information] You are using the in-memory version of the persisted grant store. This will store consent decisions, authorization codes, refresh and reference tokens in memory only. If you are using any of those features in production, you want to switch to a different store implementation.
2017-06-10 14:31:25.701 +00:00 [Debug] Using built-in CookieAuthentication middleware with scheme: "idsrv"
2017-06-10 14:31:25.705 +00:00 [Debug] Adding CookieAuthentication middleware for external authentication with scheme: "idsrv.external"
2017-06-10 14:31:25.929 +00:00 [Information] User profile is available. Using '"/root/.aspnet/DataProtection-Keys"' as key repository; keys will not be encrypted at rest.
2017-06-10 14:50:15.721 +00:00 [Information] You are using the in-memory version of the persisted grant store. This will store consent decisions, authorization codes, refresh and reference tokens in memory only. If you are using any of those features in production, you want to switch to a different store implementation.
2017-06-10 14:50:15.796 +00:00 [Debug] Using built-in CookieAuthentication middleware with scheme: "idsrv"
2017-06-10 14:50:15.804 +00:00 [Debug] Adding CookieAuthentication middleware for external authentication with scheme: "idsrv.external"
2017-06-10 14:50:16.034 +00:00 [Information] User profile is available. Using '"/root/.aspnet/DataProtection-Keys"' as key repository; keys will not be encrypted at rest.
2017-06-10 14:55:55.766 +00:00 [Information] You are using the in-memory version of the persisted grant store. This will store consent decisions, authorization codes, refresh and reference tokens in memory only. If you are using any of those features in production, you want to switch to a different store implementation.
2017-06-10 14:55:55.836 +00:00 [Debug] Using built-in CookieAuthentication middleware with scheme: "idsrv"
2017-06-10 14:55:55.840 +00:00 [Debug] Adding CookieAuthentication middleware for external authentication with scheme: "idsrv.external"
2017-06-10 14:55:56.136 +00:00 [Information] User profile is available. Using '"/root/.aspnet/DataProtection-Keys"' as key repository; keys will not be encrypted at rest.
2017-06-10 14:56:50.202 +00:00 [Information] You are using the in-memory version of the persisted grant store. This will store consent decisions, authorization codes, refresh and reference tokens in memory only. If you are using any of those features in production, you want to switch to a different store implementation.
2017-06-10 14:56:50.250 +00:00 [Debug] Using built-in CookieAuthentication middleware with scheme: "idsrv"
2017-06-10 14:56:50.258 +00:00 [Debug] Adding CookieAuthentication middleware for external authentication with scheme: "idsrv.external"
2017-06-10 14:56:50.448 +00:00 [Information] User profile is available. Using '"/root/.aspnet/DataProtection-Keys"' as key repository; keys will not be encrypted at rest.
2017-06-10 14:58:23.037 +00:00 [Information] You are using the in-memory version of the persisted grant store. This will store consent decisions, authorization codes, refresh and reference tokens in memory only. If you are using any of those features in production, you want to switch to a different store implementation.
2017-06-10 14:58:23.077 +00:00 [Debug] Using built-in CookieAuthentication middleware with scheme: "idsrv"
2017-06-10 14:58:23.081 +00:00 [Debug] Adding CookieAuthentication middleware for external authentication with scheme: "idsrv.external"
2017-06-10 14:58:23.260 +00:00 [Information] User profile is available. Using '"/root/.aspnet/DataProtection-Keys"' as key repository; keys will not be encrypted at rest.
2017-06-10 15:00:39.362 +00:00 [Information] You are using the in-memory version of the persisted grant store. This will store consent decisions, authorization codes, refresh and reference tokens in memory only. If you are using any of those features in production, you want to switch to a different store implementation.
2017-06-10 15:00:39.409 +00:00 [Debug] Using built-in CookieAuthentication middleware with scheme: "idsrv"
2017-06-10 15:00:39.413 +00:00 [Debug] Adding CookieAuthentication middleware for external authentication with scheme: "idsrv.external"
2017-06-10 15:00:39.605 +00:00 [Information] User profile is available. Using '"/root/.aspnet/DataProtection-Keys"' as key repository; keys will not be encrypted at rest.
2017-06-10 15:01:48.311 +00:00 [Information] You are using the in-memory version of the persisted grant store. This will store consent decisions, authorization codes, refresh and reference tokens in memory only. If you are using any of those features in production, you want to switch to a different store implementation.
2017-06-10 15:01:48.370 +00:00 [Debug] Using built-in CookieAuthentication middleware with scheme: "idsrv"
2017-06-10 15:01:48.373 +00:00 [Debug] Adding CookieAuthentication middleware for external authentication with scheme: "idsrv.external"
2017-06-10 15:01:48.591 +00:00 [Information] User profile is available. Using '"/root/.aspnet/DataProtection-Keys"' as key repository; keys will not be encrypted at rest.
2017-06-10 15:04:55.544 +00:00 [Information] You are using the in-memory version of the persisted grant store. This will store consent decisions, authorization codes, refresh and reference tokens in memory only. If you are using any of those features in production, you want to switch to a different store implementation.
2017-06-10 15:04:55.587 +00:00 [Debug] Using built-in CookieAuthentication middleware with scheme: "idsrv"
2017-06-10 15:04:55.591 +00:00 [Debug] Adding CookieAuthentication middleware for external authentication with scheme: "idsrv.external"
2017-06-10 15:04:55.807 +00:00 [Information] User profile is available. Using '"/root/.aspnet/DataProtection-Keys"' as key repository; keys will not be encrypted at rest.
2017-06-10 15:06:51.977 +00:00 [Information] You are using the in-memory version of the persisted grant store. This will store consent decisions, authorization codes, refresh and reference tokens in memory only. If you are using any of those features in production, you want to switch to a different store implementation.
2017-06-10 15:06:52.049 +00:00 [Debug] Using built-in CookieAuthentication middleware with scheme: "idsrv"
2017-06-10 15:06:52.055 +00:00 [Debug] Adding CookieAuthentication middleware for external authentication with scheme: "idsrv.external"
2017-06-10 15:06:52.262 +00:00 [Information] User profile is available. Using '"/root/.aspnet/DataProtection-Keys"' as key repository; keys will not be encrypted at rest.
2017-06-10 15:11:08.041 +00:00 [Information] You are using the in-memory version of the persisted grant store. This will store consent decisions, authorization codes, refresh and reference tokens in memory only. If you are using any of those features in production, you want to switch to a different store implementation.
2017-06-10 15:11:08.104 +00:00 [Debug] Using built-in CookieAuthentication middleware with scheme: "idsrv"
2017-06-10 15:11:08.110 +00:00 [Debug] Adding CookieAuthentication middleware for external authentication with scheme: "idsrv.external"
2017-06-10 15:11:08.278 +00:00 [Information] User profile is available. Using '"/root/.aspnet/DataProtection-Keys"' as key repository; keys will not be encrypted at rest.
2017-06-10 15:16:46.679 +00:00 [Information] You are using the in-memory version of the persisted grant store. This will store consent decisions, authorization codes, refresh and reference tokens in memory only. If you are using any of those features in production, you want to switch to a different store implementation.
2017-06-10 15:16:46.753 +00:00 [Debug] Using built-in CookieAuthentication middleware with scheme: "idsrv"
2017-06-10 15:16:46.759 +00:00 [Debug] Adding CookieAuthentication middleware for external authentication with scheme: "idsrv.external"
2017-06-10 15:16:47.106 +00:00 [Information] User profile is available. Using '"/root/.aspnet/DataProtection-Keys"' as key repository; keys will not be encrypted at rest.
2017-06-10 15:17:54.318 +00:00 [Information] You are using the in-memory version of the persisted grant store. This will store consent decisions, authorization codes, refresh and reference tokens in memory only. If you are using any of those features in production, you want to switch to a different store implementation.
2017-06-10 15:17:54.373 +00:00 [Debug] Using built-in CookieAuthentication middleware with scheme: "idsrv"
2017-06-10 15:17:54.376 +00:00 [Debug] Adding CookieAuthentication middleware for external authentication with scheme: "idsrv.external"
2017-06-10 15:17:54.708 +00:00 [Information] User profile is available. Using '"/root/.aspnet/DataProtection-Keys"' as key repository; keys will not be encrypted at rest.
2017-06-10 15:19:33.521 +00:00 [Information] You are using the in-memory version of the persisted grant store. This will store consent decisions, authorization codes, refresh and reference tokens in memory only. If you are using any of those features in production, you want to switch to a different store implementation.
2017-06-10 15:19:33.621 +00:00 [Debug] Using built-in CookieAuthentication middleware with scheme: "idsrv"
2017-06-10 15:19:33.638 +00:00 [Debug] Adding CookieAuthentication middleware for external authentication with scheme: "idsrv.external"
2017-06-10 15:19:33.877 +00:00 [Information] User profile is available. Using '"/root/.aspnet/DataProtection-Keys"' as key repository; keys will not be encrypted at rest.
2017-06-10 15:29:37.034 +00:00 [Information] You are using the in-memory version of the persisted grant store. This will store consent decisions, authorization codes, refresh and reference tokens in memory only. If you are using any of those features in production, you want to switch to a different store implementation.
2017-06-10 15:29:37.106 +00:00 [Debug] Using built-in CookieAuthentication middleware with scheme: "idsrv"
2017-06-10 15:29:37.114 +00:00 [Debug] Adding CookieAuthentication middleware for external authentication with scheme: "idsrv.external"
2017-06-10 15:29:37.337 +00:00 [Information] User profile is available. Using '"/root/.aspnet/DataProtection-Keys"' as key repository; keys will not be encrypted at rest.
2017-06-10 15:30:31.513 +00:00 [Information] You are using the in-memory version of the persisted grant store. This will store consent decisions, authorization codes, refresh and reference tokens in memory only. If you are using any of those features in production, you want to switch to a different store implementation.
2017-06-10 15:30:31.569 +00:00 [Debug] Using built-in CookieAuthentication middleware with scheme: "idsrv"
2017-06-10 15:30:31.573 +00:00 [Debug] Adding CookieAuthentication middleware for external authentication with scheme: "idsrv.external"
2017-06-10 15:30:31.779 +00:00 [Information] User profile is available. Using '"/root/.aspnet/DataProtection-Keys"' as key repository; keys will not be encrypted at rest.
2017-06-10 15:38:54.113 +00:00 [Information] You are using the in-memory version of the persisted grant store. This will store consent decisions, authorization codes, refresh and reference tokens in memory only. If you are using any of those features in production, you want to switch to a different store implementation.
2017-06-10 15:38:54.181 +00:00 [Debug] Using built-in CookieAuthentication middleware with scheme: "idsrv"
2017-06-10 15:38:54.185 +00:00 [Debug] Adding CookieAuthentication middleware for external authentication with scheme: "idsrv.external"
2017-06-10 15:38:54.393 +00:00 [Information] User profile is available. Using '"/root/.aspnet/DataProtection-Keys"' as key repository; keys will not be encrypted at rest.
2017-06-10 15:40:03.660 +00:00 [Information] You are using the in-memory version of the persisted grant store. This will store consent decisions, authorization codes, refresh and reference tokens in memory only. If you are using any of those features in production, you want to switch to a different store implementation.
2017-06-10 15:40:03.736 +00:00 [Debug] Using built-in CookieAuthentication middleware with scheme: "idsrv"
2017-06-10 15:40:03.739 +00:00 [Debug] Adding CookieAuthentication middleware for external authentication with scheme: "idsrv.external"
2017-06-10 15:40:03.982 +00:00 [Information] User profile is available. Using '"/root/.aspnet/DataProtection-Keys"' as key repository; keys will not be encrypted at rest.
2017-06-10 15:41:03.124 +00:00 [Information] You are using the in-memory version of the persisted grant store. This will store consent decisions, authorization codes, refresh and reference tokens in memory only. If you are using any of those features in production, you want to switch to a different store implementation.
2017-06-10 15:41:03.204 +00:00 [Debug] Using built-in CookieAuthentication middleware with scheme: "idsrv"
2017-06-10 15:41:03.209 +00:00 [Debug] Adding CookieAuthentication middleware for external authentication with scheme: "idsrv.external"
2017-06-10 15:41:03.478 +00:00 [Information] User profile is available. Using '"/root/.aspnet/DataProtection-Keys"' as key repository; keys will not be encrypted at rest.
2017-06-10 15:42:34.437 +00:00 [Information] You are using the in-memory version of the persisted grant store. This will store consent decisions, authorization codes, refresh and reference tokens in memory only. If you are using any of those features in production, you want to switch to a different store implementation.
2017-06-10 15:42:34.507 +00:00 [Debug] Using built-in CookieAuthentication middleware with scheme: "idsrv"
2017-06-10 15:42:34.517 +00:00 [Debug] Adding CookieAuthentication middleware for external authentication with scheme: "idsrv.external"
2017-06-10 15:42:34.787 +00:00 [Information] User profile is available. Using '"/root/.aspnet/DataProtection-Keys"' as key repository; keys will not be encrypted at rest.
2017-06-10 15:47:49.987 +00:00 [Information] You are using the in-memory version of the persisted grant store. This will store consent decisions, authorization codes, refresh and reference tokens in memory only. If you are using any of those features in production, you want to switch to a different store implementation.
2017-06-10 15:47:50.063 +00:00 [Debug] Using built-in CookieAuthentication middleware with scheme: "idsrv"
2017-06-10 15:47:50.071 +00:00 [Debug] Adding CookieAuthentication middleware for external authentication with scheme: "idsrv.external"
2017-06-10 15:47:50.365 +00:00 [Information] User profile is available. Using '"/root/.aspnet/DataProtection-Keys"' as key repository; keys will not be encrypted at rest.
2017-06-10 15:48:49.170 +00:00 [Information] You are using the in-memory version of the persisted grant store. This will store consent decisions, authorization codes, refresh and reference tokens in memory only. If you are using any of those features in production, you want to switch to a different store implementation.
2017-06-10 15:48:49.257 +00:00 [Debug] Using built-in CookieAuthentication middleware with scheme: "idsrv"
2017-06-10 15:48:49.265 +00:00 [Debug] Adding CookieAuthentication middleware for external authentication with scheme: "idsrv.external"
2017-06-10 15:48:49.513 +00:00 [Information] User profile is available. Using '"/root/.aspnet/DataProtection-Keys"' as key repository; keys will not be encrypted at rest.
2017-06-10 15:51:23.788 +00:00 [Information] You are using the in-memory version of the persisted grant store. This will store consent decisions, authorization codes, refresh and reference tokens in memory only. If you are using any of those features in production, you want to switch to a different store implementation.
2017-06-10 15:51:23.877 +00:00 [Debug] Using built-in CookieAuthentication middleware with scheme: "idsrv"
2017-06-10 15:51:23.881 +00:00 [Debug] Adding CookieAuthentication middleware for external authentication with scheme: "idsrv.external"
2017-06-10 15:51:24.064 +00:00 [Information] User profile is available. Using '"/root/.aspnet/DataProtection-Keys"' as key repository; keys will not be encrypted at rest.
2017-06-10 15:57:26.259 +00:00 [Information] You are using the in-memory version of the persisted grant store. This will store consent decisions, authorization codes, refresh and reference tokens in memory only. If you are using any of those features in production, you want to switch to a different store implementation.
2017-06-10 15:57:26.325 +00:00 [Debug] Using built-in CookieAuthentication middleware with scheme: "idsrv"
2017-06-10 15:57:26.331 +00:00 [Debug] Adding CookieAuthentication middleware for external authentication with scheme: "idsrv.external"
2017-06-10 15:57:26.588 +00:00 [Information] User profile is available. Using '"/root/.aspnet/DataProtection-Keys"' as key repository; keys will not be encrypted at rest.
2017-06-10 15:57:59.503 +00:00 [Information] You are using the in-memory version of the persisted grant store. This will store consent decisions, authorization codes, refresh and reference tokens in memory only. If you are using any of those features in production, you want to switch to a different store implementation.
2017-06-10 15:57:59.579 +00:00 [Debug] Using built-in CookieAuthentication middleware with scheme: "idsrv"
2017-06-10 15:57:59.584 +00:00 [Debug] Adding CookieAuthentication middleware for external authentication with scheme: "idsrv.external"
2017-06-10 15:57:59.809 +00:00 [Information] User profile is available. Using '"/root/.aspnet/DataProtection-Keys"' as key repository; keys will not be encrypted at rest.
2017-06-10 15:59:01.930 +00:00 [Information] You are using the in-memory version of the persisted grant store. This will store consent decisions, authorization codes, refresh and reference tokens in memory only. If you are using any of those features in production, you want to switch to a different store implementation.
2017-06-10 15:59:01.998 +00:00 [Debug] Using built-in CookieAuthentication middleware with scheme: "idsrv"
2017-06-10 15:59:02.002 +00:00 [Debug] Adding CookieAuthentication middleware for external authentication with scheme: "idsrv.external"
2017-06-10 15:59:02.220 +00:00 [Information] User profile is available. Using '"/root/.aspnet/DataProtection-Keys"' as key repository; keys will not be encrypted at rest.
2017-06-10 16:00:17.752 +00:00 [Information] You are using the in-memory version of the persisted grant store. This will store consent decisions, authorization codes, refresh and reference tokens in memory only. If you are using any of those features in production, you want to switch to a different store implementation.
2017-06-10 16:00:17.881 +00:00 [Debug] Using built-in CookieAuthentication middleware with scheme: "idsrv"
2017-06-10 16:00:17.887 +00:00 [Debug] Adding CookieAuthentication middleware for external authentication with scheme: "idsrv.external"
2017-06-10 16:00:18.191 +00:00 [Information] User profile is available. Using '"/root/.aspnet/DataProtection-Keys"' as key repository; keys will not be encrypted at rest.
2017-06-10 16:03:00.644 +00:00 [Information] You are using the in-memory version of the persisted grant store. This will store consent decisions, authorization codes, refresh and reference tokens in memory only. If you are using any of those features in production, you want to switch to a different store implementation.
2017-06-10 16:03:00.748 +00:00 [Debug] Using built-in CookieAuthentication middleware with scheme: "idsrv"
2017-06-10 16:03:00.753 +00:00 [Debug] Adding CookieAuthentication middleware for external authentication with scheme: "idsrv.external"
2017-06-10 16:03:01.126 +00:00 [Information] User profile is available. Using '"/root/.aspnet/DataProtection-Keys"' as key repository; keys will not be encrypted at rest.
2017-06-10 16:03:35.104 +00:00 [Information] You are using the in-memory version of the persisted grant store. This will store consent decisions, authorization codes, refresh and reference tokens in memory only. If you are using any of those features in production, you want to switch to a different store implementation.
2017-06-10 16:03:35.187 +00:00 [Debug] Using built-in CookieAuthentication middleware with scheme: "idsrv"
2017-06-10 16:03:35.192 +00:00 [Debug] Adding CookieAuthentication middleware for external authentication with scheme: "idsrv.external"
2017-06-10 16:03:35.450 +00:00 [Information] User profile is available. Using '"/root/.aspnet/DataProtection-Keys"' as key repository; keys will not be encrypted at rest.
2017-06-10 16:05:02.211 +00:00 [Information] You are using the in-memory version of the persisted grant store. This will store consent decisions, authorization codes, refresh and reference tokens in memory only. If you are using any of those features in production, you want to switch to a different store implementation.
2017-06-10 16:05:02.265 +00:00 [Debug] Using built-in CookieAuthentication middleware with scheme: "idsrv"
2017-06-10 16:05:02.273 +00:00 [Debug] Adding CookieAuthentication middleware for external authentication with scheme: "idsrv.external"
2017-06-10 16:05:02.507 +00:00 [Information] User profile is available. Using '"/root/.aspnet/DataProtection-Keys"' as key repository; keys will not be encrypted at rest.
2017-06-10 16:06:37.044 +00:00 [Information] You are using the in-memory version of the persisted grant store. This will store consent decisions, authorization codes, refresh and reference tokens in memory only. If you are using any of those features in production, you want to switch to a different store implementation.
2017-06-10 16:06:37.100 +00:00 [Debug] Using built-in CookieAuthentication middleware with scheme: "idsrv"
2017-06-10 16:06:37.104 +00:00 [Debug] Adding CookieAuthentication middleware for external authentication with scheme: "idsrv.external"
2017-06-10 16:06:37.296 +00:00 [Information] User profile is available. Using '"/root/.aspnet/DataProtection-Keys"' as key repository; keys will not be encrypted at rest.
2017-06-10 16:08:56.690 +00:00 [Information] You are using the in-memory version of the persisted grant store. This will store consent decisions, authorization codes, refresh and reference tokens in memory only. If you are using any of those features in production, you want to switch to a different store implementation.
2017-06-10 16:08:56.787 +00:00 [Debug] Using built-in CookieAuthentication middleware with scheme: "idsrv"
2017-06-10 16:08:56.794 +00:00 [Debug] Adding CookieAuthentication middleware for external authentication with scheme: "idsrv.external"
2017-06-10 16:08:57.090 +00:00 [Information] User profile is available. Using '"/root/.aspnet/DataProtection-Keys"' as key repository; keys will not be encrypted at rest.
2017-06-10 16:09:37.382 +00:00 [Information] You are using the in-memory version of the persisted grant store. This will store consent decisions, authorization codes, refresh and reference tokens in memory only. If you are using any of those features in production, you want to switch to a different store implementation.
2017-06-10 16:09:37.453 +00:00 [Debug] Using built-in CookieAuthentication middleware with scheme: "idsrv"
2017-06-10 16:09:37.462 +00:00 [Debug] Adding CookieAuthentication middleware for external authentication with scheme: "idsrv.external"
2017-06-10 16:09:37.693 +00:00 [Information] User profile is available. Using '"/root/.aspnet/DataProtection-Keys"' as key repository; keys will not be encrypted at rest.
2017-06-10 16:11:58.248 +00:00 [Information] You are using the in-memory version of the persisted grant store. This will store consent decisions, authorization codes, refresh and reference tokens in memory only. If you are using any of those features in production, you want to switch to a different store implementation.
2017-06-10 16:11:58.320 +00:00 [Debug] Using built-in CookieAuthentication middleware with scheme: "idsrv"
2017-06-10 16:11:58.323 +00:00 [Debug] Adding CookieAuthentication middleware for external authentication with scheme: "idsrv.external"
2017-06-10 16:11:58.556 +00:00 [Information] User profile is available. Using '"/root/.aspnet/DataProtection-Keys"' as key repository; keys will not be encrypted at rest.
2017-06-10 16:12:34.024 +00:00 [Information] You are using the in-memory version of the persisted grant store. This will store consent decisions, authorization codes, refresh and reference tokens in memory only. If you are using any of those features in production, you want to switch to a different store implementation.
2017-06-10 16:12:34.093 +00:00 [Debug] Using built-in CookieAuthentication middleware with scheme: "idsrv"
2017-06-10 16:12:34.097 +00:00 [Debug] Adding CookieAuthentication middleware for external authentication with scheme: "idsrv.external"
2017-06-10 16:12:34.410 +00:00 [Information] User profile is available. Using '"/root/.aspnet/DataProtection-Keys"' as key repository; keys will not be encrypted at rest.
2017-06-10 16:13:31.215 +00:00 [Information] You are using the in-memory version of the persisted grant store. This will store consent decisions, authorization codes, refresh and reference tokens in memory only. If you are using any of those features in production, you want to switch to a different store implementation.
2017-06-10 16:13:31.336 +00:00 [Debug] Using built-in CookieAuthentication middleware with scheme: "idsrv"
2017-06-10 16:13:31.347 +00:00 [Debug] Adding CookieAuthentication middleware for external authentication with scheme: "idsrv.external"
2017-06-10 16:13:31.750 +00:00 [Information] User profile is available. Using '"/root/.aspnet/DataProtection-Keys"' as key repository; keys will not be encrypted at rest.
2017-06-10 16:13:34.290 +00:00 [Information] Request starting HTTP/1.1 GET http://spaidsrv.org:5005/.well-known/openid-configuration  
2017-06-10 16:13:34.307 +00:00 [Debug] CORS request made for path: "/.well-known/openid-configuration" from origin: "http://spaclient.org:5007"
2017-06-10 16:13:34.312 +00:00 [Debug] Client list checked and origin: "http://spaclient.org:5007" is allowed
2017-06-10 16:13:34.313 +00:00 [Debug] CorsPolicyService allowed origin: "http://spaclient.org:5007"
2017-06-10 16:13:34.364 +00:00 [Debug] Request path "/.well-known/openid-configuration" matched to endpoint type Discovery
2017-06-10 16:13:34.367 +00:00 [Debug] Mapping found for endpoint: Discovery, creating handler: "IdentityServer4.Endpoints.DiscoveryEndpoint"
2017-06-10 16:13:34.372 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.DiscoveryEndpoint" for "/.well-known/openid-configuration"
2017-06-10 16:13:34.375 +00:00 [Verbose] Processing discovery request.
2017-06-10 16:13:34.379 +00:00 [Debug] Start discovery request
2017-06-10 16:13:34.400 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.DiscoveryDocumentResult"
2017-06-10 16:13:34.509 +00:00 [Information] Request finished in 223.8169ms 200 application/json
2017-06-10 16:13:34.525 +00:00 [Information] Request starting HTTP/1.1 GET http://spaidsrv.org:5005/connect/authorize?client_id=http%3A%2F%2Fspaclient.org%3A5007&redirect_uri=http%3A%2F%2Fspaclient.org%3A5007%2Fcallback.html&response_type=id_token%20token&scope=openid%20profile%20productapi&state=3f493896bd314685ab572cb5146d3aa6&nonce=81775747feac47cb9c3dadc24f2eba30  
2017-06-10 16:13:34.572 +00:00 [Information] HttpContext.User merged via AutomaticAuthentication from authenticationScheme: "idsrv".
2017-06-10 16:13:34.573 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 16:13:34.585 +00:00 [Debug] Request path "/connect/authorize" matched to endpoint type Authorize
2017-06-10 16:13:34.586 +00:00 [Debug] Mapping found for endpoint: Authorize, creating handler: "IdentityServer4.Endpoints.AuthorizeEndpoint"
2017-06-10 16:13:34.596 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.AuthorizeEndpoint" for "/connect/authorize"
2017-06-10 16:13:34.606 +00:00 [Debug] Start authorize request
2017-06-10 16:13:34.645 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 16:13:34.656 +00:00 [Debug] User in authorize request: "2"
2017-06-10 16:13:34.661 +00:00 [Debug] Start authorize request protocol validation
2017-06-10 16:13:34.710 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 16:13:34.712 +00:00 [Debug] Calling into custom validator: "IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator"
2017-06-10 16:13:34.714 +00:00 [Verbose] Authorize request protocol validation successful
2017-06-10 16:13:34.738 +00:00 [Information] ValidatedAuthorizeRequest
"{
  \"ClientId\": \"http://spaclient.org:5007\",
  \"ClientName\": \"SPAClient\",
  \"RedirectUri\": \"http://spaclient.org:5007/callback.html\",
  \"AllowedRedirectUris\": [
    \"http://spaclient.org:5007/callback.html\"
  ],
  \"SubjectId\": \"2\",
  \"ResponseType\": \"id_token token\",
  \"ResponseMode\": \"fragment\",
  \"GrantType\": \"implicit\",
  \"RequestedScopes\": \"openid profile productapi\",
  \"State\": \"3f493896bd314685ab572cb5146d3aa6\",
  \"Nonce\": \"81775747feac47cb9c3dadc24f2eba30\",
  \"SessionId\": \"08cae3fa6327fe14b94b29ff5b58d7e3\",
  \"Raw\": {
    \"client_id\": \"http://spaclient.org:5007\",
    \"redirect_uri\": \"http://spaclient.org:5007/callback.html\",
    \"response_type\": \"id_token token\",
    \"scope\": \"openid profile productapi\",
    \"state\": \"3f493896bd314685ab572cb5146d3aa6\",
    \"nonce\": \"81775747feac47cb9c3dadc24f2eba30\"
  }
}"
2017-06-10 16:13:34.743 +00:00 [Verbose] ProcessInteractionAsync
2017-06-10 16:13:34.775 +00:00 [Debug] "user_consent" grant with value: "http://spaclient.org:5007|2" not found in store.
2017-06-10 16:13:34.777 +00:00 [Information] Showing consent: User has not yet consented
2017-06-10 16:13:34.779 +00:00 [Verbose] End authorize request. result type: "IdentityServer4.Endpoints.Results.ConsentPageResult"
2017-06-10 16:13:34.779 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.ConsentPageResult"
2017-06-10 16:13:34.801 +00:00 [Information] Request finished in 275.3619ms 302 
2017-06-10 16:13:34.808 +00:00 [Information] Request starting HTTP/1.1 GET http://spaidsrv.org:5005/consent?returnUrl=%2Fconnect%2Fauthorize%2Fconsent%3Fclient_id%3Dhttp%253A%252F%252Fspaclient.org%253A5007%26redirect_uri%3Dhttp%253A%252F%252Fspaclient.org%253A5007%252Fcallback.html%26response_type%3Did_token%2520token%26scope%3Dopenid%2520profile%2520productapi%26state%3D3f493896bd314685ab572cb5146d3aa6%26nonce%3D81775747feac47cb9c3dadc24f2eba30  
2017-06-10 16:13:34.809 +00:00 [Information] HttpContext.User merged via AutomaticAuthentication from authenticationScheme: "idsrv".
2017-06-10 16:13:34.809 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 16:13:34.810 +00:00 [Verbose] No endpoint entry found for request path: "/consent"
2017-06-10 16:13:35.102 +00:00 [Information] Executing action method "IdentityServer4.Quickstart.UI.ConsentController.Index (SpaIdSrv)" with arguments (["/connect/authorize/consent?client_id=http%3A%2F%2Fspaclient.org%3A5007&redirect_uri=http%3A%2F%2Fspaclient.org%3A5007%2Fcallback.html&response_type=id_token%20token&scope=openid%20profile%20productapi&state=3f493896bd314685ab572cb5146d3aa6&nonce=81775747feac47cb9c3dadc24f2eba30"]) - ModelState is Valid
2017-06-10 16:13:35.115 +00:00 [Verbose] returnUrl is valid
2017-06-10 16:13:35.118 +00:00 [Verbose] returnUrl is valid
2017-06-10 16:13:35.121 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 16:13:35.121 +00:00 [Debug] Start authorize request protocol validation
2017-06-10 16:13:35.123 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 16:13:35.123 +00:00 [Debug] Calling into custom validator: "IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator"
2017-06-10 16:13:35.124 +00:00 [Verbose] Authorize request protocol validation successful
2017-06-10 16:13:35.124 +00:00 [Verbose] AuthorizationRequest being returned
2017-06-10 16:13:35.127 +00:00 [Verbose] AuthorizationRequest being returned
2017-06-10 16:13:40.390 +00:00 [Information] Executing ViewResult, running view at path "/Views/Consent/Index.cshtml".
2017-06-10 16:13:40.822 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 16:13:40.857 +00:00 [Information] Request starting HTTP/1.1 GET http://spaidsrv.org:5005/icon.png  
2017-06-10 16:13:40.861 +00:00 [Information] HttpContext.User merged via AutomaticAuthentication from authenticationScheme: "idsrv".
2017-06-10 16:13:40.862 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 16:13:40.864 +00:00 [Verbose] No endpoint entry found for request path: "/icon.png"
2017-06-10 16:13:40.873 +00:00 [Information] Executed action "IdentityServer4.Quickstart.UI.ConsentController.Index (SpaIdSrv)" in 5849.9456ms
2017-06-10 16:13:40.876 +00:00 [Information] Sending file. Request path: '"/icon.png"'. Physical path: '"/app/wwwroot/icon.png"'
2017-06-10 16:13:40.887 +00:00 [Information] Request finished in 6078.947ms 200 text/html; charset=utf-8
2017-06-10 16:13:40.950 +00:00 [Information] Request finished in 92.6019ms 200 image/png
2017-06-10 16:13:41.118 +00:00 [Information] Request starting HTTP/1.1 GET http://spaidsrv.org:5005/lib/bootstrap/fonts/glyphicons-halflings-regular.woff2  
2017-06-10 16:13:41.119 +00:00 [Information] HttpContext.User merged via AutomaticAuthentication from authenticationScheme: "idsrv".
2017-06-10 16:13:41.120 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 16:13:41.121 +00:00 [Verbose] No endpoint entry found for request path: "/lib/bootstrap/fonts/glyphicons-halflings-regular.woff2"
2017-06-10 16:13:41.129 +00:00 [Information] Sending file. Request path: '"/lib/bootstrap/fonts/glyphicons-halflings-regular.woff2"'. Physical path: '"/app/wwwroot/lib/bootstrap/fonts/glyphicons-halflings-regular.woff2"'
2017-06-10 16:13:41.271 +00:00 [Information] Request finished in 152.9007ms 200 application/font-woff2
2017-06-10 16:13:43.681 +00:00 [Information] Request starting HTTP/1.1 POST http://spaidsrv.org:5005/consent application/x-www-form-urlencoded 675
2017-06-10 16:13:43.683 +00:00 [Information] HttpContext.User merged via AutomaticAuthentication from authenticationScheme: "idsrv".
2017-06-10 16:13:43.684 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 16:13:43.684 +00:00 [Verbose] No endpoint entry found for request path: "/consent"
2017-06-10 16:13:43.725 +00:00 [Information] Executing action method "IdentityServer4.Quickstart.UI.ConsentController.Index (SpaIdSrv)" with arguments (["IdentityServer4.Quickstart.UI.ConsentInputModel"]) - ModelState is Valid
2017-06-10 16:13:43.733 +00:00 [Verbose] returnUrl is valid
2017-06-10 16:13:43.733 +00:00 [Verbose] returnUrl is valid
2017-06-10 16:13:43.733 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 16:13:43.733 +00:00 [Debug] Start authorize request protocol validation
2017-06-10 16:13:43.736 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 16:13:43.736 +00:00 [Debug] Calling into custom validator: "IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator"
2017-06-10 16:13:43.736 +00:00 [Verbose] Authorize request protocol validation successful
2017-06-10 16:13:43.736 +00:00 [Verbose] AuthorizationRequest being returned
2017-06-10 16:13:43.737 +00:00 [Verbose] AuthorizationRequest being returned
2017-06-10 16:13:43.742 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 16:13:43.757 +00:00 [Verbose] Protecting message: "{\"Created\":636327080237488500,\"Data\":{\"Granted\":true,\"ScopesConsented\":[\"openid\",\"profile\",\"productapi\"]}}"
2017-06-10 16:13:43.763 +00:00 [Information] Executing RedirectResult, redirecting to "/connect/authorize/consent?client_id=http%3A%2F%2Fspaclient.org%3A5007&redirect_uri=http%3A%2F%2Fspaclient.org%3A5007%2Fcallback.html&response_type=id_token%20token&scope=openid%20profile%20productapi&state=3f493896bd314685ab572cb5146d3aa6&nonce=81775747feac47cb9c3dadc24f2eba30".
2017-06-10 16:13:43.763 +00:00 [Information] Executed action "IdentityServer4.Quickstart.UI.ConsentController.Index (SpaIdSrv)" in 72.3702ms
2017-06-10 16:13:43.763 +00:00 [Information] Request finished in 81.9879ms 302 
2017-06-10 16:13:43.774 +00:00 [Information] Request starting HTTP/1.1 GET http://spaidsrv.org:5005/connect/authorize/consent?client_id=http%3A%2F%2Fspaclient.org%3A5007&redirect_uri=http%3A%2F%2Fspaclient.org%3A5007%2Fcallback.html&response_type=id_token%20token&scope=openid%20profile%20productapi&state=3f493896bd314685ab572cb5146d3aa6&nonce=81775747feac47cb9c3dadc24f2eba30  
2017-06-10 16:13:43.775 +00:00 [Information] HttpContext.User merged via AutomaticAuthentication from authenticationScheme: "idsrv".
2017-06-10 16:13:43.775 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 16:13:43.775 +00:00 [Debug] Request path "/connect/authorize/consent" matched to endpoint type Authorize
2017-06-10 16:13:43.775 +00:00 [Debug] Mapping found for endpoint: Authorize, creating handler: "IdentityServer4.Endpoints.AuthorizeEndpoint"
2017-06-10 16:13:43.776 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.AuthorizeEndpoint" for "/connect/authorize/consent"
2017-06-10 16:13:43.794 +00:00 [Debug] Start authorize request (after consent)
2017-06-10 16:13:43.794 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 16:13:43.804 +00:00 [Debug] User in authorize request: "2"
2017-06-10 16:13:43.805 +00:00 [Debug] Start authorize request protocol validation
2017-06-10 16:13:43.807 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 16:13:43.808 +00:00 [Debug] Calling into custom validator: "IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator"
2017-06-10 16:13:43.809 +00:00 [Verbose] Authorize request protocol validation successful
2017-06-10 16:13:43.811 +00:00 [Information] ValidatedAuthorizeRequest
"{
  \"ClientId\": \"http://spaclient.org:5007\",
  \"ClientName\": \"SPAClient\",
  \"RedirectUri\": \"http://spaclient.org:5007/callback.html\",
  \"AllowedRedirectUris\": [
    \"http://spaclient.org:5007/callback.html\"
  ],
  \"SubjectId\": \"2\",
  \"ResponseType\": \"id_token token\",
  \"ResponseMode\": \"fragment\",
  \"GrantType\": \"implicit\",
  \"RequestedScopes\": \"openid profile productapi\",
  \"State\": \"3f493896bd314685ab572cb5146d3aa6\",
  \"Nonce\": \"81775747feac47cb9c3dadc24f2eba30\",
  \"SessionId\": \"08cae3fa6327fe14b94b29ff5b58d7e3\",
  \"Raw\": {
    \"client_id\": \"http://spaclient.org:5007\",
    \"redirect_uri\": \"http://spaclient.org:5007/callback.html\",
    \"response_type\": \"id_token token\",
    \"scope\": \"openid profile productapi\",
    \"state\": \"3f493896bd314685ab572cb5146d3aa6\",
    \"nonce\": \"81775747feac47cb9c3dadc24f2eba30\"
  }
}"
2017-06-10 16:13:43.816 +00:00 [Verbose] ProcessInteractionAsync
2017-06-10 16:13:43.816 +00:00 [Debug] "user_consent" grant with value: "http://spaclient.org:5007|2" not found in store.
2017-06-10 16:13:43.816 +00:00 [Verbose] Consent was shown to user
2017-06-10 16:13:43.824 +00:00 [Information] User consented to scopes: ["openid", "profile", "productapi"]
2017-06-10 16:13:43.839 +00:00 [Debug] Creating Implicit Flow response.
2017-06-10 16:13:43.844 +00:00 [Verbose] Creating access token
2017-06-10 16:13:43.850 +00:00 [Debug] Getting claims for access token for client: "http://spaclient.org:5007"
2017-06-10 16:13:43.851 +00:00 [Debug] Getting claims for access token for subject: "2"
2017-06-10 16:13:43.855 +00:00 [Debug] Get profile called for subject "2" from client "SPAClient" with claim types [] via "ClaimsProviderAccessToken"
2017-06-10 16:13:43.861 +00:00 [Verbose] Creating JWT access token
2017-06-10 16:13:44.122 +00:00 [Verbose] Creating identity token
2017-06-10 16:13:44.126 +00:00 [Debug] Getting claims for identity token for subject: "2" and client: "http://spaclient.org:5007"
2017-06-10 16:13:44.126 +00:00 [Debug] In addition to an id_token, an access_token was requested. No claims other than sub are included in the id_token. To obtain more user claims, either use the user info endpoint or set AlwaysIncludeUserClaimsInIdToken on the client configuration.
2017-06-10 16:13:44.128 +00:00 [Verbose] Creating JWT identity token
2017-06-10 16:13:44.134 +00:00 [Verbose] Identity token issued for "http://spaclient.org:5007 (SPAClient)" / "2": "eyJhbGciOiJSUzI1NiIsImtpZCI6ImEwM2EwZmZjMGRjZTE3ZmVmM2FkNTAwZWRhZGY5ODdhIiwidHlwIjoiSldUIn0.eyJuYmYiOjE0OTcxMTEyMjQsImV4cCI6MTQ5NzExMTUyNCwiaXNzIjoiaHR0cDovL3NwYWlkc3J2Lm9yZzo1MDA1IiwiYXVkIjoiaHR0cDovL3NwYWNsaWVudC5vcmc6NTAwNyIsIm5vbmNlIjoiODE3NzU3NDdmZWFjNDdjYjljM2RhZGMyNGYyZWJhMzAiLCJpYXQiOjE0OTcxMTEyMjQsImF0X2hhc2giOiJGbXVCYmh1TFhoUWdhQk1vb2pVanNBIiwic2lkIjoiMDhjYWUzZmE2MzI3ZmUxNGI5NGIyOWZmNWI1OGQ3ZTMiLCJzdWIiOiIyIiwiYXV0aF90aW1lIjoxNDk3MTAzNDE3LCJpZHAiOiJsb2NhbCIsImFtciI6WyJwd2QiXX0.GmMyVz-tj-3woSG4lsXI8Vrh6rEdSeREluEE0tesAaFvwQdVoJfKPC0fw2NMC_G0VwXIwxRP_HvFLaroJ9qB1HFAqP2Pb9U5s45tvOWMZqrR9EHinIXnh3fEOc3bBhxYWW469vvper-3mRIquQRRv3B4ZBe09tFms3hvEtMRyJBQQSGUsdZFMJ3wIyzd5Vt0BO2g10B406OBLNLHI3i5Ej9m5iQh3FPiX_3K3ZB0HFe1thyPx_TXo2h3Qsf_kGZ3hcPaM4ukyxBdFbmgW3za7lWA5Xdj7M0nXfM3oRwwDOKvJ2Twl_VB6hyGlmiTXbz0eghzBzgdcjdNVBtkdOnEbA"
2017-06-10 16:13:44.135 +00:00 [Verbose] Access token issued for "http://spaclient.org:5007 (SPAClient)" / "2": "eyJhbGciOiJSUzI1NiIsImtpZCI6ImEwM2EwZmZjMGRjZTE3ZmVmM2FkNTAwZWRhZGY5ODdhIiwidHlwIjoiSldUIn0.eyJuYmYiOjE0OTcxMTEyMjMsImV4cCI6MTQ5NzExNDgyMywiaXNzIjoiaHR0cDovL3NwYWlkc3J2Lm9yZzo1MDA1IiwiYXVkIjpbImh0dHA6Ly9zcGFpZHNydi5vcmc6NTAwNS9yZXNvdXJjZXMiLCJwcm9kdWN0YXBpIl0sImNsaWVudF9pZCI6Imh0dHA6Ly9zcGFjbGllbnQub3JnOjUwMDciLCJzdWIiOiIyIiwiYXV0aF90aW1lIjoxNDk3MTAzNDE3LCJpZHAiOiJsb2NhbCIsInNjb3BlIjpbIm9wZW5pZCIsInByb2ZpbGUiLCJwcm9kdWN0YXBpIl0sImFtciI6WyJwd2QiXX0.AZiWUdWSu41vB8kXs3eNlAawt5xGPiF_EVn3HBD1zl4dNnRm9Cd4BHTRsb-eA9A4VD056ORYuAmcig5ruhqLtkrb1jmemgNId8EAUioUO-rRjOWUMobUiEBD-_Po7glgOFtqtj856xOBl4dhokonPZHkfoCaMyHJt5S2JmahQPAKlzkumHLioz6t8tJEAksizPLEDdjTmayh05D2VLJwzQc87H06Gn3LY8JQnEx6H7RYnUHm-Z0q2i5Hd1df3agQn57-BVxpzClac73R_HYnK6GKUCNL5CFS4u7f6TOIbWclz27YiuzQ16Inr8Qo5MMeSLvpoDoVWT2uUhG5qYmFjw"
2017-06-10 16:13:44.150 +00:00 [Information] Authorize endpoint response
"{
  \"SubjectId\": \"2\",
  \"ClientId\": \"http://spaclient.org:5007\",
  \"RedirectUri\": \"http://spaclient.org:5007/callback.html\",
  \"State\": \"3f493896bd314685ab572cb5146d3aa6\",
  \"Scope\": \"openid profile productapi\"
}"
2017-06-10 16:13:44.150 +00:00 [Verbose] End Authorize Request. Result type: "IdentityServer4.Endpoints.Results.AuthorizeResult"
2017-06-10 16:13:44.152 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.AuthorizeResult"
2017-06-10 16:13:44.166 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 16:13:44.175 +00:00 [Information] Request finished in 401.02ms 302 
2017-06-10 16:13:44.488 +00:00 [Information] Request starting HTTP/1.1 GET http://spaidsrv.org:5005/.well-known/openid-configuration  
2017-06-10 16:13:44.488 +00:00 [Debug] CORS request made for path: "/.well-known/openid-configuration" from origin: "http://spaclient.org:5007"
2017-06-10 16:13:44.489 +00:00 [Debug] Client list checked and origin: "http://spaclient.org:5007" is allowed
2017-06-10 16:13:44.489 +00:00 [Debug] CorsPolicyService allowed origin: "http://spaclient.org:5007"
2017-06-10 16:13:44.490 +00:00 [Debug] Request path "/.well-known/openid-configuration" matched to endpoint type Discovery
2017-06-10 16:13:44.491 +00:00 [Debug] Mapping found for endpoint: Discovery, creating handler: "IdentityServer4.Endpoints.DiscoveryEndpoint"
2017-06-10 16:13:44.497 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.DiscoveryEndpoint" for "/.well-known/openid-configuration"
2017-06-10 16:13:44.498 +00:00 [Verbose] Processing discovery request.
2017-06-10 16:13:44.498 +00:00 [Debug] Start discovery request
2017-06-10 16:13:44.501 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.DiscoveryDocumentResult"
2017-06-10 16:13:44.504 +00:00 [Information] Request finished in 15.802ms 200 application/json
2017-06-10 16:13:44.556 +00:00 [Information] Request starting HTTP/1.1 GET http://spaidsrv.org:5005/.well-known/openid-configuration/jwks  
2017-06-10 16:13:44.558 +00:00 [Debug] CORS request made for path: "/.well-known/openid-configuration/jwks" from origin: "http://spaclient.org:5007"
2017-06-10 16:13:44.558 +00:00 [Debug] Client list checked and origin: "http://spaclient.org:5007" is allowed
2017-06-10 16:13:44.558 +00:00 [Debug] CorsPolicyService allowed origin: "http://spaclient.org:5007"
2017-06-10 16:13:44.559 +00:00 [Debug] Request path "/.well-known/openid-configuration/jwks" matched to endpoint type Discovery
2017-06-10 16:13:44.559 +00:00 [Debug] Mapping found for endpoint: Discovery, creating handler: "IdentityServer4.Endpoints.DiscoveryEndpoint"
2017-06-10 16:13:44.559 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.DiscoveryEndpoint" for "/.well-known/openid-configuration/jwks"
2017-06-10 16:13:44.559 +00:00 [Verbose] Processing discovery request.
2017-06-10 16:13:44.563 +00:00 [Debug] Start key discovery request
2017-06-10 16:13:44.580 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.JsonWebKeysResult"
2017-06-10 16:13:44.592 +00:00 [Information] Request finished in 38.7092ms 200 application/json
2017-06-10 16:13:44.615 +00:00 [Information] Request starting HTTP/1.1 OPTIONS http://spaidsrv.org:5005/connect/userinfo  
2017-06-10 16:13:44.615 +00:00 [Debug] CORS request made for path: "/connect/userinfo" from origin: "http://spaclient.org:5007"
2017-06-10 16:13:44.615 +00:00 [Debug] Client list checked and origin: "http://spaclient.org:5007" is allowed
2017-06-10 16:13:44.615 +00:00 [Debug] CorsPolicyService allowed origin: "http://spaclient.org:5007"
2017-06-10 16:13:44.619 +00:00 [Information] Request finished in 4.0857ms 204 
2017-06-10 16:13:44.623 +00:00 [Information] Request starting HTTP/1.1 GET http://spaidsrv.org:5005/connect/userinfo  
2017-06-10 16:13:44.623 +00:00 [Debug] CORS request made for path: "/connect/userinfo" from origin: "http://spaclient.org:5007"
2017-06-10 16:13:44.623 +00:00 [Debug] Client list checked and origin: "http://spaclient.org:5007" is allowed
2017-06-10 16:13:44.623 +00:00 [Debug] CorsPolicyService allowed origin: "http://spaclient.org:5007"
2017-06-10 16:13:44.624 +00:00 [Debug] Request path "/connect/userinfo" matched to endpoint type UserInfo
2017-06-10 16:13:44.624 +00:00 [Debug] Mapping found for endpoint: UserInfo, creating handler: "IdentityServer4.Endpoints.UserInfoEndpoint"
2017-06-10 16:13:44.626 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.UserInfoEndpoint" for "/connect/userinfo"
2017-06-10 16:13:44.641 +00:00 [Debug] Start userinfo request
2017-06-10 16:13:44.646 +00:00 [Information] ValidateAsync: Locating bearer token
2017-06-10 16:13:44.648 +00:00 [Verbose] Authorization header value found
2017-06-10 16:13:44.648 +00:00 [Verbose] Authorization scheme is bearer
2017-06-10 16:13:44.651 +00:00 [Debug] Bearer token found in header
2017-06-10 16:13:44.651 +00:00 [Debug] Token found: "AuthorizationHeader"
2017-06-10 16:13:44.666 +00:00 [Verbose] Start access token validation
2017-06-10 16:13:44.740 +00:00 [Debug] Token validation success
"{
  \"ValidateLifetime\": true,
  \"AccessTokenType\": \"Jwt\",
  \"ExpectedScope\": \"openid\",
  \"Claims\": {
    \"nbf\": 1497111223,
    \"exp\": 1497114823,
    \"iss\": \"http://spaidsrv.org:5005\",
    \"aud\": [
      \"http://spaidsrv.org:5005/resources\",
      \"productapi\"
    ],
    \"client_id\": \"http://spaclient.org:5007\",
    \"sub\": \"2\",
    \"auth_time\": 1497103417,
    \"idp\": \"local\",
    \"scope\": [
      \"openid\",
      \"profile\",
      \"productapi\"
    ],
    \"amr\": \"pwd\"
  }
}"
2017-06-10 16:13:44.754 +00:00 [Verbose] Creating userinfo response
2017-06-10 16:13:44.760 +00:00 [Debug] Scopes in access token: "openid profile productapi"
2017-06-10 16:13:44.766 +00:00 [Debug] Requested claim types: "sub name family_name given_name middle_name nickname preferred_username profile picture website gender birthdate zoneinfo locale updated_at"
2017-06-10 16:13:44.767 +00:00 [Debug] Get profile called for subject "2" from client "SPAClient" with claim types ["sub", "name", "family_name", "given_name", "middle_name", "nickname", "preferred_username", "profile", "picture", "website", "gender", "birthdate", "zoneinfo", "locale", "updated_at"] via "UserInfoEndpoint"
2017-06-10 16:13:44.771 +00:00 [Information] Profile service returned to the following claim types: ""
2017-06-10 16:13:44.771 +00:00 [Debug] End userinfo request
2017-06-10 16:13:44.772 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.UserInfoResult"
2017-06-10 16:13:44.777 +00:00 [Information] Request finished in 153.7481ms 200 application/json
2017-06-10 16:13:44.811 +00:00 [Information] Request starting HTTP/1.1 GET http://spaidsrv.org:5005/connect/checksession  
2017-06-10 16:13:44.812 +00:00 [Information] HttpContext.User merged via AutomaticAuthentication from authenticationScheme: "idsrv".
2017-06-10 16:13:44.812 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 16:13:44.812 +00:00 [Debug] Request path "/connect/checksession" matched to endpoint type CheckSession
2017-06-10 16:13:44.812 +00:00 [Debug] Mapping found for endpoint: CheckSession, creating handler: "IdentityServer4.Endpoints.CheckSessionEndpoint"
2017-06-10 16:13:44.813 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.CheckSessionEndpoint" for "/connect/checksession"
2017-06-10 16:13:44.817 +00:00 [Debug] Rendering check session result
2017-06-10 16:13:44.818 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.CheckSessionResult"
2017-06-10 16:13:44.841 +00:00 [Information] Request finished in 30.8815ms 200 text/html; charset=UTF-8
2017-06-10 16:13:45.165 +00:00 [Information] Request starting HTTP/1.1 GET http://spaidsrv.org:5005/.well-known/openid-configuration  
2017-06-10 16:13:45.165 +00:00 [Debug] CORS request made for path: "/.well-known/openid-configuration" from origin: "http://spaclient.org:5007"
2017-06-10 16:13:45.166 +00:00 [Debug] Client list checked and origin: "http://spaclient.org:5007" is allowed
2017-06-10 16:13:45.166 +00:00 [Debug] CorsPolicyService allowed origin: "http://spaclient.org:5007"
2017-06-10 16:13:45.166 +00:00 [Debug] Request path "/.well-known/openid-configuration" matched to endpoint type Discovery
2017-06-10 16:13:45.167 +00:00 [Debug] Mapping found for endpoint: Discovery, creating handler: "IdentityServer4.Endpoints.DiscoveryEndpoint"
2017-06-10 16:13:45.167 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.DiscoveryEndpoint" for "/.well-known/openid-configuration"
2017-06-10 16:13:45.167 +00:00 [Verbose] Processing discovery request.
2017-06-10 16:13:45.167 +00:00 [Debug] Start discovery request
2017-06-10 16:13:45.167 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.DiscoveryDocumentResult"
2017-06-10 16:13:45.168 +00:00 [Information] Request finished in 2.836ms 200 application/json
2017-06-10 16:13:45.201 +00:00 [Information] Request starting HTTP/1.1 GET http://spaidsrv.org:5005/connect/checksession  
2017-06-10 16:13:45.202 +00:00 [Information] HttpContext.User merged via AutomaticAuthentication from authenticationScheme: "idsrv".
2017-06-10 16:13:45.202 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 16:13:45.202 +00:00 [Debug] Request path "/connect/checksession" matched to endpoint type CheckSession
2017-06-10 16:13:45.202 +00:00 [Debug] Mapping found for endpoint: CheckSession, creating handler: "IdentityServer4.Endpoints.CheckSessionEndpoint"
2017-06-10 16:13:45.203 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.CheckSessionEndpoint" for "/connect/checksession"
2017-06-10 16:13:45.203 +00:00 [Debug] Rendering check session result
2017-06-10 16:13:45.203 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.CheckSessionResult"
2017-06-10 16:13:45.204 +00:00 [Information] Request finished in 3.104ms 200 text/html; charset=UTF-8
2017-06-10 16:13:47.194 +00:00 [Information] Request starting HTTP/1.1 GET http://spaidsrv.org:5005/.well-known/openid-configuration  
2017-06-10 16:13:47.194 +00:00 [Debug] Request path "/.well-known/openid-configuration" matched to endpoint type Discovery
2017-06-10 16:13:47.195 +00:00 [Debug] Mapping found for endpoint: Discovery, creating handler: "IdentityServer4.Endpoints.DiscoveryEndpoint"
2017-06-10 16:13:47.195 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.DiscoveryEndpoint" for "/.well-known/openid-configuration"
2017-06-10 16:13:47.195 +00:00 [Verbose] Processing discovery request.
2017-06-10 16:13:47.195 +00:00 [Debug] Start discovery request
2017-06-10 16:13:47.195 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.DiscoveryDocumentResult"
2017-06-10 16:13:47.196 +00:00 [Information] Request finished in 2.1ms 200 application/json
2017-06-10 16:13:47.413 +00:00 [Information] Request starting HTTP/1.1 GET http://spaidsrv.org:5005/.well-known/openid-configuration/jwks  
2017-06-10 16:13:47.414 +00:00 [Debug] Request path "/.well-known/openid-configuration/jwks" matched to endpoint type Discovery
2017-06-10 16:13:47.414 +00:00 [Debug] Mapping found for endpoint: Discovery, creating handler: "IdentityServer4.Endpoints.DiscoveryEndpoint"
2017-06-10 16:13:47.414 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.DiscoveryEndpoint" for "/.well-known/openid-configuration/jwks"
2017-06-10 16:13:47.414 +00:00 [Verbose] Processing discovery request.
2017-06-10 16:13:47.414 +00:00 [Debug] Start key discovery request
2017-06-10 16:13:47.415 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.JsonWebKeysResult"
2017-06-10 16:13:47.415 +00:00 [Information] Request finished in 1.4396ms 200 application/json
2017-06-10 16:13:49.219 +00:00 [Information] Request starting HTTP/1.1 GET http://spaidsrv.org:5005/connect/endsession?id_token_hint=eyJhbGciOiJSUzI1NiIsImtpZCI6ImEwM2EwZmZjMGRjZTE3ZmVmM2FkNTAwZWRhZGY5ODdhIiwidHlwIjoiSldUIn0.eyJuYmYiOjE0OTcxMTEyMjQsImV4cCI6MTQ5NzExMTUyNCwiaXNzIjoiaHR0cDovL3NwYWlkc3J2Lm9yZzo1MDA1IiwiYXVkIjoiaHR0cDovL3NwYWNsaWVudC5vcmc6NTAwNyIsIm5vbmNlIjoiODE3NzU3NDdmZWFjNDdjYjljM2RhZGMyNGYyZWJhMzAiLCJpYXQiOjE0OTcxMTEyMjQsImF0X2hhc2giOiJGbXVCYmh1TFhoUWdhQk1vb2pVanNBIiwic2lkIjoiMDhjYWUzZmE2MzI3ZmUxNGI5NGIyOWZmNWI1OGQ3ZTMiLCJzdWIiOiIyIiwiYXV0aF90aW1lIjoxNDk3MTAzNDE3LCJpZHAiOiJsb2NhbCIsImFtciI6WyJwd2QiXX0.GmMyVz-tj-3woSG4lsXI8Vrh6rEdSeREluEE0tesAaFvwQdVoJfKPC0fw2NMC_G0VwXIwxRP_HvFLaroJ9qB1HFAqP2Pb9U5s45tvOWMZqrR9EHinIXnh3fEOc3bBhxYWW469vvper-3mRIquQRRv3B4ZBe09tFms3hvEtMRyJBQQSGUsdZFMJ3wIyzd5Vt0BO2g10B406OBLNLHI3i5Ej9m5iQh3FPiX_3K3ZB0HFe1thyPx_TXo2h3Qsf_kGZ3hcPaM4ukyxBdFbmgW3za7lWA5Xdj7M0nXfM3oRwwDOKvJ2Twl_VB6hyGlmiTXbz0eghzBzgdcjdNVBtkdOnEbA&post_logout_redirect_uri=http%3A%2F%2Fspaclient.org%3A5007%2Findex.html  
2017-06-10 16:13:49.220 +00:00 [Information] HttpContext.User merged via AutomaticAuthentication from authenticationScheme: "idsrv".
2017-06-10 16:13:49.220 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 16:13:49.220 +00:00 [Debug] Request path "/connect/endsession" matched to endpoint type EndSession
2017-06-10 16:13:49.220 +00:00 [Debug] Mapping found for endpoint: EndSession, creating handler: "IdentityServer4.Endpoints.EndSessionEndpoint"
2017-06-10 16:13:49.229 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.EndSessionEndpoint" for "/connect/endsession"
2017-06-10 16:13:49.238 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 16:13:49.239 +00:00 [Debug] Processing signout request for "2"
2017-06-10 16:13:49.247 +00:00 [Debug] Start end session request validation
2017-06-10 16:13:49.254 +00:00 [Debug] Start identity token validation
2017-06-10 16:13:49.257 +00:00 [Debug] Client found: "http://spaclient.org:5007" / "SPAClient"
2017-06-10 16:13:49.258 +00:00 [Debug] Calling into custom token validator: "IdentityServer4.Validation.DefaultCustomTokenValidator"
2017-06-10 16:13:49.262 +00:00 [Debug] Token validation success
"{
  \"ClientId\": \"http://spaclient.org:5007\",
  \"ClientName\": \"SPAClient\",
  \"ValidateLifetime\": false,
  \"Claims\": {
    \"nbf\": 1497111224,
    \"exp\": 1497111524,
    \"iss\": \"http://spaidsrv.org:5005\",
    \"aud\": \"http://spaclient.org:5007\",
    \"nonce\": \"81775747feac47cb9c3dadc24f2eba30\",
    \"iat\": 1497111224,
    \"at_hash\": \"FmuBbhuLXhQgaBMoojUjsA\",
    \"sid\": \"08cae3fa6327fe14b94b29ff5b58d7e3\",
    \"sub\": \"2\",
    \"auth_time\": 1497103417,
    \"idp\": \"local\",
    \"amr\": \"pwd\"
  }
}"
2017-06-10 16:13:49.262 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 16:13:49.271 +00:00 [Information] End session request validation success
"{
  \"ClientId\": \"http://spaclient.org:5007\",
  \"ClientName\": \"SPAClient\",
  \"SubjectId\": \"2\",
  \"PostLogOutUri\": \"http://spaclient.org:5007/index.html\",
  \"Raw\": {
    \"id_token_hint\": \"eyJhbGciOiJSUzI1NiIsImtpZCI6ImEwM2EwZmZjMGRjZTE3ZmVmM2FkNTAwZWRhZGY5ODdhIiwidHlwIjoiSldUIn0.eyJuYmYiOjE0OTcxMTEyMjQsImV4cCI6MTQ5NzExMTUyNCwiaXNzIjoiaHR0cDovL3NwYWlkc3J2Lm9yZzo1MDA1IiwiYXVkIjoiaHR0cDovL3NwYWNsaWVudC5vcmc6NTAwNyIsIm5vbmNlIjoiODE3NzU3NDdmZWFjNDdjYjljM2RhZGMyNGYyZWJhMzAiLCJpYXQiOjE0OTcxMTEyMjQsImF0X2hhc2giOiJGbXVCYmh1TFhoUWdhQk1vb2pVanNBIiwic2lkIjoiMDhjYWUzZmE2MzI3ZmUxNGI5NGIyOWZmNWI1OGQ3ZTMiLCJzdWIiOiIyIiwiYXV0aF90aW1lIjoxNDk3MTAzNDE3LCJpZHAiOiJsb2NhbCIsImFtciI6WyJwd2QiXX0.GmMyVz-tj-3woSG4lsXI8Vrh6rEdSeREluEE0tesAaFvwQdVoJfKPC0fw2NMC_G0VwXIwxRP_HvFLaroJ9qB1HFAqP2Pb9U5s45tvOWMZqrR9EHinIXnh3fEOc3bBhxYWW469vvper-3mRIquQRRv3B4ZBe09tFms3hvEtMRyJBQQSGUsdZFMJ3wIyzd5Vt0BO2g10B406OBLNLHI3i5Ej9m5iQh3FPiX_3K3ZB0HFe1thyPx_TXo2h3Qsf_kGZ3hcPaM4ukyxBdFbmgW3za7lWA5Xdj7M0nXfM3oRwwDOKvJ2Twl_VB6hyGlmiTXbz0eghzBzgdcjdNVBtkdOnEbA\",
    \"post_logout_redirect_uri\": \"http://spaclient.org:5007/index.html\"
  }
}"
2017-06-10 16:13:49.272 +00:00 [Debug] Success validating end session request from "http://spaclient.org:5007"
2017-06-10 16:13:49.272 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.EndSessionResult"
2017-06-10 16:13:49.290 +00:00 [Verbose] Protecting message: "{\"Id\":\"a99e920207d185b7afeafdd6de5b85b3\",\"Created\":636327080292808140,\"Data\":{\"ClientId\":\"http://spaclient.org:5007\",\"PostLogoutRedirectUri\":\"http://spaclient.org:5007/index.html\",\"SessionId\":\"08cae3fa6327fe14b94b29ff5b58d7e3\",\"Parameters\":[{\"Key\":\"id_token_hint\",\"Values\":[\"eyJhbGciOiJSUzI1NiIsImtpZCI6ImEwM2EwZmZjMGRjZTE3ZmVmM2FkNTAwZWRhZGY5ODdhIiwidHlwIjoiSldUIn0.eyJuYmYiOjE0OTcxMTEyMjQsImV4cCI6MTQ5NzExMTUyNCwiaXNzIjoiaHR0cDovL3NwYWlkc3J2Lm9yZzo1MDA1IiwiYXVkIjoiaHR0cDovL3NwYWNsaWVudC5vcmc6NTAwNyIsIm5vbmNlIjoiODE3NzU3NDdmZWFjNDdjYjljM2RhZGMyNGYyZWJhMzAiLCJpYXQiOjE0OTcxMTEyMjQsImF0X2hhc2giOiJGbXVCYmh1TFhoUWdhQk1vb2pVanNBIiwic2lkIjoiMDhjYWUzZmE2MzI3ZmUxNGI5NGIyOWZmNWI1OGQ3ZTMiLCJzdWIiOiIyIiwiYXV0aF90aW1lIjoxNDk3MTAzNDE3LCJpZHAiOiJsb2NhbCIsImFtciI6WyJwd2QiXX0.GmMyVz-tj-3woSG4lsXI8Vrh6rEdSeREluEE0tesAaFvwQdVoJfKPC0fw2NMC_G0VwXIwxRP_HvFLaroJ9qB1HFAqP2Pb9U5s45tvOWMZqrR9EHinIXnh3fEOc3bBhxYWW469vvper-3mRIquQRRv3B4ZBe09tFms3hvEtMRyJBQQSGUsdZFMJ3wIyzd5Vt0BO2g10B406OBLNLHI3i5Ej9m5iQh3FPiX_3K3ZB0HFe1thyPx_TXo2h3Qsf_kGZ3hcPaM4ukyxBdFbmgW3za7lWA5Xdj7M0nXfM3oRwwDOKvJ2Twl_VB6hyGlmiTXbz0eghzBzgdcjdNVBtkdOnEbA\"]},{\"Key\":\"post_logout_redirect_uri\",\"Values\":[\"http://spaclient.org:5007/index.html\"]}]}}"
2017-06-10 16:13:49.296 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 16:13:49.296 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 16:13:49.302 +00:00 [Information] Request finished in 82.3086ms 302 
2017-06-10 16:13:49.320 +00:00 [Information] Request starting HTTP/1.1 GET http://spaidsrv.org:5005/account/logout?logoutId=a99e920207d185b7afeafdd6de5b85b3  
2017-06-10 16:13:49.321 +00:00 [Information] HttpContext.User merged via AutomaticAuthentication from authenticationScheme: "idsrv".
2017-06-10 16:13:49.321 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 16:13:49.322 +00:00 [Verbose] No endpoint entry found for request path: "/account/logout"
2017-06-10 16:13:49.328 +00:00 [Information] Executing action method "IdentityServer4.Quickstart.UI.AccountController.Logout (SpaIdSrv)" with arguments (["a99e920207d185b7afeafdd6de5b85b3"]) - ModelState is Valid
2017-06-10 16:13:49.332 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 16:13:49.344 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 16:13:49.344 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 16:13:49.350 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 16:13:49.351 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 16:13:49.353 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 16:13:49.363 +00:00 [Information] AuthenticationScheme: "idsrv" signed out.
2017-06-10 16:13:49.364 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 16:13:49.472 +00:00 [Information] Executing ViewResult, running view at path "/Views/Account/LoggedOut.cshtml".
2017-06-10 16:13:49.492 +00:00 [Information] Executed action "IdentityServer4.Quickstart.UI.AccountController.Logout (SpaIdSrv)" in 166.7931ms
2017-06-10 16:13:49.495 +00:00 [Information] Request finished in 174.3114ms 200 text/html; charset=utf-8
2017-06-10 16:13:49.638 +00:00 [Information] Request starting HTTP/1.1 GET http://spaidsrv.org:5005/connect/endsession/callback?sid=08cae3fa6327fe14b94b29ff5b58d7e3&logoutId=a99e920207d185b7afeafdd6de5b85b3  
2017-06-10 16:13:49.639 +00:00 [Debug] Request path "/connect/endsession/callback" matched to endpoint type EndSession
2017-06-10 16:13:49.639 +00:00 [Debug] Mapping found for endpoint: EndSession, creating handler: "IdentityServer4.Endpoints.EndSessionEndpoint"
2017-06-10 16:13:49.639 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.EndSessionEndpoint" for "/connect/endsession/callback"
2017-06-10 16:13:49.642 +00:00 [Debug] Processing signout callback request
2017-06-10 16:13:49.662 +00:00 [Debug] No client end session iframe URLs
2017-06-10 16:13:49.662 +00:00 [Information] Successful signout callback. Client logout iframe urls: []
2017-06-10 16:13:49.664 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.EndSessionCallbackResult"
2017-06-10 16:13:49.678 +00:00 [Information] Request finished in 39.7817ms 200 text/html; charset=UTF-8
2017-06-10 16:17:11.965 +00:00 [Information] You are using the in-memory version of the persisted grant store. This will store consent decisions, authorization codes, refresh and reference tokens in memory only. If you are using any of those features in production, you want to switch to a different store implementation.
2017-06-10 16:17:12.038 +00:00 [Debug] Using built-in CookieAuthentication middleware with scheme: "idsrv"
2017-06-10 16:17:12.042 +00:00 [Debug] Adding CookieAuthentication middleware for external authentication with scheme: "idsrv.external"
2017-06-10 16:17:12.223 +00:00 [Information] User profile is available. Using '"/root/.aspnet/DataProtection-Keys"' as key repository; keys will not be encrypted at rest.
2017-06-10 16:18:31.382 +00:00 [Information] You are using the in-memory version of the persisted grant store. This will store consent decisions, authorization codes, refresh and reference tokens in memory only. If you are using any of those features in production, you want to switch to a different store implementation.
2017-06-10 16:18:31.427 +00:00 [Debug] Using built-in CookieAuthentication middleware with scheme: "idsrv"
2017-06-10 16:18:31.431 +00:00 [Debug] Adding CookieAuthentication middleware for external authentication with scheme: "idsrv.external"
2017-06-10 16:18:31.639 +00:00 [Information] User profile is available. Using '"/root/.aspnet/DataProtection-Keys"' as key repository; keys will not be encrypted at rest.
2017-06-10 16:23:39.212 +00:00 [Information] You are using the in-memory version of the persisted grant store. This will store consent decisions, authorization codes, refresh and reference tokens in memory only. If you are using any of those features in production, you want to switch to a different store implementation.
2017-06-10 16:23:39.302 +00:00 [Debug] Using built-in CookieAuthentication middleware with scheme: "idsrv"
2017-06-10 16:23:39.306 +00:00 [Debug] Adding CookieAuthentication middleware for external authentication with scheme: "idsrv.external"
2017-06-10 16:23:39.670 +00:00 [Information] User profile is available. Using '"/root/.aspnet/DataProtection-Keys"' as key repository; keys will not be encrypted at rest.
2017-06-10 16:23:50.317 +00:00 [Information] Request starting HTTP/1.1 GET http://spaidsrv.org:8081/.well-known/openid-configuration  
2017-06-10 16:23:50.332 +00:00 [Debug] CORS request made for path: "/.well-known/openid-configuration" from origin: "http://spaclient.org:8080"
2017-06-10 16:23:50.336 +00:00 [Debug] Client list checked and origin: "http://spaclient.org:8080" is allowed
2017-06-10 16:23:50.336 +00:00 [Debug] CorsPolicyService allowed origin: "http://spaclient.org:8080"
2017-06-10 16:23:50.383 +00:00 [Debug] Request path "/.well-known/openid-configuration" matched to endpoint type Discovery
2017-06-10 16:23:50.386 +00:00 [Debug] Mapping found for endpoint: Discovery, creating handler: "IdentityServer4.Endpoints.DiscoveryEndpoint"
2017-06-10 16:23:50.389 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.DiscoveryEndpoint" for "/.well-known/openid-configuration"
2017-06-10 16:23:50.392 +00:00 [Verbose] Processing discovery request.
2017-06-10 16:23:50.396 +00:00 [Debug] Start discovery request
2017-06-10 16:23:50.417 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.DiscoveryDocumentResult"
2017-06-10 16:23:50.512 +00:00 [Information] Request finished in 201.8491ms 200 application/json
2017-06-10 16:23:50.532 +00:00 [Information] Request starting HTTP/1.1 GET http://spaidsrv.org:8081/connect/authorize?client_id=http%3A%2F%2Fspaclient.org%3A8080&redirect_uri=http%3A%2F%2Fspaclient.org%3A8080%2Fcallback.html&response_type=id_token%20token&scope=openid%20profile%20productapi&state=7ad240ec2dc44552859ea1d10072d5fa&nonce=42c614b24bcc4d4c92fca1499045c726  
2017-06-10 16:23:50.537 +00:00 [Debug] Request path "/connect/authorize" matched to endpoint type Authorize
2017-06-10 16:23:50.537 +00:00 [Debug] Mapping found for endpoint: Authorize, creating handler: "IdentityServer4.Endpoints.AuthorizeEndpoint"
2017-06-10 16:23:50.548 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.AuthorizeEndpoint" for "/connect/authorize"
2017-06-10 16:23:50.556 +00:00 [Debug] Start authorize request
2017-06-10 16:23:50.608 +00:00 [Debug] No user present in authorize request
2017-06-10 16:23:50.616 +00:00 [Debug] Start authorize request protocol validation
2017-06-10 16:23:50.660 +00:00 [Debug] Calling into custom validator: "IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator"
2017-06-10 16:23:50.661 +00:00 [Verbose] Authorize request protocol validation successful
2017-06-10 16:23:50.687 +00:00 [Information] ValidatedAuthorizeRequest
"{
  \"ClientId\": \"http://spaclient.org:8080\",
  \"ClientName\": \"SPAClient\",
  \"RedirectUri\": \"http://spaclient.org:8080/callback.html\",
  \"AllowedRedirectUris\": [
    \"http://spaclient.org:8080/callback.html\"
  ],
  \"SubjectId\": \"anonymous\",
  \"ResponseType\": \"id_token token\",
  \"ResponseMode\": \"fragment\",
  \"GrantType\": \"implicit\",
  \"RequestedScopes\": \"openid profile productapi\",
  \"State\": \"7ad240ec2dc44552859ea1d10072d5fa\",
  \"Nonce\": \"42c614b24bcc4d4c92fca1499045c726\",
  \"Raw\": {
    \"client_id\": \"http://spaclient.org:8080\",
    \"redirect_uri\": \"http://spaclient.org:8080/callback.html\",
    \"response_type\": \"id_token token\",
    \"scope\": \"openid profile productapi\",
    \"state\": \"7ad240ec2dc44552859ea1d10072d5fa\",
    \"nonce\": \"42c614b24bcc4d4c92fca1499045c726\"
  }
}"
2017-06-10 16:23:50.698 +00:00 [Verbose] ProcessInteractionAsync
2017-06-10 16:23:50.705 +00:00 [Information] Showing login: User is not authenticated
2017-06-10 16:23:50.706 +00:00 [Verbose] End authorize request. result type: "IdentityServer4.Endpoints.Results.LoginPageResult"
2017-06-10 16:23:50.706 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.LoginPageResult"
2017-06-10 16:23:50.721 +00:00 [Information] Request finished in 188.8557ms 302 
2017-06-10 16:23:50.726 +00:00 [Information] Request starting HTTP/1.1 GET http://spaidsrv.org:8081/account/login?returnUrl=%2Fconnect%2Fauthorize%2Flogin%3Fclient_id%3Dhttp%253A%252F%252Fspaclient.org%253A8080%26redirect_uri%3Dhttp%253A%252F%252Fspaclient.org%253A8080%252Fcallback.html%26response_type%3Did_token%2520token%26scope%3Dopenid%2520profile%2520productapi%26state%3D7ad240ec2dc44552859ea1d10072d5fa%26nonce%3D42c614b24bcc4d4c92fca1499045c726  
2017-06-10 16:23:50.728 +00:00 [Verbose] No endpoint entry found for request path: "/account/login"
2017-06-10 16:23:50.945 +00:00 [Information] Executing action method "IdentityServer4.Quickstart.UI.AccountController.Login (SpaIdSrv)" with arguments (["/connect/authorize/login?client_id=http%3A%2F%2Fspaclient.org%3A8080&redirect_uri=http%3A%2F%2Fspaclient.org%3A8080%2Fcallback.html&response_type=id_token%20token&scope=openid%20profile%20productapi&state=7ad240ec2dc44552859ea1d10072d5fa&nonce=42c614b24bcc4d4c92fca1499045c726"]) - ModelState is Valid
2017-06-10 16:23:50.963 +00:00 [Verbose] returnUrl is valid
2017-06-10 16:23:50.968 +00:00 [Verbose] returnUrl is valid
2017-06-10 16:23:50.972 +00:00 [Debug] Start authorize request protocol validation
2017-06-10 16:23:50.975 +00:00 [Debug] Calling into custom validator: "IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator"
2017-06-10 16:23:50.976 +00:00 [Verbose] Authorize request protocol validation successful
2017-06-10 16:23:50.977 +00:00 [Verbose] AuthorizationRequest being returned
2017-06-10 16:23:50.980 +00:00 [Verbose] AuthorizationRequest being returned
2017-06-10 16:23:55.520 +00:00 [Information] Executing ViewResult, running view at path "/Views/Account/Login.cshtml".
2017-06-10 16:23:55.722 +00:00 [Information] Creating key {ab5fb972-32e5-4ed6-bfa4-0e4f020ef949} with creation date 2017-06-10 16:23:55Z, activation date 2017-06-10 16:23:55Z, and expiration date 2017-09-08 16:23:55Z.
2017-06-10 16:23:55.732 +00:00 [Warning] No XML encryptor configured. Key {ab5fb972-32e5-4ed6-bfa4-0e4f020ef949} may be persisted to storage in unencrypted form.
2017-06-10 16:23:55.739 +00:00 [Information] Writing data to file '"/root/.aspnet/DataProtection-Keys/key-ab5fb972-32e5-4ed6-bfa4-0e4f020ef949.xml"'.
2017-06-10 16:23:55.760 +00:00 [Error] An exception was thrown while deserializing the token.
System.InvalidOperationException: The antiforgery token could not be decrypted. ---> System.Security.Cryptography.CryptographicException: The key {40ca8c69-b6b3-4672-9b1e-1016049c7008} was not found in the key ring.
   at Microsoft.AspNetCore.DataProtection.KeyManagement.KeyRingBasedDataProtector.UnprotectCore(Byte[] protectedData, Boolean allowOperationsOnRevokedKeys, UnprotectStatus& status)
   at Microsoft.AspNetCore.DataProtection.KeyManagement.KeyRingBasedDataProtector.DangerousUnprotect(Byte[] protectedData, Boolean ignoreRevocationErrors, Boolean& requiresMigration, Boolean& wasRevoked)
   at Microsoft.AspNetCore.DataProtection.KeyManagement.KeyRingBasedDataProtector.Unprotect(Byte[] protectedData)
   at Microsoft.AspNetCore.Antiforgery.Internal.DefaultAntiforgeryTokenSerializer.Deserialize(String serializedToken)
   --- End of inner exception stack trace ---
   at Microsoft.AspNetCore.Antiforgery.Internal.DefaultAntiforgeryTokenSerializer.Deserialize(String serializedToken)
   at Microsoft.AspNetCore.Antiforgery.Internal.DefaultAntiforgery.GetCookieTokenDoesNotThrow(HttpContext httpContext)
2017-06-10 16:23:56.125 +00:00 [Information] Executed action "IdentityServer4.Quickstart.UI.AccountController.Login (SpaIdSrv)" in 5244.5379ms
2017-06-10 16:23:56.146 +00:00 [Information] Request starting HTTP/1.1 GET http://spaidsrv.org:8081/lib/bootstrap/css/bootstrap.css  
2017-06-10 16:23:56.146 +00:00 [Information] Request starting HTTP/1.1 GET http://spaidsrv.org:8081/css/site.css  
2017-06-10 16:23:56.149 +00:00 [Verbose] No endpoint entry found for request path: "/lib/bootstrap/css/bootstrap.css"
2017-06-10 16:23:56.149 +00:00 [Verbose] No endpoint entry found for request path: "/css/site.css"
2017-06-10 16:23:56.158 +00:00 [Information] Request finished in 5431.5849ms 200 text/html; charset=utf-8
2017-06-10 16:23:56.181 +00:00 [Information] Sending file. Request path: '"/css/site.css"'. Physical path: '"/app/wwwroot/css/site.css"'
2017-06-10 16:23:56.181 +00:00 [Information] Sending file. Request path: '"/lib/bootstrap/css/bootstrap.css"'. Physical path: '"/app/wwwroot/lib/bootstrap/css/bootstrap.css"'
2017-06-10 16:23:56.180 +00:00 [Information] Request starting HTTP/1.1 GET http://spaidsrv.org:8081/lib/jquery/jquery.js  
2017-06-10 16:23:56.182 +00:00 [Verbose] No endpoint entry found for request path: "/lib/jquery/jquery.js"
2017-06-10 16:23:56.189 +00:00 [Information] Sending file. Request path: '"/lib/jquery/jquery.js"'. Physical path: '"/app/wwwroot/lib/jquery/jquery.js"'
2017-06-10 16:23:56.374 +00:00 [Information] Request finished in 227.3449ms 200 text/css
2017-06-10 16:23:56.374 +00:00 [Information] Request finished in 193.9399ms 200 application/javascript
2017-06-10 16:23:56.394 +00:00 [Information] Request starting HTTP/1.1 GET http://spaidsrv.org:8081/lib/bootstrap/js/bootstrap.js  
2017-06-10 16:23:56.396 +00:00 [Information] Request finished in 250.3128ms 200 text/css
2017-06-10 16:23:56.396 +00:00 [Information] Request starting HTTP/1.1 GET http://spaidsrv.org:8081/icon.png  
2017-06-10 16:23:56.396 +00:00 [Verbose] No endpoint entry found for request path: "/lib/bootstrap/js/bootstrap.js"
2017-06-10 16:23:56.396 +00:00 [Verbose] No endpoint entry found for request path: "/icon.png"
2017-06-10 16:23:56.406 +00:00 [Information] Sending file. Request path: '"/icon.png"'. Physical path: '"/app/wwwroot/icon.png"'
2017-06-10 16:23:56.415 +00:00 [Information] Sending file. Request path: '"/lib/bootstrap/js/bootstrap.js"'. Physical path: '"/app/wwwroot/lib/bootstrap/js/bootstrap.js"'
2017-06-10 16:23:56.493 +00:00 [Information] Request finished in 119.4842ms 200 application/javascript
2017-06-10 16:23:56.527 +00:00 [Information] Request starting HTTP/1.1 GET http://spaidsrv.org:8081/favicon.ico  
2017-06-10 16:23:56.528 +00:00 [Verbose] No endpoint entry found for request path: "/favicon.ico"
2017-06-10 16:23:56.539 +00:00 [Information] Request finished in 142.9239ms 200 image/png
2017-06-10 16:23:56.545 +00:00 [Information] Sending file. Request path: '"/favicon.ico"'. Physical path: '"/app/wwwroot/favicon.ico"'
2017-06-10 16:23:56.561 +00:00 [Information] Request finished in 33.3265ms 200 image/x-icon
2017-06-10 16:24:00.587 +00:00 [Information] Request starting HTTP/1.1 POST http://spaidsrv.org:8081/account/login?returnUrl=%2Fconnect%2Fauthorize%2Flogin%3Fclient_id%3Dhttp%253A%252F%252Fspaclient.org%253A8080%26redirect_uri%3Dhttp%253A%252F%252Fspaclient.org%253A8080%252Fcallback.html%26response_type%3Did_token%2520token%26scope%3Dopenid%2520profile%2520productapi%26state%3D7ad240ec2dc44552859ea1d10072d5fa%26nonce%3D42c614b24bcc4d4c92fca1499045c726 application/x-www-form-urlencoded 578
2017-06-10 16:24:00.588 +00:00 [Verbose] No endpoint entry found for request path: "/account/login"
2017-06-10 16:24:00.625 +00:00 [Information] Executing action method "IdentityServer4.Quickstart.UI.AccountController.Login (SpaIdSrv)" with arguments (["IdentityServer4.Quickstart.UI.LoginInputModel"]) - ModelState is Valid
2017-06-10 16:24:00.644 +00:00 [Debug] Augmenting SignInContext
2017-06-10 16:24:00.657 +00:00 [Information] AuthenticationScheme: "idsrv" signed in.
2017-06-10 16:24:00.661 +00:00 [Verbose] returnUrl is valid
2017-06-10 16:24:00.661 +00:00 [Verbose] IsValidReturnUrl true
2017-06-10 16:24:00.664 +00:00 [Information] Executing RedirectResult, redirecting to "/connect/authorize/login?client_id=http%3A%2F%2Fspaclient.org%3A8080&redirect_uri=http%3A%2F%2Fspaclient.org%3A8080%2Fcallback.html&response_type=id_token%20token&scope=openid%20profile%20productapi&state=7ad240ec2dc44552859ea1d10072d5fa&nonce=42c614b24bcc4d4c92fca1499045c726".
2017-06-10 16:24:00.665 +00:00 [Information] Executed action "IdentityServer4.Quickstart.UI.AccountController.Login (SpaIdSrv)" in 69.3274ms
2017-06-10 16:24:00.687 +00:00 [Information] Request finished in 79.5381ms 302 
2017-06-10 16:24:00.688 +00:00 [Information] Request starting HTTP/1.1 GET http://spaidsrv.org:8081/connect/authorize/login?client_id=http%3A%2F%2Fspaclient.org%3A8080&redirect_uri=http%3A%2F%2Fspaclient.org%3A8080%2Fcallback.html&response_type=id_token%20token&scope=openid%20profile%20productapi&state=7ad240ec2dc44552859ea1d10072d5fa&nonce=42c614b24bcc4d4c92fca1499045c726  
2017-06-10 16:24:00.690 +00:00 [Information] HttpContext.User merged via AutomaticAuthentication from authenticationScheme: "idsrv".
2017-06-10 16:24:00.690 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 16:24:00.691 +00:00 [Debug] Request path "/connect/authorize/login" matched to endpoint type Authorize
2017-06-10 16:24:00.691 +00:00 [Debug] Mapping found for endpoint: Authorize, creating handler: "IdentityServer4.Endpoints.AuthorizeEndpoint"
2017-06-10 16:24:00.705 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.AuthorizeEndpoint" for "/connect/authorize/login"
2017-06-10 16:24:00.712 +00:00 [Debug] Start authorize request (after login)
2017-06-10 16:24:00.712 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 16:24:00.713 +00:00 [Debug] User in authorize request: "2"
2017-06-10 16:24:00.713 +00:00 [Debug] Start authorize request protocol validation
2017-06-10 16:24:00.714 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 16:24:00.714 +00:00 [Debug] Calling into custom validator: "IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator"
2017-06-10 16:24:00.715 +00:00 [Verbose] Authorize request protocol validation successful
2017-06-10 16:24:00.715 +00:00 [Information] ValidatedAuthorizeRequest
"{
  \"ClientId\": \"http://spaclient.org:8080\",
  \"ClientName\": \"SPAClient\",
  \"RedirectUri\": \"http://spaclient.org:8080/callback.html\",
  \"AllowedRedirectUris\": [
    \"http://spaclient.org:8080/callback.html\"
  ],
  \"SubjectId\": \"2\",
  \"ResponseType\": \"id_token token\",
  \"ResponseMode\": \"fragment\",
  \"GrantType\": \"implicit\",
  \"RequestedScopes\": \"openid profile productapi\",
  \"State\": \"7ad240ec2dc44552859ea1d10072d5fa\",
  \"Nonce\": \"42c614b24bcc4d4c92fca1499045c726\",
  \"SessionId\": \"fc9a457dc4545d23fe4181b3fb0956d2\",
  \"Raw\": {
    \"client_id\": \"http://spaclient.org:8080\",
    \"redirect_uri\": \"http://spaclient.org:8080/callback.html\",
    \"response_type\": \"id_token token\",
    \"scope\": \"openid profile productapi\",
    \"state\": \"7ad240ec2dc44552859ea1d10072d5fa\",
    \"nonce\": \"42c614b24bcc4d4c92fca1499045c726\"
  }
}"
2017-06-10 16:24:00.719 +00:00 [Verbose] ProcessInteractionAsync
2017-06-10 16:24:00.746 +00:00 [Debug] "user_consent" grant with value: "http://spaclient.org:8080|2" not found in store.
2017-06-10 16:24:00.747 +00:00 [Information] Showing consent: User has not yet consented
2017-06-10 16:24:00.748 +00:00 [Verbose] End Authorize Request. Result type: "IdentityServer4.Endpoints.Results.ConsentPageResult"
2017-06-10 16:24:00.748 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.ConsentPageResult"
2017-06-10 16:24:00.751 +00:00 [Information] Request finished in 63.0058ms 302 
2017-06-10 16:24:00.756 +00:00 [Information] Request starting HTTP/1.1 GET http://spaidsrv.org:8081/consent?returnUrl=%2Fconnect%2Fauthorize%2Fconsent%3Fclient_id%3Dhttp%253A%252F%252Fspaclient.org%253A8080%26redirect_uri%3Dhttp%253A%252F%252Fspaclient.org%253A8080%252Fcallback.html%26response_type%3Did_token%2520token%26scope%3Dopenid%2520profile%2520productapi%26state%3D7ad240ec2dc44552859ea1d10072d5fa%26nonce%3D42c614b24bcc4d4c92fca1499045c726  
2017-06-10 16:24:00.759 +00:00 [Information] HttpContext.User merged via AutomaticAuthentication from authenticationScheme: "idsrv".
2017-06-10 16:24:00.760 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 16:24:00.762 +00:00 [Verbose] No endpoint entry found for request path: "/consent"
2017-06-10 16:24:00.767 +00:00 [Information] Executing action method "IdentityServer4.Quickstart.UI.ConsentController.Index (SpaIdSrv)" with arguments (["/connect/authorize/consent?client_id=http%3A%2F%2Fspaclient.org%3A8080&redirect_uri=http%3A%2F%2Fspaclient.org%3A8080%2Fcallback.html&response_type=id_token%20token&scope=openid%20profile%20productapi&state=7ad240ec2dc44552859ea1d10072d5fa&nonce=42c614b24bcc4d4c92fca1499045c726"]) - ModelState is Valid
2017-06-10 16:24:00.774 +00:00 [Verbose] returnUrl is valid
2017-06-10 16:24:00.774 +00:00 [Verbose] returnUrl is valid
2017-06-10 16:24:00.775 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 16:24:00.776 +00:00 [Debug] Start authorize request protocol validation
2017-06-10 16:24:00.777 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 16:24:00.778 +00:00 [Debug] Calling into custom validator: "IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator"
2017-06-10 16:24:00.779 +00:00 [Verbose] Authorize request protocol validation successful
2017-06-10 16:24:00.780 +00:00 [Verbose] AuthorizationRequest being returned
2017-06-10 16:24:00.780 +00:00 [Verbose] AuthorizationRequest being returned
2017-06-10 16:24:00.918 +00:00 [Information] Executing ViewResult, running view at path "/Views/Consent/Index.cshtml".
2017-06-10 16:24:01.046 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 16:24:01.055 +00:00 [Information] Executed action "IdentityServer4.Quickstart.UI.ConsentController.Index (SpaIdSrv)" in 290.734ms
2017-06-10 16:24:01.057 +00:00 [Information] Request finished in 300.5474ms 200 text/html; charset=utf-8
2017-06-10 16:24:01.146 +00:00 [Information] Request starting HTTP/1.1 GET http://spaidsrv.org:8081/lib/bootstrap/fonts/glyphicons-halflings-regular.woff2  
2017-06-10 16:24:01.146 +00:00 [Information] HttpContext.User merged via AutomaticAuthentication from authenticationScheme: "idsrv".
2017-06-10 16:24:01.146 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 16:24:01.146 +00:00 [Verbose] No endpoint entry found for request path: "/lib/bootstrap/fonts/glyphicons-halflings-regular.woff2"
2017-06-10 16:24:01.152 +00:00 [Information] Sending file. Request path: '"/lib/bootstrap/fonts/glyphicons-halflings-regular.woff2"'. Physical path: '"/app/wwwroot/lib/bootstrap/fonts/glyphicons-halflings-regular.woff2"'
2017-06-10 16:24:01.263 +00:00 [Information] Request finished in 116.8711ms 200 application/font-woff2
2017-06-10 16:24:03.488 +00:00 [Information] Request starting HTTP/1.1 POST http://spaidsrv.org:8081/consent application/x-www-form-urlencoded 675
2017-06-10 16:24:03.488 +00:00 [Information] HttpContext.User merged via AutomaticAuthentication from authenticationScheme: "idsrv".
2017-06-10 16:24:03.489 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 16:24:03.489 +00:00 [Verbose] No endpoint entry found for request path: "/consent"
2017-06-10 16:24:03.504 +00:00 [Information] Executing action method "IdentityServer4.Quickstart.UI.ConsentController.Index (SpaIdSrv)" with arguments (["IdentityServer4.Quickstart.UI.ConsentInputModel"]) - ModelState is Valid
2017-06-10 16:24:03.509 +00:00 [Verbose] returnUrl is valid
2017-06-10 16:24:03.510 +00:00 [Verbose] returnUrl is valid
2017-06-10 16:24:03.510 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 16:24:03.511 +00:00 [Debug] Start authorize request protocol validation
2017-06-10 16:24:03.512 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 16:24:03.514 +00:00 [Debug] Calling into custom validator: "IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator"
2017-06-10 16:24:03.514 +00:00 [Verbose] Authorize request protocol validation successful
2017-06-10 16:24:03.515 +00:00 [Verbose] AuthorizationRequest being returned
2017-06-10 16:24:03.515 +00:00 [Verbose] AuthorizationRequest being returned
2017-06-10 16:24:03.521 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 16:24:03.536 +00:00 [Verbose] Protecting message: "{\"Created\":636327086435264940,\"Data\":{\"Granted\":true,\"ScopesConsented\":[\"openid\",\"profile\",\"productapi\"]}}"
2017-06-10 16:24:03.538 +00:00 [Information] Executing RedirectResult, redirecting to "/connect/authorize/consent?client_id=http%3A%2F%2Fspaclient.org%3A8080&redirect_uri=http%3A%2F%2Fspaclient.org%3A8080%2Fcallback.html&response_type=id_token%20token&scope=openid%20profile%20productapi&state=7ad240ec2dc44552859ea1d10072d5fa&nonce=42c614b24bcc4d4c92fca1499045c726".
2017-06-10 16:24:03.539 +00:00 [Information] Executed action "IdentityServer4.Quickstart.UI.ConsentController.Index (SpaIdSrv)" in 44.9226ms
2017-06-10 16:24:03.540 +00:00 [Information] Request finished in 51.9896ms 302 
2017-06-10 16:24:03.545 +00:00 [Information] Request starting HTTP/1.1 GET http://spaidsrv.org:8081/connect/authorize/consent?client_id=http%3A%2F%2Fspaclient.org%3A8080&redirect_uri=http%3A%2F%2Fspaclient.org%3A8080%2Fcallback.html&response_type=id_token%20token&scope=openid%20profile%20productapi&state=7ad240ec2dc44552859ea1d10072d5fa&nonce=42c614b24bcc4d4c92fca1499045c726  
2017-06-10 16:24:03.545 +00:00 [Information] HttpContext.User merged via AutomaticAuthentication from authenticationScheme: "idsrv".
2017-06-10 16:24:03.546 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 16:24:03.546 +00:00 [Debug] Request path "/connect/authorize/consent" matched to endpoint type Authorize
2017-06-10 16:24:03.546 +00:00 [Debug] Mapping found for endpoint: Authorize, creating handler: "IdentityServer4.Endpoints.AuthorizeEndpoint"
2017-06-10 16:24:03.546 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.AuthorizeEndpoint" for "/connect/authorize/consent"
2017-06-10 16:24:03.555 +00:00 [Debug] Start authorize request (after consent)
2017-06-10 16:24:03.555 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 16:24:03.563 +00:00 [Debug] User in authorize request: "2"
2017-06-10 16:24:03.563 +00:00 [Debug] Start authorize request protocol validation
2017-06-10 16:24:03.564 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 16:24:03.564 +00:00 [Debug] Calling into custom validator: "IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator"
2017-06-10 16:24:03.565 +00:00 [Verbose] Authorize request protocol validation successful
2017-06-10 16:24:03.566 +00:00 [Information] ValidatedAuthorizeRequest
"{
  \"ClientId\": \"http://spaclient.org:8080\",
  \"ClientName\": \"SPAClient\",
  \"RedirectUri\": \"http://spaclient.org:8080/callback.html\",
  \"AllowedRedirectUris\": [
    \"http://spaclient.org:8080/callback.html\"
  ],
  \"SubjectId\": \"2\",
  \"ResponseType\": \"id_token token\",
  \"ResponseMode\": \"fragment\",
  \"GrantType\": \"implicit\",
  \"RequestedScopes\": \"openid profile productapi\",
  \"State\": \"7ad240ec2dc44552859ea1d10072d5fa\",
  \"Nonce\": \"42c614b24bcc4d4c92fca1499045c726\",
  \"SessionId\": \"fc9a457dc4545d23fe4181b3fb0956d2\",
  \"Raw\": {
    \"client_id\": \"http://spaclient.org:8080\",
    \"redirect_uri\": \"http://spaclient.org:8080/callback.html\",
    \"response_type\": \"id_token token\",
    \"scope\": \"openid profile productapi\",
    \"state\": \"7ad240ec2dc44552859ea1d10072d5fa\",
    \"nonce\": \"42c614b24bcc4d4c92fca1499045c726\"
  }
}"
2017-06-10 16:24:03.568 +00:00 [Verbose] ProcessInteractionAsync
2017-06-10 16:24:03.569 +00:00 [Debug] "user_consent" grant with value: "http://spaclient.org:8080|2" not found in store.
2017-06-10 16:24:03.569 +00:00 [Verbose] Consent was shown to user
2017-06-10 16:24:03.581 +00:00 [Information] User consented to scopes: ["openid", "profile", "productapi"]
2017-06-10 16:24:03.595 +00:00 [Debug] Creating Implicit Flow response.
2017-06-10 16:24:03.600 +00:00 [Verbose] Creating access token
2017-06-10 16:24:03.607 +00:00 [Debug] Getting claims for access token for client: "http://spaclient.org:8080"
2017-06-10 16:24:03.608 +00:00 [Debug] Getting claims for access token for subject: "2"
2017-06-10 16:24:03.614 +00:00 [Debug] Get profile called for subject "2" from client "SPAClient" with claim types [] via "ClaimsProviderAccessToken"
2017-06-10 16:24:03.619 +00:00 [Verbose] Creating JWT access token
2017-06-10 16:24:03.865 +00:00 [Verbose] Creating identity token
2017-06-10 16:24:03.871 +00:00 [Debug] Getting claims for identity token for subject: "2" and client: "http://spaclient.org:8080"
2017-06-10 16:24:03.871 +00:00 [Debug] In addition to an id_token, an access_token was requested. No claims other than sub are included in the id_token. To obtain more user claims, either use the user info endpoint or set AlwaysIncludeUserClaimsInIdToken on the client configuration.
2017-06-10 16:24:03.872 +00:00 [Verbose] Creating JWT identity token
2017-06-10 16:24:03.880 +00:00 [Verbose] Identity token issued for "http://spaclient.org:8080 (SPAClient)" / "2": "eyJhbGciOiJSUzI1NiIsImtpZCI6ImRlNmE2NjFkODFhMjNhYWZjNmE5YjE2NzcyMmUyNDU0IiwidHlwIjoiSldUIn0.eyJuYmYiOjE0OTcxMTE4NDMsImV4cCI6MTQ5NzExMjE0MywiaXNzIjoiaHR0cDovL3NwYWlkc3J2Lm9yZzo4MDgxIiwiYXVkIjoiaHR0cDovL3NwYWNsaWVudC5vcmc6ODA4MCIsIm5vbmNlIjoiNDJjNjE0YjI0YmNjNGQ0YzkyZmNhMTQ5OTA0NWM3MjYiLCJpYXQiOjE0OTcxMTE4NDMsImF0X2hhc2giOiJrRW9PRVd6UnVhS296OTd6eGtfS3VBIiwic2lkIjoiZmM5YTQ1N2RjNDU0NWQyM2ZlNDE4MWIzZmIwOTU2ZDIiLCJzdWIiOiIyIiwiYXV0aF90aW1lIjoxNDk3MTExODQwLCJpZHAiOiJsb2NhbCIsImFtciI6WyJwd2QiXX0.M9jTerynaDus_u3Ytfu64Lv98pV9KrCAaPGRWrfPPYvOFmllHKWgelxUzxOjkOTWQsFDqkYu5q9oBDF6jaDPhhMaJ_TRUjiTovnCMnY0H3piMX_97O4t0Y62I_9ftIWZfJXixQOEZnlMPyfLLNWAY5h85xpYv71DlPCqY-WWAV4bQscodQI5pmB9CHEtRa99Yub6iC2pUPdFHVgfpSUsnOMfIDYxIH1-QAc2oIFrvCPt4rTgpVRao-7GVVQkvXj1HM91gKo9bGH8dUhGOvFe5LMeP92zfoN2X0TQUV2GTP2OgshrkohapXJO2zHJLt2bMY0UzwTybXjttU5_p4aU7Q"
2017-06-10 16:24:03.880 +00:00 [Verbose] Access token issued for "http://spaclient.org:8080 (SPAClient)" / "2": "eyJhbGciOiJSUzI1NiIsImtpZCI6ImRlNmE2NjFkODFhMjNhYWZjNmE5YjE2NzcyMmUyNDU0IiwidHlwIjoiSldUIn0.eyJuYmYiOjE0OTcxMTE4NDMsImV4cCI6MTQ5NzExNTQ0MywiaXNzIjoiaHR0cDovL3NwYWlkc3J2Lm9yZzo4MDgxIiwiYXVkIjpbImh0dHA6Ly9zcGFpZHNydi5vcmc6ODA4MS9yZXNvdXJjZXMiLCJwcm9kdWN0YXBpIl0sImNsaWVudF9pZCI6Imh0dHA6Ly9zcGFjbGllbnQub3JnOjgwODAiLCJzdWIiOiIyIiwiYXV0aF90aW1lIjoxNDk3MTExODQwLCJpZHAiOiJsb2NhbCIsInNjb3BlIjpbIm9wZW5pZCIsInByb2ZpbGUiLCJwcm9kdWN0YXBpIl0sImFtciI6WyJwd2QiXX0.fjHiqUt9x9vFIGLHcGvqIxB690UD06-KpaeJ9ZHiXc0cVzWCjnqwumWFVtycFrQAqW9WnGr3LvGOe-vb_DOUZYlhpucTnPKNigR9pgifElDrAA-ABTa0IYyHQxOMSg5SVhSEFRUK833j3dewZp52THgcmdr9HW36OKG77cU5rGO-wuGnqIFH1JRMV7KtMCmwT2SWVvk_vRSLX4YHPK8xyp-BYECue-3pkvTdQRWp-6hPv7iUr-yAOOVnyqgFVM2bTriDS-92VbNzwtZgjB9DeAn_458b7NCjui-pUGq8AKvAzcGJ-XJl6GhsYsPFxSJ-g_Qdzabt_mi612BG7L1J9w"
2017-06-10 16:24:03.892 +00:00 [Information] Authorize endpoint response
"{
  \"SubjectId\": \"2\",
  \"ClientId\": \"http://spaclient.org:8080\",
  \"RedirectUri\": \"http://spaclient.org:8080/callback.html\",
  \"State\": \"7ad240ec2dc44552859ea1d10072d5fa\",
  \"Scope\": \"openid profile productapi\"
}"
2017-06-10 16:24:03.895 +00:00 [Verbose] End Authorize Request. Result type: "IdentityServer4.Endpoints.Results.AuthorizeResult"
2017-06-10 16:24:03.900 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.AuthorizeResult"
2017-06-10 16:24:03.913 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 16:24:03.923 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 16:24:03.928 +00:00 [Debug] Augmenting SignInContext
2017-06-10 16:24:03.930 +00:00 [Information] AuthenticationScheme: "idsrv" signed in.
2017-06-10 16:24:03.940 +00:00 [Information] Request finished in 395.787ms 302 
2017-06-10 16:24:04.161 +00:00 [Information] Request starting HTTP/1.1 GET http://spaidsrv.org:8081/.well-known/openid-configuration  
2017-06-10 16:24:04.162 +00:00 [Debug] CORS request made for path: "/.well-known/openid-configuration" from origin: "http://spaclient.org:8080"
2017-06-10 16:24:04.163 +00:00 [Debug] Client list checked and origin: "http://spaclient.org:8080" is allowed
2017-06-10 16:24:04.164 +00:00 [Debug] CorsPolicyService allowed origin: "http://spaclient.org:8080"
2017-06-10 16:24:04.164 +00:00 [Debug] Request path "/.well-known/openid-configuration" matched to endpoint type Discovery
2017-06-10 16:24:04.164 +00:00 [Debug] Mapping found for endpoint: Discovery, creating handler: "IdentityServer4.Endpoints.DiscoveryEndpoint"
2017-06-10 16:24:04.165 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.DiscoveryEndpoint" for "/.well-known/openid-configuration"
2017-06-10 16:24:04.166 +00:00 [Verbose] Processing discovery request.
2017-06-10 16:24:04.166 +00:00 [Debug] Start discovery request
2017-06-10 16:24:04.166 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.DiscoveryDocumentResult"
2017-06-10 16:24:04.166 +00:00 [Information] Request finished in 5.3422ms 200 application/json
2017-06-10 16:24:04.193 +00:00 [Information] Request starting HTTP/1.1 GET http://spaidsrv.org:8081/.well-known/openid-configuration/jwks  
2017-06-10 16:24:04.193 +00:00 [Debug] CORS request made for path: "/.well-known/openid-configuration/jwks" from origin: "http://spaclient.org:8080"
2017-06-10 16:24:04.193 +00:00 [Debug] Client list checked and origin: "http://spaclient.org:8080" is allowed
2017-06-10 16:24:04.193 +00:00 [Debug] CorsPolicyService allowed origin: "http://spaclient.org:8080"
2017-06-10 16:24:04.194 +00:00 [Debug] Request path "/.well-known/openid-configuration/jwks" matched to endpoint type Discovery
2017-06-10 16:24:04.194 +00:00 [Debug] Mapping found for endpoint: Discovery, creating handler: "IdentityServer4.Endpoints.DiscoveryEndpoint"
2017-06-10 16:24:04.194 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.DiscoveryEndpoint" for "/.well-known/openid-configuration/jwks"
2017-06-10 16:24:04.194 +00:00 [Verbose] Processing discovery request.
2017-06-10 16:24:04.200 +00:00 [Debug] Start key discovery request
2017-06-10 16:24:04.214 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.JsonWebKeysResult"
2017-06-10 16:24:04.223 +00:00 [Information] Request finished in 30.114ms 200 application/json
2017-06-10 16:24:04.242 +00:00 [Information] Request starting HTTP/1.1 OPTIONS http://spaidsrv.org:8081/connect/userinfo  
2017-06-10 16:24:04.242 +00:00 [Debug] CORS request made for path: "/connect/userinfo" from origin: "http://spaclient.org:8080"
2017-06-10 16:24:04.242 +00:00 [Debug] Client list checked and origin: "http://spaclient.org:8080" is allowed
2017-06-10 16:24:04.242 +00:00 [Debug] CorsPolicyService allowed origin: "http://spaclient.org:8080"
2017-06-10 16:24:04.244 +00:00 [Information] Request finished in 1.6801ms 204 
2017-06-10 16:24:04.250 +00:00 [Information] Request starting HTTP/1.1 GET http://spaidsrv.org:8081/connect/userinfo  
2017-06-10 16:24:04.251 +00:00 [Debug] CORS request made for path: "/connect/userinfo" from origin: "http://spaclient.org:8080"
2017-06-10 16:24:04.251 +00:00 [Debug] Client list checked and origin: "http://spaclient.org:8080" is allowed
2017-06-10 16:24:04.251 +00:00 [Debug] CorsPolicyService allowed origin: "http://spaclient.org:8080"
2017-06-10 16:24:04.251 +00:00 [Debug] Request path "/connect/userinfo" matched to endpoint type UserInfo
2017-06-10 16:24:04.252 +00:00 [Debug] Mapping found for endpoint: UserInfo, creating handler: "IdentityServer4.Endpoints.UserInfoEndpoint"
2017-06-10 16:24:04.256 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.UserInfoEndpoint" for "/connect/userinfo"
2017-06-10 16:24:04.263 +00:00 [Debug] Start userinfo request
2017-06-10 16:24:04.266 +00:00 [Information] ValidateAsync: Locating bearer token
2017-06-10 16:24:04.268 +00:00 [Verbose] Authorization header value found
2017-06-10 16:24:04.268 +00:00 [Verbose] Authorization scheme is bearer
2017-06-10 16:24:04.268 +00:00 [Debug] Bearer token found in header
2017-06-10 16:24:04.269 +00:00 [Debug] Token found: "AuthorizationHeader"
2017-06-10 16:24:04.275 +00:00 [Verbose] Start access token validation
2017-06-10 16:24:04.324 +00:00 [Debug] Token validation success
"{
  \"ValidateLifetime\": true,
  \"AccessTokenType\": \"Jwt\",
  \"ExpectedScope\": \"openid\",
  \"Claims\": {
    \"nbf\": 1497111843,
    \"exp\": 1497115443,
    \"iss\": \"http://spaidsrv.org:8081\",
    \"aud\": [
      \"http://spaidsrv.org:8081/resources\",
      \"productapi\"
    ],
    \"client_id\": \"http://spaclient.org:8080\",
    \"sub\": \"2\",
    \"auth_time\": 1497111840,
    \"idp\": \"local\",
    \"scope\": [
      \"openid\",
      \"profile\",
      \"productapi\"
    ],
    \"amr\": \"pwd\"
  }
}"
2017-06-10 16:24:04.332 +00:00 [Verbose] Creating userinfo response
2017-06-10 16:24:04.337 +00:00 [Debug] Scopes in access token: "openid profile productapi"
2017-06-10 16:24:04.341 +00:00 [Debug] Requested claim types: "sub name family_name given_name middle_name nickname preferred_username profile picture website gender birthdate zoneinfo locale updated_at"
2017-06-10 16:24:04.341 +00:00 [Debug] Get profile called for subject "2" from client "SPAClient" with claim types ["sub", "name", "family_name", "given_name", "middle_name", "nickname", "preferred_username", "profile", "picture", "website", "gender", "birthdate", "zoneinfo", "locale", "updated_at"] via "UserInfoEndpoint"
2017-06-10 16:24:04.343 +00:00 [Information] Profile service returned to the following claim types: ""
2017-06-10 16:24:04.343 +00:00 [Debug] End userinfo request
2017-06-10 16:24:04.344 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.UserInfoResult"
2017-06-10 16:24:04.348 +00:00 [Information] Request finished in 96.739ms 200 application/json
2017-06-10 16:24:04.363 +00:00 [Information] Request starting HTTP/1.1 GET http://spaidsrv.org:8081/connect/checksession  
2017-06-10 16:24:04.365 +00:00 [Information] HttpContext.User merged via AutomaticAuthentication from authenticationScheme: "idsrv".
2017-06-10 16:24:04.367 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 16:24:04.368 +00:00 [Debug] Request path "/connect/checksession" matched to endpoint type CheckSession
2017-06-10 16:24:04.368 +00:00 [Debug] Mapping found for endpoint: CheckSession, creating handler: "IdentityServer4.Endpoints.CheckSessionEndpoint"
2017-06-10 16:24:04.370 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.CheckSessionEndpoint" for "/connect/checksession"
2017-06-10 16:24:04.373 +00:00 [Debug] Rendering check session result
2017-06-10 16:24:04.373 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.CheckSessionResult"
2017-06-10 16:24:04.383 +00:00 [Information] Request finished in 19.5725ms 200 text/html; charset=UTF-8
2017-06-10 16:24:04.609 +00:00 [Information] Request starting HTTP/1.1 GET http://spaidsrv.org:8081/.well-known/openid-configuration  
2017-06-10 16:24:04.610 +00:00 [Debug] CORS request made for path: "/.well-known/openid-configuration" from origin: "http://spaclient.org:8080"
2017-06-10 16:24:04.610 +00:00 [Debug] Client list checked and origin: "http://spaclient.org:8080" is allowed
2017-06-10 16:24:04.611 +00:00 [Debug] CorsPolicyService allowed origin: "http://spaclient.org:8080"
2017-06-10 16:24:04.611 +00:00 [Debug] Request path "/.well-known/openid-configuration" matched to endpoint type Discovery
2017-06-10 16:24:04.612 +00:00 [Debug] Mapping found for endpoint: Discovery, creating handler: "IdentityServer4.Endpoints.DiscoveryEndpoint"
2017-06-10 16:24:04.618 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.DiscoveryEndpoint" for "/.well-known/openid-configuration"
2017-06-10 16:24:04.619 +00:00 [Verbose] Processing discovery request.
2017-06-10 16:24:04.620 +00:00 [Debug] Start discovery request
2017-06-10 16:24:04.620 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.DiscoveryDocumentResult"
2017-06-10 16:24:04.621 +00:00 [Information] Request finished in 11.605ms 200 application/json
2017-06-10 16:24:04.633 +00:00 [Information] Request starting HTTP/1.1 GET http://spaidsrv.org:8081/connect/checksession  
2017-06-10 16:24:04.634 +00:00 [Information] HttpContext.User merged via AutomaticAuthentication from authenticationScheme: "idsrv".
2017-06-10 16:24:04.635 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 16:24:04.635 +00:00 [Debug] Request path "/connect/checksession" matched to endpoint type CheckSession
2017-06-10 16:24:04.635 +00:00 [Debug] Mapping found for endpoint: CheckSession, creating handler: "IdentityServer4.Endpoints.CheckSessionEndpoint"
2017-06-10 16:24:04.635 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.CheckSessionEndpoint" for "/connect/checksession"
2017-06-10 16:24:04.636 +00:00 [Debug] Rendering check session result
2017-06-10 16:24:04.636 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.CheckSessionResult"
2017-06-10 16:24:04.639 +00:00 [Information] Request finished in 5.311ms 200 text/html; charset=UTF-8
2017-06-10 16:28:58.879 +00:00 [Information] You are using the in-memory version of the persisted grant store. This will store consent decisions, authorization codes, refresh and reference tokens in memory only. If you are using any of those features in production, you want to switch to a different store implementation.
2017-06-10 16:28:58.932 +00:00 [Debug] Using built-in CookieAuthentication middleware with scheme: "idsrv"
2017-06-10 16:28:58.935 +00:00 [Debug] Adding CookieAuthentication middleware for external authentication with scheme: "idsrv.external"
2017-06-10 16:28:59.199 +00:00 [Information] User profile is available. Using '"/root/.aspnet/DataProtection-Keys"' as key repository; keys will not be encrypted at rest.
2017-06-10 16:29:00.626 +00:00 [Information] Request starting HTTP/1.1 GET http://spaidsrv.org:8081/.well-known/openid-configuration  
2017-06-10 16:29:00.644 +00:00 [Debug] CORS request made for path: "/.well-known/openid-configuration" from origin: "http://spaclient.org:8080"
2017-06-10 16:29:00.649 +00:00 [Debug] Client list checked and origin: "http://spaclient.org:8080" is allowed
2017-06-10 16:29:00.650 +00:00 [Debug] CorsPolicyService allowed origin: "http://spaclient.org:8080"
2017-06-10 16:29:00.701 +00:00 [Debug] Request path "/.well-known/openid-configuration" matched to endpoint type Discovery
2017-06-10 16:29:00.706 +00:00 [Debug] Mapping found for endpoint: Discovery, creating handler: "IdentityServer4.Endpoints.DiscoveryEndpoint"
2017-06-10 16:29:00.711 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.DiscoveryEndpoint" for "/.well-known/openid-configuration"
2017-06-10 16:29:00.713 +00:00 [Verbose] Processing discovery request.
2017-06-10 16:29:00.716 +00:00 [Debug] Start discovery request
2017-06-10 16:29:00.740 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.DiscoveryDocumentResult"
2017-06-10 16:29:00.851 +00:00 [Information] Request finished in 234.8508ms 200 application/json
2017-06-10 16:29:00.875 +00:00 [Information] Request starting HTTP/1.1 GET http://spaidsrv.org:8081/connect/checksession  
2017-06-10 16:29:00.930 +00:00 [Information] HttpContext.User merged via AutomaticAuthentication from authenticationScheme: "idsrv".
2017-06-10 16:29:00.932 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 16:29:00.937 +00:00 [Debug] Request path "/connect/checksession" matched to endpoint type CheckSession
2017-06-10 16:29:00.939 +00:00 [Debug] Mapping found for endpoint: CheckSession, creating handler: "IdentityServer4.Endpoints.CheckSessionEndpoint"
2017-06-10 16:29:00.941 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.CheckSessionEndpoint" for "/connect/checksession"
2017-06-10 16:29:00.945 +00:00 [Debug] Rendering check session result
2017-06-10 16:29:00.946 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.CheckSessionResult"
2017-06-10 16:29:00.963 +00:00 [Information] Request finished in 88.2514ms 200 text/html; charset=UTF-8
2017-06-10 16:29:06.914 +00:00 [Information] Request starting HTTP/1.1 GET http://spaidsrv.org:8081/connect/authorize?client_id=http%3A%2F%2Fspaclient.org%3A8080&redirect_uri=http%3A%2F%2Fspaclient.org%3A8080%2Fcallback.html&response_type=id_token%20token&scope=openid%20profile%20productapi&state=9a33b84af2694fc8af247359f58d4002&nonce=60dc4a2a8b034e7ebb88fc998f8c6e68  
2017-06-10 16:29:06.915 +00:00 [Information] HttpContext.User merged via AutomaticAuthentication from authenticationScheme: "idsrv".
2017-06-10 16:29:06.915 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 16:29:06.915 +00:00 [Debug] Request path "/connect/authorize" matched to endpoint type Authorize
2017-06-10 16:29:06.915 +00:00 [Debug] Mapping found for endpoint: Authorize, creating handler: "IdentityServer4.Endpoints.AuthorizeEndpoint"
2017-06-10 16:29:06.930 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.AuthorizeEndpoint" for "/connect/authorize"
2017-06-10 16:29:06.941 +00:00 [Debug] Start authorize request
2017-06-10 16:29:06.982 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 16:29:06.991 +00:00 [Debug] User in authorize request: "2"
2017-06-10 16:29:06.997 +00:00 [Debug] Start authorize request protocol validation
2017-06-10 16:29:07.041 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 16:29:07.042 +00:00 [Debug] Calling into custom validator: "IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator"
2017-06-10 16:29:07.044 +00:00 [Verbose] Authorize request protocol validation successful
2017-06-10 16:29:07.068 +00:00 [Information] ValidatedAuthorizeRequest
"{
  \"ClientId\": \"http://spaclient.org:8080\",
  \"ClientName\": \"SPAClient\",
  \"RedirectUri\": \"http://spaclient.org:8080/callback.html\",
  \"AllowedRedirectUris\": [
    \"http://spaclient.org:8080/callback.html\"
  ],
  \"SubjectId\": \"2\",
  \"ResponseType\": \"id_token token\",
  \"ResponseMode\": \"fragment\",
  \"GrantType\": \"implicit\",
  \"RequestedScopes\": \"openid profile productapi\",
  \"State\": \"9a33b84af2694fc8af247359f58d4002\",
  \"Nonce\": \"60dc4a2a8b034e7ebb88fc998f8c6e68\",
  \"SessionId\": \"fc9a457dc4545d23fe4181b3fb0956d2\",
  \"Raw\": {
    \"client_id\": \"http://spaclient.org:8080\",
    \"redirect_uri\": \"http://spaclient.org:8080/callback.html\",
    \"response_type\": \"id_token token\",
    \"scope\": \"openid profile productapi\",
    \"state\": \"9a33b84af2694fc8af247359f58d4002\",
    \"nonce\": \"60dc4a2a8b034e7ebb88fc998f8c6e68\"
  }
}"
2017-06-10 16:29:07.081 +00:00 [Verbose] ProcessInteractionAsync
2017-06-10 16:29:07.100 +00:00 [Debug] "user_consent" grant with value: "http://spaclient.org:8080|2" not found in store.
2017-06-10 16:29:07.101 +00:00 [Information] Showing consent: User has not yet consented
2017-06-10 16:29:07.103 +00:00 [Verbose] End authorize request. result type: "IdentityServer4.Endpoints.Results.ConsentPageResult"
2017-06-10 16:29:07.103 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.ConsentPageResult"
2017-06-10 16:29:07.115 +00:00 [Information] Request finished in 201.0916ms 302 
2017-06-10 16:29:07.120 +00:00 [Information] Request starting HTTP/1.1 GET http://spaidsrv.org:8081/consent?returnUrl=%2Fconnect%2Fauthorize%2Fconsent%3Fclient_id%3Dhttp%253A%252F%252Fspaclient.org%253A8080%26redirect_uri%3Dhttp%253A%252F%252Fspaclient.org%253A8080%252Fcallback.html%26response_type%3Did_token%2520token%26scope%3Dopenid%2520profile%2520productapi%26state%3D9a33b84af2694fc8af247359f58d4002%26nonce%3D60dc4a2a8b034e7ebb88fc998f8c6e68  
2017-06-10 16:29:07.121 +00:00 [Information] HttpContext.User merged via AutomaticAuthentication from authenticationScheme: "idsrv".
2017-06-10 16:29:07.121 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 16:29:07.121 +00:00 [Verbose] No endpoint entry found for request path: "/consent"
2017-06-10 16:29:07.390 +00:00 [Information] Executing action method "IdentityServer4.Quickstart.UI.ConsentController.Index (SpaIdSrv)" with arguments (["/connect/authorize/consent?client_id=http%3A%2F%2Fspaclient.org%3A8080&redirect_uri=http%3A%2F%2Fspaclient.org%3A8080%2Fcallback.html&response_type=id_token%20token&scope=openid%20profile%20productapi&state=9a33b84af2694fc8af247359f58d4002&nonce=60dc4a2a8b034e7ebb88fc998f8c6e68"]) - ModelState is Valid
2017-06-10 16:29:07.411 +00:00 [Verbose] returnUrl is valid
2017-06-10 16:29:07.415 +00:00 [Verbose] returnUrl is valid
2017-06-10 16:29:07.418 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 16:29:07.419 +00:00 [Debug] Start authorize request protocol validation
2017-06-10 16:29:07.420 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 16:29:07.421 +00:00 [Debug] Calling into custom validator: "IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator"
2017-06-10 16:29:07.422 +00:00 [Verbose] Authorize request protocol validation successful
2017-06-10 16:29:07.424 +00:00 [Verbose] AuthorizationRequest being returned
2017-06-10 16:29:07.426 +00:00 [Verbose] AuthorizationRequest being returned
2017-06-10 16:29:12.799 +00:00 [Information] Executing ViewResult, running view at path "/Views/Consent/Index.cshtml".
2017-06-10 16:29:13.286 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 16:29:13.333 +00:00 [Information] Executed action "IdentityServer4.Quickstart.UI.ConsentController.Index (SpaIdSrv)" in 6032.9113ms
2017-06-10 16:29:13.337 +00:00 [Information] Request finished in 6216.6898ms 200 text/html; charset=utf-8
2017-06-10 16:29:13.684 +00:00 [Information] Request starting HTTP/1.1 GET http://spaidsrv.org:8081/lib/bootstrap/css/bootstrap.css.map  
2017-06-10 16:29:13.685 +00:00 [Information] HttpContext.User merged via AutomaticAuthentication from authenticationScheme: "idsrv".
2017-06-10 16:29:13.685 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 16:29:13.685 +00:00 [Verbose] No endpoint entry found for request path: "/lib/bootstrap/css/bootstrap.css.map"
2017-06-10 16:29:13.696 +00:00 [Information] Sending file. Request path: '"/lib/bootstrap/css/bootstrap.css.map"'. Physical path: '"/app/wwwroot/lib/bootstrap/css/bootstrap.css.map"'
2017-06-10 16:29:13.860 +00:00 [Information] Request finished in 176.6379ms 200 text/plain
2017-06-10 16:29:15.685 +00:00 [Information] Request starting HTTP/1.1 POST http://spaidsrv.org:8081/consent application/x-www-form-urlencoded 675
2017-06-10 16:29:15.685 +00:00 [Information] HttpContext.User merged via AutomaticAuthentication from authenticationScheme: "idsrv".
2017-06-10 16:29:15.685 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 16:29:15.686 +00:00 [Verbose] No endpoint entry found for request path: "/consent"
2017-06-10 16:29:15.733 +00:00 [Information] Executing action method "IdentityServer4.Quickstart.UI.ConsentController.Index (SpaIdSrv)" with arguments (["IdentityServer4.Quickstart.UI.ConsentInputModel"]) - ModelState is Valid
2017-06-10 16:29:15.740 +00:00 [Verbose] returnUrl is valid
2017-06-10 16:29:15.741 +00:00 [Verbose] returnUrl is valid
2017-06-10 16:29:15.741 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 16:29:15.741 +00:00 [Debug] Start authorize request protocol validation
2017-06-10 16:29:15.741 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 16:29:15.742 +00:00 [Debug] Calling into custom validator: "IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator"
2017-06-10 16:29:15.742 +00:00 [Verbose] Authorize request protocol validation successful
2017-06-10 16:29:15.742 +00:00 [Verbose] AuthorizationRequest being returned
2017-06-10 16:29:15.742 +00:00 [Verbose] AuthorizationRequest being returned
2017-06-10 16:29:15.748 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 16:29:15.766 +00:00 [Verbose] Protecting message: "{\"Created\":636327089557558730,\"Data\":{\"Granted\":true,\"ScopesConsented\":[\"openid\",\"profile\",\"productapi\"]}}"
2017-06-10 16:29:15.771 +00:00 [Information] Executing RedirectResult, redirecting to "/connect/authorize/consent?client_id=http%3A%2F%2Fspaclient.org%3A8080&redirect_uri=http%3A%2F%2Fspaclient.org%3A8080%2Fcallback.html&response_type=id_token%20token&scope=openid%20profile%20productapi&state=9a33b84af2694fc8af247359f58d4002&nonce=60dc4a2a8b034e7ebb88fc998f8c6e68".
2017-06-10 16:29:15.771 +00:00 [Information] Executed action "IdentityServer4.Quickstart.UI.ConsentController.Index (SpaIdSrv)" in 84.0378ms
2017-06-10 16:29:15.773 +00:00 [Information] Request finished in 88.3593ms 302 
2017-06-10 16:29:15.786 +00:00 [Information] Request starting HTTP/1.1 GET http://spaidsrv.org:8081/connect/authorize/consent?client_id=http%3A%2F%2Fspaclient.org%3A8080&redirect_uri=http%3A%2F%2Fspaclient.org%3A8080%2Fcallback.html&response_type=id_token%20token&scope=openid%20profile%20productapi&state=9a33b84af2694fc8af247359f58d4002&nonce=60dc4a2a8b034e7ebb88fc998f8c6e68  
2017-06-10 16:29:15.787 +00:00 [Information] HttpContext.User merged via AutomaticAuthentication from authenticationScheme: "idsrv".
2017-06-10 16:29:15.787 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 16:29:15.788 +00:00 [Debug] Request path "/connect/authorize/consent" matched to endpoint type Authorize
2017-06-10 16:29:15.788 +00:00 [Debug] Mapping found for endpoint: Authorize, creating handler: "IdentityServer4.Endpoints.AuthorizeEndpoint"
2017-06-10 16:29:15.805 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.AuthorizeEndpoint" for "/connect/authorize/consent"
2017-06-10 16:29:15.813 +00:00 [Debug] Start authorize request (after consent)
2017-06-10 16:29:15.814 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 16:29:15.821 +00:00 [Debug] User in authorize request: "2"
2017-06-10 16:29:15.821 +00:00 [Debug] Start authorize request protocol validation
2017-06-10 16:29:15.822 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 16:29:15.822 +00:00 [Debug] Calling into custom validator: "IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator"
2017-06-10 16:29:15.823 +00:00 [Verbose] Authorize request protocol validation successful
2017-06-10 16:29:15.823 +00:00 [Information] ValidatedAuthorizeRequest
"{
  \"ClientId\": \"http://spaclient.org:8080\",
  \"ClientName\": \"SPAClient\",
  \"RedirectUri\": \"http://spaclient.org:8080/callback.html\",
  \"AllowedRedirectUris\": [
    \"http://spaclient.org:8080/callback.html\"
  ],
  \"SubjectId\": \"2\",
  \"ResponseType\": \"id_token token\",
  \"ResponseMode\": \"fragment\",
  \"GrantType\": \"implicit\",
  \"RequestedScopes\": \"openid profile productapi\",
  \"State\": \"9a33b84af2694fc8af247359f58d4002\",
  \"Nonce\": \"60dc4a2a8b034e7ebb88fc998f8c6e68\",
  \"SessionId\": \"fc9a457dc4545d23fe4181b3fb0956d2\",
  \"Raw\": {
    \"client_id\": \"http://spaclient.org:8080\",
    \"redirect_uri\": \"http://spaclient.org:8080/callback.html\",
    \"response_type\": \"id_token token\",
    \"scope\": \"openid profile productapi\",
    \"state\": \"9a33b84af2694fc8af247359f58d4002\",
    \"nonce\": \"60dc4a2a8b034e7ebb88fc998f8c6e68\"
  }
}"
2017-06-10 16:29:15.823 +00:00 [Verbose] ProcessInteractionAsync
2017-06-10 16:29:15.823 +00:00 [Debug] "user_consent" grant with value: "http://spaclient.org:8080|2" not found in store.
2017-06-10 16:29:15.823 +00:00 [Verbose] Consent was shown to user
2017-06-10 16:29:15.838 +00:00 [Information] User consented to scopes: ["openid", "profile", "productapi"]
2017-06-10 16:29:15.854 +00:00 [Debug] Creating Implicit Flow response.
2017-06-10 16:29:15.861 +00:00 [Verbose] Creating access token
2017-06-10 16:29:15.869 +00:00 [Debug] Getting claims for access token for client: "http://spaclient.org:8080"
2017-06-10 16:29:15.870 +00:00 [Debug] Getting claims for access token for subject: "2"
2017-06-10 16:29:15.876 +00:00 [Debug] Get profile called for subject "2" from client "SPAClient" with claim types [] via "ClaimsProviderAccessToken"
2017-06-10 16:29:15.881 +00:00 [Verbose] Creating JWT access token
2017-06-10 16:29:16.027 +00:00 [Verbose] Creating identity token
2017-06-10 16:29:16.033 +00:00 [Debug] Getting claims for identity token for subject: "2" and client: "http://spaclient.org:8080"
2017-06-10 16:29:16.034 +00:00 [Debug] In addition to an id_token, an access_token was requested. No claims other than sub are included in the id_token. To obtain more user claims, either use the user info endpoint or set AlwaysIncludeUserClaimsInIdToken on the client configuration.
2017-06-10 16:29:16.035 +00:00 [Verbose] Creating JWT identity token
2017-06-10 16:29:16.042 +00:00 [Verbose] Identity token issued for "http://spaclient.org:8080 (SPAClient)" / "2": "eyJhbGciOiJSUzI1NiIsImtpZCI6ImJmZmI1YjEwOWY3NDU5ZTMwODZmYTIyYzEyNjBjNjNjIiwidHlwIjoiSldUIn0.eyJuYmYiOjE0OTcxMTIxNTYsImV4cCI6MTQ5NzExMjQ1NiwiaXNzIjoiaHR0cDovL3NwYWlkc3J2Lm9yZzo4MDgxIiwiYXVkIjoiaHR0cDovL3NwYWNsaWVudC5vcmc6ODA4MCIsIm5vbmNlIjoiNjBkYzRhMmE4YjAzNGU3ZWJiODhmYzk5OGY4YzZlNjgiLCJpYXQiOjE0OTcxMTIxNTYsImF0X2hhc2giOiIydVlscHJXeTduOGdVakJOTHdGQVV3Iiwic2lkIjoiZmM5YTQ1N2RjNDU0NWQyM2ZlNDE4MWIzZmIwOTU2ZDIiLCJzdWIiOiIyIiwiYXV0aF90aW1lIjoxNDk3MTExODQwLCJpZHAiOiJsb2NhbCIsImFtciI6WyJwd2QiXX0.rP-725BkPb1ttM5a8whOC9wSMT6GVL39VMGzUk8N4i5qAd39FQJtydf8Yf1YRIS3wmZQrgnw3bwf_0k9Y9KSidKKKQtufGGHDPb-eoL2uKBGSd_2AQEP4tyawdrt5YsJejoZ0l7lFSP38TU-Ngda_0F5VU3bUhprkwhmjSetRpaADB_Ry2ClkWRAUpZTEq4o3NCjG8rndr6akedTCrRk-UdooZJS8yywvCKzNy3TwCoszEh_YZokLya2KgjCz9YbvXM87IHmqGGutXH30IoQbntEmHy6hRrf1WKaYs1LawlvRj4RsJT_jMbvFFgNGjffFhhapcljQBEvcPGqah5Vsw"
2017-06-10 16:29:16.042 +00:00 [Verbose] Access token issued for "http://spaclient.org:8080 (SPAClient)" / "2": "eyJhbGciOiJSUzI1NiIsImtpZCI6ImJmZmI1YjEwOWY3NDU5ZTMwODZmYTIyYzEyNjBjNjNjIiwidHlwIjoiSldUIn0.eyJuYmYiOjE0OTcxMTIxNTUsImV4cCI6MTQ5NzExNTc1NSwiaXNzIjoiaHR0cDovL3NwYWlkc3J2Lm9yZzo4MDgxIiwiYXVkIjpbImh0dHA6Ly9zcGFpZHNydi5vcmc6ODA4MS9yZXNvdXJjZXMiLCJwcm9kdWN0YXBpIl0sImNsaWVudF9pZCI6Imh0dHA6Ly9zcGFjbGllbnQub3JnOjgwODAiLCJzdWIiOiIyIiwiYXV0aF90aW1lIjoxNDk3MTExODQwLCJpZHAiOiJsb2NhbCIsInNjb3BlIjpbIm9wZW5pZCIsInByb2ZpbGUiLCJwcm9kdWN0YXBpIl0sImFtciI6WyJwd2QiXX0.Ry4wqPuMFlRh2Yrj_HO2DHCvuIpL2VlzZIoapL0nzimtR8B-7wjVHVgDjEE1veBKOSg86rrIdHsM2hMuxMG-9qPJCumV9x6GUhpXGTKby6epfK93OUyhwLcerFl_0L7sCk72q1f6F94mgodfN0DlT5fBmEzWJeWKjRTNxhLkdgs0dDjFjoNZ4ucOUByVP3eUrCPwdnbP1yw29fE7xd24xVTsSNO3nO603_2D6NOOUd4YXiu6_yqwg3EfJKO0vCCYDw-8z-MyHzmTQT-Ei4OjK6lLfuhwK9vc1EWEbN3KI0fiTW4eHtVjJh6H33kyi6K59o_Ki2NLOsocFGMfNxEKGw"
2017-06-10 16:29:16.055 +00:00 [Information] Authorize endpoint response
"{
  \"SubjectId\": \"2\",
  \"ClientId\": \"http://spaclient.org:8080\",
  \"RedirectUri\": \"http://spaclient.org:8080/callback.html\",
  \"State\": \"9a33b84af2694fc8af247359f58d4002\",
  \"Scope\": \"openid profile productapi\"
}"
2017-06-10 16:29:16.057 +00:00 [Verbose] End Authorize Request. Result type: "IdentityServer4.Endpoints.Results.AuthorizeResult"
2017-06-10 16:29:16.061 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.AuthorizeResult"
2017-06-10 16:29:16.072 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 16:29:16.080 +00:00 [Information] Request finished in 294.6165ms 302 
2017-06-10 16:29:16.431 +00:00 [Information] Request starting HTTP/1.1 GET http://spaidsrv.org:8081/.well-known/openid-configuration  
2017-06-10 16:29:16.431 +00:00 [Debug] CORS request made for path: "/.well-known/openid-configuration" from origin: "http://spaclient.org:8080"
2017-06-10 16:29:16.433 +00:00 [Debug] Client list checked and origin: "http://spaclient.org:8080" is allowed
2017-06-10 16:29:16.433 +00:00 [Debug] CorsPolicyService allowed origin: "http://spaclient.org:8080"
2017-06-10 16:29:16.434 +00:00 [Debug] Request path "/.well-known/openid-configuration" matched to endpoint type Discovery
2017-06-10 16:29:16.435 +00:00 [Debug] Mapping found for endpoint: Discovery, creating handler: "IdentityServer4.Endpoints.DiscoveryEndpoint"
2017-06-10 16:29:16.435 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.DiscoveryEndpoint" for "/.well-known/openid-configuration"
2017-06-10 16:29:16.438 +00:00 [Verbose] Processing discovery request.
2017-06-10 16:29:16.438 +00:00 [Debug] Start discovery request
2017-06-10 16:29:16.438 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.DiscoveryDocumentResult"
2017-06-10 16:29:16.442 +00:00 [Information] Request finished in 11.0238ms 200 application/json
2017-06-10 16:29:16.490 +00:00 [Information] Request starting HTTP/1.1 GET http://spaidsrv.org:8081/.well-known/openid-configuration/jwks  
2017-06-10 16:29:16.490 +00:00 [Debug] CORS request made for path: "/.well-known/openid-configuration/jwks" from origin: "http://spaclient.org:8080"
2017-06-10 16:29:16.490 +00:00 [Debug] Client list checked and origin: "http://spaclient.org:8080" is allowed
2017-06-10 16:29:16.491 +00:00 [Debug] CorsPolicyService allowed origin: "http://spaclient.org:8080"
2017-06-10 16:29:16.491 +00:00 [Debug] Request path "/.well-known/openid-configuration/jwks" matched to endpoint type Discovery
2017-06-10 16:29:16.491 +00:00 [Debug] Mapping found for endpoint: Discovery, creating handler: "IdentityServer4.Endpoints.DiscoveryEndpoint"
2017-06-10 16:29:16.491 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.DiscoveryEndpoint" for "/.well-known/openid-configuration/jwks"
2017-06-10 16:29:16.491 +00:00 [Verbose] Processing discovery request.
2017-06-10 16:29:16.495 +00:00 [Debug] Start key discovery request
2017-06-10 16:29:16.504 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.JsonWebKeysResult"
2017-06-10 16:29:16.522 +00:00 [Information] Request finished in 32.1689ms 200 application/json
2017-06-10 16:29:16.551 +00:00 [Information] Request starting HTTP/1.1 OPTIONS http://spaidsrv.org:8081/connect/userinfo  
2017-06-10 16:29:16.551 +00:00 [Debug] CORS request made for path: "/connect/userinfo" from origin: "http://spaclient.org:8080"
2017-06-10 16:29:16.551 +00:00 [Debug] Client list checked and origin: "http://spaclient.org:8080" is allowed
2017-06-10 16:29:16.551 +00:00 [Debug] CorsPolicyService allowed origin: "http://spaclient.org:8080"
2017-06-10 16:29:16.554 +00:00 [Information] Request finished in 2.7316ms 204 
2017-06-10 16:29:16.561 +00:00 [Information] Request starting HTTP/1.1 GET http://spaidsrv.org:8081/connect/userinfo  
2017-06-10 16:29:16.561 +00:00 [Debug] CORS request made for path: "/connect/userinfo" from origin: "http://spaclient.org:8080"
2017-06-10 16:29:16.563 +00:00 [Debug] Client list checked and origin: "http://spaclient.org:8080" is allowed
2017-06-10 16:29:16.565 +00:00 [Debug] CorsPolicyService allowed origin: "http://spaclient.org:8080"
2017-06-10 16:29:16.567 +00:00 [Debug] Request path "/connect/userinfo" matched to endpoint type UserInfo
2017-06-10 16:29:16.567 +00:00 [Debug] Mapping found for endpoint: UserInfo, creating handler: "IdentityServer4.Endpoints.UserInfoEndpoint"
2017-06-10 16:29:16.570 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.UserInfoEndpoint" for "/connect/userinfo"
2017-06-10 16:29:16.580 +00:00 [Debug] Start userinfo request
2017-06-10 16:29:16.592 +00:00 [Information] ValidateAsync: Locating bearer token
2017-06-10 16:29:16.594 +00:00 [Verbose] Authorization header value found
2017-06-10 16:29:16.594 +00:00 [Verbose] Authorization scheme is bearer
2017-06-10 16:29:16.594 +00:00 [Debug] Bearer token found in header
2017-06-10 16:29:16.594 +00:00 [Debug] Token found: "AuthorizationHeader"
2017-06-10 16:29:16.605 +00:00 [Verbose] Start access token validation
2017-06-10 16:29:16.677 +00:00 [Debug] Token validation success
"{
  \"ValidateLifetime\": true,
  \"AccessTokenType\": \"Jwt\",
  \"ExpectedScope\": \"openid\",
  \"Claims\": {
    \"nbf\": 1497112155,
    \"exp\": 1497115755,
    \"iss\": \"http://spaidsrv.org:8081\",
    \"aud\": [
      \"http://spaidsrv.org:8081/resources\",
      \"productapi\"
    ],
    \"client_id\": \"http://spaclient.org:8080\",
    \"sub\": \"2\",
    \"auth_time\": 1497111840,
    \"idp\": \"local\",
    \"scope\": [
      \"openid\",
      \"profile\",
      \"productapi\"
    ],
    \"amr\": \"pwd\"
  }
}"
2017-06-10 16:29:16.687 +00:00 [Verbose] Creating userinfo response
2017-06-10 16:29:16.694 +00:00 [Debug] Scopes in access token: "openid profile productapi"
2017-06-10 16:29:16.699 +00:00 [Debug] Requested claim types: "sub name family_name given_name middle_name nickname preferred_username profile picture website gender birthdate zoneinfo locale updated_at"
2017-06-10 16:29:16.699 +00:00 [Debug] Get profile called for subject "2" from client "SPAClient" with claim types ["sub", "name", "family_name", "given_name", "middle_name", "nickname", "preferred_username", "profile", "picture", "website", "gender", "birthdate", "zoneinfo", "locale", "updated_at"] via "UserInfoEndpoint"
2017-06-10 16:29:16.702 +00:00 [Information] Profile service returned to the following claim types: ""
2017-06-10 16:29:16.702 +00:00 [Debug] End userinfo request
2017-06-10 16:29:16.702 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.UserInfoResult"
2017-06-10 16:29:16.705 +00:00 [Information] Request finished in 144.863ms 200 application/json
2017-06-10 16:29:16.714 +00:00 [Information] Request starting HTTP/1.1 GET http://spaidsrv.org:8081/connect/checksession  
2017-06-10 16:29:16.714 +00:00 [Information] HttpContext.User merged via AutomaticAuthentication from authenticationScheme: "idsrv".
2017-06-10 16:29:16.715 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 16:29:16.715 +00:00 [Debug] Request path "/connect/checksession" matched to endpoint type CheckSession
2017-06-10 16:29:16.715 +00:00 [Debug] Mapping found for endpoint: CheckSession, creating handler: "IdentityServer4.Endpoints.CheckSessionEndpoint"
2017-06-10 16:29:16.716 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.CheckSessionEndpoint" for "/connect/checksession"
2017-06-10 16:29:16.717 +00:00 [Debug] Rendering check session result
2017-06-10 16:29:16.717 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.CheckSessionResult"
2017-06-10 16:29:16.718 +00:00 [Information] Request finished in 4.1494ms 200 text/html; charset=UTF-8
2017-06-10 16:29:17.110 +00:00 [Information] Request starting HTTP/1.1 GET http://spaidsrv.org:8081/.well-known/openid-configuration  
2017-06-10 16:29:17.110 +00:00 [Debug] CORS request made for path: "/.well-known/openid-configuration" from origin: "http://spaclient.org:8080"
2017-06-10 16:29:17.111 +00:00 [Debug] Client list checked and origin: "http://spaclient.org:8080" is allowed
2017-06-10 16:29:17.111 +00:00 [Debug] CorsPolicyService allowed origin: "http://spaclient.org:8080"
2017-06-10 16:29:17.111 +00:00 [Debug] Request path "/.well-known/openid-configuration" matched to endpoint type Discovery
2017-06-10 16:29:17.111 +00:00 [Debug] Mapping found for endpoint: Discovery, creating handler: "IdentityServer4.Endpoints.DiscoveryEndpoint"
2017-06-10 16:29:17.112 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.DiscoveryEndpoint" for "/.well-known/openid-configuration"
2017-06-10 16:29:17.112 +00:00 [Verbose] Processing discovery request.
2017-06-10 16:29:17.112 +00:00 [Debug] Start discovery request
2017-06-10 16:29:17.112 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.DiscoveryDocumentResult"
2017-06-10 16:29:17.113 +00:00 [Information] Request finished in 3.0443ms 200 application/json
2017-06-10 16:29:17.146 +00:00 [Information] Request starting HTTP/1.1 GET http://spaidsrv.org:8081/connect/checksession  
2017-06-10 16:29:17.146 +00:00 [Information] HttpContext.User merged via AutomaticAuthentication from authenticationScheme: "idsrv".
2017-06-10 16:29:17.147 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 16:29:17.147 +00:00 [Debug] Request path "/connect/checksession" matched to endpoint type CheckSession
2017-06-10 16:29:17.147 +00:00 [Debug] Mapping found for endpoint: CheckSession, creating handler: "IdentityServer4.Endpoints.CheckSessionEndpoint"
2017-06-10 16:29:17.147 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.CheckSessionEndpoint" for "/connect/checksession"
2017-06-10 16:29:17.147 +00:00 [Debug] Rendering check session result
2017-06-10 16:29:17.147 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.CheckSessionResult"
2017-06-10 16:29:17.147 +00:00 [Information] Request finished in 1.5195ms 200 text/html; charset=UTF-8
2017-06-10 16:29:37.189 +00:00 [Information] Request starting HTTP/1.1 GET http://spaidsrv.org:8081/.well-known/openid-configuration  
2017-06-10 16:29:37.190 +00:00 [Debug] CORS request made for path: "/.well-known/openid-configuration" from origin: "http://spaclient.org:8080"
2017-06-10 16:29:37.190 +00:00 [Debug] Client list checked and origin: "http://spaclient.org:8080" is allowed
2017-06-10 16:29:37.190 +00:00 [Debug] CorsPolicyService allowed origin: "http://spaclient.org:8080"
2017-06-10 16:29:37.191 +00:00 [Debug] Request path "/.well-known/openid-configuration" matched to endpoint type Discovery
2017-06-10 16:29:37.191 +00:00 [Debug] Mapping found for endpoint: Discovery, creating handler: "IdentityServer4.Endpoints.DiscoveryEndpoint"
2017-06-10 16:29:37.191 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.DiscoveryEndpoint" for "/.well-known/openid-configuration"
2017-06-10 16:29:37.191 +00:00 [Verbose] Processing discovery request.
2017-06-10 16:29:37.191 +00:00 [Debug] Start discovery request
2017-06-10 16:29:37.192 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.DiscoveryDocumentResult"
2017-06-10 16:29:37.193 +00:00 [Information] Request finished in 3.8317ms 200 application/json
2017-06-10 16:29:37.211 +00:00 [Information] Request starting HTTP/1.1 GET http://spaidsrv.org:8081/connect/checksession  
2017-06-10 16:29:37.212 +00:00 [Information] HttpContext.User merged via AutomaticAuthentication from authenticationScheme: "idsrv".
2017-06-10 16:29:37.212 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 16:29:37.212 +00:00 [Debug] Request path "/connect/checksession" matched to endpoint type CheckSession
2017-06-10 16:29:37.212 +00:00 [Debug] Mapping found for endpoint: CheckSession, creating handler: "IdentityServer4.Endpoints.CheckSessionEndpoint"
2017-06-10 16:29:37.212 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.CheckSessionEndpoint" for "/connect/checksession"
2017-06-10 16:29:37.212 +00:00 [Debug] Rendering check session result
2017-06-10 16:29:37.212 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.CheckSessionResult"
2017-06-10 16:29:37.212 +00:00 [Information] Request finished in 1.0888ms 200 text/html; charset=UTF-8
2017-06-10 16:29:42.737 +00:00 [Information] Request starting HTTP/1.1 GET http://spaidsrv.org:8081/.well-known/openid-configuration  
2017-06-10 16:29:42.738 +00:00 [Debug] CORS request made for path: "/.well-known/openid-configuration" from origin: "http://spaclient.org:8080"
2017-06-10 16:29:42.738 +00:00 [Debug] Client list checked and origin: "http://spaclient.org:8080" is allowed
2017-06-10 16:29:42.738 +00:00 [Debug] CorsPolicyService allowed origin: "http://spaclient.org:8080"
2017-06-10 16:29:42.738 +00:00 [Debug] Request path "/.well-known/openid-configuration" matched to endpoint type Discovery
2017-06-10 16:29:42.738 +00:00 [Debug] Mapping found for endpoint: Discovery, creating handler: "IdentityServer4.Endpoints.DiscoveryEndpoint"
2017-06-10 16:29:42.738 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.DiscoveryEndpoint" for "/.well-known/openid-configuration"
2017-06-10 16:29:42.738 +00:00 [Verbose] Processing discovery request.
2017-06-10 16:29:42.738 +00:00 [Debug] Start discovery request
2017-06-10 16:29:42.738 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.DiscoveryDocumentResult"
2017-06-10 16:29:42.738 +00:00 [Information] Request finished in 1.0567ms 200 application/json
2017-06-10 16:29:42.755 +00:00 [Information] Request starting HTTP/1.1 GET http://spaidsrv.org:8081/connect/checksession  
2017-06-10 16:29:42.755 +00:00 [Information] HttpContext.User merged via AutomaticAuthentication from authenticationScheme: "idsrv".
2017-06-10 16:29:42.755 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 16:29:42.755 +00:00 [Debug] Request path "/connect/checksession" matched to endpoint type CheckSession
2017-06-10 16:29:42.756 +00:00 [Debug] Mapping found for endpoint: CheckSession, creating handler: "IdentityServer4.Endpoints.CheckSessionEndpoint"
2017-06-10 16:29:42.758 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.CheckSessionEndpoint" for "/connect/checksession"
2017-06-10 16:29:42.760 +00:00 [Debug] Rendering check session result
2017-06-10 16:29:42.760 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.CheckSessionResult"
2017-06-10 16:29:42.760 +00:00 [Information] Request finished in 5.8107ms 200 text/html; charset=UTF-8
2017-06-10 16:36:51.380 +00:00 [Information] You are using the in-memory version of the persisted grant store. This will store consent decisions, authorization codes, refresh and reference tokens in memory only. If you are using any of those features in production, you want to switch to a different store implementation.
2017-06-10 16:36:51.477 +00:00 [Debug] Using built-in CookieAuthentication middleware with scheme: "idsrv"
2017-06-10 16:36:51.482 +00:00 [Debug] Adding CookieAuthentication middleware for external authentication with scheme: "idsrv.external"
2017-06-10 16:36:51.780 +00:00 [Information] User profile is available. Using '"/root/.aspnet/DataProtection-Keys"' as key repository; keys will not be encrypted at rest.
2017-06-10 16:36:56.741 +00:00 [Information] Request starting HTTP/1.1 GET http://spaidsrv.org:8081/.well-known/openid-configuration  
2017-06-10 16:36:56.764 +00:00 [Debug] CORS request made for path: "/.well-known/openid-configuration" from origin: "http://spaclient.org:8080"
2017-06-10 16:36:56.771 +00:00 [Debug] Client list checked and origin: "http://spaclient.org:8080" is allowed
2017-06-10 16:36:56.771 +00:00 [Debug] CorsPolicyService allowed origin: "http://spaclient.org:8080"
2017-06-10 16:36:56.834 +00:00 [Debug] Request path "/.well-known/openid-configuration" matched to endpoint type Discovery
2017-06-10 16:36:56.838 +00:00 [Debug] Mapping found for endpoint: Discovery, creating handler: "IdentityServer4.Endpoints.DiscoveryEndpoint"
2017-06-10 16:36:56.850 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.DiscoveryEndpoint" for "/.well-known/openid-configuration"
2017-06-10 16:36:56.856 +00:00 [Verbose] Processing discovery request.
2017-06-10 16:36:56.863 +00:00 [Debug] Start discovery request
2017-06-10 16:36:56.898 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.DiscoveryDocumentResult"
2017-06-10 16:36:57.025 +00:00 [Information] Request finished in 292.9136ms 200 application/json
2017-06-10 16:36:57.040 +00:00 [Information] Request starting HTTP/1.1 GET http://spaidsrv.org:8081/connect/checksession  
2017-06-10 16:36:57.086 +00:00 [Information] HttpContext.User merged via AutomaticAuthentication from authenticationScheme: "idsrv".
2017-06-10 16:36:57.087 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 16:36:57.090 +00:00 [Debug] Request path "/connect/checksession" matched to endpoint type CheckSession
2017-06-10 16:36:57.091 +00:00 [Debug] Mapping found for endpoint: CheckSession, creating handler: "IdentityServer4.Endpoints.CheckSessionEndpoint"
2017-06-10 16:36:57.093 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.CheckSessionEndpoint" for "/connect/checksession"
2017-06-10 16:36:57.095 +00:00 [Debug] Rendering check session result
2017-06-10 16:36:57.096 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.CheckSessionResult"
2017-06-10 16:36:57.108 +00:00 [Information] Request finished in 67.7056ms 200 text/html; charset=UTF-8
2017-06-10 16:36:58.118 +00:00 [Information] Request starting HTTP/1.1 GET http://spaidsrv.org:8081/connect/authorize?client_id=http%3A%2F%2Fspaclient.org%3A8080&redirect_uri=http%3A%2F%2Fspaclient.org%3A8080%2Fcallback.html&response_type=id_token%20token&scope=openid%20profile%20productapi&state=d6a78bb2afd44cfaaf49ccc6601f9077&nonce=1fa3108fde1941c0922df0f20cb392db  
2017-06-10 16:36:58.119 +00:00 [Information] HttpContext.User merged via AutomaticAuthentication from authenticationScheme: "idsrv".
2017-06-10 16:36:58.120 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 16:36:58.123 +00:00 [Debug] Request path "/connect/authorize" matched to endpoint type Authorize
2017-06-10 16:36:58.124 +00:00 [Debug] Mapping found for endpoint: Authorize, creating handler: "IdentityServer4.Endpoints.AuthorizeEndpoint"
2017-06-10 16:36:58.130 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.AuthorizeEndpoint" for "/connect/authorize"
2017-06-10 16:36:58.140 +00:00 [Debug] Start authorize request
2017-06-10 16:36:58.176 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 16:36:58.186 +00:00 [Debug] User in authorize request: "2"
2017-06-10 16:36:58.192 +00:00 [Debug] Start authorize request protocol validation
2017-06-10 16:36:58.239 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 16:36:58.239 +00:00 [Debug] Calling into custom validator: "IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator"
2017-06-10 16:36:58.240 +00:00 [Verbose] Authorize request protocol validation successful
2017-06-10 16:36:58.263 +00:00 [Information] ValidatedAuthorizeRequest
"{
  \"ClientId\": \"http://spaclient.org:8080\",
  \"ClientName\": \"SPAClient\",
  \"RedirectUri\": \"http://spaclient.org:8080/callback.html\",
  \"AllowedRedirectUris\": [
    \"http://spaclient.org:8080/callback.html\"
  ],
  \"SubjectId\": \"2\",
  \"ResponseType\": \"id_token token\",
  \"ResponseMode\": \"fragment\",
  \"GrantType\": \"implicit\",
  \"RequestedScopes\": \"openid profile productapi\",
  \"State\": \"d6a78bb2afd44cfaaf49ccc6601f9077\",
  \"Nonce\": \"1fa3108fde1941c0922df0f20cb392db\",
  \"SessionId\": \"fc9a457dc4545d23fe4181b3fb0956d2\",
  \"Raw\": {
    \"client_id\": \"http://spaclient.org:8080\",
    \"redirect_uri\": \"http://spaclient.org:8080/callback.html\",
    \"response_type\": \"id_token token\",
    \"scope\": \"openid profile productapi\",
    \"state\": \"d6a78bb2afd44cfaaf49ccc6601f9077\",
    \"nonce\": \"1fa3108fde1941c0922df0f20cb392db\"
  }
}"
2017-06-10 16:36:58.270 +00:00 [Verbose] ProcessInteractionAsync
2017-06-10 16:36:58.295 +00:00 [Debug] "user_consent" grant with value: "http://spaclient.org:8080|2" not found in store.
2017-06-10 16:36:58.295 +00:00 [Information] Showing consent: User has not yet consented
2017-06-10 16:36:58.296 +00:00 [Verbose] End authorize request. result type: "IdentityServer4.Endpoints.Results.ConsentPageResult"
2017-06-10 16:36:58.296 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.ConsentPageResult"
2017-06-10 16:36:58.312 +00:00 [Information] Request finished in 193.9722ms 302 
2017-06-10 16:36:58.319 +00:00 [Information] Request starting HTTP/1.1 GET http://spaidsrv.org:8081/consent?returnUrl=%2Fconnect%2Fauthorize%2Fconsent%3Fclient_id%3Dhttp%253A%252F%252Fspaclient.org%253A8080%26redirect_uri%3Dhttp%253A%252F%252Fspaclient.org%253A8080%252Fcallback.html%26response_type%3Did_token%2520token%26scope%3Dopenid%2520profile%2520productapi%26state%3Dd6a78bb2afd44cfaaf49ccc6601f9077%26nonce%3D1fa3108fde1941c0922df0f20cb392db  
2017-06-10 16:36:58.320 +00:00 [Information] HttpContext.User merged via AutomaticAuthentication from authenticationScheme: "idsrv".
2017-06-10 16:36:58.320 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 16:36:58.320 +00:00 [Verbose] No endpoint entry found for request path: "/consent"
2017-06-10 16:36:58.579 +00:00 [Information] Executing action method "IdentityServer4.Quickstart.UI.ConsentController.Index (SpaIdSrv)" with arguments (["/connect/authorize/consent?client_id=http%3A%2F%2Fspaclient.org%3A8080&redirect_uri=http%3A%2F%2Fspaclient.org%3A8080%2Fcallback.html&response_type=id_token%20token&scope=openid%20profile%20productapi&state=d6a78bb2afd44cfaaf49ccc6601f9077&nonce=1fa3108fde1941c0922df0f20cb392db"]) - ModelState is Valid
2017-06-10 16:36:58.596 +00:00 [Verbose] returnUrl is valid
2017-06-10 16:36:58.600 +00:00 [Verbose] returnUrl is valid
2017-06-10 16:36:58.603 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 16:36:58.603 +00:00 [Debug] Start authorize request protocol validation
2017-06-10 16:36:58.605 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 16:36:58.605 +00:00 [Debug] Calling into custom validator: "IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator"
2017-06-10 16:36:58.605 +00:00 [Verbose] Authorize request protocol validation successful
2017-06-10 16:36:58.606 +00:00 [Verbose] AuthorizationRequest being returned
2017-06-10 16:36:58.609 +00:00 [Verbose] AuthorizationRequest being returned
2017-06-10 16:37:03.663 +00:00 [Information] Executing ViewResult, running view at path "/Views/Consent/Index.cshtml".
2017-06-10 16:37:04.092 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 16:37:04.123 +00:00 [Information] Executed action "IdentityServer4.Quickstart.UI.ConsentController.Index (SpaIdSrv)" in 5641.4793ms
2017-06-10 16:37:04.130 +00:00 [Information] Request finished in 5810.5764ms 200 text/html; charset=utf-8
2017-06-10 16:37:06.162 +00:00 [Information] Request starting HTTP/1.1 POST http://spaidsrv.org:8081/consent application/x-www-form-urlencoded 675
2017-06-10 16:37:06.163 +00:00 [Information] HttpContext.User merged via AutomaticAuthentication from authenticationScheme: "idsrv".
2017-06-10 16:37:06.163 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 16:37:06.163 +00:00 [Verbose] No endpoint entry found for request path: "/consent"
2017-06-10 16:37:06.205 +00:00 [Information] Executing action method "IdentityServer4.Quickstart.UI.ConsentController.Index (SpaIdSrv)" with arguments (["IdentityServer4.Quickstart.UI.ConsentInputModel"]) - ModelState is Valid
2017-06-10 16:37:06.212 +00:00 [Verbose] returnUrl is valid
2017-06-10 16:37:06.213 +00:00 [Verbose] returnUrl is valid
2017-06-10 16:37:06.214 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 16:37:06.214 +00:00 [Debug] Start authorize request protocol validation
2017-06-10 16:37:06.214 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 16:37:06.214 +00:00 [Debug] Calling into custom validator: "IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator"
2017-06-10 16:37:06.214 +00:00 [Verbose] Authorize request protocol validation successful
2017-06-10 16:37:06.214 +00:00 [Verbose] AuthorizationRequest being returned
2017-06-10 16:37:06.214 +00:00 [Verbose] AuthorizationRequest being returned
2017-06-10 16:37:06.220 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 16:37:06.236 +00:00 [Verbose] Protecting message: "{\"Created\":636327094262269340,\"Data\":{\"Granted\":true,\"ScopesConsented\":[\"openid\",\"profile\",\"productapi\"]}}"
2017-06-10 16:37:06.240 +00:00 [Information] Executing RedirectResult, redirecting to "/connect/authorize/consent?client_id=http%3A%2F%2Fspaclient.org%3A8080&redirect_uri=http%3A%2F%2Fspaclient.org%3A8080%2Fcallback.html&response_type=id_token%20token&scope=openid%20profile%20productapi&state=d6a78bb2afd44cfaaf49ccc6601f9077&nonce=1fa3108fde1941c0922df0f20cb392db".
2017-06-10 16:37:06.241 +00:00 [Information] Executed action "IdentityServer4.Quickstart.UI.ConsentController.Index (SpaIdSrv)" in 73.3522ms
2017-06-10 16:37:06.242 +00:00 [Information] Request finished in 79.4955ms 302 
2017-06-10 16:37:06.247 +00:00 [Information] Request starting HTTP/1.1 GET http://spaidsrv.org:8081/connect/authorize/consent?client_id=http%3A%2F%2Fspaclient.org%3A8080&redirect_uri=http%3A%2F%2Fspaclient.org%3A8080%2Fcallback.html&response_type=id_token%20token&scope=openid%20profile%20productapi&state=d6a78bb2afd44cfaaf49ccc6601f9077&nonce=1fa3108fde1941c0922df0f20cb392db  
2017-06-10 16:37:06.248 +00:00 [Information] HttpContext.User merged via AutomaticAuthentication from authenticationScheme: "idsrv".
2017-06-10 16:37:06.248 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 16:37:06.249 +00:00 [Debug] Request path "/connect/authorize/consent" matched to endpoint type Authorize
2017-06-10 16:37:06.249 +00:00 [Debug] Mapping found for endpoint: Authorize, creating handler: "IdentityServer4.Endpoints.AuthorizeEndpoint"
2017-06-10 16:37:06.250 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.AuthorizeEndpoint" for "/connect/authorize/consent"
2017-06-10 16:37:06.265 +00:00 [Debug] Start authorize request (after consent)
2017-06-10 16:37:06.265 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 16:37:06.278 +00:00 [Debug] User in authorize request: "2"
2017-06-10 16:37:06.279 +00:00 [Debug] Start authorize request protocol validation
2017-06-10 16:37:06.281 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 16:37:06.281 +00:00 [Debug] Calling into custom validator: "IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator"
2017-06-10 16:37:06.282 +00:00 [Verbose] Authorize request protocol validation successful
2017-06-10 16:37:06.283 +00:00 [Information] ValidatedAuthorizeRequest
"{
  \"ClientId\": \"http://spaclient.org:8080\",
  \"ClientName\": \"SPAClient\",
  \"RedirectUri\": \"http://spaclient.org:8080/callback.html\",
  \"AllowedRedirectUris\": [
    \"http://spaclient.org:8080/callback.html\"
  ],
  \"SubjectId\": \"2\",
  \"ResponseType\": \"id_token token\",
  \"ResponseMode\": \"fragment\",
  \"GrantType\": \"implicit\",
  \"RequestedScopes\": \"openid profile productapi\",
  \"State\": \"d6a78bb2afd44cfaaf49ccc6601f9077\",
  \"Nonce\": \"1fa3108fde1941c0922df0f20cb392db\",
  \"SessionId\": \"fc9a457dc4545d23fe4181b3fb0956d2\",
  \"Raw\": {
    \"client_id\": \"http://spaclient.org:8080\",
    \"redirect_uri\": \"http://spaclient.org:8080/callback.html\",
    \"response_type\": \"id_token token\",
    \"scope\": \"openid profile productapi\",
    \"state\": \"d6a78bb2afd44cfaaf49ccc6601f9077\",
    \"nonce\": \"1fa3108fde1941c0922df0f20cb392db\"
  }
}"
2017-06-10 16:37:06.284 +00:00 [Verbose] ProcessInteractionAsync
2017-06-10 16:37:06.286 +00:00 [Debug] "user_consent" grant with value: "http://spaclient.org:8080|2" not found in store.
2017-06-10 16:37:06.286 +00:00 [Verbose] Consent was shown to user
2017-06-10 16:37:06.299 +00:00 [Information] User consented to scopes: ["openid", "profile", "productapi"]
2017-06-10 16:37:06.325 +00:00 [Debug] Creating Implicit Flow response.
2017-06-10 16:37:06.331 +00:00 [Verbose] Creating access token
2017-06-10 16:37:06.338 +00:00 [Debug] Getting claims for access token for client: "http://spaclient.org:8080"
2017-06-10 16:37:06.338 +00:00 [Debug] Getting claims for access token for subject: "2"
2017-06-10 16:37:06.346 +00:00 [Debug] Get profile called for subject "2" from client "SPAClient" with claim types [] via "ClaimsProviderAccessToken"
2017-06-10 16:37:06.352 +00:00 [Verbose] Creating JWT access token
2017-06-10 16:37:06.629 +00:00 [Verbose] Creating identity token
2017-06-10 16:37:06.635 +00:00 [Debug] Getting claims for identity token for subject: "2" and client: "http://spaclient.org:8080"
2017-06-10 16:37:06.635 +00:00 [Debug] In addition to an id_token, an access_token was requested. No claims other than sub are included in the id_token. To obtain more user claims, either use the user info endpoint or set AlwaysIncludeUserClaimsInIdToken on the client configuration.
2017-06-10 16:37:06.638 +00:00 [Verbose] Creating JWT identity token
2017-06-10 16:37:06.645 +00:00 [Verbose] Identity token issued for "http://spaclient.org:8080 (SPAClient)" / "2": "eyJhbGciOiJSUzI1NiIsImtpZCI6IjhiYWY1ZjE0NDg0ZDM3N2UxM2Y0ZmE2NTFmYjI5ZDcyIiwidHlwIjoiSldUIn0.eyJuYmYiOjE0OTcxMTI2MjYsImV4cCI6MTQ5NzExMjkyNiwiaXNzIjoiaHR0cDovL3NwYWlkc3J2Lm9yZzo4MDgxIiwiYXVkIjoiaHR0cDovL3NwYWNsaWVudC5vcmc6ODA4MCIsIm5vbmNlIjoiMWZhMzEwOGZkZTE5NDFjMDkyMmRmMGYyMGNiMzkyZGIiLCJpYXQiOjE0OTcxMTI2MjYsImF0X2hhc2giOiJZYzZwUU5IclJTQng1bnY2bEtSRUFnIiwic2lkIjoiZmM5YTQ1N2RjNDU0NWQyM2ZlNDE4MWIzZmIwOTU2ZDIiLCJzdWIiOiIyIiwiYXV0aF90aW1lIjoxNDk3MTExODQwLCJpZHAiOiJsb2NhbCIsImFtciI6WyJwd2QiXX0.z-FcderL7Y6NnalCyUQt9WAt27eKcqAjJ57_A9D7HlqhpfP1SLc1dR3so-gcV7FECN2t1RUNBNZyzGXorpaQvvDpiSp6IBoJFZX5VEsLf-N2hMiYG4LHkOg6O2wO47XtgynZlj5hM5xVo0zKwebbZDlCnvaTvZVjITTEb8mDykcmHxun7wUuivOlPVCcGqzz8kRF4n1tdbUOTwnbqI-gcm7SoSHPKj6uk2H1o-8lVLs7UqqHI1nXuMeELjFF4xO4nh-0q8ULV2x80NT3Q06Q7TMYj7rFbH8O_oPcgCId_f9TUnc6paYyCI-Ig5XHvnWzj1yeDhCqDDLqfZpVvjk-qQ"
2017-06-10 16:37:06.645 +00:00 [Verbose] Access token issued for "http://spaclient.org:8080 (SPAClient)" / "2": "eyJhbGciOiJSUzI1NiIsImtpZCI6IjhiYWY1ZjE0NDg0ZDM3N2UxM2Y0ZmE2NTFmYjI5ZDcyIiwidHlwIjoiSldUIn0.eyJuYmYiOjE0OTcxMTI2MjYsImV4cCI6MTQ5NzExNjIyNiwiaXNzIjoiaHR0cDovL3NwYWlkc3J2Lm9yZzo4MDgxIiwiYXVkIjpbImh0dHA6Ly9zcGFpZHNydi5vcmc6ODA4MS9yZXNvdXJjZXMiLCJwcm9kdWN0YXBpIl0sImNsaWVudF9pZCI6Imh0dHA6Ly9zcGFjbGllbnQub3JnOjgwODAiLCJzdWIiOiIyIiwiYXV0aF90aW1lIjoxNDk3MTExODQwLCJpZHAiOiJsb2NhbCIsInNjb3BlIjpbIm9wZW5pZCIsInByb2ZpbGUiLCJwcm9kdWN0YXBpIl0sImFtciI6WyJwd2QiXX0.TI9AYyp0FkbW8uKxj6d20jmChA9BiHIm39At-LKZ_yJ8AuVE-xJNiiNPNy-_3NEOxOvprkgRdCqzcHvuTQVjZng0lq7f253oFqs4tBhTiWcFo6x4ywuRtnUuHgUxpRswzyRCqQ3dFGk551wIhgsq3BCg64Jtj1Gm2GOG6eTxRIAF0YLrW_bH41GgMFR5cmfGtmXm5XWdV7cL5wXY5wyKMdYZFSixMiC1krr64qtvYCrDzFwmUVVf42KtsNpyQjeDZTyyAuyEy9fTCtzdilcq5RFTpxfQ4NYVm8bu7l20cbEKpKilimcEcVG4DlJP4Dn9CTG5FvOVl3NTWxOR2onAnQ"
2017-06-10 16:37:06.659 +00:00 [Information] Authorize endpoint response
"{
  \"SubjectId\": \"2\",
  \"ClientId\": \"http://spaclient.org:8080\",
  \"RedirectUri\": \"http://spaclient.org:8080/callback.html\",
  \"State\": \"d6a78bb2afd44cfaaf49ccc6601f9077\",
  \"Scope\": \"openid profile productapi\"
}"
2017-06-10 16:37:06.659 +00:00 [Verbose] End Authorize Request. Result type: "IdentityServer4.Endpoints.Results.AuthorizeResult"
2017-06-10 16:37:06.663 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.AuthorizeResult"
2017-06-10 16:37:06.678 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 16:37:06.688 +00:00 [Information] Request finished in 440.5426ms 302 
2017-06-10 16:37:07.041 +00:00 [Information] Request starting HTTP/1.1 GET http://spaidsrv.org:8081/.well-known/openid-configuration  
2017-06-10 16:37:07.041 +00:00 [Debug] CORS request made for path: "/.well-known/openid-configuration" from origin: "http://spaclient.org:8080"
2017-06-10 16:37:07.041 +00:00 [Debug] Client list checked and origin: "http://spaclient.org:8080" is allowed
2017-06-10 16:37:07.041 +00:00 [Debug] CorsPolicyService allowed origin: "http://spaclient.org:8080"
2017-06-10 16:37:07.042 +00:00 [Debug] Request path "/.well-known/openid-configuration" matched to endpoint type Discovery
2017-06-10 16:37:07.042 +00:00 [Debug] Mapping found for endpoint: Discovery, creating handler: "IdentityServer4.Endpoints.DiscoveryEndpoint"
2017-06-10 16:37:07.042 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.DiscoveryEndpoint" for "/.well-known/openid-configuration"
2017-06-10 16:37:07.042 +00:00 [Verbose] Processing discovery request.
2017-06-10 16:37:07.042 +00:00 [Debug] Start discovery request
2017-06-10 16:37:07.043 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.DiscoveryDocumentResult"
2017-06-10 16:37:07.043 +00:00 [Information] Request finished in 2.4299ms 200 application/json
2017-06-10 16:37:07.089 +00:00 [Information] Request starting HTTP/1.1 GET http://spaidsrv.org:8081/.well-known/openid-configuration/jwks  
2017-06-10 16:37:07.090 +00:00 [Debug] CORS request made for path: "/.well-known/openid-configuration/jwks" from origin: "http://spaclient.org:8080"
2017-06-10 16:37:07.090 +00:00 [Debug] Client list checked and origin: "http://spaclient.org:8080" is allowed
2017-06-10 16:37:07.090 +00:00 [Debug] CorsPolicyService allowed origin: "http://spaclient.org:8080"
2017-06-10 16:37:07.091 +00:00 [Debug] Request path "/.well-known/openid-configuration/jwks" matched to endpoint type Discovery
2017-06-10 16:37:07.093 +00:00 [Debug] Mapping found for endpoint: Discovery, creating handler: "IdentityServer4.Endpoints.DiscoveryEndpoint"
2017-06-10 16:37:07.094 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.DiscoveryEndpoint" for "/.well-known/openid-configuration/jwks"
2017-06-10 16:37:07.094 +00:00 [Verbose] Processing discovery request.
2017-06-10 16:37:07.111 +00:00 [Debug] Start key discovery request
2017-06-10 16:37:07.128 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.JsonWebKeysResult"
2017-06-10 16:37:07.140 +00:00 [Information] Request finished in 51.3864ms 200 application/json
2017-06-10 16:37:07.165 +00:00 [Information] Request starting HTTP/1.1 OPTIONS http://spaidsrv.org:8081/connect/userinfo  
2017-06-10 16:37:07.165 +00:00 [Debug] CORS request made for path: "/connect/userinfo" from origin: "http://spaclient.org:8080"
2017-06-10 16:37:07.165 +00:00 [Debug] Client list checked and origin: "http://spaclient.org:8080" is allowed
2017-06-10 16:37:07.165 +00:00 [Debug] CorsPolicyService allowed origin: "http://spaclient.org:8080"
2017-06-10 16:37:07.167 +00:00 [Information] Request finished in 2.7784ms 204 
2017-06-10 16:37:07.172 +00:00 [Information] Request starting HTTP/1.1 GET http://spaidsrv.org:8081/connect/userinfo  
2017-06-10 16:37:07.172 +00:00 [Debug] CORS request made for path: "/connect/userinfo" from origin: "http://spaclient.org:8080"
2017-06-10 16:37:07.173 +00:00 [Debug] Client list checked and origin: "http://spaclient.org:8080" is allowed
2017-06-10 16:37:07.173 +00:00 [Debug] CorsPolicyService allowed origin: "http://spaclient.org:8080"
2017-06-10 16:37:07.173 +00:00 [Debug] Request path "/connect/userinfo" matched to endpoint type UserInfo
2017-06-10 16:37:07.173 +00:00 [Debug] Mapping found for endpoint: UserInfo, creating handler: "IdentityServer4.Endpoints.UserInfoEndpoint"
2017-06-10 16:37:07.175 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.UserInfoEndpoint" for "/connect/userinfo"
2017-06-10 16:37:07.188 +00:00 [Debug] Start userinfo request
2017-06-10 16:37:07.193 +00:00 [Information] ValidateAsync: Locating bearer token
2017-06-10 16:37:07.202 +00:00 [Verbose] Authorization header value found
2017-06-10 16:37:07.202 +00:00 [Verbose] Authorization scheme is bearer
2017-06-10 16:37:07.202 +00:00 [Debug] Bearer token found in header
2017-06-10 16:37:07.203 +00:00 [Debug] Token found: "AuthorizationHeader"
2017-06-10 16:37:07.209 +00:00 [Verbose] Start access token validation
2017-06-10 16:37:07.273 +00:00 [Debug] Token validation success
"{
  \"ValidateLifetime\": true,
  \"AccessTokenType\": \"Jwt\",
  \"ExpectedScope\": \"openid\",
  \"Claims\": {
    \"nbf\": 1497112626,
    \"exp\": 1497116226,
    \"iss\": \"http://spaidsrv.org:8081\",
    \"aud\": [
      \"http://spaidsrv.org:8081/resources\",
      \"productapi\"
    ],
    \"client_id\": \"http://spaclient.org:8080\",
    \"sub\": \"2\",
    \"auth_time\": 1497111840,
    \"idp\": \"local\",
    \"scope\": [
      \"openid\",
      \"profile\",
      \"productapi\"
    ],
    \"amr\": \"pwd\"
  }
}"
2017-06-10 16:37:07.286 +00:00 [Verbose] Creating userinfo response
2017-06-10 16:37:07.292 +00:00 [Debug] Scopes in access token: "openid profile productapi"
2017-06-10 16:37:07.297 +00:00 [Debug] Requested claim types: "sub name family_name given_name middle_name nickname preferred_username profile picture website gender birthdate zoneinfo locale updated_at"
2017-06-10 16:37:07.297 +00:00 [Debug] Get profile called for subject "2" from client "SPAClient" with claim types ["sub", "name", "family_name", "given_name", "middle_name", "nickname", "preferred_username", "profile", "picture", "website", "gender", "birthdate", "zoneinfo", "locale", "updated_at"] via "UserInfoEndpoint"
2017-06-10 16:37:07.300 +00:00 [Information] Profile service returned to the following claim types: ""
2017-06-10 16:37:07.300 +00:00 [Debug] End userinfo request
2017-06-10 16:37:07.300 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.UserInfoResult"
2017-06-10 16:37:07.304 +00:00 [Information] Request finished in 131.3233ms 200 application/json
2017-06-10 16:37:07.312 +00:00 [Information] Request starting HTTP/1.1 GET http://spaidsrv.org:8081/connect/checksession  
2017-06-10 16:37:07.314 +00:00 [Information] HttpContext.User merged via AutomaticAuthentication from authenticationScheme: "idsrv".
2017-06-10 16:37:07.316 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 16:37:07.317 +00:00 [Debug] Request path "/connect/checksession" matched to endpoint type CheckSession
2017-06-10 16:37:07.317 +00:00 [Debug] Mapping found for endpoint: CheckSession, creating handler: "IdentityServer4.Endpoints.CheckSessionEndpoint"
2017-06-10 16:37:07.318 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.CheckSessionEndpoint" for "/connect/checksession"
2017-06-10 16:37:07.320 +00:00 [Debug] Rendering check session result
2017-06-10 16:37:07.320 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.CheckSessionResult"
2017-06-10 16:37:07.322 +00:00 [Information] Request finished in 9.586ms 200 text/html; charset=UTF-8
2017-06-10 16:37:07.715 +00:00 [Information] Request starting HTTP/1.1 GET http://spaidsrv.org:8081/.well-known/openid-configuration  
2017-06-10 16:37:07.715 +00:00 [Debug] CORS request made for path: "/.well-known/openid-configuration" from origin: "http://spaclient.org:8080"
2017-06-10 16:37:07.715 +00:00 [Debug] Client list checked and origin: "http://spaclient.org:8080" is allowed
2017-06-10 16:37:07.716 +00:00 [Debug] CorsPolicyService allowed origin: "http://spaclient.org:8080"
2017-06-10 16:37:07.716 +00:00 [Debug] Request path "/.well-known/openid-configuration" matched to endpoint type Discovery
2017-06-10 16:37:07.716 +00:00 [Debug] Mapping found for endpoint: Discovery, creating handler: "IdentityServer4.Endpoints.DiscoveryEndpoint"
2017-06-10 16:37:07.717 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.DiscoveryEndpoint" for "/.well-known/openid-configuration"
2017-06-10 16:37:07.721 +00:00 [Verbose] Processing discovery request.
2017-06-10 16:37:07.722 +00:00 [Debug] Start discovery request
2017-06-10 16:37:07.723 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.DiscoveryDocumentResult"
2017-06-10 16:37:07.723 +00:00 [Information] Request finished in 8.5122ms 200 application/json
2017-06-10 16:37:07.746 +00:00 [Information] Request starting HTTP/1.1 GET http://spaidsrv.org:8081/connect/checksession  
2017-06-10 16:37:07.747 +00:00 [Information] HttpContext.User merged via AutomaticAuthentication from authenticationScheme: "idsrv".
2017-06-10 16:37:07.747 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 16:37:07.747 +00:00 [Debug] Request path "/connect/checksession" matched to endpoint type CheckSession
2017-06-10 16:37:07.747 +00:00 [Debug] Mapping found for endpoint: CheckSession, creating handler: "IdentityServer4.Endpoints.CheckSessionEndpoint"
2017-06-10 16:37:07.747 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.CheckSessionEndpoint" for "/connect/checksession"
2017-06-10 16:37:07.747 +00:00 [Debug] Rendering check session result
2017-06-10 16:37:07.747 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.CheckSessionResult"
2017-06-10 16:37:07.747 +00:00 [Information] Request finished in 0.9882ms 200 text/html; charset=UTF-8
2017-06-10 16:37:22.204 +00:00 [Information] Request starting HTTP/1.1 GET http://spaidsrv.org:8081/.well-known/openid-configuration  
2017-06-10 16:37:22.204 +00:00 [Debug] Request path "/.well-known/openid-configuration" matched to endpoint type Discovery
2017-06-10 16:37:22.204 +00:00 [Debug] Mapping found for endpoint: Discovery, creating handler: "IdentityServer4.Endpoints.DiscoveryEndpoint"
2017-06-10 16:37:22.205 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.DiscoveryEndpoint" for "/.well-known/openid-configuration"
2017-06-10 16:37:22.205 +00:00 [Verbose] Processing discovery request.
2017-06-10 16:37:22.206 +00:00 [Debug] Start discovery request
2017-06-10 16:37:22.206 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.DiscoveryDocumentResult"
2017-06-10 16:37:22.207 +00:00 [Information] Request finished in 3.7928ms 200 application/json
2017-06-10 16:37:22.400 +00:00 [Information] Request starting HTTP/1.1 GET http://spaidsrv.org:8081/.well-known/openid-configuration/jwks  
2017-06-10 16:37:22.401 +00:00 [Debug] Request path "/.well-known/openid-configuration/jwks" matched to endpoint type Discovery
2017-06-10 16:37:22.403 +00:00 [Debug] Mapping found for endpoint: Discovery, creating handler: "IdentityServer4.Endpoints.DiscoveryEndpoint"
2017-06-10 16:37:22.403 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.DiscoveryEndpoint" for "/.well-known/openid-configuration/jwks"
2017-06-10 16:37:22.404 +00:00 [Verbose] Processing discovery request.
2017-06-10 16:37:22.404 +00:00 [Debug] Start key discovery request
2017-06-10 16:37:22.405 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.JsonWebKeysResult"
2017-06-10 16:37:22.407 +00:00 [Information] Request finished in 6.0492ms 200 application/json
2017-06-10 16:39:36.178 +00:00 [Information] You are using the in-memory version of the persisted grant store. This will store consent decisions, authorization codes, refresh and reference tokens in memory only. If you are using any of those features in production, you want to switch to a different store implementation.
2017-06-10 16:39:36.241 +00:00 [Debug] Using built-in CookieAuthentication middleware with scheme: "idsrv"
2017-06-10 16:39:36.246 +00:00 [Debug] Adding CookieAuthentication middleware for external authentication with scheme: "idsrv.external"
2017-06-10 16:39:36.500 +00:00 [Information] User profile is available. Using '"/root/.aspnet/DataProtection-Keys"' as key repository; keys will not be encrypted at rest.
2017-06-10 16:39:57.642 +00:00 [Information] You are using the in-memory version of the persisted grant store. This will store consent decisions, authorization codes, refresh and reference tokens in memory only. If you are using any of those features in production, you want to switch to a different store implementation.
2017-06-10 16:39:57.696 +00:00 [Debug] Using built-in CookieAuthentication middleware with scheme: "idsrv"
2017-06-10 16:39:57.700 +00:00 [Debug] Adding CookieAuthentication middleware for external authentication with scheme: "idsrv.external"
2017-06-10 16:39:57.877 +00:00 [Information] User profile is available. Using '"/root/.aspnet/DataProtection-Keys"' as key repository; keys will not be encrypted at rest.
2017-06-10 16:39:59.046 +00:00 [Information] Request starting HTTP/1.1 GET http://spaidsrv.org:8081/.well-known/openid-configuration  
2017-06-10 16:39:59.069 +00:00 [Debug] CORS request made for path: "/.well-known/openid-configuration" from origin: "http://spaclient.org:8080"
2017-06-10 16:39:59.074 +00:00 [Debug] Client list checked and origin: "http://spaclient.org:8080" is allowed
2017-06-10 16:39:59.074 +00:00 [Debug] CorsPolicyService allowed origin: "http://spaclient.org:8080"
2017-06-10 16:39:59.130 +00:00 [Debug] Request path "/.well-known/openid-configuration" matched to endpoint type Discovery
2017-06-10 16:39:59.133 +00:00 [Debug] Mapping found for endpoint: Discovery, creating handler: "IdentityServer4.Endpoints.DiscoveryEndpoint"
2017-06-10 16:39:59.137 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.DiscoveryEndpoint" for "/.well-known/openid-configuration"
2017-06-10 16:39:59.139 +00:00 [Verbose] Processing discovery request.
2017-06-10 16:39:59.143 +00:00 [Debug] Start discovery request
2017-06-10 16:39:59.173 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.DiscoveryDocumentResult"
2017-06-10 16:39:59.298 +00:00 [Information] Request finished in 257.6682ms 200 application/json
2017-06-10 16:39:59.317 +00:00 [Information] Request starting HTTP/1.1 GET http://spaidsrv.org:8081/connect/checksession  
2017-06-10 16:39:59.369 +00:00 [Information] HttpContext.User merged via AutomaticAuthentication from authenticationScheme: "idsrv".
2017-06-10 16:39:59.371 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 16:39:59.376 +00:00 [Debug] Request path "/connect/checksession" matched to endpoint type CheckSession
2017-06-10 16:39:59.376 +00:00 [Debug] Mapping found for endpoint: CheckSession, creating handler: "IdentityServer4.Endpoints.CheckSessionEndpoint"
2017-06-10 16:39:59.378 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.CheckSessionEndpoint" for "/connect/checksession"
2017-06-10 16:39:59.382 +00:00 [Debug] Rendering check session result
2017-06-10 16:39:59.382 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.CheckSessionResult"
2017-06-10 16:39:59.393 +00:00 [Information] Request finished in 76.2826ms 200 text/html; charset=UTF-8
2017-06-10 16:40:02.937 +00:00 [Information] Request starting HTTP/1.1 GET http://spaidsrv.org:8081/.well-known/openid-configuration  
2017-06-10 16:40:02.937 +00:00 [Debug] Request path "/.well-known/openid-configuration" matched to endpoint type Discovery
2017-06-10 16:40:02.937 +00:00 [Debug] Mapping found for endpoint: Discovery, creating handler: "IdentityServer4.Endpoints.DiscoveryEndpoint"
2017-06-10 16:40:02.937 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.DiscoveryEndpoint" for "/.well-known/openid-configuration"
2017-06-10 16:40:02.939 +00:00 [Verbose] Processing discovery request.
2017-06-10 16:40:02.939 +00:00 [Debug] Start discovery request
2017-06-10 16:40:02.940 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.DiscoveryDocumentResult"
2017-06-10 16:40:02.941 +00:00 [Information] Request finished in 3.6244ms 200 application/json
2017-06-10 16:40:03.108 +00:00 [Information] Request starting HTTP/1.1 GET http://spaidsrv.org:8081/.well-known/openid-configuration/jwks  
2017-06-10 16:40:03.109 +00:00 [Debug] Request path "/.well-known/openid-configuration/jwks" matched to endpoint type Discovery
2017-06-10 16:40:03.109 +00:00 [Debug] Mapping found for endpoint: Discovery, creating handler: "IdentityServer4.Endpoints.DiscoveryEndpoint"
2017-06-10 16:40:03.111 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.DiscoveryEndpoint" for "/.well-known/openid-configuration/jwks"
2017-06-10 16:40:03.111 +00:00 [Verbose] Processing discovery request.
2017-06-10 16:40:03.116 +00:00 [Debug] Start key discovery request
2017-06-10 16:40:03.385 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.JsonWebKeysResult"
2017-06-10 16:40:03.402 +00:00 [Information] Request finished in 292.971ms 200 application/json
2017-06-10 16:40:07.348 +00:00 [Information] Request starting HTTP/1.1 GET http://spaidsrv.org:8081/connect/authorize?client_id=http%3A%2F%2Fspaclient.org%3A8080&redirect_uri=http%3A%2F%2Fspaclient.org%3A8080%2Fcallback.html&response_type=id_token%20token&scope=openid%20profile%20productapi&state=417fb4d93568467b91dce7b21646e02b&nonce=efd9cc1ac4d34933868df86247f069f4  
2017-06-10 16:40:07.349 +00:00 [Information] HttpContext.User merged via AutomaticAuthentication from authenticationScheme: "idsrv".
2017-06-10 16:40:07.349 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 16:40:07.349 +00:00 [Debug] Request path "/connect/authorize" matched to endpoint type Authorize
2017-06-10 16:40:07.349 +00:00 [Debug] Mapping found for endpoint: Authorize, creating handler: "IdentityServer4.Endpoints.AuthorizeEndpoint"
2017-06-10 16:40:07.357 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.AuthorizeEndpoint" for "/connect/authorize"
2017-06-10 16:40:07.368 +00:00 [Debug] Start authorize request
2017-06-10 16:40:07.402 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 16:40:07.412 +00:00 [Debug] User in authorize request: "2"
2017-06-10 16:40:07.417 +00:00 [Debug] Start authorize request protocol validation
2017-06-10 16:40:07.462 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 16:40:07.462 +00:00 [Debug] Calling into custom validator: "IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator"
2017-06-10 16:40:07.463 +00:00 [Verbose] Authorize request protocol validation successful
2017-06-10 16:40:07.481 +00:00 [Information] ValidatedAuthorizeRequest
"{
  \"ClientId\": \"http://spaclient.org:8080\",
  \"ClientName\": \"SPAClient\",
  \"RedirectUri\": \"http://spaclient.org:8080/callback.html\",
  \"AllowedRedirectUris\": [
    \"http://spaclient.org:8080/callback.html\"
  ],
  \"SubjectId\": \"2\",
  \"ResponseType\": \"id_token token\",
  \"ResponseMode\": \"fragment\",
  \"GrantType\": \"implicit\",
  \"RequestedScopes\": \"openid profile productapi\",
  \"State\": \"417fb4d93568467b91dce7b21646e02b\",
  \"Nonce\": \"efd9cc1ac4d34933868df86247f069f4\",
  \"SessionId\": \"fc9a457dc4545d23fe4181b3fb0956d2\",
  \"Raw\": {
    \"client_id\": \"http://spaclient.org:8080\",
    \"redirect_uri\": \"http://spaclient.org:8080/callback.html\",
    \"response_type\": \"id_token token\",
    \"scope\": \"openid profile productapi\",
    \"state\": \"417fb4d93568467b91dce7b21646e02b\",
    \"nonce\": \"efd9cc1ac4d34933868df86247f069f4\"
  }
}"
2017-06-10 16:40:07.486 +00:00 [Verbose] ProcessInteractionAsync
2017-06-10 16:40:07.506 +00:00 [Debug] "user_consent" grant with value: "http://spaclient.org:8080|2" not found in store.
2017-06-10 16:40:07.506 +00:00 [Information] Showing consent: User has not yet consented
2017-06-10 16:40:07.506 +00:00 [Verbose] End authorize request. result type: "IdentityServer4.Endpoints.Results.ConsentPageResult"
2017-06-10 16:40:07.506 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.ConsentPageResult"
2017-06-10 16:40:07.520 +00:00 [Information] Request finished in 171.4883ms 302 
2017-06-10 16:40:07.524 +00:00 [Information] Request starting HTTP/1.1 GET http://spaidsrv.org:8081/consent?returnUrl=%2Fconnect%2Fauthorize%2Fconsent%3Fclient_id%3Dhttp%253A%252F%252Fspaclient.org%253A8080%26redirect_uri%3Dhttp%253A%252F%252Fspaclient.org%253A8080%252Fcallback.html%26response_type%3Did_token%2520token%26scope%3Dopenid%2520profile%2520productapi%26state%3D417fb4d93568467b91dce7b21646e02b%26nonce%3Defd9cc1ac4d34933868df86247f069f4  
2017-06-10 16:40:07.525 +00:00 [Information] HttpContext.User merged via AutomaticAuthentication from authenticationScheme: "idsrv".
2017-06-10 16:40:07.525 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 16:40:07.525 +00:00 [Verbose] No endpoint entry found for request path: "/consent"
2017-06-10 16:40:07.774 +00:00 [Information] Executing action method "IdentityServer4.Quickstart.UI.ConsentController.Index (SpaIdSrv)" with arguments (["/connect/authorize/consent?client_id=http%3A%2F%2Fspaclient.org%3A8080&redirect_uri=http%3A%2F%2Fspaclient.org%3A8080%2Fcallback.html&response_type=id_token%20token&scope=openid%20profile%20productapi&state=417fb4d93568467b91dce7b21646e02b&nonce=efd9cc1ac4d34933868df86247f069f4"]) - ModelState is Valid
2017-06-10 16:40:07.791 +00:00 [Verbose] returnUrl is valid
2017-06-10 16:40:07.796 +00:00 [Verbose] returnUrl is valid
2017-06-10 16:40:07.799 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 16:40:07.800 +00:00 [Debug] Start authorize request protocol validation
2017-06-10 16:40:07.802 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 16:40:07.804 +00:00 [Debug] Calling into custom validator: "IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator"
2017-06-10 16:40:07.805 +00:00 [Verbose] Authorize request protocol validation successful
2017-06-10 16:40:07.806 +00:00 [Verbose] AuthorizationRequest being returned
2017-06-10 16:40:07.810 +00:00 [Verbose] AuthorizationRequest being returned
2017-06-10 16:40:12.568 +00:00 [Information] Executing ViewResult, running view at path "/Views/Consent/Index.cshtml".
2017-06-10 16:40:12.949 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 16:40:12.979 +00:00 [Information] Executed action "IdentityServer4.Quickstart.UI.ConsentController.Index (SpaIdSrv)" in 5284.1934ms
2017-06-10 16:40:12.984 +00:00 [Information] Request finished in 5460.2006ms 200 text/html; charset=utf-8
2017-06-10 16:40:15.125 +00:00 [Information] Request starting HTTP/1.1 POST http://spaidsrv.org:8081/consent application/x-www-form-urlencoded 675
2017-06-10 16:40:15.126 +00:00 [Information] HttpContext.User merged via AutomaticAuthentication from authenticationScheme: "idsrv".
2017-06-10 16:40:15.127 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 16:40:15.127 +00:00 [Verbose] No endpoint entry found for request path: "/consent"
2017-06-10 16:40:15.173 +00:00 [Information] Executing action method "IdentityServer4.Quickstart.UI.ConsentController.Index (SpaIdSrv)" with arguments (["IdentityServer4.Quickstart.UI.ConsentInputModel"]) - ModelState is Valid
2017-06-10 16:40:15.179 +00:00 [Verbose] returnUrl is valid
2017-06-10 16:40:15.179 +00:00 [Verbose] returnUrl is valid
2017-06-10 16:40:15.187 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 16:40:15.187 +00:00 [Debug] Start authorize request protocol validation
2017-06-10 16:40:15.188 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 16:40:15.188 +00:00 [Debug] Calling into custom validator: "IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator"
2017-06-10 16:40:15.188 +00:00 [Verbose] Authorize request protocol validation successful
2017-06-10 16:40:15.188 +00:00 [Verbose] AuthorizationRequest being returned
2017-06-10 16:40:15.188 +00:00 [Verbose] AuthorizationRequest being returned
2017-06-10 16:40:15.192 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 16:40:15.208 +00:00 [Verbose] Protecting message: "{\"Created\":636327096151974360,\"Data\":{\"Granted\":true,\"ScopesConsented\":[\"openid\",\"profile\",\"productapi\"]}}"
2017-06-10 16:40:15.213 +00:00 [Information] Executing RedirectResult, redirecting to "/connect/authorize/consent?client_id=http%3A%2F%2Fspaclient.org%3A8080&redirect_uri=http%3A%2F%2Fspaclient.org%3A8080%2Fcallback.html&response_type=id_token%20token&scope=openid%20profile%20productapi&state=417fb4d93568467b91dce7b21646e02b&nonce=efd9cc1ac4d34933868df86247f069f4".
2017-06-10 16:40:15.214 +00:00 [Information] Executed action "IdentityServer4.Quickstart.UI.ConsentController.Index (SpaIdSrv)" in 82.8805ms
2017-06-10 16:40:15.215 +00:00 [Information] Request finished in 90.375ms 302 
2017-06-10 16:40:15.223 +00:00 [Information] Request starting HTTP/1.1 GET http://spaidsrv.org:8081/connect/authorize/consent?client_id=http%3A%2F%2Fspaclient.org%3A8080&redirect_uri=http%3A%2F%2Fspaclient.org%3A8080%2Fcallback.html&response_type=id_token%20token&scope=openid%20profile%20productapi&state=417fb4d93568467b91dce7b21646e02b&nonce=efd9cc1ac4d34933868df86247f069f4  
2017-06-10 16:40:15.229 +00:00 [Information] HttpContext.User merged via AutomaticAuthentication from authenticationScheme: "idsrv".
2017-06-10 16:40:15.229 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 16:40:15.229 +00:00 [Debug] Request path "/connect/authorize/consent" matched to endpoint type Authorize
2017-06-10 16:40:15.230 +00:00 [Debug] Mapping found for endpoint: Authorize, creating handler: "IdentityServer4.Endpoints.AuthorizeEndpoint"
2017-06-10 16:40:15.230 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.AuthorizeEndpoint" for "/connect/authorize/consent"
2017-06-10 16:40:15.246 +00:00 [Debug] Start authorize request (after consent)
2017-06-10 16:40:15.246 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 16:40:15.258 +00:00 [Debug] User in authorize request: "2"
2017-06-10 16:40:15.258 +00:00 [Debug] Start authorize request protocol validation
2017-06-10 16:40:15.265 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 16:40:15.265 +00:00 [Debug] Calling into custom validator: "IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator"
2017-06-10 16:40:15.266 +00:00 [Verbose] Authorize request protocol validation successful
2017-06-10 16:40:15.266 +00:00 [Information] ValidatedAuthorizeRequest
"{
  \"ClientId\": \"http://spaclient.org:8080\",
  \"ClientName\": \"SPAClient\",
  \"RedirectUri\": \"http://spaclient.org:8080/callback.html\",
  \"AllowedRedirectUris\": [
    \"http://spaclient.org:8080/callback.html\"
  ],
  \"SubjectId\": \"2\",
  \"ResponseType\": \"id_token token\",
  \"ResponseMode\": \"fragment\",
  \"GrantType\": \"implicit\",
  \"RequestedScopes\": \"openid profile productapi\",
  \"State\": \"417fb4d93568467b91dce7b21646e02b\",
  \"Nonce\": \"efd9cc1ac4d34933868df86247f069f4\",
  \"SessionId\": \"fc9a457dc4545d23fe4181b3fb0956d2\",
  \"Raw\": {
    \"client_id\": \"http://spaclient.org:8080\",
    \"redirect_uri\": \"http://spaclient.org:8080/callback.html\",
    \"response_type\": \"id_token token\",
    \"scope\": \"openid profile productapi\",
    \"state\": \"417fb4d93568467b91dce7b21646e02b\",
    \"nonce\": \"efd9cc1ac4d34933868df86247f069f4\"
  }
}"
2017-06-10 16:40:15.267 +00:00 [Verbose] ProcessInteractionAsync
2017-06-10 16:40:15.268 +00:00 [Debug] "user_consent" grant with value: "http://spaclient.org:8080|2" not found in store.
2017-06-10 16:40:15.268 +00:00 [Verbose] Consent was shown to user
2017-06-10 16:40:15.283 +00:00 [Information] User consented to scopes: ["openid", "profile", "productapi"]
2017-06-10 16:40:15.306 +00:00 [Debug] Creating Implicit Flow response.
2017-06-10 16:40:15.313 +00:00 [Verbose] Creating access token
2017-06-10 16:40:15.323 +00:00 [Debug] Getting claims for access token for client: "http://spaclient.org:8080"
2017-06-10 16:40:15.326 +00:00 [Debug] Getting claims for access token for subject: "2"
2017-06-10 16:40:15.332 +00:00 [Debug] Get profile called for subject "2" from client "SPAClient" with claim types [] via "ClaimsProviderAccessToken"
2017-06-10 16:40:15.341 +00:00 [Verbose] Creating JWT access token
2017-06-10 16:40:15.438 +00:00 [Verbose] Creating identity token
2017-06-10 16:40:15.443 +00:00 [Debug] Getting claims for identity token for subject: "2" and client: "http://spaclient.org:8080"
2017-06-10 16:40:15.444 +00:00 [Debug] In addition to an id_token, an access_token was requested. No claims other than sub are included in the id_token. To obtain more user claims, either use the user info endpoint or set AlwaysIncludeUserClaimsInIdToken on the client configuration.
2017-06-10 16:40:15.447 +00:00 [Verbose] Creating JWT identity token
2017-06-10 16:40:15.453 +00:00 [Verbose] Identity token issued for "http://spaclient.org:8080 (SPAClient)" / "2": "eyJhbGciOiJSUzI1NiIsImtpZCI6ImMxZDZjZDFhMjU4ZWExODJhNWQ4ODUyZGQ1MDdmM2YzIiwidHlwIjoiSldUIn0.eyJuYmYiOjE0OTcxMTI4MTUsImV4cCI6MTQ5NzExMzExNSwiaXNzIjoiaHR0cDovL3NwYWlkc3J2Lm9yZzo4MDgxIiwiYXVkIjoiaHR0cDovL3NwYWNsaWVudC5vcmc6ODA4MCIsIm5vbmNlIjoiZWZkOWNjMWFjNGQzNDkzMzg2OGRmODYyNDdmMDY5ZjQiLCJpYXQiOjE0OTcxMTI4MTUsImF0X2hhc2giOiJvbVF0SG1GWThpcV9PSktHWktwTWpBIiwic2lkIjoiZmM5YTQ1N2RjNDU0NWQyM2ZlNDE4MWIzZmIwOTU2ZDIiLCJzdWIiOiIyIiwiYXV0aF90aW1lIjoxNDk3MTExODQwLCJpZHAiOiJsb2NhbCIsImFtciI6WyJwd2QiXX0.I3-HtCKeih_B74X-lZmCeI68MOsbeIumdcJaHNt1fmfCIa2FkQdaHKbY4DJEjT9RPoiIsgqOwLwCvWb_PVMMSXTvj3gvMVIQ6Junhx9h9sq8sh6FNsEWVwJvqhOq7sTQKtFXH3PQZ8jz7RkpTwVm6l85Fj08mygWSK3Z-o0kyEe2bmmh00UyY4qO9DWe4g4cwFrN86DYKU2nf7rUGNk843EKRQI-qcMlgv-9k01IFlaCp3flLp54yCxrU3xZB0qLoQibiMbG2RXX6Wsxll9zjNjFYXNLAHYwV6j1-xlnPMK9Yy3tbIz8gx2l5paw9q43DC6KtePUgS4wPcW-CYs2oQ"
2017-06-10 16:40:15.454 +00:00 [Verbose] Access token issued for "http://spaclient.org:8080 (SPAClient)" / "2": "eyJhbGciOiJSUzI1NiIsImtpZCI6ImMxZDZjZDFhMjU4ZWExODJhNWQ4ODUyZGQ1MDdmM2YzIiwidHlwIjoiSldUIn0.eyJuYmYiOjE0OTcxMTI4MTUsImV4cCI6MTQ5NzExNjQxNSwiaXNzIjoiaHR0cDovL3NwYWlkc3J2Lm9yZzo4MDgxIiwiYXVkIjpbImh0dHA6Ly9zcGFpZHNydi5vcmc6ODA4MS9yZXNvdXJjZXMiLCJwcm9kdWN0YXBpIl0sImNsaWVudF9pZCI6Imh0dHA6Ly9zcGFjbGllbnQub3JnOjgwODAiLCJzdWIiOiIyIiwiYXV0aF90aW1lIjoxNDk3MTExODQwLCJpZHAiOiJsb2NhbCIsInNjb3BlIjpbIm9wZW5pZCIsInByb2ZpbGUiLCJwcm9kdWN0YXBpIl0sImFtciI6WyJwd2QiXX0.tpUAzTjOilwKcyAEHbeKTDCaG22EfMj6hrdGcMtpevP7RGmaoJZ9jnVQ_wdPWOJNIVVRNBBYSkKPaGu_u_EDzMHzzWR2ERf1vmR4gPCWhQ8piT-8-Ik8dxVgIyaAQ0ohj_zByaMzhi5qiYg9bRH2h9wEfz8GwD_DjDuZJsTyHaR2kxjuF0EjwQeV1wmxx8wd-CCTLLuQoCnKUjwTnWQTV0CboXxpUPXbSG5T3Qoa6bfwLG7nUKaW1iDEPxqj3f5lsnimkmAq5gTxrs77xA8PMRHH_V7PRvc_MxHGE_5HuX2AOue3oM6tAOacmUnbbX2H7Db4tnXdbN0iUQZZZkJAUA"
2017-06-10 16:40:15.468 +00:00 [Information] Authorize endpoint response
"{
  \"SubjectId\": \"2\",
  \"ClientId\": \"http://spaclient.org:8080\",
  \"RedirectUri\": \"http://spaclient.org:8080/callback.html\",
  \"State\": \"417fb4d93568467b91dce7b21646e02b\",
  \"Scope\": \"openid profile productapi\"
}"
2017-06-10 16:40:15.470 +00:00 [Verbose] End Authorize Request. Result type: "IdentityServer4.Endpoints.Results.AuthorizeResult"
2017-06-10 16:40:15.474 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.AuthorizeResult"
2017-06-10 16:40:15.487 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 16:40:15.495 +00:00 [Information] Request finished in 271.8127ms 302 
2017-06-10 16:40:15.823 +00:00 [Information] Request starting HTTP/1.1 GET http://spaidsrv.org:8081/.well-known/openid-configuration  
2017-06-10 16:40:15.823 +00:00 [Debug] CORS request made for path: "/.well-known/openid-configuration" from origin: "http://spaclient.org:8080"
2017-06-10 16:40:15.823 +00:00 [Debug] Client list checked and origin: "http://spaclient.org:8080" is allowed
2017-06-10 16:40:15.823 +00:00 [Debug] CorsPolicyService allowed origin: "http://spaclient.org:8080"
2017-06-10 16:40:15.824 +00:00 [Debug] Request path "/.well-known/openid-configuration" matched to endpoint type Discovery
2017-06-10 16:40:15.824 +00:00 [Debug] Mapping found for endpoint: Discovery, creating handler: "IdentityServer4.Endpoints.DiscoveryEndpoint"
2017-06-10 16:40:15.824 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.DiscoveryEndpoint" for "/.well-known/openid-configuration"
2017-06-10 16:40:15.824 +00:00 [Verbose] Processing discovery request.
2017-06-10 16:40:15.824 +00:00 [Debug] Start discovery request
2017-06-10 16:40:15.824 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.DiscoveryDocumentResult"
2017-06-10 16:40:15.825 +00:00 [Information] Request finished in 2.1105ms 200 application/json
2017-06-10 16:40:15.875 +00:00 [Information] Request starting HTTP/1.1 GET http://spaidsrv.org:8081/.well-known/openid-configuration/jwks  
2017-06-10 16:40:15.875 +00:00 [Debug] CORS request made for path: "/.well-known/openid-configuration/jwks" from origin: "http://spaclient.org:8080"
2017-06-10 16:40:15.876 +00:00 [Debug] Client list checked and origin: "http://spaclient.org:8080" is allowed
2017-06-10 16:40:15.876 +00:00 [Debug] CorsPolicyService allowed origin: "http://spaclient.org:8080"
2017-06-10 16:40:15.877 +00:00 [Debug] Request path "/.well-known/openid-configuration/jwks" matched to endpoint type Discovery
2017-06-10 16:40:15.877 +00:00 [Debug] Mapping found for endpoint: Discovery, creating handler: "IdentityServer4.Endpoints.DiscoveryEndpoint"
2017-06-10 16:40:15.877 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.DiscoveryEndpoint" for "/.well-known/openid-configuration/jwks"
2017-06-10 16:40:15.878 +00:00 [Verbose] Processing discovery request.
2017-06-10 16:40:15.878 +00:00 [Debug] Start key discovery request
2017-06-10 16:40:15.878 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.JsonWebKeysResult"
2017-06-10 16:40:15.878 +00:00 [Information] Request finished in 3.5107ms 200 application/json
2017-06-10 16:40:15.914 +00:00 [Information] Request starting HTTP/1.1 OPTIONS http://spaidsrv.org:8081/connect/userinfo  
2017-06-10 16:40:15.914 +00:00 [Debug] CORS request made for path: "/connect/userinfo" from origin: "http://spaclient.org:8080"
2017-06-10 16:40:15.914 +00:00 [Debug] Client list checked and origin: "http://spaclient.org:8080" is allowed
2017-06-10 16:40:15.915 +00:00 [Debug] CorsPolicyService allowed origin: "http://spaclient.org:8080"
2017-06-10 16:40:15.918 +00:00 [Information] Request finished in 4.2527ms 204 
2017-06-10 16:40:15.923 +00:00 [Information] Request starting HTTP/1.1 GET http://spaidsrv.org:8081/connect/userinfo  
2017-06-10 16:40:15.923 +00:00 [Debug] CORS request made for path: "/connect/userinfo" from origin: "http://spaclient.org:8080"
2017-06-10 16:40:15.923 +00:00 [Debug] Client list checked and origin: "http://spaclient.org:8080" is allowed
2017-06-10 16:40:15.923 +00:00 [Debug] CorsPolicyService allowed origin: "http://spaclient.org:8080"
2017-06-10 16:40:15.925 +00:00 [Debug] Request path "/connect/userinfo" matched to endpoint type UserInfo
2017-06-10 16:40:15.926 +00:00 [Debug] Mapping found for endpoint: UserInfo, creating handler: "IdentityServer4.Endpoints.UserInfoEndpoint"
2017-06-10 16:40:15.932 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.UserInfoEndpoint" for "/connect/userinfo"
2017-06-10 16:40:15.939 +00:00 [Debug] Start userinfo request
2017-06-10 16:40:15.944 +00:00 [Information] ValidateAsync: Locating bearer token
2017-06-10 16:40:15.946 +00:00 [Verbose] Authorization header value found
2017-06-10 16:40:15.946 +00:00 [Verbose] Authorization scheme is bearer
2017-06-10 16:40:15.946 +00:00 [Debug] Bearer token found in header
2017-06-10 16:40:15.947 +00:00 [Debug] Token found: "AuthorizationHeader"
2017-06-10 16:40:15.955 +00:00 [Verbose] Start access token validation
2017-06-10 16:40:16.024 +00:00 [Debug] Token validation success
"{
  \"ValidateLifetime\": true,
  \"AccessTokenType\": \"Jwt\",
  \"ExpectedScope\": \"openid\",
  \"Claims\": {
    \"nbf\": 1497112815,
    \"exp\": 1497116415,
    \"iss\": \"http://spaidsrv.org:8081\",
    \"aud\": [
      \"http://spaidsrv.org:8081/resources\",
      \"productapi\"
    ],
    \"client_id\": \"http://spaclient.org:8080\",
    \"sub\": \"2\",
    \"auth_time\": 1497111840,
    \"idp\": \"local\",
    \"scope\": [
      \"openid\",
      \"profile\",
      \"productapi\"
    ],
    \"amr\": \"pwd\"
  }
}"
2017-06-10 16:40:16.033 +00:00 [Verbose] Creating userinfo response
2017-06-10 16:40:16.038 +00:00 [Debug] Scopes in access token: "openid profile productapi"
2017-06-10 16:40:16.042 +00:00 [Debug] Requested claim types: "sub name family_name given_name middle_name nickname preferred_username profile picture website gender birthdate zoneinfo locale updated_at"
2017-06-10 16:40:16.043 +00:00 [Debug] Get profile called for subject "2" from client "SPAClient" with claim types ["sub", "name", "family_name", "given_name", "middle_name", "nickname", "preferred_username", "profile", "picture", "website", "gender", "birthdate", "zoneinfo", "locale", "updated_at"] via "UserInfoEndpoint"
2017-06-10 16:40:16.045 +00:00 [Information] Profile service returned to the following claim types: ""
2017-06-10 16:40:16.045 +00:00 [Debug] End userinfo request
2017-06-10 16:40:16.045 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.UserInfoResult"
2017-06-10 16:40:16.051 +00:00 [Information] Request finished in 128.4381ms 200 application/json
2017-06-10 16:40:16.058 +00:00 [Information] Request starting HTTP/1.1 GET http://spaidsrv.org:8081/connect/checksession  
2017-06-10 16:40:16.060 +00:00 [Information] HttpContext.User merged via AutomaticAuthentication from authenticationScheme: "idsrv".
2017-06-10 16:40:16.060 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 16:40:16.061 +00:00 [Debug] Request path "/connect/checksession" matched to endpoint type CheckSession
2017-06-10 16:40:16.062 +00:00 [Debug] Mapping found for endpoint: CheckSession, creating handler: "IdentityServer4.Endpoints.CheckSessionEndpoint"
2017-06-10 16:40:16.062 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.CheckSessionEndpoint" for "/connect/checksession"
2017-06-10 16:40:16.063 +00:00 [Debug] Rendering check session result
2017-06-10 16:40:16.064 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.CheckSessionResult"
2017-06-10 16:40:16.065 +00:00 [Information] Request finished in 7.0533ms 200 text/html; charset=UTF-8
2017-06-10 16:40:16.396 +00:00 [Information] Request starting HTTP/1.1 GET http://spaidsrv.org:8081/.well-known/openid-configuration  
2017-06-10 16:40:16.397 +00:00 [Debug] CORS request made for path: "/.well-known/openid-configuration" from origin: "http://spaclient.org:8080"
2017-06-10 16:40:16.397 +00:00 [Debug] Client list checked and origin: "http://spaclient.org:8080" is allowed
2017-06-10 16:40:16.397 +00:00 [Debug] CorsPolicyService allowed origin: "http://spaclient.org:8080"
2017-06-10 16:40:16.397 +00:00 [Debug] Request path "/.well-known/openid-configuration" matched to endpoint type Discovery
2017-06-10 16:40:16.398 +00:00 [Debug] Mapping found for endpoint: Discovery, creating handler: "IdentityServer4.Endpoints.DiscoveryEndpoint"
2017-06-10 16:40:16.398 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.DiscoveryEndpoint" for "/.well-known/openid-configuration"
2017-06-10 16:40:16.398 +00:00 [Verbose] Processing discovery request.
2017-06-10 16:40:16.399 +00:00 [Debug] Start discovery request
2017-06-10 16:40:16.399 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.DiscoveryDocumentResult"
2017-06-10 16:40:16.400 +00:00 [Information] Request finished in 4.1363ms 200 application/json
2017-06-10 16:40:16.432 +00:00 [Information] Request starting HTTP/1.1 GET http://spaidsrv.org:8081/connect/checksession  
2017-06-10 16:40:16.433 +00:00 [Information] HttpContext.User merged via AutomaticAuthentication from authenticationScheme: "idsrv".
2017-06-10 16:40:16.433 +00:00 [Information] AuthenticationScheme: "idsrv" was successfully authenticated.
2017-06-10 16:40:16.434 +00:00 [Debug] Request path "/connect/checksession" matched to endpoint type CheckSession
2017-06-10 16:40:16.434 +00:00 [Debug] Mapping found for endpoint: CheckSession, creating handler: "IdentityServer4.Endpoints.CheckSessionEndpoint"
2017-06-10 16:40:16.435 +00:00 [Information] Invoking IdentityServer endpoint: "IdentityServer4.Endpoints.CheckSessionEndpoint" for "/connect/checksession"
2017-06-10 16:40:16.435 +00:00 [Debug] Rendering check session result
2017-06-10 16:40:16.436 +00:00 [Verbose] Invoking result: "IdentityServer4.Endpoints.Results.CheckSessionResult"
2017-06-10 16:40:16.439 +00:00 [Information] Request finished in 7.3429ms 200 text/html; charset=UTF-8
2017-06-14 17:57:57.320 +00:00 [Information] You are using the in-memory version of the persisted grant store. This will store consent decisions, authorization codes, refresh and reference tokens in memory only. If you are using any of those features in production, you want to switch to a different store implementation.
2017-06-14 17:57:57.370 +00:00 [Debug] Using built-in CookieAuthentication middleware with scheme: "idsrv"
2017-06-14 17:57:57.373 +00:00 [Debug] Adding CookieAuthentication middleware for external authentication with scheme: "idsrv.external"
2017-06-14 17:57:57.770 +00:00 [Information] User profile is available. Using '"/root/.aspnet/DataProtection-Keys"' as key repository; keys will not be encrypted at rest.
2017-06-14 19:29:46.683 +00:00 [Information] You are using the in-memory version of the persisted grant store. This will store consent decisions, authorization codes, refresh and reference tokens in memory only. If you are using any of those features in production, you want to switch to a different store implementation.
2017-06-14 19:29:46.751 +00:00 [Debug] Using built-in CookieAuthentication middleware with scheme: "idsrv"
2017-06-14 19:29:46.754 +00:00 [Debug] Adding CookieAuthentication middleware for external authentication with scheme: "idsrv.external"
2017-06-14 19:29:46.971 +00:00 [Information] User profile is available. Using '"/root/.aspnet/DataProtection-Keys"' as key repository; keys will not be encrypted at rest.
